{"version":3,"file":"azure-communicationservices-signaling.js","sources":["../../../common/temp/node_modules/.pnpm/@skype+tsregistrar@2024.14.0-1.56-h89a1c/node_modules/@skype/tsregistrar/lib/webpack:/webpack/universalModuleDefinition","../../../common/temp/node_modules/.pnpm/@skype+tsregistrar@2024.14.0-1.56-h89a1c/node_modules/@skype/tsregistrar/lib/webpack:/webpack/bootstrap 6b13a4ac2afc10e0dd9d","../../../common/temp/node_modules/.pnpm/@skype+tsregistrar@2024.14.0-1.56-h89a1c/node_modules/@skype/tsregistrar/lib/webpack:/tsregistrar.js","../../../common/temp/node_modules/.pnpm/@skype+tsregistrar@2024.14.0-1.56-h89a1c/node_modules/@skype/tsregistrar/lib/webpack:/lib_temp/Common.ts","../../../common/temp/node_modules/.pnpm/@skype+tsregistrar@2024.14.0-1.56-h89a1c/node_modules/@skype/tsregistrar/lib/webpack:/lib_temp/RegistrarClient.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/webpack/universalModuleDefinition","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/webpack/bootstrap b8d066f6f21edf895ca2","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/tstrouter.js","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/Logger.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/Constants.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/Interfaces.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/Common.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/InternalInterfaces.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/ProtocolAdapters.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TrouterFsm.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TrouterConnection.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/MessageHandler.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/SkypeTokenProviderWithCache.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TrouterManager.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TrouterUrlPromise.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/socket.io.js","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/(webpack)/buildin/global.js","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/(webpack)/buildin/module.js","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/ConnectionTracker.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/DisconnectReason.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/ExponentialBackoff.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/RegistrationEnforcer.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TrouterManagerFsm.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/lib_temp/TsTrouter.ts","../../../common/temp/node_modules/.pnpm/@skype+tstrouter@2024.14.0-1.56-h89a1c/node_modules/@skype/tstrouter/lib/webpack:/external \"@skype/tsregistrar\"","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/rng.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/regex.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/validate.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/stringify.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v1.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/parse.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v35.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/md5.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v3.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v4.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/sha1.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/v5.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/nil.js","../../../common/temp/node_modules/.pnpm/uuid@8.3.2/node_modules/uuid/dist/esm-browser/version.js","../../../common/temp/node_modules/.pnpm/@azure+abort-controller@2.1.2/node_modules/@azure/abort-controller/src/AbortError.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/createAbortablePromise.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/delay.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/aborterUtils.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/random.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/object.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/error.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/sha256.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/typeGuards.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/uuidUtils.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/checkEnvironment.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/bytesEncoding.ts","../../../common/temp/node_modules/.pnpm/@azure+core-util@1.9.1/node_modules/@azure/core-util/src/index.ts","../dist-esm/src/constants.js","../dist-esm/src/TrouterUtils.js","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/base64-browser.mts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/interfaces.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/utils.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/serializer.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/pipeline.ts","../../../common/temp/node_modules/.pnpm/@azure+logger@1.1.3/node_modules/@azure/logger/src/log.ts","../../../common/temp/node_modules/.pnpm/@azure+logger@1.1.3/node_modules/@azure/logger/src/debug.ts","../../../common/temp/node_modules/.pnpm/@azure+logger@1.1.3/node_modules/@azure/logger/src/index.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/log.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/sanitizer.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/logPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/redirectPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/userAgentPlatform.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/constants.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/userAgent.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/userAgentPolicy.ts","../../../common/temp/node_modules/.pnpm/tslib@2.6.3/node_modules/tslib/tslib.es6.js","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/typeGuards.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/file.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/concat.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/multipartPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/decompressResponsePolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/helpers.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/retryStrategies/throttlingRetryStrategy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/retryStrategies/exponentialRetryStrategy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/retryPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/defaultRetryPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/httpHeaders.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/formDataPolicy.ts","../../../common/temp/node_modules/.pnpm/ms@2.1.2/node_modules/ms/index.js","../../../common/temp/node_modules/.pnpm/debug@4.3.6_supports-color@8.1.1/node_modules/debug/src/common.js","../../../common/temp/node_modules/.pnpm/debug@4.3.6_supports-color@8.1.1/node_modules/debug/src/browser.js","../../../common/temp/node_modules/.pnpm/agent-base@7.1.1/node_modules/agent-base/src/helpers.ts","../../../common/temp/node_modules/.pnpm/agent-base@7.1.1/node_modules/agent-base/src/index.ts","../../../common/temp/node_modules/.pnpm/https-proxy-agent@7.0.5/node_modules/https-proxy-agent/src/parse-proxy-response.ts","../../../common/temp/node_modules/.pnpm/https-proxy-agent@7.0.5/node_modules/https-proxy-agent/src/index.ts","../../../common/temp/node_modules/.pnpm/events@3.3.0/node_modules/events/events.js","../../../common/temp/node_modules/.pnpm/http-proxy-agent@7.0.2/node_modules/http-proxy-agent/src/index.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/proxyPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/setClientRequestIdPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/tlsPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-tracing@1.1.2/node_modules/@azure/core-tracing/src/tracingContext.ts","../../../common/temp/node_modules/.pnpm/@azure+core-tracing@1.1.2/node_modules/@azure/core-tracing/src/state-browser.mts","../../../common/temp/node_modules/.pnpm/@azure+core-tracing@1.1.2/node_modules/@azure/core-tracing/src/instrumenter.ts","../../../common/temp/node_modules/.pnpm/@azure+core-tracing@1.1.2/node_modules/@azure/core-tracing/src/tracingClient.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/inspect.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/restError.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/tracingPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/createPipelineFromOptions.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/nodeHttpClient.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/defaultHttpClient.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/pipelineRequest.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/exponentialRetryPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/systemErrorRetryPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/throttlingRetryPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/util/tokenCycler.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/bearerTokenAuthenticationPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/ndJsonPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/policies/auxiliaryAuthenticationHeaderPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-rest-pipeline@1.17.0/node_modules/@azure/core-rest-pipeline/src/index.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/state-browser.mts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/operationHelpers.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/deserializationPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/interfaceHelpers.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/serializationPolicy.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/pipeline.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/httpClientCache.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/urlHelpers.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/log.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/serviceClient.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/authorizeRequestOnClaimChallenge.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/authorizeRequestOnTenantChallenge.ts","../../../common/temp/node_modules/.pnpm/@azure+core-client@1.9.2/node_modules/@azure/core-client/src/index.ts","../dist-esm/src/TrouterConfigClient.js","../dist-esm/src/TrouterSettings.js","../dist-esm/src/SignalingClient.js","../dist-esm/src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@skype/tsregistrar\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@skype/tsregistrar\"] = factory();\n\telse\n\t\troot[\"@skype/tsregistrar\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6b13a4ac2afc10e0dd9d","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@skype/tsregistrar\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@skype/tsregistrar\"] = factory();\n\telse\n\t\troot[\"@skype/tsregistrar\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Timespan = exports.toJson = exports.fetchWithTimeout = void 0;\n/** Wrapper to send request with specified timeout */\nfunction fetchWithTimeout(request, timeoutMs) {\n    var timeoutId;\n    var fetchPromise = new Promise(function (resolve, reject) {\n        fetch(request).then(function (response) {\n            if (timeoutId !== undefined) {\n                clearTimeout(timeoutId);\n            }\n            resolve(response);\n        }).catch(function (error) {\n            if (timeoutId !== undefined) {\n                clearTimeout(timeoutId);\n            }\n            reject(error);\n        });\n    });\n    if (timeoutMs !== 0) {\n        var timeoutPromise = new Promise(function (resolve, reject) {\n            timeoutId = setTimeout(reject, timeoutMs, new Error(\"Fetch for '\".concat(request.url, \"' timed out\")));\n        });\n        return Promise.race([fetchPromise, timeoutPromise]);\n    }\n    return fetchPromise;\n}\nexports.fetchWithTimeout = fetchWithTimeout;\nfunction toJson(obj) {\n    try {\n        return JSON.stringify(obj);\n    }\n    catch (error) {\n        return \"Unable to serialize object of type \".concat(typeof obj);\n    }\n}\nexports.toJson = toJson;\n/**\n * Simplify calculation of time intervals\n */\nvar Timespan = /** @class */ (function () {\n    function Timespan() {\n        this.start = Date.now();\n    }\n    Object.defineProperty(Timespan.prototype, \"duration\", {\n        /**\n         * Returns number of milliseconds from start\n         */\n        get: function () {\n            return Date.now() - this.start;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Timespan.prototype, \"startTime\", {\n        /**\n         * Returns start time\n         */\n        get: function () {\n            return this.start;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Reset start of interval to current timestamp\n     */\n    Timespan.prototype.reset = function () {\n        this.start = Date.now();\n    };\n    return Timespan;\n}());\nexports.Timespan = Timespan;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createRegistrarClient = exports.RegistrarClient = void 0;\nvar Common_1 = __webpack_require__(0);\nvar SUPPORTED_TOKEN_TYPES = ['skype', 'aad', 'cae'];\n/**\n * Thrown when retry process was cancelled\n */\nvar CancelationError = /** @class */ (function (_super) {\n    __extends(CancelationError, _super);\n    function CancelationError(message) {\n        var _this = _super.call(this, message) || this;\n        _this.name = 'CancelationError';\n        return _this;\n    }\n    return CancelationError;\n}(Error));\n/**\n * Randomized exponential delay used for retries\n */\nvar ExponentialDelay = /** @class */ (function () {\n    function ExponentialDelay(logger, maxBackoffInMs, initialDelay) {\n        this.logger = logger;\n        this.maxBackoffInMs = maxBackoffInMs;\n        this.initialDelay = initialDelay;\n        this.backoffCount = 0;\n        this.id = ++ExponentialDelay.idCounter;\n    }\n    ExponentialDelay.prototype.delay = function (taskName) {\n        var _this = this;\n        if (this.timerHandle !== undefined) {\n            throw new Error('Retry sequence logical failure');\n        }\n        if (this.backoffCount === -1) {\n            return new Promise(function (resolve, reject) { reject(new CancelationError('Cancelled')); });\n        }\n        var backoffMs = this.calculateNextBackoffMs();\n        this.backoffCount++;\n        this.logger.info(\"[RegistrarClient] Backing off \".concat(taskName, \" for \").concat(backoffMs, \" milliseconds with ID \").concat(this.id));\n        return new Promise(function (resolve, reject) {\n            _this.cancelFunc = reject;\n            _this.timerHandle = setTimeout(function () {\n                _this.logger.info(\"[RegistrarClient] Back off for \".concat(taskName, \" with ID \").concat(_this.id, \" complete\"));\n                _this.timerHandle = undefined;\n                resolve();\n            }, backoffMs);\n        });\n    };\n    ExponentialDelay.prototype.cancel = function () {\n        if (this.timerHandle !== undefined) {\n            this.logger.debug('Resetting back off');\n            clearTimeout(this.timerHandle);\n            if (this.cancelFunc !== undefined) {\n                this.cancelFunc(new CancelationError('Cancelled'));\n            }\n        }\n        this.backoffCount = -1;\n    };\n    ExponentialDelay.prototype.calculateNextBackoffMs = function () {\n        var fudge = 1 + (Math.random() - 0.5) * 0.4; // +/- 20%\n        var backoff = this.initialDelay * Math.pow(2, this.backoffCount) * fudge;\n        backoff = Math.round(backoff);\n        return Math.min(this.maxBackoffInMs, backoff);\n    };\n    ExponentialDelay.idCounter = 0;\n    return ExponentialDelay;\n}());\n/**\n * Registrar client implementation\n */\nvar RegistrarClient = /** @class */ (function () {\n    function RegistrarClient(logger, tokenProvider, options) {\n        var _a;\n        this.logger = logger;\n        this.tokenProvider = tokenProvider;\n        this.options = options;\n        this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN = 15;\n        // Default value for maximum backoff between retries\n        this.DEFAULT_MAX_BACKOFF_TIME_IN_MS = 300000; // 5 minutes\n        this.backoffs = {};\n        this.maxBackOffTime =\n            this.options.maxRetryDelayMs > 0\n                ? this.options.maxRetryDelayMs\n                : this.DEFAULT_MAX_BACKOFF_TIME_IN_MS;\n        this.maxRetriesForGetToken =\n            options.maxRetriesForGetToken === undefined ||\n                options.maxRetriesForGetToken === null\n                ? this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN\n                : options.maxRetriesForGetToken;\n        this.proxyUrlRewrite = (_a = options.proxyUrlRewrite) !== null && _a !== void 0 ? _a : (function (url) { return url; });\n    }\n    RegistrarClient.prototype.setTelemetryLogger = function (eventLogger) {\n        this.eventLogger = eventLogger;\n    };\n    RegistrarClient.prototype.register = function (client, transports) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.performRegistration(client, transports, 'pr_set_registration')];\n                    case 1:\n                        _a.sent();\n                        this.cachedRegistrationParams = [client, transports];\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.unregister = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var unregisterRequest;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.logger.info('[RegistrarClient] sending unregister request');\n                        unregisterRequest = new Request(this.proxyUrlRewrite(\"\".concat(this.options.registrarUrl, \"/\").concat(this.options.registrationId)), {\n                            method: 'DELETE',\n                            mode: 'cors',\n                            headers: new Headers(__assign(__assign({}, this.options.extraRegistrationHeaders), { accept: 'application/json, text/javascript' }))\n                        });\n                        return [4 /*yield*/, this.callRegistrar(unregisterRequest, 'pr_delete_registration')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.cancelPendingRequests = function () {\n        var _this = this;\n        Object.keys(this.backoffs).forEach(function (id) {\n            _this.backoffs[id].cancel();\n        });\n        this.backoffs = {};\n    };\n    RegistrarClient.prototype.resendRegistration = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.cachedRegistrationParams) {\n                            throw new Error('Re-registration failed because there is no registration parameters cached');\n                        }\n                        return [4 /*yield*/, this.performRegistration(this.cachedRegistrationParams[0], this.cachedRegistrationParams[1], 'pr_resend_registration')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.performRegistration = function (client, transports, eventName) {\n        return __awaiter(this, void 0, void 0, function () {\n            var payload, registerRequest;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.logger.info('[RegistrarClient] Sending register request');\n                        payload = {\n                            clientDescription: client,\n                            registrationId: this.options.registrationId,\n                            nodeId: '',\n                            transports: transports\n                        };\n                        registerRequest = new Request(this.proxyUrlRewrite(this.options.registrarUrl), {\n                            method: 'POST',\n                            mode: 'cors',\n                            headers: new Headers(__assign(__assign({}, this.options.extraRegistrationHeaders), { 'content-type': 'application/json', accept: 'application/json, text/javascript' })),\n                            body: (0, Common_1.toJson)(payload)\n                        });\n                        return [4 /*yield*/, this.callRegistrar(registerRequest, eventName)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.startBackoff = function () {\n        var backoff = new ExponentialDelay(this.logger, this.maxBackOffTime, this.options.initialRetryDelayMs);\n        this.backoffs[backoff.id] = backoff;\n        return backoff;\n    };\n    RegistrarClient.prototype.stopBackoff = function (backoff) {\n        backoff.cancel();\n        delete this.backoffs[backoff.id];\n    };\n    RegistrarClient.prototype.getToken = function (claimsChallenge) {\n        return __awaiter(this, void 0, void 0, function () {\n            var backoff, retryCount, token, error_1, stringfiedError, err, cancelError_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        backoff = this.startBackoff();\n                        retryCount = 0;\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 8]);\n                        this.logger.info('[RegistrarClient] Asking for a new token');\n                        return [4 /*yield*/, this.tokenProvider({\n                                needFresh: true,\n                                supportedTokenTypes: SUPPORTED_TOKEN_TYPES,\n                                wwwAuthenticateHeader: claimsChallenge,\n                                purpose: 'registrar'\n                            })];\n                    case 2:\n                        token = _a.sent();\n                        this.stopBackoff(backoff);\n                        return [2 /*return*/, token];\n                    case 3:\n                        error_1 = _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        _a.trys.push([4, 6, , 7]);\n                        retryCount++;\n                        stringfiedError = JSON.stringify(error_1);\n                        if (retryCount > this.maxRetriesForGetToken) {\n                            err = \"[RegistrarClient] getToken retry limit hit. Will not retry now. Error: \".concat(stringfiedError);\n                            this.logger.error(err);\n                            this.stopBackoff(backoff);\n                            return [2 /*return*/, Promise.reject(err)];\n                        }\n                        this.logger.warn(\"[RegistrarClient] Retrying for a new token. Retry Count: \".concat(retryCount, \" Error: \").concat(stringfiedError));\n                        return [4 /*yield*/, backoff.delay('Fetching a new token')];\n                    case 5:\n                        _a.sent();\n                        return [3 /*break*/, 8];\n                    case 6:\n                        cancelError_1 = _a.sent();\n                        this.stopBackoff(backoff);\n                        throw cancelError_1;\n                    case 7: return [3 /*break*/, 8];\n                    case 8: return [3 /*break*/, 1];\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.callRegistrar = function (request, eventName) {\n        var _a, _b, _c;\n        return __awaiter(this, void 0, void 0, function () {\n            var backoff, cachedToken, stopwatch, retryCount, response, req, err, claimsChallenge, _d, _e, error_2, canceledError_1, details, _f, _g, error_3, message;\n            return __generator(this, function (_h) {\n                switch (_h.label) {\n                    case 0:\n                        backoff = this.startBackoff();\n                        return [4 /*yield*/, this.tokenProvider({\n                                needFresh: false,\n                                supportedTokenTypes: SUPPORTED_TOKEN_TYPES,\n                                wwwAuthenticateHeader: undefined,\n                                purpose: 'registrar'\n                            })];\n                    case 1:\n                        cachedToken = _h.sent();\n                        this.setTokenHeader(request, cachedToken);\n                        stopwatch = new Common_1.Timespan();\n                        retryCount = 0;\n                        _h.label = 2;\n                    case 2:\n                        response = void 0;\n                        _h.label = 3;\n                    case 3:\n                        _h.trys.push([3, 10, 15, 16]);\n                        req = request.clone();\n                        return [4 /*yield*/, (0, Common_1.fetchWithTimeout)(req, this.options.requestTimeoutMs)];\n                    case 4:\n                        response = _h.sent();\n                        if (!(response.status === 401)) return [3 /*break*/, 8];\n                        retryCount++;\n                        if (retryCount > this.maxRetriesForGetToken) {\n                            err = \"[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '\".concat(request.url, \"' failed with \").concat(response.status, \" \").concat(response.statusText);\n                            this.logger.error(err);\n                            this.stopBackoff(backoff);\n                            return [2 /*return*/, Promise.reject(err)];\n                        }\n                        this.logger.warn(\"[RegistrarClient] Retry Count \".concat(retryCount, \". Request '\").concat(request.url, \"' failed with \").concat(response.status, \" \").concat(response.statusText));\n                        claimsChallenge = (_b = (_a = response.headers) === null || _a === void 0 ? void 0 : _a.get('www-authenticate')) !== null && _b !== void 0 ? _b : undefined;\n                        _d = this.setTokenHeader;\n                        _e = [request];\n                        return [4 /*yield*/, this.getToken(claimsChallenge)];\n                    case 5:\n                        _d.apply(this, _e.concat([_h.sent()]));\n                        if (!(retryCount > 1)) return [3 /*break*/, 7];\n                        // for later retries, e.g. with token revocation, wait until SEAL knows the token was revoked,\n                        // so that proper claims challenges are sent, see https://skype.visualstudio.com/SCC/_workitems/edit/3337904/\n                        return [4 /*yield*/, backoff.delay('Registrar call retry after 401')];\n                    case 6:\n                        // for later retries, e.g. with token revocation, wait until SEAL knows the token was revoked,\n                        // so that proper claims challenges are sent, see https://skype.visualstudio.com/SCC/_workitems/edit/3337904/\n                        _h.sent();\n                        _h.label = 7;\n                    case 7: return [3 /*break*/, 22];\n                    case 8:\n                        if (response.status >= 500 && response.status < 600) {\n                            // throw and retry after in the catch section\n                            throw new Error(\"Fetch for '\".concat(request.url, \"' failed with \").concat(response.status, \" \").concat(response.statusText));\n                        }\n                        _h.label = 9;\n                    case 9: return [3 /*break*/, 16];\n                    case 10:\n                        error_2 = _h.sent();\n                        this.logger.error(\"[RegistrarClient] Request failed with \".concat(error_2));\n                        _h.label = 11;\n                    case 11:\n                        _h.trys.push([11, 13, , 14]);\n                        // retry on network errors (thrown by fetch) and retryable codes\n                        return [4 /*yield*/, backoff.delay('Registrar call retry')];\n                    case 12:\n                        // retry on network errors (thrown by fetch) and retryable codes\n                        _h.sent();\n                        return [3 /*break*/, 22];\n                    case 13:\n                        canceledError_1 = _h.sent();\n                        this.logger.error('[RegistrarClient] Request cancelled');\n                        this.stopBackoff(backoff);\n                        throw canceledError_1;\n                    case 14: return [3 /*break*/, 16];\n                    case 15:\n                        this.sendTelemetryEvent(eventName, request, response, stopwatch);\n                        return [7 /*endfinally*/];\n                    case 16:\n                        this.stopBackoff(backoff);\n                        if (!response.ok) return [3 /*break*/, 17];\n                        return [2 /*return*/, response];\n                    case 17:\n                        details = void 0;\n                        _h.label = 18;\n                    case 18:\n                        _h.trys.push([18, 20, , 21]);\n                        _g = (_f = JSON).stringify;\n                        return [4 /*yield*/, response.json()];\n                    case 19:\n                        details = _g.apply(_f, [_h.sent()]);\n                        return [3 /*break*/, 21];\n                    case 20:\n                        error_3 = _h.sent();\n                        details = 'no details';\n                        return [3 /*break*/, 21];\n                    case 21:\n                        message = \"Fetch for '\".concat(request.url, \"' failed with \").concat(response.status, \" \").concat(response.statusText, \" (\").concat(details, \", MS-CV: \").concat((_c = response.headers) === null || _c === void 0 ? void 0 : _c.get('MS-CV'), \")\");\n                        this.logger.error(\"[RegistrarClient] \".concat(message));\n                        throw new Error(message);\n                    case 22: return [3 /*break*/, 2];\n                    case 23: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RegistrarClient.prototype.setTokenHeader = function (request, token) {\n        // Because a request object is cloned on 401 retries, we need to reset the state to baseline\n        request.headers.delete('X-Skypetoken');\n        request.headers.delete('Authorization');\n        request.headers.delete('X-MS-Migration');\n        switch (token.tokenType.toLowerCase()) {\n            case 'skype':\n                request.headers.set('X-Skypetoken', token.token);\n                break;\n            case 'aad':\n            case 'cae':\n                request.headers.set('Authorization', \"Bearer \".concat(token.token));\n                break;\n            default:\n                throw new Error(\"unsupported token type: \".concat(token.tokenType));\n        }\n        if (this.options.usingLegacyTokenApi === false) {\n            request.headers.set('X-MS-Migration', 'True');\n        }\n    };\n    RegistrarClient.prototype.sendTelemetryEvent = function (eventName, request, response, stopwatch) {\n        if (this.eventLogger === undefined) {\n            return;\n        }\n        var clientEvent = {\n            name: eventName,\n            properties: {\n                url: { value: request.url },\n                result_code: { value: response !== undefined ? response.status : 0 },\n                begin_timestamp: { value: stopwatch.startTime },\n                elapsed: { value: stopwatch.duration }\n            }\n        };\n        this.eventLogger.logEvent(clientEvent);\n    };\n    return RegistrarClient;\n}());\nexports.RegistrarClient = RegistrarClient;\nfunction createRegistrarClient(logProvider, tokenProvider, options) {\n    return new RegistrarClient(logProvider, tokenProvider, options);\n}\nexports.createRegistrarClient = createRegistrarClient;\n\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// tsregistrar.js","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\n/** Wrapper to send request with specified timeout */\r\nexport function fetchWithTimeout(request: Request, timeoutMs: number): Promise<Response> {\r\n    let timeoutId: Timeout | undefined;\r\n    const fetchPromise = new Promise<Response>((resolve, reject) => {\r\n        fetch(request).then((response) => {\r\n            if (timeoutId !== undefined) {\r\n                clearTimeout(timeoutId);\r\n            }\r\n            resolve(response);\r\n        }).catch((error) => {\r\n            if (timeoutId !== undefined) {\r\n                clearTimeout(timeoutId);\r\n            }\r\n            reject(error);\r\n        });\r\n    });\r\n    if (timeoutMs !== 0) {\r\n        const timeoutPromise = new Promise<Response>((resolve, reject) => {\r\n            timeoutId = setTimeout(reject, timeoutMs, new Error(`Fetch for '${request.url}' timed out`));\r\n          });\r\n\r\n        return Promise.race([fetchPromise, timeoutPromise]);\r\n    }\r\n\r\n    return fetchPromise;\r\n}\r\n\r\nexport function toJson(obj: unknown): string {\r\n    try {\r\n        return JSON.stringify(obj);\r\n    } catch (error) {\r\n        return `Unable to serialize object of type ${typeof obj}`;\r\n    }\r\n}\r\n\r\n/**\r\n * Simplify calculation of time intervals\r\n */\r\nexport class Timespan {\r\n    private start: number;\r\n\r\n    constructor() {\r\n        this.start = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Returns number of milliseconds from start\r\n     */\r\n    public get duration(): number {\r\n        return Date.now() - this.start;\r\n    }\r\n\r\n    /**\r\n     * Returns start time\r\n     */\r\n    public get startTime() {\r\n        return this.start;\r\n    }\r\n\r\n    /**\r\n     * Reset start of interval to current timestamp\r\n     */\r\n    public reset() {\r\n        this.start = Date.now();\r\n    }\r\n}\r\n\r\n// Browser vs. @types/node compatibility - browser (where the client is mainly used) uses `number` as return type of setTimeout,\r\n// node.js (where the tests run) uses its own type.\r\nexport type Timeout = ReturnType<typeof setTimeout>;\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/Common.ts","import { fetchWithTimeout, Timeout, Timespan, toJson } from './Common';\r\nimport { AuthTokenProvider, IClientDescription, IRegistrarClient, IRegistrarClientOptions, ITelemetrySender,\r\n         ITransports, IUrlRewrite, LogProvider, TelemetryEvent, TokenResult } from './Interfaces';\r\n\r\nconst SUPPORTED_TOKEN_TYPES = <const>['skype', 'aad', 'cae'];\r\n\r\n/**\r\n * Thrown when retry process was cancelled\r\n */\r\nclass CancelationError extends Error {\r\n    constructor(message: string) {\r\n        super(message);\r\n        this.name = 'CancelationError';\r\n    }\r\n}\r\n\r\n/**\r\n * Randomized exponential delay used for retries\r\n */\r\nclass ExponentialDelay {\r\n    private static idCounter: number = 0;\r\n\r\n    public readonly id: number;\r\n\r\n    private backoffCount: number = 0;\r\n    private timerHandle?: Timeout;\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    private cancelFunc: ((err?: any) => void) | undefined;\r\n\r\n    public constructor(\r\n        private logger: LogProvider,\r\n        private maxBackoffInMs: number,\r\n        private initialDelay: number\r\n    ) {\r\n        this.id = ++ExponentialDelay.idCounter;\r\n    }\r\n\r\n    public delay(taskName: string): Promise<void> {\r\n        if (this.timerHandle !== undefined) {\r\n            throw new Error('Retry sequence logical failure');\r\n        }\r\n\r\n        if (this.backoffCount === -1) {\r\n            return new Promise((resolve, reject) => { reject(new CancelationError('Cancelled')); });\r\n        }\r\n\r\n        const backoffMs = this.calculateNextBackoffMs();\r\n        this.backoffCount++;\r\n        this.logger.info(`[RegistrarClient] Backing off ${taskName} for ${backoffMs} milliseconds with ID ${this.id}`);\r\n\r\n        return new Promise( (resolve, reject) => {\r\n            this.cancelFunc = reject;\r\n            this.timerHandle = setTimeout(() => {\r\n                this.logger.info(`[RegistrarClient] Back off for ${taskName} with ID ${this.id} complete`);\r\n                this.timerHandle = undefined;\r\n                resolve();\r\n            }, backoffMs);\r\n        });\r\n    }\r\n\r\n    public cancel(): void {\r\n        if (this.timerHandle !== undefined) {\r\n            this.logger.debug('Resetting back off');\r\n            clearTimeout(this.timerHandle);\r\n            if (this.cancelFunc !== undefined) {\r\n                this.cancelFunc(new CancelationError('Cancelled'));\r\n            }\r\n        }\r\n        this.backoffCount = -1;\r\n    }\r\n\r\n    private calculateNextBackoffMs(): number {\r\n        const fudge = 1 + (Math.random() - 0.5) * 0.4; // +/- 20%\r\n        let backoff = this.initialDelay * Math.pow(2, this.backoffCount) * fudge;\r\n        backoff = Math.round(backoff);\r\n\r\n        return Math.min(this.maxBackoffInMs, backoff);\r\n    }\r\n}\r\n\r\n/**\r\n * Registrar client implementation\r\n */\r\nexport class RegistrarClient implements IRegistrarClient {\r\n    private backoffs: { [id: string]: ExponentialDelay };\r\n    private eventLogger?: ITelemetrySender;\r\n    private cachedRegistrationParams?: [IClientDescription, ITransports];\r\n    private maxBackOffTime: number;\r\n    private maxRetriesForGetToken: number;\r\n    private readonly DEFAULT_MAX_RETRIES_FOR_GET_TOKEN = 15;\r\n    private readonly proxyUrlRewrite: IUrlRewrite;\r\n\r\n    // Default value for maximum backoff between retries\r\n    private readonly DEFAULT_MAX_BACKOFF_TIME_IN_MS = 300000; // 5 minutes\r\n\r\n    constructor(\r\n        private logger: LogProvider,\r\n        private tokenProvider: AuthTokenProvider,\r\n        private options: IRegistrarClientOptions\r\n    ) {\r\n        this.backoffs = {};\r\n        this.maxBackOffTime =\r\n          this.options.maxRetryDelayMs > 0\r\n            ? this.options.maxRetryDelayMs\r\n            : this.DEFAULT_MAX_BACKOFF_TIME_IN_MS;\r\n        this.maxRetriesForGetToken =\r\n          options.maxRetriesForGetToken === undefined ||\r\n          options.maxRetriesForGetToken === null\r\n            ? this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN\r\n            : options.maxRetriesForGetToken;\r\n        this.proxyUrlRewrite = options.proxyUrlRewrite ?? (url => url);\r\n    }\r\n\r\n    public setTelemetryLogger(eventLogger: ITelemetrySender) {\r\n        this.eventLogger = eventLogger;\r\n    }\r\n\r\n    public async register(client: IClientDescription, transports: ITransports): Promise<void> {\r\n        await this.performRegistration(client, transports, 'pr_set_registration');\r\n        this.cachedRegistrationParams = [client, transports];\r\n    }\r\n\r\n    public async unregister(): Promise<void> {\r\n        this.logger.info('[RegistrarClient] sending unregister request');\r\n\r\n        const unregisterRequest = new Request(\r\n            this.proxyUrlRewrite(`${this.options.registrarUrl}/${this.options.registrationId}`),\r\n            {\r\n                method: 'DELETE',\r\n                mode: 'cors',\r\n                headers: new Headers({\r\n                    ...this.options.extraRegistrationHeaders,\r\n                    accept: 'application/json, text/javascript'\r\n                })\r\n            });\r\n\r\n            await this.callRegistrar(unregisterRequest, 'pr_delete_registration');\r\n    }\r\n\r\n    public cancelPendingRequests() {\r\n        Object.keys(this.backoffs).forEach((id: string) => {\r\n            this.backoffs[id].cancel();\r\n        });\r\n        this.backoffs = {};\r\n    }\r\n\r\n    public async resendRegistration(): Promise<void> {\r\n        if (!this.cachedRegistrationParams) {\r\n            throw new Error('Re-registration failed because there is no registration parameters cached');\r\n        }\r\n\r\n        await this.performRegistration(this.cachedRegistrationParams[0], this.cachedRegistrationParams[1], 'pr_resend_registration');\r\n    }\r\n\r\n    private async performRegistration(client: IClientDescription, transports: ITransports, eventName: string) {\r\n        this.logger.info('[RegistrarClient] Sending register request');\r\n        const payload = {\r\n            clientDescription: client,\r\n            registrationId: this.options.registrationId,\r\n            nodeId: '',\r\n            transports: transports\r\n        };\r\n        const registerRequest = new Request(this.proxyUrlRewrite(this.options.registrarUrl), {\r\n            method: 'POST',\r\n            mode: 'cors',\r\n            headers: new Headers({\r\n                ...this.options.extraRegistrationHeaders,\r\n                'content-type': 'application/json',\r\n                accept: 'application/json, text/javascript'\r\n            }),\r\n            body: toJson(payload)\r\n        });\r\n        await this.callRegistrar(registerRequest, eventName);\r\n    }\r\n\r\n    private startBackoff() {\r\n        const backoff = new ExponentialDelay(\r\n          this.logger,\r\n          this.maxBackOffTime,\r\n          this.options.initialRetryDelayMs\r\n        );\r\n        this.backoffs[backoff.id] = backoff;\r\n\r\n        return backoff;\r\n    }\r\n\r\n    private stopBackoff(backoff: ExponentialDelay) {\r\n        backoff.cancel();\r\n        delete this.backoffs[backoff.id];\r\n    }\r\n\r\n    private async getToken(claimsChallenge: string|undefined): Promise<TokenResult> {\r\n        const backoff = this.startBackoff();\r\n        let retryCount = 0;\r\n        for (;;) {\r\n            try {\r\n                this.logger.info('[RegistrarClient] Asking for a new token');\r\n                const token = await this.tokenProvider({\r\n                    needFresh: true,\r\n                    supportedTokenTypes: SUPPORTED_TOKEN_TYPES,\r\n                    wwwAuthenticateHeader: claimsChallenge,\r\n                    purpose: 'registrar'\r\n                });\r\n                this.stopBackoff(backoff);\r\n\r\n                return token;\r\n            } catch (error) {\r\n                try {\r\n                    retryCount++;\r\n                    const stringfiedError = JSON.stringify(error);\r\n                    if (retryCount > this.maxRetriesForGetToken) {\r\n                        const err = `[RegistrarClient] getToken retry limit hit. Will not retry now. Error: ${stringfiedError}`;\r\n                        this.logger.error(err);\r\n                        this.stopBackoff(backoff);\r\n\r\n                        return Promise.reject(err);\r\n                    }\r\n\r\n                    this.logger.warn(`[RegistrarClient] Retrying for a new token. Retry Count: ${retryCount} Error: ${stringfiedError}`);\r\n                    await backoff.delay('Fetching a new token');\r\n                    continue;\r\n                } catch (cancelError) {\r\n                    this.stopBackoff(backoff);\r\n                    throw cancelError;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private async callRegistrar(request: Request, eventName: string): Promise<Response> {\r\n        const backoff = this.startBackoff();\r\n\r\n        const cachedToken = await this.tokenProvider({\r\n            needFresh: false,\r\n            supportedTokenTypes: SUPPORTED_TOKEN_TYPES,\r\n            wwwAuthenticateHeader: undefined,\r\n            purpose: 'registrar'\r\n        });\r\n        this.setTokenHeader(request, cachedToken);\r\n\r\n        const stopwatch = new Timespan();\r\n        let retryCount = 0;\r\n\r\n        for (;;) {\r\n            let response: Response | undefined;\r\n            try {\r\n                // Make a clone in case we need to retry, one Request cannot be used twice with fetch()\r\n                const req = request.clone();\r\n                response = await fetchWithTimeout(req, this.options.requestTimeoutMs);\r\n                if (response.status === 401) {\r\n                    retryCount++;\r\n                    if (retryCount > this.maxRetriesForGetToken) {\r\n                        const err = `[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '${request.url}' failed with ${response.status} ${response.statusText}`;\r\n                        this.logger.error(err);\r\n                        this.stopBackoff(backoff);\r\n\r\n                        return Promise.reject(err);\r\n                    }\r\n\r\n                    this.logger.warn(`[RegistrarClient] Retry Count ${retryCount}. Request '${request.url}' failed with ${response.status} ${response.statusText}`);\r\n                    const claimsChallenge = response.headers?.get('www-authenticate') ?? undefined;\r\n                    this.setTokenHeader(request, await this.getToken(claimsChallenge));\r\n                    // do not wait the first time - quick reaction to e.g. expired token\r\n                    if (retryCount > 1) {\r\n                        // for later retries, e.g. with token revocation, wait until SEAL knows the token was revoked,\r\n                        // so that proper claims challenges are sent, see https://skype.visualstudio.com/SCC/_workitems/edit/3337904/\r\n                        await backoff.delay('Registrar call retry after 401');\r\n                    }\r\n                    continue;\r\n                } else if (response.status >= 500 && response.status < 600) {\r\n                    // throw and retry after in the catch section\r\n                    throw new Error(`Fetch for '${request.url}' failed with ${response.status} ${response.statusText}`);\r\n                }\r\n            } catch (error) {\r\n                this.logger.error(`[RegistrarClient] Request failed with ${error}`);\r\n                try {\r\n                    // retry on network errors (thrown by fetch) and retryable codes\r\n                    await backoff.delay('Registrar call retry');\r\n                    continue;\r\n                } catch (canceledError) {\r\n                    this.logger.error('[RegistrarClient] Request cancelled');\r\n                    this.stopBackoff(backoff);\r\n                    throw canceledError;\r\n                }\r\n            } finally {\r\n                this.sendTelemetryEvent(eventName, request, response, stopwatch);\r\n            }\r\n\r\n            this.stopBackoff(backoff);\r\n            if (response.ok) {\r\n                return response;\r\n            } else  {\r\n                let details: string;\r\n                try {\r\n                    details = JSON.stringify(await response.json());\r\n                } catch (error) {\r\n                    details = 'no details';\r\n                }\r\n                // Note MS-CV will be null until Registrar service CORS fix\r\n                // https://dev.azure.com/skype/SCC/_workitems/edit/2353812\r\n                const message = `Fetch for '${request.url}' failed with ${response.status} ${response.statusText} (${details}, MS-CV: ${response.headers?.get('MS-CV')})`;\r\n                this.logger.error(`[RegistrarClient] ${message}`);\r\n                throw new Error(message);\r\n            }\r\n        }\r\n    }\r\n\r\n    private setTokenHeader(request: Request, token: TokenResult) {\r\n        // Because a request object is cloned on 401 retries, we need to reset the state to baseline\r\n        request.headers.delete('X-Skypetoken');\r\n        request.headers.delete('Authorization');\r\n        request.headers.delete('X-MS-Migration');\r\n\r\n        switch (token.tokenType.toLowerCase()) {\r\n            case 'skype':\r\n                request.headers.set('X-Skypetoken', token.token);\r\n                break;\r\n\r\n            case 'aad':\r\n            case 'cae':\r\n                request.headers.set('Authorization', `Bearer ${token.token}`);\r\n                break;\r\n\r\n            default:\r\n                throw new Error(`unsupported token type: ${token.tokenType}`);\r\n        }\r\n        if (this.options.usingLegacyTokenApi === false) {\r\n            request.headers.set('X-MS-Migration', 'True');\r\n        }\r\n    }\r\n\r\n    private sendTelemetryEvent(eventName: string, request: Request, response: Response | undefined, stopwatch: Timespan) {\r\n        if (this.eventLogger === undefined) {\r\n            return;\r\n        }\r\n\r\n        const clientEvent: TelemetryEvent = {\r\n            name: eventName,\r\n            properties: {\r\n                url: { value: request.url },\r\n                result_code: { value: response !== undefined ? response.status : 0 },\r\n                begin_timestamp: { value: stopwatch.startTime },\r\n                elapsed: { value: stopwatch.duration }\r\n            }\r\n        };\r\n\r\n        this.eventLogger.logEvent(clientEvent);\r\n    }\r\n}\r\n\r\nexport function createRegistrarClient(\r\n    logProvider: LogProvider,\r\n    tokenProvider: AuthTokenProvider,\r\n    options: IRegistrarClientOptions\r\n): IRegistrarClient {\r\n    return new RegistrarClient(logProvider, tokenProvider, options);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/RegistrarClient.ts","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@skype/tsregistrar\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@skype/tstrouter\", [\"@skype/tsregistrar\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@skype/tstrouter\"] = factory(require(\"@skype/tsregistrar\"));\n\telse\n\t\troot[\"@skype/tstrouter\"] = factory(root[\"@skype/tsregistrar\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_21__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b8d066f6f21edf895ca2","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@skype/tsregistrar\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@skype/tstrouter\", [\"@skype/tsregistrar\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@skype/tstrouter\"] = factory(require(\"@skype/tsregistrar\"));\n\telse\n\t\troot[\"@skype/tstrouter\"] = factory(root[\"@skype/tsregistrar\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_21__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 20);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Logger = void 0;\n/**\n * Simple logger\n */\nvar Logger = /** @class */ (function () {\n    function Logger(name, logger) {\n        this.name = name;\n        this.logger = logger;\n    }\n    Logger.prototype.debug = function (message) {\n        this.logger.debug(\"[\".concat(this.name, \"] \").concat(message));\n    };\n    Logger.prototype.info = function (message) {\n        this.logger.info(\"[\".concat(this.name, \"] \").concat(message));\n    };\n    Logger.prototype.warn = function (message) {\n        this.logger.warn(\"[\".concat(this.name, \"] \").concat(message));\n    };\n    Logger.prototype.error = function (message) {\n        this.logger.error(\"[\".concat(this.name, \"] \").concat(message));\n    };\n    return Logger;\n}());\nexports.Logger = Logger;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.USER_AUTHENTICATE_EVENT_NAME = exports.SUPPORTED_TOKEN_TYPES = exports.FAILED_MESSAGE_ACK = exports.UNHANDLED_MESSAGE_ACK = exports.HANDLED_MESSAGE_ACK = exports.CLIENT_VERSION = exports.constants = void 0;\nexports.constants = {\n    TROUTER_INIT: 'trouterinit',\n    TROUTER_READY_EVENT: 'trouterReadyEvent',\n    TROUTER_READY_TIMEOUT: 'trouterReadyTimeout',\n    TROUTER_TOKEN_REQUEST: 'trouterTokenRequest',\n    TROUTER_TOKEN_GET_SUCCEEDED: 'trouterTokenGetSucceeded',\n    TROUTER_TOKEN_GET_FAILED: 'trouterTokenGetFailed',\n    TROUTER_RECONNECTING: 'trouterReconnecting',\n    RENEWAL: 'renewal',\n    NEW_CONNECTION: 'newConnection',\n    ENDPOINT_REGISTRATION_FAILED: 'endpointRegistrationFailed'\n};\nexports.CLIENT_VERSION = '2024.14.01.55';\nexports.HANDLED_MESSAGE_ACK = 200;\nexports.UNHANDLED_MESSAGE_ACK = 404;\nexports.FAILED_MESSAGE_ACK = 500;\nexports.SUPPORTED_TOKEN_TYPES = ['skype', 'aad', 'cae'];\nexports.USER_AUTHENTICATE_EVENT_NAME = 'user.authenticate';\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n * Type definitions for Trouter JavaScript Client 2024.14.01.55\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterState = exports.UserActivityState = void 0;\n/**\n * States that a user can reach\n *\n * Use with the `setUserActivityState()` method.\n */\nvar UserActivityState;\n(function (UserActivityState) {\n    UserActivityState[UserActivityState[\"Unknown\"] = 0] = \"Unknown\";\n    UserActivityState[UserActivityState[\"Active\"] = 1] = \"Active\";\n    UserActivityState[UserActivityState[\"Inactive\"] = 2] = \"Inactive\"; /// User is not active according to the application\n})(UserActivityState || (exports.UserActivityState = UserActivityState = {}));\nvar TrouterState;\n(function (TrouterState) {\n    /** Initial state */\n    TrouterState[TrouterState[\"Unknown\"] = 0] = \"Unknown\";\n    /** ready to work */\n    TrouterState[TrouterState[\"Connected\"] = 2] = \"Connected\";\n    /**\n     * waiting for 'connected' event\n     * Might also be in Terminal State. Users should call `isInTerminalState` to check.\n     * For legacy reasons, we cannot change the TrouterState enum any longer.\n     */\n    TrouterState[TrouterState[\"Disconnected\"] = 3] = \"Disconnected\";\n    /** waiting for 'register' from second connection */\n    TrouterState[TrouterState[\"Switching\"] = 9] = \"Switching\";\n})(TrouterState || (exports.TrouterState = TrouterState = {}));\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Timespan = exports.CorrelationVector = exports.fetchWithTimeout = exports.calculateExpireTsInSec = exports.calculateTtlInSec = exports.toJson = void 0;\nfunction toJson(obj) {\n    try {\n        return JSON.stringify(obj);\n    }\n    catch (error) {\n        return \"Unable to serialize object of type \".concat(typeof obj);\n    }\n}\nexports.toJson = toJson;\nfunction calculateTtlInSec(expirationTsInSec) {\n    var now = Math.round(new Date().getTime() / 1000);\n    return expirationTsInSec !== undefined && expirationTsInSec > now\n        ? expirationTsInSec - now\n        : 0;\n}\nexports.calculateTtlInSec = calculateTtlInSec;\nfunction calculateExpireTsInSec(ttlInSec) {\n    return Math.round(new Date().getTime() / 1000) + ttlInSec;\n}\nexports.calculateExpireTsInSec = calculateExpireTsInSec;\n/** Wrapper to send request with specified timeout */\nfunction fetchWithTimeout(request, timeoutMs) {\n    return __awaiter(this, void 0, void 0, function () {\n        var timeoutId, fetchPromise, timeoutPromise;\n        return __generator(this, function (_a) {\n            fetchPromise = new Promise(function (resolve, reject) {\n                fetch(request).then(function (response) {\n                    clearTimeout(timeoutId);\n                    resolve(response);\n                }).catch(function (error) {\n                    clearTimeout(timeoutId);\n                    reject(error);\n                });\n            });\n            if (timeoutMs !== 0) {\n                timeoutPromise = new Promise(function (resolve, reject) {\n                    // We make a compromise on how much information to show in the error message.\n                    // Having the URL there is useful, but including any query parameters is both\n                    // cumbersome (millions of different errors in telemetry) and unsafe (secret\n                    // fields that would need to be redacted). \"Origin\" and \"pathname\" achieve that.\n                    var url = new URL(request.url);\n                    var error = new Error(\"\".concat(request.method, \" \").concat(url.origin).concat(url.pathname, \" timed out\"));\n                    timeoutId = setTimeout(reject, timeoutMs, error);\n                });\n                return [2 /*return*/, Promise.race([fetchPromise, timeoutPromise])];\n            }\n            return [2 /*return*/, fetchPromise];\n        });\n    });\n}\nexports.fetchWithTimeout = fetchWithTimeout;\n/***\n * Correlation vector\n */\nvar CorrelationVector = /** @class */ (function () {\n    function CorrelationVector(correlationVector) {\n        this.base = (correlationVector !== undefined) ? correlationVector : this.createCorrelationVectorBase();\n        this.extension = 0;\n    }\n    CorrelationVector.extend = function (correlationVector) {\n        return new CorrelationVector(correlationVector);\n    };\n    CorrelationVector.prototype.increase = function () {\n        this.extension++;\n    };\n    CorrelationVector.prototype.value = function () {\n        return \"\".concat(this.base, \".\").concat(this.extension);\n    };\n    CorrelationVector.prototype.createCorrelationVectorBase = function () {\n        var length = 21;\n        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+';\n        var endChars = 'AQgw';\n        var result = '';\n        for (var i = 0; i < length; i++) {\n            result += chars.charAt(Math.floor(Math.random() * chars.length));\n        }\n        result += endChars.charAt(Math.floor(Math.random() * endChars.length));\n        return result;\n    };\n    return CorrelationVector;\n}());\nexports.CorrelationVector = CorrelationVector;\n/**\n * Simplify calculation of time intervals\n */\nvar Timespan = /** @class */ (function () {\n    function Timespan() {\n        this.start = Date.now();\n    }\n    Object.defineProperty(Timespan.prototype, \"duration\", {\n        /**\n         * Returns number of milliseconds from start\n         */\n        get: function () {\n            return Date.now() - this.start;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Timespan.prototype, \"startTime\", {\n        /**\n         * Returns start time\n         */\n        get: function () {\n            return this.start;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Reset start of interval to current timestamp\n     */\n    Timespan.prototype.reset = function () {\n        this.start = Date.now();\n    };\n    return Timespan;\n}());\nexports.Timespan = Timespan;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n * Internal type definitions for Trouter JavaScript Client\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterManagerState = exports.UserActivityEventReason = exports.ServerState = void 0;\nvar Common_1 = __webpack_require__(3);\n/**\n * Information about server connection\n */\nvar ServerState = /** @class */ (function () {\n    function ServerState(\n    /** Trouter client connection ID */\n    connectionId, \n    /** Trouter client connected client ID */\n    connectedClientId, \n    /** window.location.hostname */\n    domId, \n    /** Unsecure Trouter url at which client can be reached */\n    unsecureUrl, \n    /** Secure Trouter url at which client can be reached */\n    url, \n    /** URL base to use for client-to-client requests */\n    c2cUrlBase, \n    /** expiration timestamp for connection in seconds */\n    expirationTsSec) {\n        this.connectionId = connectionId;\n        this.connectedClientId = connectedClientId;\n        this.domId = domId;\n        this.unsecureUrl = unsecureUrl;\n        this.url = url;\n        this.c2cUrlBase = c2cUrlBase;\n        this.expirationTsSec = expirationTsSec;\n    }\n    /** Return connection TTL, i.e. number of seconds till expiration */\n    ServerState.prototype.getRemainingTtlInSec = function () {\n        return (0, Common_1.calculateTtlInSec)(this.expirationTsSec);\n    };\n    return ServerState;\n}());\nexports.ServerState = ServerState;\nvar UserActivityEventReason;\n(function (UserActivityEventReason) {\n    UserActivityEventReason[UserActivityEventReason[\"Unknown\"] = 0] = \"Unknown\";\n    UserActivityEventReason[UserActivityEventReason[\"Modified\"] = 1] = \"Modified\";\n    UserActivityEventReason[UserActivityEventReason[\"Snapshot\"] = 2] = \"Snapshot\";\n    UserActivityEventReason[UserActivityEventReason[\"Connected\"] = 3] = \"Connected\";\n})(UserActivityEventReason || (exports.UserActivityEventReason = UserActivityEventReason = {}));\n/**\n * Duplicating TrouterState since too many parts of SCC depend on it for us to change it internally.\n * Don't expose this to the outside world, to avoid another repeat of this issue.\n */\nvar TrouterManagerState;\n(function (TrouterManagerState) {\n    /** Initial state */\n    TrouterManagerState[TrouterManagerState[\"Unknown\"] = 0] = \"Unknown\";\n    /** ready to work */\n    TrouterManagerState[TrouterManagerState[\"Connected\"] = 2] = \"Connected\";\n    /** waiting for 'connected' event */\n    TrouterManagerState[TrouterManagerState[\"Disconnected\"] = 3] = \"Disconnected\";\n    /** waiting for 'register' from second connection */\n    TrouterManagerState[TrouterManagerState[\"Switching\"] = 9] = \"Switching\";\n    /** Unable to continue, in final state. */\n    TrouterManagerState[TrouterManagerState[\"TerminalError\"] = 10] = \"TerminalError\";\n})(TrouterManagerState || (exports.TrouterManagerState = TrouterManagerState = {}));\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.redirectUrlIfPresent = exports.ensureNumber = exports.reconnectParamsWithoutUrls = exports.adaptUrl = exports.isV4ConnectEvent = exports.usedProtocolAfterFallback = exports.usedProtocol = void 0;\nfunction usedProtocol(tokenType, reconnectParams) {\n    return (tokenType === 'skype' && safeToString(reconnectParams === null || reconnectParams === void 0 ? void 0 : reconnectParams.scae) !== '1') ? 'v4a' : 'v4c';\n}\nexports.usedProtocol = usedProtocol;\nfunction safeToString(value) {\n    if (typeof value === 'string') {\n        return value;\n    }\n    else if (typeof value === 'number') {\n        return value.toString();\n    }\n    return undefined;\n}\nfunction usedProtocolAfterFallback(protocol, fallbackReason) {\n    if ((fallbackReason === null || fallbackReason === void 0 ? void 0 : fallbackReason.kind) === 'v4c-websocket-failure') {\n        return 'v4a';\n    }\n    return protocol;\n}\nexports.usedProtocolAfterFallback = usedProtocolAfterFallback;\nfunction isV4ConnectEvent(args) {\n    return Object.prototype.hasOwnProperty.call(args, 'connectparams');\n}\nexports.isV4ConnectEvent = isV4ConnectEvent;\n/**\n * Needed because we want to have cache with reconnectUrl, serviceUrl working\n * independent of protocol (see IReconnectParameters and its uses)\n */\nfunction adaptUrl(url, protocol) {\n    if (protocol === 'v4a') {\n        // The insecure (http://, ws://) versions would only ever be used by a test application,\n        // the connection URL is normally determined by the consumer of the library.\n        // eslint-disable-next-line @microsoft/sdl/no-insecure-url\n        return url.replace(/\\/v4\\/c\\b/, '/v4/a').replace('wss://', 'https://').replace('ws://', 'http://');\n    }\n    else {\n        // eslint-disable-next-line @microsoft/sdl/no-insecure-url\n        return url.replace(/\\/v4\\/a\\b/, '/v4/c').replace('https://', 'wss://').replace('http://', 'ws://');\n    }\n}\nexports.adaptUrl = adaptUrl;\n/**\n * Unfortunately the pre-existing cache format doesn't separate connectparams into its own property so it could be easily sent back,\n * instead it manually removes `reconnectUrl` and `serviceUrl` and send everything else, so we need to do the same here\n */\nfunction reconnectParamsWithoutUrls(reconnectParams) {\n    if (reconnectParams === undefined) {\n        return undefined;\n    }\n    return __assign(__assign({}, reconnectParams), { reconnectUrl: undefined, serviceUrl: undefined });\n}\nexports.reconnectParamsWithoutUrls = reconnectParamsWithoutUrls;\nfunction ensureNumber(value) {\n    return typeof value === 'string' ? parseInt(value, 10) : value;\n}\nexports.ensureNumber = ensureNumber;\nfunction redirectUrlIfPresent(reason) {\n    if ((reason === null || reason === void 0 ? void 0 : reason.kind) !== 'redirect' || reason.host === undefined) {\n        return undefined;\n    }\n    var redirectHost = reason.host;\n    if (redirectHost.endsWith('/')) {\n        redirectHost = redirectHost.substring(0, redirectHost.length - 1);\n    }\n    if (!redirectHost.endsWith('/v4/c') && !redirectHost.endsWith('/v4/a')) {\n        redirectHost += '/v4/c';\n    }\n    return redirectHost;\n}\nexports.redirectUrlIfPresent = redirectUrlIfPresent;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterFsm = exports.State = void 0;\nvar InternalInterfaces_1 = __webpack_require__(4);\nvar Logger_1 = __webpack_require__(0);\nvar ProtocolAdapters_1 = __webpack_require__(5);\nvar State;\n(function (State) {\n    State[State[\"Initial\"] = 0] = \"Initial\";\n    /** waiting for token from User */\n    State[State[\"RetrievingToken\"] = 1] = \"RetrievingToken\";\n    /** waiting for allocation response from service */\n    State[State[\"Allocating\"] = 2] = \"Allocating\";\n    /**\n     * waiting for Socket.IO handshake to be finished. After that Socket.IO will\n     * start to try transports and send 'connecting' event\n     */\n    State[State[\"Handshaking\"] = 3] = \"Handshaking\";\n    /**\n     * waiting for 'connected' event - socket.io is trying different transports.\n     * onSocketError event should be ignored, as it's expected event. So, only ConnectFailed or\n     * connection timeout meas failed connection\n     */\n    State[State[\"Connecting\"] = 4] = \"Connecting\";\n    /**\n     * connecting to a websocket /v4/c URL\n     *\n     * this is the equivalent of the \"Allocating -> Handshaking -> Connecting\" chain\n     * from the /v4/a protocol\n     */\n    State[State[\"AnonymousConnecting\"] = 5] = \"AnonymousConnecting\";\n    /**\n     * connected to a websocket /v4/c URL, sending the authentication message,\n     * and waiting to receive a `trouter.connected` event back\n     */\n    State[State[\"WebsocketAuthenticating\"] = 6] = \"WebsocketAuthenticating\";\n    /** ready to work */\n    State[State[\"Connected\"] = 7] = \"Connected\";\n    /** waiting for a successful 'unregister' response */\n    State[State[\"Unregistering\"] = 8] = \"Unregistering\";\n    /**\n     * Unrecoverable state\n     * Trouter cannot start once in this state\n     */\n    State[State[\"TerminalError\"] = 9] = \"TerminalError\";\n})(State || (exports.State = State = {}));\nvar RegistrationState;\n(function (RegistrationState) {\n    RegistrationState[RegistrationState[\"Initial\"] = 0] = \"Initial\";\n    /** Waiting for a successful 'register' response */\n    RegistrationState[RegistrationState[\"Registering\"] = 1] = \"Registering\";\n    /** like the above, but another registration must happen when done because of resendRegistration() */\n    RegistrationState[RegistrationState[\"RegisteringButResendPending\"] = 2] = \"RegisteringButResendPending\";\n    /** Registration failed, waiting to retry */\n    RegistrationState[RegistrationState[\"Retrying\"] = 3] = \"Retrying\";\n    /** Registration succeeded */\n    RegistrationState[RegistrationState[\"Registered\"] = 4] = \"Registered\";\n    /** Registration is skipped */\n    RegistrationState[RegistrationState[\"RegistrationDisabled\"] = 5] = \"RegistrationDisabled\";\n})(RegistrationState || (RegistrationState = {}));\n/**\n * State machine for trouter\n */\nvar TrouterFsm = /** @class */ (function () {\n    function TrouterFsm(logfunc, worker, incallModeEnabled, protocolSelector) {\n        this.worker = worker;\n        this.incallModeEnabled = incallModeEnabled;\n        this.protocolSelector = protocolSelector;\n        this.state = State.Initial;\n        this.autoReconnect = true;\n        this.logger = new Logger_1.Logger('ConnectionFsm', logfunc);\n        this.registrationState = RegistrationState.Initial;\n    }\n    /** Returns current state */\n    TrouterFsm.prototype.getState = function () {\n        return this.state;\n    };\n    TrouterFsm.prototype.isActive = function () {\n        return this.state === State.Allocating\n            || this.state === State.Connected\n            || this.state === State.Handshaking\n            || this.state === State.Connecting\n            || this.state === State.RetrievingToken\n            || this.state === State.AnonymousConnecting\n            || this.state === State.WebsocketAuthenticating;\n    };\n    TrouterFsm.prototype.isConnecting = function () {\n        return this.state === State.Allocating\n            || this.state === State.Handshaking\n            || this.state === State.Connecting\n            || this.state === State.AnonymousConnecting;\n    };\n    //////////// Events ////////////\n    /**\n     * Start trouter\n     */\n    TrouterFsm.prototype.start = function () {\n        if (this.state === State.Initial) {\n            this.setState(State.RetrievingToken);\n            this.worker.getToken(true, false, undefined);\n            return true;\n        }\n        else {\n            this.showIgnored('start');\n            return false;\n        }\n    };\n    /**\n     * Stop trouter\n     * @param dontUnregister    if true, FSM will not unregister. It's needed in case of two simultaneous\n     *                          connections, to replace first connection with second - registrar just updates\n     *                          the existing record for the user, by registrationId (see their API docs),\n     *                          that id does not change during the lifetime of a TrouterService instance.\n     * @param isTerminalError   if true, FSM will transition into the terminal state\n     */\n    TrouterFsm.prototype.stop = function (dontUnregister, isTerminalError) {\n        if (dontUnregister) {\n            this.registrationState = RegistrationState.Initial;\n        }\n        if (this.worker.isIncallMode()) {\n            this.worker.exitIncallMode();\n        }\n        this.worker.resetTokenBackoff();\n        this.worker.cancelPendingRegistrationRequests();\n        this.worker.stopConnectionTimer();\n        this.worker.stopPingTimer();\n        this.worker.clearSentEventTimers();\n        this.worker.stopRegistrationTimer();\n        this.worker.stopSocketIo();\n        if (this.state === State.Connected) {\n            this.worker.sendDisconnectTelemetryEvent('connection stopped');\n        }\n        // Stop can happen in any state - the only difference is if registration exists or not.\n        // It can be also called a second time, just to stop a stuck unregistration.\n        if ((this.registrationState === RegistrationState.Registered\n            || this.registrationState === RegistrationState.Registering\n            || this.registrationState === RegistrationState.RegisteringButResendPending)\n            && this.state !== State.Unregistering) {\n            this.registrationState = RegistrationState.Initial;\n            this.setState(State.Unregistering);\n            this.worker.sendUnregisterRequest();\n        }\n        else {\n            if (isTerminalError) {\n                this.setState(State.TerminalError);\n                this.worker.dispatchTerminalError();\n            }\n            else {\n                this.setState(State.Initial);\n                this.worker.dispatchDisconnected();\n            }\n        }\n    };\n    TrouterFsm.prototype.onTokenReceived = function (token, reason, reconnectParams) {\n        if (this.state === State.RetrievingToken) {\n            if ((0, ProtocolAdapters_1.usedProtocolAfterFallback)(this.protocolSelector(token.tokenType, reconnectParams), reason) === 'v4c') {\n                this.setState(State.AnonymousConnecting);\n                this.worker.startConnectionTimer();\n                this.worker.connectV4c(token, reason);\n            }\n            else {\n                this.setState(State.Allocating);\n                this.worker.startConnectionTimer();\n                this.worker.sendAllocateRequest(token);\n            }\n        }\n        else {\n            this.showIgnored('onTokenReceived');\n        }\n    };\n    /**\n     * if disconnectDetected - need to send ping to check if connection is really dead,\n     * otherwise - network is available\n     */\n    TrouterFsm.prototype.checkConnection = function (disconnectDetected) {\n        if (disconnectDetected) {\n            this.onPingInterval();\n        }\n    };\n    /** Allocation request succeed with 200 */\n    TrouterFsm.prototype.onAllocationSucceed = function (token) {\n        // Call to dispatchUnregistered a little bit earlier takes into account the case when the state\n        // of the state machine can change inside the callback, for example if Trouter.stop() is called inside the callback.\n        if (this.state === State.Allocating && this.registrationState === RegistrationState.Registered) {\n            this.worker.dispatchUnregistered();\n        }\n        if (this.state === State.Allocating) {\n            this.setState(State.Handshaking);\n            this.registrationState = RegistrationState.Initial;\n            this.worker.startSocketIo(token);\n            return true;\n        }\n        else {\n            this.showIgnored('onAllocationSucceed');\n            return false;\n        }\n    };\n    /** Allocation request failed */\n    TrouterFsm.prototype.onAllocationFailed = function (unauthorized, claimsChallenge) {\n        if (this.state === State.Allocating) {\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: !unauthorized, claimsChallenge: claimsChallenge });\n        }\n        else {\n            this.showIgnored('onAllocationFailed');\n        }\n    };\n    TrouterFsm.prototype.onV4cException = function () {\n        if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\n            this.logger.error('v4c exception, falling back to longpoll');\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'v4c-websocket-failure' } });\n        }\n    };\n    /** Connection didn't succeed in given timeout */\n    TrouterFsm.prototype.onConnectingTimeout = function () {\n        // implementation note: this also called from onConnectingFailed\n        if (this.state === State.Allocating\n            || this.state === State.Connecting\n            || this.state === State.Handshaking\n            || this.state === State.AnonymousConnecting\n            || this.state === State.WebsocketAuthenticating) {\n            this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\n        }\n        else {\n            this.showIgnored('onConnectingTimeout');\n        }\n    };\n    /** socket.io handshake succeed and socket.io is trying next transport */\n    TrouterFsm.prototype.onConnecting = function () {\n        if (this.state === State.Handshaking) {\n            this.setState(State.Connecting);\n        }\n        else {\n            this.showIgnored('onConnecting');\n        }\n    };\n    /** socket.io connected (1::), but trouter.connected event has not arrived yet */\n    TrouterFsm.prototype.onSocketConnect = function (token) {\n        if (this.state === State.AnonymousConnecting) {\n            this.setState(State.WebsocketAuthenticating);\n            this.worker.sendV4cAuthenticationEvent(token);\n        }\n        else {\n            this.showIgnored('onSocketConnect');\n        }\n    };\n    /** Socket.io connection wasn't established */\n    TrouterFsm.prototype.onConnectingFailed = function () {\n        // This callback will be called when all transports failed to connect, i.e. socket.io can't proceed\n        if (this.state === State.Connecting) {\n            this.onConnectingTimeout();\n        }\n        else if (this.state === State.Handshaking) {\n            // It should never happen, because socket.io should try at least one transport\n            this.logger.error('Unexpected error in Socket.io - no valid transports');\n            this.onConnectingTimeout();\n        }\n        else if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\n            this.logger.info('/v4/c falling back to longpoll');\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'v4c-websocket-failure' } });\n        }\n        else {\n            this.showIgnored('onConnectingFailed');\n        }\n    };\n    /** Socket.io error (or disconnect) */\n    TrouterFsm.prototype.onSocketDisconnect = function (disconnectReason) {\n        if (this.state === State.Handshaking || this.state === State.Connected || this.state === State.WebsocketAuthenticating) {\n            if (this.state === State.Connected) {\n                this.worker.sendDisconnectTelemetryEvent(disconnectReason === null || disconnectReason === void 0 ? void 0 : disconnectReason.toTelemetryString());\n            }\n            if (this.state === State.WebsocketAuthenticating) {\n                this.worker.countDisconnectBeforeConnectionEstablishment();\n            }\n            if ((disconnectReason === null || disconnectReason === void 0 ? void 0 : disconnectReason.reason) === 'skypetoken-deprecated') {\n                this.logger.error('Skypetoken deprecated response, not retrying any further');\n                this.onTerminalError();\n            }\n            else {\n                this.cleanUpAndInitiateReconnect({\n                    // If client was already successfully connected, no backoff is needed (we want to reconnect quickly).\n                    // If however connection failed before the `trouter.connected` event arrived,\n                    // that means some sort of error where we don't want to retry immediately.\n                    backoff: this.state !== State.Connected && (disconnectReason === null || disconnectReason === void 0 ? void 0 : disconnectReason.reason) !== 'dup',\n                    allowCachedToken: (disconnectReason === null || disconnectReason === void 0 ? void 0 : disconnectReason.reason) !== 'unauthorized',\n                    claimsChallenge: disconnectReason === null || disconnectReason === void 0 ? void 0 : disconnectReason.claims\n                });\n            }\n        }\n        else {\n            // Disconnect can be called because of an error.\n            // Such error can happen in Connecting state, which means that\n            // websocket transport failed to establish connection\n            this.showIgnored('onSocketDisconnect');\n        }\n    };\n    /** Received 'trouter.connected' event from service */\n    TrouterFsm.prototype.onTrouterConnected = function () {\n        if (this.state === State.Connecting || this.state === State.WebsocketAuthenticating) {\n            this.setState(State.Connected);\n            this.worker.resetTokenBackoff();\n            this.worker.stopConnectionTimer();\n            this.worker.sendUserActivityState(InternalInterfaces_1.UserActivityEventReason.Connected, true);\n            this.worker.startPingTimer();\n            this.worker.dispatchConnected();\n            if (this.worker.shouldSkipRegistration()) {\n                this.registrationState = RegistrationState.RegistrationDisabled;\n                this.worker.dispatchRegistered();\n            }\n            else {\n                this.registrationState = RegistrationState.Registering;\n                this.worker.sendRegisterRequest();\n            }\n        }\n        else {\n            this.showIgnored('onTrouterConnected');\n        }\n    };\n    /**\n     * Received 'trouter.reconnect' event from service, or URL in configuration has changed,\n     * need to establish a new connection\n     */\n    TrouterFsm.prototype.onReconnectRequired = function (useConnectParamsFromCache, reason, eventArgs) {\n        if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\n            if (eventArgs === undefined || eventArgs.target !== 'host' || eventArgs.url === undefined || eventArgs.url === '') {\n                this.logger.error(\"unexpected reconnect arguments: \".concat(eventArgs === null || eventArgs === void 0 ? void 0 : eventArgs.target, \" \").concat(eventArgs === null || eventArgs === void 0 ? void 0 : eventArgs.url, \", reconnecting without cache\"));\n                this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'redirect-no-host' } });\n            }\n            else {\n                this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'redirect', host: eventArgs.url } });\n            }\n        }\n        else {\n            this.worker.dispatchReconnectIsRequired(useConnectParamsFromCache, reason);\n        }\n    };\n    TrouterFsm.prototype.disableAutoReconnect = function () {\n        this.autoReconnect = false;\n    };\n    /** Request from downstream is received */\n    TrouterFsm.prototype.onDownstreamRequest = function (request) {\n        if (this.state === State.Connected) {\n            this.switchToIncallModeIfEnabled();\n            this.worker.dispatchDownstreamRequest(request);\n        }\n        else {\n            this.showIgnored('onDownstreamRequest');\n        }\n    };\n    TrouterFsm.prototype.onTrouterMessageLost = function (messageLossIndicators) {\n        if (this.state === State.Connected) {\n            this.worker.dispatchTrouterMessageLost(messageLossIndicators);\n        }\n        else {\n            this.showIgnored('onTrouterMessageLost');\n        }\n    };\n    /** Timer for ping request fired */\n    TrouterFsm.prototype.onPingInterval = function () {\n        if (this.state === State.Connected) {\n            this.worker.sendPingRequest();\n        }\n        else {\n            this.showIgnored('onPingInterval');\n        }\n    };\n    /** No pong response from service within timeout */\n    TrouterFsm.prototype.onPingResponseTimeout = function () {\n        this.onMissedResponse('onPingResponseTimeout');\n    };\n    /** Pong response */\n    TrouterFsm.prototype.onPingResponse = function () {\n        if (this.state === State.Connected) {\n            // do nothing\n        }\n        else {\n            this.showIgnored('onPingResponse');\n        }\n    };\n    TrouterFsm.prototype.onRegistrationFailed = function () {\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\n            this.worker.dispatchUnregistered();\n            this.registrationState = RegistrationState.Retrying;\n            this.worker.startRegistrationRetryTimer();\n        }\n        else if (this.state === State.Connected && this.registrationState === RegistrationState.RegisteringButResendPending) {\n            this.registrationState = RegistrationState.Registering;\n            this.worker.sendRegisterRequest();\n        }\n        else {\n            this.showIgnored('onRegistrationFailed');\n        }\n    };\n    TrouterFsm.prototype.onRetryRegistration = function () {\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Retrying) {\n            this.registrationState = RegistrationState.Registering;\n            this.worker.sendRegisterRequest();\n        }\n        else {\n            this.showIgnored('onRetryRegistration');\n        }\n    };\n    TrouterFsm.prototype.onRegistrationSucceeded = function () {\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\n            this.registrationState = RegistrationState.Registered;\n            this.worker.dispatchRegistered();\n            this.worker.startRegistrationTimer();\n        }\n        else if (this.state === State.Connected && this.registrationState === RegistrationState.RegisteringButResendPending) {\n            this.registrationState = RegistrationState.Registering;\n            this.worker.sendRegisterRequest();\n        }\n        else {\n            this.showIgnored('onRegistrationSucceeded');\n        }\n    };\n    /** Registration TTL is about to expire */\n    TrouterFsm.prototype.onRegistrationNearExpiry = function () {\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registered) {\n            this.registrationState = RegistrationState.Registering;\n            this.worker.sendRegisterRequest();\n        }\n        else {\n            this.showIgnored('onRegistrationNearExpiry');\n        }\n    };\n    TrouterFsm.prototype.onUnregistrationDone = function () {\n        if (this.state === State.Unregistering) {\n            this.setState(State.Initial);\n            this.worker.dispatchUnregistered();\n            this.worker.dispatchDisconnected(); // TODO: only sending \"disconneted\" upon unregistration makes no sense\n        }\n        else {\n            this.showIgnored('onUnregistrationDone');\n        }\n    };\n    TrouterFsm.prototype.onResendRegistration = function () {\n        this.worker.dispatchUnregistered();\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registered) {\n            this.registrationState = RegistrationState.Registering;\n            this.worker.stopRegistrationTimer();\n            this.worker.sendRegisterRequest();\n        }\n        else if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\n            this.registrationState = RegistrationState.RegisteringButResendPending;\n        }\n    };\n    TrouterFsm.prototype.onIncallModeTimer = function () {\n        this.worker.exitIncallMode();\n        if (this.state === State.Connected) {\n            this.worker.stopPingTimer();\n            this.worker.startPingTimer();\n        }\n        else {\n            this.showIgnored('onIncallModeTimer');\n        }\n    };\n    TrouterFsm.prototype.onSetNewUserActivityState = function () {\n        this.worker.sendUserActivityState(InternalInterfaces_1.UserActivityEventReason.Modified, this.state === State.Connected);\n    };\n    TrouterFsm.prototype.onActivityStateResponseTimeout = function () {\n        this.onMissedResponse('onActivityStateResponseTimeout');\n    };\n    TrouterFsm.prototype.forceReconnect = function (reason) {\n        if (this.state === State.Connected) {\n            this.worker.sendDisconnectTelemetryEvent(reason);\n        }\n        this.worker.resetTokenBackoff();\n        this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\n    };\n    TrouterFsm.prototype.onTerminalError = function () {\n        this.logger.error(\"Cannot proceed, reached terminal state. Switching from state '\".concat(State[this.state], \"' to \").concat(State[State.TerminalError]));\n        this.stop(\n        /* dontUnregister */ true, \n        /* isTerminalError */ true);\n        this.setState(State.TerminalError);\n    };\n    TrouterFsm.prototype.onMissedResponse = function (onResponseHandlerName) {\n        if (this.state === State.Connected) {\n            this.worker.sendDisconnectTelemetryEvent(onResponseHandlerName);\n            this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\n        }\n        else {\n            this.showIgnored(onResponseHandlerName);\n        }\n    };\n    TrouterFsm.prototype.showIgnored = function (event) {\n        this.logger.debug(\"Ignoring event '\".concat(event, \"' in state '\").concat(State[this.state], \"'\"));\n    };\n    TrouterFsm.prototype.setState = function (state) {\n        this.logger.info(\"Switching from state '\".concat(State[this.state], \"' to state '\").concat(State[state], \"'\"));\n        if (this.state === state) {\n            this.logger.error(\"Attempt to switch to the current state '\".concat(State[state], \"'\"));\n            return;\n        }\n        this.state = state;\n    };\n    TrouterFsm.prototype.switchToIncallModeIfEnabled = function () {\n        if (this.incallModeEnabled) {\n            if (!this.worker.isIncallMode()) {\n                this.worker.enterIncallMode();\n                this.worker.stopPingTimer();\n                this.worker.startPingTimer();\n            }\n            this.worker.restartIncallModeTimer();\n        }\n    };\n    TrouterFsm.prototype.cleanUpAndInitiateReconnect = function (options) {\n        if (!this.autoReconnect) {\n            this.logger.info('Automatic reconnect is disabled, stopping this connection');\n            this.stop(true);\n            return;\n        }\n        this.worker.cancelPendingRegistrationRequests();\n        this.worker.stopConnectionTimer();\n        this.worker.stopPingTimer();\n        this.worker.clearSentEventTimers();\n        this.worker.stopRegistrationTimer();\n        this.worker.stopSocketIo();\n        this.setState(State.RetrievingToken);\n        this.worker.dispatchReconnecting();\n        this.worker.getToken(options.allowCachedToken, options.backoff, options.claimsChallenge, options.fallbackReason);\n    };\n    return TrouterFsm;\n}());\nexports.TrouterFsm = TrouterFsm;\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterConnection = exports.ReconnectReason = void 0;\nvar tsregistrar_1 = __webpack_require__(21);\nvar Common_1 = __webpack_require__(3);\nvar ConnectionTracker_1 = __webpack_require__(15);\nvar Constants_1 = __webpack_require__(1);\nvar DisconnectReason_1 = __webpack_require__(16);\nvar ExponentialBackoff_1 = __webpack_require__(17);\nvar Interfaces_1 = __webpack_require__(2);\nvar InternalInterfaces_1 = __webpack_require__(4);\nvar Logger_1 = __webpack_require__(0);\nvar ProtocolAdapters_1 = __webpack_require__(5);\nvar TrouterFsm_1 = __webpack_require__(6);\n// This is the current API version\nvar VERSION = 'v4';\n// Default value for registration timeout\nvar DEFAULT_REGISTRATION_TIMEOUT_SEC = 3600;\n// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-explicit-any\nvar io = __webpack_require__(12);\n/**\n * Stub for IClientInfo\n */\nvar ClientInfo = /** @class */ (function () {\n    function ClientInfo() {\n        this.cv = Constants_1.CLIENT_VERSION;\n        this.ua = '';\n        this.hr = '';\n        this.v = '';\n    }\n    return ClientInfo;\n}());\n/**\n * Stub for ISocketIoOptions\n */\nvar SocketIoOptions = /** @class */ (function () {\n    function SocketIoOptions() {\n        this['force new connection'] = true;\n        this['reconnect'] = false;\n        this['query'] = '';\n        this.ackTimeoutMs = 5000;\n    }\n    SocketIoOptions.prototype.rewriteUrlForProxy = function (url) { return url; };\n    return SocketIoOptions;\n}());\nvar cvHeader = 'MS-CV';\n/**\n * Request from downstream service\n */\nvar TrouterRequest = /** @class */ (function () {\n    function TrouterRequest(requestJson, logger) {\n        this.logger = logger;\n        this.cvCounter = 0;\n        var json = JSON.parse(requestJson);\n        this.startTS = this.safeJsonNumber(json, 'startTS', 0);\n        this.url = this.safeJsonString(json, 'url', '');\n        this.shortUrl = this.safeJsonString(json, 'shortUrl', '');\n        this.body = this.safeJsonString(json, 'body', '');\n        this.headers = this.safeJsonRecord(json, 'headers', {});\n        this.id = this.safeJsonNumber(json, 'id', -1);\n        this.method = this.safeJsonString(json, 'method', '');\n        this.replied = false;\n        this.timedout = false;\n        this.receivedCv = this.headers[cvHeader];\n        this.updateCvHeader();\n    }\n    Object.defineProperty(TrouterRequest.prototype, \"correlationVector\", {\n        get: function () {\n            return this.receivedCv ? \"\".concat(this.receivedCv, \".\").concat(this.cvCounter) : '';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    TrouterRequest.prototype.on = function (target, targetCallback) {\n        if (target === 'data') {\n            this.dataCallback = targetCallback;\n        }\n        else if (target === 'end') {\n            if (typeof this.dataCallback === 'function') {\n                this.dataCallback(this.body);\n            }\n            targetCallback();\n        }\n    };\n    TrouterRequest.prototype.incrementCorrelationVector = function () {\n        ++this.cvCounter;\n        this.updateCvHeader();\n    };\n    TrouterRequest.prototype.updateCvHeader = function () {\n        var cv = this.correlationVector;\n        if (cv) {\n            this.headers[cvHeader] = cv;\n        }\n    };\n    TrouterRequest.prototype.safeJsonNumber = function (json, property, defaultValue) {\n        var _a;\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\n            var jsonRecord = json;\n            if (typeof jsonRecord[property] === 'number') {\n                return (jsonRecord[property]);\n            }\n            else if (typeof jsonRecord[property] === 'string') {\n                return parseFloat((jsonRecord[property]));\n            }\n            else {\n                (_a = this.logger) === null || _a === void 0 ? void 0 : _a.warn(\"unexpected type of '\".concat(property, \"': \").concat(typeof jsonRecord[property]));\n            }\n        }\n        return defaultValue;\n    };\n    TrouterRequest.prototype.safeJsonString = function (json, property, defaultValue) {\n        var _a;\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\n            var jsonRecord = json;\n            if (typeof jsonRecord[property] === 'string') {\n                return (jsonRecord[property]);\n            }\n            else {\n                (_a = this.logger) === null || _a === void 0 ? void 0 : _a.warn(\"unexpected type of '\".concat(property, \"': \").concat(typeof jsonRecord[property]));\n            }\n        }\n        return defaultValue;\n    };\n    TrouterRequest.prototype.safeJsonRecord = function (json, property, defaultValue) {\n        var _a;\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\n            var jsonRecord = json;\n            if (typeof jsonRecord[property] === 'object') {\n                return (jsonRecord[property]);\n            }\n            else {\n                (_a = this.logger) === null || _a === void 0 ? void 0 : _a.warn(\"unexpected type of '\".concat(property, \"': \").concat(typeof jsonRecord[property]));\n            }\n        }\n        return defaultValue;\n    };\n    return TrouterRequest;\n}());\n/**\n * Response to downstream service\n */\nvar TrouterResponse = /** @class */ (function () {\n    function TrouterResponse(request, responseData, sendResponse) {\n        this.request = request;\n        this.responseData = responseData;\n        this.sendResponse = sendResponse;\n    }\n    TrouterResponse.prototype.writeHead = function (status, headers) {\n        this.responseData.status = status;\n        this.responseData.headers = headers;\n    };\n    TrouterResponse.prototype.write = function (chunk) {\n        this.responseData.body += chunk;\n    };\n    TrouterResponse.prototype.end = function (chunk) {\n        if (chunk) {\n            this.responseData.body += chunk;\n        }\n        return this.sendResponse(this.request, this.responseData);\n    };\n    return TrouterResponse;\n}());\n/**\n * An client-initiated event that is to be sent to trouter.\n */\nvar DownstreamEvent = /** @class */ (function () {\n    function DownstreamEvent(name) {\n        this.name = name;\n        this.args = {};\n        this.timeoutTimerId = 0;\n    }\n    return DownstreamEvent;\n}());\n/**\n * Reason why a connection switch is happening.\n */\nvar ReconnectReason;\n(function (ReconnectReason) {\n    /** Configuration change coming from ECS, containing different URL */\n    ReconnectReason[ReconnectReason[\"Configuration\"] = 0] = \"Configuration\";\n    /** In response to a `trouter.reconnect` socket.io event */\n    ReconnectReason[ReconnectReason[\"ServerInitiated\"] = 1] = \"ServerInitiated\";\n})(ReconnectReason || (exports.ReconnectReason = ReconnectReason = {}));\n/**\n * Trouter + registration flow implementation\n */\nvar TrouterConnection = /** @class */ (function () {\n    function TrouterConnection(logProvider, options, manager, tokenProvider, usingLegacyTokenApi, initialUserActivityState, protocolSelector, audienceSubscriptionState) {\n        var _this = this;\n        var _a;\n        this.options = options;\n        this.manager = manager;\n        this.tokenProvider = tokenProvider;\n        this.usingLegacyTokenApi = usingLegacyTokenApi;\n        this.protocolSelector = protocolSelector;\n        this.audienceSubscriptionState = audienceSubscriptionState;\n        this.WEBSOCKET_TRANSPORT_NAME = 'websocket';\n        this.XHR_POLLING_TRANSPORT_NAME = 'xhr-polling';\n        this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR = 'Error';\n        this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED = 'Unsubscribed';\n        this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT = 'Timeout';\n        this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST = \"BadRequest\";\n        this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX = /&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/;\n        this.connectionId = '';\n        this.inIncallMode = false;\n        this.connectionAttempt = 0;\n        this.connectedClientId = '';\n        this.isNavigatorOnline = true;\n        this.onNavigatorOnlineStatusUpdateBound = this.onNavigatorOnlineStatusUpdate.bind(this); // Bound to allow removing the listener\n        this.c2cUrlBase = '';\n        this.connectingErrorsInRow = 0;\n        /** Keeps track of 401s */\n        this.unauthorizedErrorCount = 0;\n        this.pendingSentEventTimers = {};\n        this.lastDisconnectReason = '';\n        this.UNKNOWN_TRANSPORT = 'unknown_transport';\n        this.connectingErrorsThreshold = 3;\n        // this variable represents and ongoing audience subscription operation that has been initiated by user\n        // if the operation value exists it means that user requested a subscription but there has not been an answer from server yet\n        // valid only for longpoll \n        this.pendingAudienceSubscription = undefined;\n        this.logger = new Logger_1.Logger('Connection', logProvider);\n        this.timeoutOptions = this.options.timeoutOptions;\n        this.tokenBackoff = new ExponentialBackoff_1.ExponentialBackoff(this.logger, this.timeoutOptions.maxBackoffMs);\n        this.clientID = Date.now();\n        if ((typeof window !== 'undefined') && window.location) {\n            this.domId = window.location.hostname;\n        }\n        var clientInfo = new ClientInfo();\n        clientInfo.cv = Constants_1.CLIENT_VERSION;\n        clientInfo.ua = '';\n        if ((_a = this.options) === null || _a === void 0 ? void 0 : _a.clientInfo) {\n            clientInfo.ua = this.safeString(this.options.clientInfo.ua);\n            clientInfo.v = this.safeString(this.options.clientInfo.v);\n        }\n        this.clientInfo = clientInfo;\n        this.connectionTracker = new ConnectionTracker_1.ConnectionTracker(logProvider, this.clientID, this.clientInfo, function () { return _this.getServerState(); }, this.options.endpointId, this.options.clientCorrelationID, this.options.environment);\n        this.applyConnectionTrackerOptions(options);\n        var useIncallMode = this.options.incallModeTimeoutMs > 0;\n        this.fsm = new TrouterFsm_1.TrouterFsm(logProvider, this, useIncallMode, this.protocolSelector);\n        if (options.registration) {\n            var registrarOptions = {\n                registrarUrl: options.registration.registrarUrl,\n                proxyUrlRewrite: options.rewriteUrlForProxy,\n                registrationId: options.registration.registrationId,\n                requestTimeoutMs: options.timeoutOptions.fetchTimeoutMs,\n                initialRetryDelayMs: 1000,\n                maxRetryDelayMs: options.timeoutOptions.maxBackoffMs,\n                usingLegacyTokenApi: this.usingLegacyTokenApi,\n                maxRetriesForGetToken: options.retryLimitOnTokenFetch,\n                extraRegistrationHeaders: options.extraConnectionHeaders\n            };\n            this.registrarClient = (0, tsregistrar_1.createRegistrarClient)(logProvider, this.tokenProvider, registrarOptions);\n        }\n        this.userActivityState = initialUserActivityState;\n    }\n    TrouterConnection.prototype.start = function (externalConnectParams) {\n        this.logger.info('Starting');\n        this.reconnectParams = externalConnectParams;\n        if (typeof window !== 'undefined' && window.navigator && window.addEventListener) {\n            this.isNavigatorOnline = window.navigator.onLine;\n            window.addEventListener('online', this.onNavigatorOnlineStatusUpdateBound);\n            window.addEventListener('offline', this.onNavigatorOnlineStatusUpdateBound);\n            this.logger.debug(\"Registered for browser online notifications - current state: \".concat(this.isNavigatorOnline));\n        }\n        else {\n            this.isNavigatorOnline = true; // Assume always online if the API is not available\n        }\n        this.fsm.start();\n    };\n    TrouterConnection.prototype.stop = function (dontUnregister) {\n        this.logger.info('Stopping');\n        if (typeof window !== 'undefined' && window.navigator) {\n            window.removeEventListener('online', this.onNavigatorOnlineStatusUpdateBound);\n            window.removeEventListener('offline', this.onNavigatorOnlineStatusUpdateBound);\n        }\n        this.fsm.stop(dontUnregister);\n        this.connectionTracker.close();\n    };\n    TrouterConnection.prototype.configure = function (options) {\n        // Currently only baseUrl and telemetrySettings options are supported for reconfiguration\n        var urlChanged = this.options.trouterUrl !== options.trouterUrl;\n        this.options = options;\n        this.applyConnectionTrackerOptions(options);\n        if (urlChanged) {\n            this.logger.info('Configuration changed. Reconnection required.');\n            this.fsm.onReconnectRequired(false, ReconnectReason.Configuration);\n        }\n    };\n    TrouterConnection.prototype.checkConnection = function (disconnectDetected) {\n        this.logger.info(\"checkConnection called with \".concat(disconnectDetected));\n        this.fsm.checkConnection(disconnectDetected);\n        // Don't send on disconnectDetected === false, because Teams client calls it on timer\n        if (disconnectDetected) {\n            this.connectionTracker.sendTelemetry(ConnectionTracker_1.ClientEventName.CheckConnection, {\n                disconnectDetected: disconnectDetected\n            }, []);\n        }\n    };\n    TrouterConnection.prototype.disableRegistrationsAndAutoReconnect = function () {\n        this.stopRegistrationTimer();\n        this.cancelPendingRegistrationRequests();\n        this.fsm.disableAutoReconnect();\n    };\n    /** Returns info about connection */\n    TrouterConnection.prototype.getServerState = function () {\n        return new InternalInterfaces_1.ServerState(this.connectionId, this.connectedClientId, this.domId ? this.domId : '', this.allocateResult ? this.allocateResult.url : '', this.allocateResult ? this.allocateResult.surl : '', this.c2cUrlBase, this.connectionExpireTimestampInSecs);\n    };\n    TrouterConnection.prototype.getState = function () {\n        return this.fsm.getState();\n    };\n    //////// Implement IWorker ////////\n    TrouterConnection.prototype.getToken = function (useCache, backoff, claimsChallenge, reason, retryCounter) {\n        var _this = this;\n        if (retryCounter === void 0) { retryCounter = 0; }\n        this.logger.info(\"Getting token \".concat(backoff ? 'with backoff' : 'without backoff'));\n        var requestFunction = function () {\n            _this.connectionTracker.trackStart('token');\n            var tokenRequest = {\n                needFresh: !useCache,\n                wwwAuthenticateHeader: claimsChallenge,\n                supportedTokenTypes: Constants_1.SUPPORTED_TOKEN_TYPES,\n                purpose: 'trouter'\n            };\n            _this.logger.info(\"Requesting token: needFresh=\".concat(tokenRequest.needFresh, \" \") +\n                \"types=[\".concat(Constants_1.SUPPORTED_TOKEN_TYPES, \"], \") +\n                \"wwwAuthenticateHeader is \".concat(tokenRequest.wwwAuthenticateHeader ? 'non empty' : 'empty'));\n            _this.tokenProvider(tokenRequest).then(function (token) {\n                _this.logger.debug(\"\".concat(token.tokenType, \" token is received\"));\n                _this.connectionTracker.trackEnd('token');\n                _this.fsm.onTokenReceived(token, reason, _this.reconnectParams);\n            }).catch(function (error) {\n                var msg = (0, Common_1.toJson)(error.stack);\n                _this.logger.error(\"Getting token failed, will retry after timeout. Error: \".concat(msg));\n                _this.connectionTracker.trackError('token', msg);\n                // Can't retry getToken request, which means client would not receive any notifications from trouter.\n                // Unrecoverable error unless client tries to reconnect with Trouter\n                //     - retryCounter tracks internal loop\n                //     - unauthorizedErrorCount tracks external loop (consecutive number of sendAllocationFailures as a result of 401s)\n                if (!_this.canRetryTokenFetchRequest(retryCounter + _this.unauthorizedErrorCount)) {\n                    var errorMessage = 'getToken retry limit hit, reached terminal error state';\n                    _this.connectionTracker.trackError('token', errorMessage);\n                    _this.resetTokenBackoff();\n                    _this.fsm.onTerminalError();\n                    return;\n                }\n                _this.getToken(useCache, true, claimsChallenge, reason, retryCounter + 1);\n            });\n        };\n        if (backoff) {\n            this.tokenBackoff.backoff('getting token', requestFunction);\n        }\n        else {\n            this.resetTokenBackoff();\n            requestFunction();\n        }\n    };\n    TrouterConnection.prototype.startConnectionTimer = function () {\n        var _this = this;\n        this.stopConnectionTimer();\n        this.logger.debug(\"Starting connection timeout for \".concat(this.timeoutOptions.connectionTimeoutMs, \" ms\"));\n        this.connectionTimeoutId = setTimeout(function () {\n            _this.logger.info('Connection timeout is fired');\n            _this.fsm.onConnectingTimeout();\n        }, this.timeoutOptions.connectionTimeoutMs);\n    };\n    TrouterConnection.prototype.stopConnectionTimer = function () {\n        if (this.connectionTimeoutId) {\n            this.logger.debug('Stopping connection timeout');\n            clearTimeout(this.connectionTimeoutId);\n            this.connectionTimeoutId = undefined;\n        }\n    };\n    TrouterConnection.prototype.startPingTimer = function () {\n        var _this = this;\n        if (this.transportTypeName === 'websocket') {\n            this.logger.debug(\"Starting ping timeout for \".concat(this.timeoutOptions.pingTimeoutMs, \" ms\"));\n            this.pingTimerId = setInterval(function () {\n                _this.logger.info('Ping interval fired');\n                _this.fsm.onPingInterval();\n            }, this.timeoutOptions.pingTimeoutMs);\n        }\n        else {\n            this.logger.debug(\"Not starting ping for transport \".concat(this.transportTypeName));\n        }\n    };\n    TrouterConnection.prototype.stopPingTimer = function () {\n        if (this.pingTimerId) {\n            this.logger.debug('Stopping ping timeout');\n            this.clearPingResponseTimer();\n            clearInterval(this.pingTimerId);\n            this.pingTimerId = undefined;\n        }\n    };\n    TrouterConnection.prototype.shouldSkipRegistration = function () {\n        return this.options.registration === undefined;\n    };\n    TrouterConnection.prototype.hasCustomRegistrationTtl = function () {\n        var _a, _b;\n        return ((_a = this.options.registration) === null || _a === void 0 ? void 0 : _a.registrarTtlSec) !== undefined && ((_b = this.options.registration) === null || _b === void 0 ? void 0 : _b.registrarTtlSec) !== 0;\n    };\n    TrouterConnection.prototype.startRegistrationTimer = function () {\n        var _this = this;\n        this.stopRegistrationTimer();\n        var timeForReregistrationSec = 30;\n        var _a = this.getRegistrationTtl(), ttl = _a[0], isTtlReduced = _a[1];\n        if (ttl <= timeForReregistrationSec || !isTtlReduced) {\n            this.logger.debug(\"Starting registration expiration timer (TTL \".concat(ttl, \" sec)\"));\n            this.registrationTimerId = setTimeout(function () {\n                _this.registrationTimerId = undefined;\n                _this.logger.warn('Registration expired but the connection is still alive. Should never happen');\n                _this.dispatchUnregistered();\n            }, ttl * 1000);\n            return;\n        }\n        var delay = ttl - timeForReregistrationSec;\n        this.logger.debug(\"Starting registration extension timer for \".concat(delay, \" sec\"));\n        this.registrationTimerId = setTimeout(function () {\n            _this.logger.info('Registration extension timer fired');\n            _this.registrationTimerId = setTimeout(function () {\n                _this.registrationTimerId = undefined;\n                _this.logger.debug('Registration extension did not happen in time');\n                _this.dispatchUnregistered();\n            }, timeForReregistrationSec * 1000);\n            _this.fsm.onRegistrationNearExpiry();\n        }, delay * 1000);\n    };\n    TrouterConnection.prototype.startRegistrationRetryTimer = function () {\n        var _this = this;\n        this.stopRegistrationTimer();\n        // A simple static delay for now, per discussion in PR 870422.\n        var registrationRetryDelaySec = 123;\n        this.registrationTimerId = setTimeout(function () {\n            _this.registrationTimerId = undefined;\n            _this.fsm.onRetryRegistration();\n        }, registrationRetryDelaySec * 1000);\n    };\n    TrouterConnection.prototype.stopRegistrationTimer = function () {\n        if (this.registrationTimerId) {\n            this.logger.debug('Stopping registration timeout');\n            clearTimeout(this.registrationTimerId);\n            this.registrationTimerId = undefined;\n        }\n    };\n    TrouterConnection.prototype.resendRegistration = function () {\n        if (!this.registrarClient) {\n            throw new Error('Trouter Client not configured to handle registrations');\n        }\n        this.fsm.onResendRegistration();\n        return Promise.resolve();\n    };\n    TrouterConnection.prototype.buildSocketIoUrlParams = function (userActivitySnapshot, audienceSubscriptionSnapshot) {\n        if (!this.allocateResult) {\n            throw new Error('Allocate result is undefined in buildSocketIoUrlParams()');\n        }\n        var urlParams = {};\n        // Copy connection parameters (i.e. signature) from allocation response\n        var signatureData = this.allocateResult.connectparams;\n        for (var _i = 0, _a = Object.keys(signatureData); _i < _a.length; _i++) {\n            var i = _a[_i];\n            if (signatureData[i] !== undefined) {\n                var value = signatureData[i];\n                if (typeof value === 'string' || typeof value === 'number') {\n                    urlParams[i] = value;\n                }\n                else {\n                    this.logger.error(\"signatureData[\".concat(i, \"] has unsupported type \").concat(typeof value));\n                }\n            }\n        }\n        // And add some more fields\n        urlParams.v = VERSION;\n        urlParams.tc = encodeURI((0, Common_1.toJson)(this.clientInfo));\n        urlParams.timeout = this.timeoutOptions.pingTimeoutMs / 1000;\n        urlParams.auth = 'true';\n        if (this.options.endpointId) {\n            urlParams.epid = this.options.endpointId;\n        }\n        if (userActivitySnapshot) {\n            urlParams.userActivity = encodeURI((0, Common_1.toJson)(userActivitySnapshot));\n        }\n        if (audienceSubscriptionSnapshot) {\n            urlParams.audienceSubscriptionState = encodeURIComponent((0, Common_1.toJson)(audienceSubscriptionSnapshot));\n        }\n        return this.appendConnectedClientIds(this.buildQuery(urlParams), true);\n    };\n    TrouterConnection.prototype.startSocketIo = function (token) {\n        var _a, _b;\n        this.logger.debug('Starting socket io');\n        this.connectionTracker.trackStart('connectSocket');\n        if (!this.allocateResult) {\n            throw new Error('Allocate result is undefined in startSocketIo()');\n        }\n        var options = this.options.ioOptions ? __assign({}, this.options.ioOptions) : new SocketIoOptions();\n        // Take user activity snapshot (if a state isn't unknown) to make sure it's consistent between the function calls below.\n        var userActivitySnapshot = this.userActivityState.state !== Interfaces_1.UserActivityState.Unknown\n            ? this.userActivityState.increaseCvAndGetEventObject()\n            : undefined;\n        var audienceSubscriptionStateSnapshot = (_a = this.audienceSubscriptionState) === null || _a === void 0 ? void 0 : _a.increaseCvAndGetEventObject();\n        // Regardless of any passed in socket.io options, force the following settings.\n        options['force new connection'] = true;\n        options.reconnect = false;\n        options.rewriteUrlForProxy = this.options.rewriteUrlForProxy;\n        options.requestHeaders = __assign(__assign({}, this.options.extraConnectionHeaders), headersFromToken(token, this.usingLegacyTokenApi));\n        // Query params to each socket.io request\n        options.query = this.buildSocketIoUrlParams(userActivitySnapshot, audienceSubscriptionStateSnapshot);\n        this.logger.info(\"connecting to \".concat(this.allocateResult.socketio, \"?\").concat(options.query));\n        // msg868 - clear all events and disconnect\n        this.stopSocketIo();\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call\n        this.socket = ((_b = this.options.io) !== null && _b !== void 0 ? _b : io).connect(this.allocateResult.socketio, options);\n        if (this.socket === undefined) {\n            throw new Error('Can\\'t create Socket.io object');\n        }\n        this.attachSocketIoHandlers(this.socket, token, userActivitySnapshot, audienceSubscriptionStateSnapshot);\n    };\n    TrouterConnection.prototype.stopSocketIo = function () {\n        if (this.socket) {\n            this.logger.debug('clearing socket.io');\n            try {\n                for (var _i = 0, _a = [\n                    'connecting', 'connect', 'connect_failed', 'close_during_connecting', 'disconnect', 'reconnect', 'reconnect_failed',\n                    'reconnecting', 'error', 'message', 'trouter.connected', 'trouter.reconnect', 'trouter.message_loss'\n                ]; _i < _a.length; _i++) {\n                    var event_1 = _a[_i];\n                    this.socket.removeAllListeners(event_1);\n                }\n                this.socket.disconnect();\n                this.logger.debug('cleared socket');\n                this.socket = undefined;\n            }\n            catch (error) {\n                this.logger.error(\"exception in disconnecting previous socket. Error: \".concat(errorStackToJson(error)));\n            }\n        }\n    };\n    TrouterConnection.prototype.dispatchConnected = function () {\n        this.logger.info('dispatching connected');\n        this.manager.onConnected(this);\n    };\n    TrouterConnection.prototype.dispatchRegistered = function () {\n        this.logger.info('dispatching registered');\n        this.manager.onRegistered(this);\n    };\n    TrouterConnection.prototype.dispatchUnregistered = function () {\n        this.logger.info('dispatching unregistered');\n        this.manager.onUnregistered(this);\n    };\n    TrouterConnection.prototype.dispatchDownstreamRequest = function (request) {\n        var _this = this;\n        this.logger.debug('dispatching downstream request');\n        try {\n            var response = new TrouterResponse(request, new ConnectionTracker_1.ResponseData(request.id), function (req, responseData) {\n                _this.logger.debug('sending response to downstream');\n                return _this.sendResponse(req, responseData);\n            });\n            this.manager.onDownstreamRequest(this, request, response);\n        }\n        catch (error) {\n            this.logger.error(\"exception in socket.on message. Error : \".concat(errorStackToJson(error)));\n        }\n    };\n    TrouterConnection.prototype.dispatchReconnecting = function () {\n        this.logger.info('dispatching reconnecting');\n        this.manager.onReconnecting(this);\n    };\n    TrouterConnection.prototype.dispatchReconnectIsRequired = function (useConnectParamsFromCache, reason) {\n        this.logger.info('dispatching reconnect is required by server');\n        this.manager.onReconnectIsRequired(this, useConnectParamsFromCache, reason);\n    };\n    TrouterConnection.prototype.dispatchDisconnected = function () {\n        this.logger.info('dispatching disconnected');\n        this.manager.onDisconnected(this);\n    };\n    TrouterConnection.prototype.dispatchTerminalError = function () {\n        this.logger.info('dispatching terminal error');\n        this.manager.onTerminalError(this);\n    };\n    TrouterConnection.prototype.dispatchTrouterMessageLost = function (messageLossIndicators) {\n        this.logger.info('dispatching trouter message lost');\n        this.manager.onTrouterMessageLost(messageLossIndicators);\n    };\n    TrouterConnection.prototype.countDisconnectBeforeConnectionEstablishment = function () {\n        this.logger.warn('counting disconnect before connection was fully established as a connection failure');\n        this.connectingErrorsInRow++;\n        if (this.connectingErrorsInRow >= this.connectingErrorsThreshold) {\n            this.resetReconnectParamsOnErrorThreshold();\n        }\n    };\n    TrouterConnection.prototype.sendProcessedDroppedIndicators = function (messageLossIndicators) {\n        var _this = this;\n        try {\n            this.logger.debug('emitting processed flow tags to the server');\n            var processedMessageLossEvent = new DownstreamEvent('trouter.processed_message_loss');\n            processedMessageLossEvent.args = { droppedIndicators: messageLossIndicators };\n            this.sendDownstreamEvent(processedMessageLossEvent, function () {\n                _this.logger.info('emitted processed flow tags to the server');\n            });\n        }\n        catch (error) {\n            var msg = errorStackToJson(error);\n            this.logger.error(\"unable to send processed message loss event. Error: \".concat(msg));\n            this.connectionTracker.trackError('trouter.processed_message_loss', msg, false);\n        }\n    };\n    TrouterConnection.prototype.sendAllocateRequest = function (token) {\n        var _this = this;\n        this.connectionAttempt++;\n        this.connectionTracker.trackNewConnection();\n        var url = this.options.trouterUrl;\n        var connectParams;\n        var rp = this.reconnectParams;\n        var expiration = typeof (rp === null || rp === void 0 ? void 0 : rp.se) === 'string' ? parseInt(rp.se, 10) : (typeof (rp === null || rp === void 0 ? void 0 : rp.se) === 'number' ? rp.se : undefined);\n        if (expiration && expiration <= Date.now() + 3600000) { // 1 hour\n            this.logger.warn(\"Dropping expired cached connection parameters: \".concat(new Date(expiration)));\n            this.reconnectParams = rp = undefined;\n        }\n        if (rp && rp.serviceUrl !== url) {\n            this.logger.warn(\"Dropping cached connection parameters for a different environment (\".concat(rp.serviceUrl, \", now \").concat(url, \")\"));\n            this.reconnectParams = rp = undefined;\n        }\n        if (rp === null || rp === void 0 ? void 0 : rp.reconnectUrl) {\n            url = rp.reconnectUrl;\n        }\n        if (rp) {\n            // Do not append serviceUrl and reconnectUrl as query parameters\n            connectParams = __assign(__assign({}, rp), { serviceUrl: undefined, reconnectUrl: undefined });\n        }\n        else {\n            connectParams = null;\n        }\n        url = (0, ProtocolAdapters_1.adaptUrl)(url, 'v4a');\n        url = this.appendCorrelationIds(url, false);\n        url = this.appendEndpointId(url, false);\n        if (connectParams) {\n            url += \"&\".concat(this.buildQuery(connectParams));\n            // Currently server doesn't return \"v\" in allocate result, but it\n            // can be changed, so implement it this way just in case\n            if (!connectParams.v) {\n                url += \"&v=\".concat(VERSION);\n            }\n        }\n        url = this.options.rewriteUrlForProxy(url);\n        var allocateRequest = new Request(url, {\n            method: 'POST',\n            mode: 'cors',\n            headers: new Headers(__assign(__assign({ 'Content-Type': 'text/plain' }, this.options.extraConnectionHeaders), headersFromToken(token, this.usingLegacyTokenApi)))\n        });\n        this.logger.info(\"sendAllocateRequest: POST \".concat(url));\n        this.connectionTracker.trackStart('allocation');\n        var startTimestamp = Date.now();\n        var responseStatusCode = -1;\n        var responseClaimsChallenge;\n        var responseSkypetokenDeprecated = false;\n        (0, Common_1.fetchWithTimeout)(allocateRequest, this.timeoutOptions.fetchTimeoutMs).then(function (response) {\n            var _a;\n            responseStatusCode = response.status;\n            if (!response.ok) {\n                responseClaimsChallenge = (_a = response.headers.get('www-authenticate')) !== null && _a !== void 0 ? _a : undefined;\n                responseSkypetokenDeprecated = response.headers.get('x-trouter-skypetoken-deprecated') === '1';\n                _this.logger.warn(\"Allocation request got response status \".concat(response.status, \", www-authenticate header was \").concat(responseClaimsChallenge ? 'not empty' : 'empty'));\n                throw new Error(response.statusText);\n            }\n            var contentType = response.headers.get('content-type');\n            if (!contentType || (contentType !== 'application/json' && !contentType.startsWith('application/json;'))) {\n                throw new Error(\"Content-type '\".concat(contentType, \"' is unexpected\"));\n            }\n            _this.connectionTracker.trackEnd('allocation');\n            return response.json();\n        }).then(function (responseObj) {\n            _this.unauthorizedErrorCount = 0;\n            // We perform no parsing/validation of the response received from server\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            _this.onAllocationResponse(responseObj, token);\n        }).catch(function (error) {\n            _this.connectingErrorsInRow++;\n            var msg = \"\".concat(error).concat(responseStatusCode >= 0 ? \", status code \".concat(responseStatusCode) : '');\n            _this.logger.error(\"\".concat(_this.connectingErrorsInRow, \" failed connecting attempt(s) in a row. \").concat(msg));\n            _this.connectionTracker.trackError('allocation', msg);\n            if (responseSkypetokenDeprecated) {\n                var errorMessage = 'Skypetoken deprecated response, not retrying any further';\n                _this.logger.error(errorMessage);\n                _this.connectionTracker.trackError('allocation', errorMessage);\n                _this.fsm.onTerminalError();\n                return;\n            }\n            if (responseStatusCode === 401) {\n                _this.unauthorizedErrorCount++;\n            }\n            if (!_this.canRetryTokenFetchRequest(_this.unauthorizedErrorCount)) {\n                var errorMessage = 'getToken retry limit hit, reached terminal error state';\n                _this.connectionTracker.trackError('allocation', errorMessage);\n                _this.fsm.onTerminalError();\n                return;\n            }\n            if (responseStatusCode === -1 && !_this.isNavigatorOnline) {\n                _this.logger.info('Expected failure, the browser says it is not online at the moment');\n            }\n            else if (_this.reconnectParams && _this.connectingErrorsInRow >= _this.connectingErrorsThreshold) {\n                if (responseStatusCode >= 400 && responseStatusCode <= 599) {\n                    _this.resetReconnectParamsOnErrorThreshold();\n                }\n                else if (_this.reconnectParams.reconnectUrl && _this.connectingErrorsInRow % 3 === 0) {\n                    _this.logger.warn(\"\".concat(_this.connectingErrorsInRow, \" connection attempts, testing nominal service URL\"));\n                    // Make sure to finish the check before connection timeout passes to avoid unexpected FSM calls\n                    var timeoutMs = Math.min(_this.timeoutOptions.connectionTimeoutMs - (Date.now() - startTimestamp) - 500, _this.timeoutOptions.fetchTimeoutMs);\n                    _this.testNominalUrlConnectivity(timeoutMs)\n                        .then(function (result) {\n                        _this.connectionTracker.trackProgress('nomcheck', result ? 'ok' : 'failed');\n                        if (result) {\n                            _this.logger.warn('Nominal service URL is reachable, erasing cached reconnect URL');\n                            if (_this.reconnectParams) {\n                                delete _this.reconnectParams.reconnectUrl;\n                            }\n                        }\n                        else {\n                            _this.logger.warn('Nominal service URL is not reachable either, keeping cached reconnect URL');\n                        }\n                        _this.fsm.onAllocationFailed(false, undefined);\n                    }, function () {\n                        // Should not happen, but removes no-floating-promises warning\n                        _this.fsm.onAllocationFailed(false, undefined);\n                    });\n                    return;\n                }\n            }\n            _this.fsm.onAllocationFailed(responseStatusCode === 401, responseClaimsChallenge);\n        });\n    };\n    TrouterConnection.prototype.testNominalUrlConnectivity = function (timeoutMs) {\n        var _this = this;\n        if (timeoutMs < 1000) {\n            this.logger.warn(\"There is no time left to reasonably perform the nominal service URL connectivity check (\".concat(timeoutMs, \" ms), falling back to assuming that the connectivity is fine\"));\n            return Promise.resolve(true);\n        }\n        var testRequest;\n        try {\n            var url = new URL(this.options.trouterUrl);\n            // Modify the URL to reach the root page (which returns a plain text string \"Trouter\")\n            url.pathname = '/';\n            // Add a few query parameters for possible classification and troubleshooting\n            url.search = '?' + this.buildQuery({\n                check: Date.now(),\n                cor_id: encodeURIComponent(this.options.clientCorrelationID),\n                epid: encodeURIComponent(this.options.endpointId ? this.options.endpointId : ''),\n                tc: encodeURIComponent((0, Common_1.toJson)(this.clientInfo))\n            });\n            testRequest = new Request(this.options.rewriteUrlForProxy(url.toString()), {\n                method: 'GET',\n                headers: { Accept: 'text/plain' }\n            });\n        }\n        catch (error) {\n            this.logger.warn(\"Nominal service URL connectivity test request could not be created (\".concat(error, \"), falling back to assuming that the connectivity is fine\"));\n            return Promise.resolve(true);\n        }\n        return (0, Common_1.fetchWithTimeout)(testRequest, timeoutMs)\n            .then(function (response) {\n            if (response.status !== 200) {\n                throw new Error(\"Not 200 OK: \".concat(response.status, \" \").concat(response.statusText));\n            }\n            return response.text();\n        })\n            .then(function (body) {\n            if (body !== 'Trouter') {\n                throw new Error(\"Not \\\"Trouter\\\": \".concat(body.substring(0, 16)).concat(body.length > 16 ? '...' : ''));\n            }\n            return true;\n        })\n            .catch(function (error) {\n            _this.logger.error(\"Nominal service URL connectivity test failed: \".concat(error));\n            return false;\n        });\n    };\n    TrouterConnection.prototype.sendPingRequest = function () {\n        var _this = this;\n        if (this.socket && this.pingResponseTimerId === undefined) {\n            try {\n                this.logger.debug('emitting ping event');\n                var timeoutReached_1 = false;\n                this.socket.emit('ping', function () {\n                    if (timeoutReached_1 === true) {\n                        return;\n                    }\n                    _this.onPingResponse();\n                });\n                this.pingResponseTimerId = setTimeout(function () {\n                    _this.logger.error('Ping response timeout is fired');\n                    timeoutReached_1 = true;\n                    _this.clearPingResponseTimer();\n                    _this.fsm.onPingResponseTimeout();\n                }, this.timeoutOptions.pongTimeoutMs);\n            }\n            catch (error) {\n                var msg = errorStackToJson(error);\n                this.logger.error(\"unable to send ping. Error: \".concat(msg));\n                this.connectionTracker.trackError('ping', msg, false);\n            }\n        }\n    };\n    TrouterConnection.prototype.connectV4c = function (token, reason) {\n        var _a, _b, _c, _d, _e, _f;\n        var options = this.options.ioOptions ? __assign({}, this.options.ioOptions) : new SocketIoOptions();\n        // Regardless of any passed in socket.io options, force the following settings.\n        options['force new connection'] = true;\n        options.reconnect = false;\n        if (((_a = this.reconnectParams) === null || _a === void 0 ? void 0 : _a.serviceUrl) &&\n            // previous input URL != current input URL (passed via `start()`)\n            (0, ProtocolAdapters_1.adaptUrl)(this.reconnectParams.serviceUrl, 'v4c') !== (0, ProtocolAdapters_1.adaptUrl)(this.options.trouterUrl, 'v4c')) {\n            this.logger.warn(\"Dropping cached connection parameters for a different environment (\".concat(this.reconnectParams.serviceUrl, \", now \").concat(this.options.trouterUrl, \")\"));\n            this.reconnectParams = undefined;\n        }\n        var inputUrl = (_d = (_b = (0, ProtocolAdapters_1.redirectUrlIfPresent)(reason)) !== null && _b !== void 0 ? _b : ((reason === null || reason === void 0 ? void 0 : reason.kind) !== 'redirect-no-host' ? (_c = this.reconnectParams) === null || _c === void 0 ? void 0 : _c.reconnectUrl : undefined)) !== null && _d !== void 0 ? _d : this.options.trouterUrl;\n        var url = (0, ProtocolAdapters_1.adaptUrl)(inputUrl, 'v4c');\n        options['skipped handshake data'] = {\n            timeout: 70,\n            websocketUrl: url\n        };\n        options.query = this.buildV4cUrlParams();\n        options.rewriteUrlForProxy = this.options.rewriteUrlForProxy;\n        try {\n            this.stopSocketIo();\n            this.transportTypeName = 'websocket';\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-assignment\n            this.socket = ((_e = this.options.io) !== null && _e !== void 0 ? _e : io).connect(this.options.trouterUrl, options);\n            if (this.socket === undefined) {\n                throw new Error('failed to create Socket.io object');\n            }\n            var audienceSubscriptionStateSnapshot = (_f = this.audienceSubscriptionState) === null || _f === void 0 ? void 0 : _f.increaseCvAndGetEventObject();\n            this.attachSocketIoHandlers(this.socket, token, undefined, audienceSubscriptionStateSnapshot);\n        }\n        catch (e) {\n            this.logger.error(\"\".concat(e));\n            this.connectionTracker.trackError('v4c', \"\".concat(e));\n            this.fsm.onV4cException();\n        }\n    };\n    TrouterConnection.prototype.sendV4cAuthenticationEvent = function (token) {\n        var _a;\n        var payload = {\n            headers: __assign(__assign({}, this.options.extraConnectionHeaders), headersFromToken(token, this.usingLegacyTokenApi)),\n            connectparams: (0, ProtocolAdapters_1.reconnectParamsWithoutUrls)(this.reconnectParams)\n        };\n        (_a = this.socket) === null || _a === void 0 ? void 0 : _a.emit(Constants_1.USER_AUTHENTICATE_EVENT_NAME, payload);\n    };\n    TrouterConnection.prototype.setUserActivityState = function (userActivityObject) {\n        var changed = (userActivityObject.state !== this.userActivityState.state);\n        this.userActivityState = userActivityObject;\n        if (changed) {\n            this.logger.info(\"Changing user activity state to '\".concat(userActivityObject.toEventJSON(), \"'\"));\n            this.fsm.onSetNewUserActivityState();\n        }\n        else {\n            this.logger.debug(\"Not changing the same user activity state '\".concat(userActivityObject.toEventJSON(), \"'\"));\n            this.manager.onUserActivityStateAccepted(userActivityObject.correlationVector.value());\n        }\n    };\n    TrouterConnection.prototype.sendUserActivityState = function (reason, connected) {\n        if (this.userActivityState.state === Interfaces_1.UserActivityState.Unknown) {\n            return;\n        }\n        if (this.transportTypeName === 'websocket' && connected) {\n            if (reason === InternalInterfaces_1.UserActivityEventReason.Connected) {\n                this.sendUserActivityStateMultiple(2);\n            }\n            else {\n                this.sendUserActivityStateMultiple(1);\n            }\n        }\n        else if (this.transportTypeName === 'xhr-polling') { // ignoring the connected flag\n            if (reason === InternalInterfaces_1.UserActivityEventReason.Modified) {\n                this.fsm.forceReconnect('user activity/force reconnect');\n            }\n        }\n    };\n    TrouterConnection.prototype.setAudienceSubscriptionsAsync = function (audienceSubscriptionState, timeoutInMs) {\n        var previousAudienceSubscriptionState = this.audienceSubscriptionState;\n        this.audienceSubscriptionState = audienceSubscriptionState;\n        if (this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\n            return this.setAudienceSubscriptionsInternalAsync(audienceSubscriptionState.increaseCvAndGetEventObject(), timeoutInMs);\n        }\n        if (this.transportTypeName === this.XHR_POLLING_TRANSPORT_NAME) {\n            var setAudienceSubscriptionsPromise = this.setAudienceSubscriptionsLongpollInternalAsync(audienceSubscriptionState.increaseCvAndGetEventObject(), timeoutInMs, previousAudienceSubscriptionState);\n            this.fsm.forceReconnect('set audience subscription force reconnect');\n            return setAudienceSubscriptionsPromise;\n        }\n        throw new Error('set audience subscription executed on an unknown transport');\n    };\n    TrouterConnection.prototype.setAudienceSubscriptionsUnsafeAsync = function (audienceSubscriptionSnapshot) {\n        if (!audienceSubscriptionSnapshot) {\n            return undefined;\n        }\n        if (this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\n            return this.setAudienceSubscriptionsInternalAsync(audienceSubscriptionSnapshot, 15000);\n        }\n    };\n    TrouterConnection.prototype.setAudienceSubscriptionsInternalAsync = function (audienceSubscriptionSnapshot, timeoutInMs) {\n        return __awaiter(this, void 0, void 0, function () {\n            var audienceSubscriptionEvent, result;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.logger.info('[WebSocket] Audience subscription set requested.');\n                        audienceSubscriptionEvent = new DownstreamEvent('audience.subscribe');\n                        audienceSubscriptionEvent.args = audienceSubscriptionSnapshot;\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                var hasTimedOut = false;\n                                var timeoutId = setTimeout(function () {\n                                    hasTimedOut = true;\n                                    return resolve(_this.buildAudienceSubscriptionsTimeoutResponse(audienceSubscriptionSnapshot));\n                                }, timeoutInMs);\n                                _this.sendDownstreamEvent(audienceSubscriptionEvent, function (_, args) {\n                                    if (hasTimedOut) {\n                                        return;\n                                    }\n                                    clearTimeout(timeoutId);\n                                    _this.logger.debug(\"[Websocket] Audience subscription response: \".concat(args));\n                                    if (_this.pendingAudienceSubscription) {\n                                        _this.onAudienceSubscriptionResult(args);\n                                    }\n                                    resolve(args);\n                                });\n                            })];\n                    case 1:\n                        result = _a.sent();\n                        this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    TrouterConnection.prototype.setAudienceSubscriptionsLongpollInternalAsync = function (audienceSubscriptionSnapshot, timeoutInMs, previousSubscriptionState) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var result, currentResponse, currentAudienceResponse, subscribesToDifferentAudience, synthResponses;\n            var _b;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.logger.info('[XHR Polling] Audience subscription set requested.');\n                        if (this.pendingAudienceSubscription) {\n                            this.logger.error('Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons.');\n                            clearTimeout(this.pendingAudienceSubscription.timeoutId);\n                        }\n                        if (audienceSubscriptionSnapshot.audiences.length === 0) {\n                            return [2 /*return*/, this.handleAudienceUnsubscribeLongpoll(audienceSubscriptionSnapshot.cv, previousSubscriptionState)];\n                        }\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                var timeoutId = setTimeout(function () {\n                                    _this.pendingAudienceSubscription = undefined;\n                                    return resolve(_this.buildAudienceSubscriptionsTimeoutResponse(audienceSubscriptionSnapshot));\n                                }, timeoutInMs);\n                                _this.pendingAudienceSubscription = {\n                                    audienceSetResolve: resolve,\n                                    timeoutId: timeoutId\n                                };\n                            })];\n                    case 1:\n                        result = _c.sent();\n                        if (this.manager.getState() === Interfaces_1.TrouterState.Unknown || this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\n                            return [2 /*return*/, result];\n                        }\n                        currentResponse = result.responses[0];\n                        if ((currentResponse === null || currentResponse === void 0 ? void 0 : currentResponse.result.audienceSubscriptionState) === this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST) {\n                            this.clearAudienceSubscriptionStateQueryParam();\n                            this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\n                            return [2 /*return*/, result];\n                        }\n                        currentAudienceResponse = result.responses.find(function (r) { return r.audienceId === audienceSubscriptionSnapshot.audiences[0].id; });\n                        if ((currentAudienceResponse === null || currentAudienceResponse === void 0 ? void 0 : currentAudienceResponse.result.audienceSubscriptionState) === this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR) {\n                            this.clearAudienceSubscriptionStateQueryParam();\n                            this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\n                            return [2 /*return*/, result];\n                        }\n                        subscribesToDifferentAudience = ((_a = previousSubscriptionState === null || previousSubscriptionState === void 0 ? void 0 : previousSubscriptionState.audienceSubscriptionModel.audienceSubscriptions[0]) === null || _a === void 0 ? void 0 : _a.id) !== (currentResponse === null || currentResponse === void 0 ? void 0 : currentResponse.audienceId);\n                        if (previousSubscriptionState && subscribesToDifferentAudience) {\n                            synthResponses = this.mapToSyntheticAudienceSubscriptionResponses(previousSubscriptionState.audienceSubscriptionModel.audienceSubscriptions, this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED, 200);\n                            (_b = result.responses).push.apply(_b, synthResponses);\n                        }\n                        this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    // remove the `audienceSubscriptionState` param from longpoll query string so the subscription is not attempted over and over creating loop\n    TrouterConnection.prototype.clearAudienceSubscriptionStateQueryParam = function () {\n        var _a, _b, _c;\n        if ((_c = (_b = (_a = this.socket) === null || _a === void 0 ? void 0 : _a.socket) === null || _b === void 0 ? void 0 : _b.options) === null || _c === void 0 ? void 0 : _c.query) {\n            this.socket.socket.options.query = this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX, '');\n        }\n    };\n    TrouterConnection.prototype.handleAudienceUnsubscribeLongpoll = function (correlationVector, previousSubscriptionState) {\n        var _a;\n        this.audienceSubscriptionState = undefined;\n        var result = {\n            responses: []\n        };\n        if (previousSubscriptionState) {\n            var synthResponses = this.mapToSyntheticAudienceSubscriptionResponses(previousSubscriptionState.audienceSubscriptionModel.audienceSubscriptions, this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED, 200);\n            (_a = result.responses).push.apply(_a, synthResponses);\n        }\n        this.manager.onAudiencesSetResolved(result, correlationVector);\n        return result;\n    };\n    TrouterConnection.prototype.buildAudienceSubscriptionsTimeoutResponse = function (audienceSubscriptionSnapshot) {\n        this.logger.error(\"Audience subscription attempt has timed out.\");\n        return {\n            responses: this.mapToSyntheticAudienceSubscriptionResponses(audienceSubscriptionSnapshot.audiences, this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)\n        };\n    };\n    TrouterConnection.prototype.mapToSyntheticAudienceSubscriptionResponses = function (audiences, synthState, synthResponseStatus) {\n        return audiences\n            .map(function (audSub) { return ({\n            audienceId: audSub.id,\n            result: {\n                audienceSubscriptionState: synthState,\n                responseStatus: synthResponseStatus\n            }\n        }); });\n    };\n    TrouterConnection.prototype.expediteBackoff = function () {\n        this.tokenBackoff.expediteIfPending();\n    };\n    TrouterConnection.prototype.sendRegisterRequest = function () {\n        var _this = this;\n        if (!this.options.registration || !this.registrarClient) {\n            throw new Error('Internal error - options.registration is undefined');\n        }\n        if (!this.allocateResult) {\n            throw new Error('Allocate result is undefined in sendRegisterRequest()');\n        }\n        this.logger.info('sending register request');\n        var span = new Common_1.Timespan();\n        this.connectionTracker.trackStart('registration');\n        var registrationTtl = this.getRegistrationTtl()[0];\n        this.registrarClient.register({\n            appId: this.options.registration.pnhAppId,\n            aesKey: '',\n            languageId: 'en-US',\n            platform: this.options.registration.platform,\n            templateKey: this.options.registration.pnhTemplateKey,\n            platformUIVersion: this.options.registration.platformUIVersion,\n            productContext: this.options.registration.productContext\n        }, {\n            TROUTER: [{\n                    context: this.options.registration.context,\n                    path: this.allocateResult.surl,\n                    ttl: registrationTtl\n                }]\n        }).then(function () {\n            _this.logger.info('Register request successful');\n            _this.connectionTracker.trackEnd('registration');\n            _this.fsm.onRegistrationSucceeded();\n            _this.connectionTracker.sendTelemetry(ConnectionTracker_1.ClientEventName.Registration, {\n                duration: span.duration\n            }, []);\n        }).catch(function (error) {\n            _this.logger.error(\"Register request failed. Error: \".concat(error));\n            _this.connectionTracker.trackError('registration', errorMessageToString(error));\n            _this.fsm.onRegistrationFailed();\n            _this.connectionTracker.sendTelemetry(ConnectionTracker_1.ClientEventName.Registration, {\n                duration: span.duration\n            }, []);\n        });\n    };\n    TrouterConnection.prototype.sendUnregisterRequest = function () {\n        var _this = this;\n        this.logger.info('sending unregister request');\n        var span = new Common_1.Timespan();\n        if (!this.options.registration || !this.registrarClient) {\n            throw new Error('Internal error - options.registration is undefined');\n        }\n        this.connectionTracker.trackStart('unregistration');\n        this.registrarClient.unregister().then(function () {\n            _this.logger.info('Unregister request successful');\n            _this.connectionTracker.trackEnd('unregistration');\n            _this.fsm.onUnregistrationDone();\n            _this.connectionTracker.sendTelemetry(ConnectionTracker_1.ClientEventName.Unregistration, {\n                duration: span.duration\n            }, []);\n        }).catch(function (error) {\n            _this.logger.error(\"Unregister request failed. Error: \".concat(error));\n            _this.connectionTracker.trackError('unregistration', errorMessageToString(error));\n            // The Registrar Client library already does internal retries on 5xx HTTP responses etc.\n            // So if we end up here, something more exceptional must have happened. There is little\n            // point delaying the stopping further by trying again, just finish as if successful.\n            _this.fsm.onUnregistrationDone();\n            _this.connectionTracker.sendTelemetry(ConnectionTracker_1.ClientEventName.Unregistration, {\n                duration: span.duration\n            }, []);\n        });\n    };\n    TrouterConnection.prototype.resetTokenBackoff = function () {\n        this.tokenBackoff.reset();\n    };\n    TrouterConnection.prototype.cancelPendingRegistrationRequests = function () {\n        if (this.registrarClient) {\n            this.registrarClient.cancelPendingRequests();\n        }\n    };\n    TrouterConnection.prototype.clearSentEventTimers = function () {\n        var keys = Object.keys(this.pendingSentEventTimers);\n        if (keys.length > 0) {\n            this.logger.debug('Clearing all pending downstream events related timers');\n            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n                var key = keys_1[_i];\n                this.clearSentEventTimer(Number(key));\n            }\n        }\n    };\n    TrouterConnection.prototype.restartIncallModeTimer = function () {\n        var _this = this;\n        this.clearIncallModeTimerId();\n        this.logger.debug('Restarting incall mode timer');\n        this.incallModeTimerId = setTimeout(function () {\n            _this.logger.info('Call mode timer fired');\n            _this.fsm.onIncallModeTimer();\n        }, this.options.incallModeTimeoutMs);\n    };\n    TrouterConnection.prototype.enterIncallMode = function () {\n        this.logger.info('Entering incall mode');\n        this.timeoutOptions = this.options.incallTimeoutOptions;\n        this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs);\n        // Uncomment to enable change of timeout in XHR mode - do it once server start to support it\n        // if (this.socket) {\n        //     this.socket.socket.options.query = this.buildSocketIoUrlParams();\n        // }\n        this.inIncallMode = true;\n    };\n    TrouterConnection.prototype.exitIncallMode = function () {\n        this.logger.info('Exiting incall mode');\n        this.clearIncallModeTimerId();\n        this.timeoutOptions = this.options.timeoutOptions;\n        this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs);\n        // Uncomment to enable change of timeout in XHR mode - do it once server start to support it\n        // if (this.socket) {\n        //     this.socket.socket.options.query = this.buildSocketIoUrlParams();\n        // }\n        this.inIncallMode = false;\n    };\n    TrouterConnection.prototype.isIncallMode = function () {\n        return this.inIncallMode;\n    };\n    TrouterConnection.prototype.sendDisconnectTelemetryEvent = function (reason) {\n        var props = { reason: reason, serverClosed: !this.fsm.isActive() };\n        this.connectionTracker.trackDisconnected(props);\n        this.connectionTracker.clearConnectedInfo();\n    };\n    TrouterConnection.prototype.forceReconnectDueToNoRegistration = function () {\n        this.fsm.forceReconnect('force reconnect due to no registration');\n    };\n    TrouterConnection.prototype.resetReconnectParamsOnErrorThreshold = function () {\n        this.logger.warn(\"\".concat(this.connectingErrorsInRow, \" connection attempts, server-side failure: erasing cached connection parameters\"));\n        this.reconnectParams = undefined;\n    };\n    ////////// SocketIO callbacks //////////\n    TrouterConnection.prototype.onSocketConnecting = function (transportTypeName) {\n        this.logger.info(\"onSocketConnecting(\".concat(transportTypeName, \")\"));\n        this.transportTypeName = transportTypeName;\n        this.connectionTracker.trackProgress('connecting', this.transportTypeName);\n        this.fsm.onConnecting();\n    };\n    TrouterConnection.prototype.onSocketConnect = function (token) {\n        this.logger.info('onSocketConnect');\n        this.fsm.onSocketConnect(token);\n    };\n    TrouterConnection.prototype.onSocketConnectFailed = function (reason) {\n        this.logger.error('onSocketConnectFailed');\n        this.connectionTracker.trackError('connect_failed', reason, true, this.transportTypeName ? this.transportTypeName : this.UNKNOWN_TRANSPORT);\n        this.fsm.onConnectingFailed();\n    };\n    TrouterConnection.prototype.onSocketDisconnect = function (rawReason) {\n        var sessionLengthMs = this.connectionTracker.getSessionLength() || 0;\n        var reason = DisconnectReason_1.DisconnectReason.fromRawReason(rawReason);\n        this.logger.error(\"onSocketDisconnect, reason: \".concat(reason.reason));\n        if (reason.reason === 'dup' && this.lastDisconnectReason === 'dup' &&\n            sessionLengthMs < this.options.duplicateDisconnectThresholdMs) {\n            this.logger.warn('Socket was closed by server as Duplicate for the second time in a row ' +\n                \"after \".concat(sessionLengthMs, \" ms which is below the threshold of \") +\n                \"\".concat(this.options.duplicateDisconnectThresholdMs, \" ms. Resetting cached \") +\n                'connection parameters and making a new allocation.');\n            this.reconnectParams = undefined;\n        }\n        this.lastDisconnectReason = reason.reason;\n        this.fsm.onSocketDisconnect(reason);\n        this.connectionExpireTimestampInSecs = undefined;\n    };\n    TrouterConnection.prototype.onSocketReconnect = function () {\n        // this callback should not be called, because reconnect on socket.io is disabled, but\n        // leave it here in case error in socket.io\n        this.logger.error('onSocketReconnect');\n        this.fsm.onTrouterConnected();\n    };\n    TrouterConnection.prototype.onSocketReconnectFailed = function (reason) {\n        // this callback should not be called, because reconnect on socket.io is disabled, but\n        // leave it here in case error in socket.io\n        this.logger.error(\"onSocketReconnectFailed with '\".concat(reason, \"'\"));\n        this.fsm.onSocketDisconnect(DisconnectReason_1.DisconnectReason.fromSocketIoEventData('reconnecterror', reason));\n    };\n    TrouterConnection.prototype.onSocketReconnecting = function () {\n        // this callback should not be called, because reconnect on socket.io is disabled, but\n        // leave it here in case error in socket.io\n        this.logger.error('onSocketReconnecting');\n    };\n    TrouterConnection.prototype.onSocketError = function (errorObject) {\n        this.logger.error(\"onSocketError with '\".concat((0, Common_1.toJson)(errorObject), \"'\"));\n        if (this.fsm.isConnecting()) {\n            this.connectingErrorsInRow++;\n            if (this.connectingErrorsInRow >= this.connectingErrorsThreshold) {\n                this.resetReconnectParamsOnErrorThreshold();\n            }\n        }\n        this.connectionTracker.trackError('connectSocket', safeToStringOrType(errorObject));\n        this.fsm.onSocketDisconnect(DisconnectReason_1.DisconnectReason.fromSocketIoEventData('socketerror', errorObject));\n    };\n    TrouterConnection.prototype.onSocketMessage = function (requestJson) {\n        var _this = this;\n        var _a;\n        this.logger.debug('onSocketMessage');\n        var request;\n        try {\n            request = new TrouterRequest(requestJson, this.logger);\n            var chainId = (_a = request.headers) === null || _a === void 0 ? void 0 : _a['X-Microsoft-Skype-Chain-ID'];\n            var chainIdLogText = chainId ? \" Chain-Id \".concat(chainId) : '';\n            this.logger.info(\"Received request N \".concat(request.id).concat(chainIdLogText, \" CV \").concat(request.correlationVector, \" to '\").concat(request.url, \"'\"));\n            request.startTS = Date.now();\n            if (request.url && this.urlPath && request.url.startsWith(this.urlPath)) {\n                request.shortUrl = request.url.substring(this.urlPath.length);\n            }\n        }\n        catch (error) {\n            var msg = errorStackToJson(error);\n            this.logger.error(\"unable to parse request. Error: \".concat(msg));\n            this.connectionTracker.trackRequest(undefined, msg);\n            this.connectionTracker.sendResponseError(\"unable to parse request, error: \".concat(error));\n            return;\n        }\n        request.timeoutTimerId = setTimeout(function () {\n            if (request.replied) {\n                return;\n            }\n            _this.logger.error(\"Request \".concat(request.id, \" timed out\"));\n            var responseData = new ConnectionTracker_1.ResponseData(request.id);\n            responseData.status = 504;\n            responseData.headers = { 'Trouter-Responder': 'ClientLib' };\n            _this.sendResponse(request, responseData);\n            request.timedout = true;\n        }, this.timeoutOptions.requestTimeoutMs);\n        try {\n            this.connectionTracker.trackRequest(request);\n            this.fsm.onDownstreamRequest(request);\n        }\n        catch (error) {\n            this.logger.error(\"exception in socket.on message. Error: \".concat(errorStackToJson(error)));\n            this.connectionTracker.sendResponseError(errorMessageToString(error), request, undefined);\n        }\n    };\n    TrouterConnection.prototype.onTrouterConnected = function (eventArgs, userActivitySnapshot, audienceSubscriptionSnapshot) {\n        var _this = this;\n        var _a, _b, _c, _d;\n        if ((0, ProtocolAdapters_1.isV4ConnectEvent)(eventArgs)) {\n            var v4cArgs = eventArgs;\n            this.allocateResult = __assign(__assign({}, v4cArgs), { ttl: eventArgs.ttl.toString() });\n            this.populateAndCacheReconnectParams(v4cArgs, v4cArgs.reconnectUrl);\n            this.populateConnectionStateFields(v4cArgs);\n        }\n        else if (!this.allocateResult) {\n            this.logger.error('Invalid internal state - received onTrouterConnected while allocateResult is not set');\n            return;\n        }\n        this.connectingErrorsInRow = 0;\n        this.logger.info(\"onTrouterConnected: \".concat(this.allocateResult.url));\n        if (this.transportTypeName === 'xhr-polling' && userActivitySnapshot) {\n            this.manager.onUserActivityStateAccepted(userActivitySnapshot.cv);\n        }\n        // Prevent next 'trouter.connected' responses from other trouter nodes\n        // hackish way, since socket.io doesn't have API for that\n        if ((_c = (_b = (_a = this.socket) === null || _a === void 0 ? void 0 : _a.socket) === null || _b === void 0 ? void 0 : _b.options) === null || _c === void 0 ? void 0 : _c.query) {\n            this.socket.socket.options.query += '&connected=true';\n        }\n        // Strip off the first part of the URL, up to the path\n        // eslint-disable-next-line no-useless-escape\n        this.urlPath = this.allocateResult.url.replace(/https?:\\/\\/([A-z0-9\\:\\$\\-\\_\\.\\+\\!\\*\\\"\\(\\)\\,]*)\\//, '/');\n        var isNewUrl = (this.connectedUrl !== this.allocateResult.url);\n        this.connectedUrl = this.allocateResult.url;\n        this.connectionExpireTimestampInSecs = (0, Common_1.calculateExpireTsInSec)((0, ProtocolAdapters_1.ensureNumber)(eventArgs.ttl));\n        this.connectionTracker.trackEnd('connectSocket');\n        this.connectionTracker.trackConnected(isNewUrl, this.transportTypeName ? this.transportTypeName : this.UNKNOWN_TRANSPORT);\n        (_d = this.setAudienceSubscriptionsUnsafeAsync(audienceSubscriptionSnapshot)) === null || _d === void 0 ? void 0 : _d.catch(function (reason) { return _this.logger.error(\"Re-subscribe to audiences has failed with \".concat(reason)); });\n        this.fsm.onTrouterConnected();\n    };\n    TrouterConnection.prototype.onTrouterReconnect = function (eventArgs) {\n        var target = eventArgs.target;\n        this.logger.info(\"onTrouterReconnect target: \".concat(target));\n        if (target === 'self') {\n            this.fsm.onReconnectRequired(true, ReconnectReason.ServerInitiated);\n        }\n        else {\n            this.fsm.onReconnectRequired(false, ReconnectReason.ServerInitiated, eventArgs);\n        }\n    };\n    TrouterConnection.prototype.onTrouterMessageLoss = function (eventArgs) {\n        this.logger.debug('onTrouterMessageLoss');\n        // Send only array of tags for further processing\n        this.fsm.onTrouterMessageLost(eventArgs.droppedIndicators);\n    };\n    TrouterConnection.prototype.onAudienceSubscriptionResult = function (eventArgs) {\n        this.logger.info('onAudienceSubscriptionResult');\n        if (!this.pendingAudienceSubscription) {\n            return;\n        }\n        clearTimeout(this.pendingAudienceSubscription.timeoutId);\n        this.pendingAudienceSubscription.audienceSetResolve(eventArgs);\n        this.pendingAudienceSubscription = undefined;\n    };\n    ////////// Other functions //////////\n    TrouterConnection.prototype.buildV4cUrlParams = function () {\n        var urlParams = {};\n        urlParams.tc = encodeURI((0, Common_1.toJson)(this.clientInfo));\n        urlParams.timeout = Math.floor(this.timeoutOptions.pingTimeoutMs / 1000);\n        if (this.options.endpointId) {\n            urlParams.epid = this.options.endpointId;\n        }\n        return this.appendConnectedClientIds(this.buildQuery(urlParams), true);\n    };\n    TrouterConnection.prototype.attachSocketIoHandlers = function (socket, token, userActivitySnapshot, audienceSubscriptionSnapshot) {\n        var _this = this;\n        socket.on('connecting', function (transportTypeName) { _this.onSocketConnecting(transportTypeName); });\n        socket.on('connect', function () { _this.onSocketConnect(token); });\n        socket.on('connect_failed', function (reason) { _this.onSocketConnectFailed(reason); });\n        socket.on('close_during_connecting', function (reason) { _this.onSocketConnectFailed(reason); });\n        socket.on('disconnect', function (reason) { _this.onSocketDisconnect(reason); });\n        socket.on('reconnect', function () { _this.onSocketReconnect(); });\n        socket.on('reconnect_failed', function (reason) { _this.onSocketReconnectFailed(reason); });\n        socket.on('reconnecting', function () { _this.onSocketReconnecting(); });\n        socket.on('error', function (error) { _this.onSocketError(error); });\n        socket.on('message', function (request) { _this.onSocketMessage(request); });\n        socket.on('trouter.connected', function (eventArgs) { _this.onTrouterConnected(eventArgs, userActivitySnapshot, audienceSubscriptionSnapshot); });\n        socket.on('trouter.reconnect', function (eventArgs) { _this.onTrouterReconnect(eventArgs); });\n        socket.on('trouter.message_loss', function (eventArgs) { _this.onTrouterMessageLoss(eventArgs); });\n        // event valid only for long polling\n        // when user subscribes for audience events a query param `audienceSubscriptionState` is added to all long poll GETs \n        // if the audience subscription state differs from the one defined on server, it will adjust its state to be identical\n        // after audience set opeartion finished server side `audience.subscriptionresult` is fired marking the end of asynchronous operation\n        socket.on('audience.subscriptionresult', function (_, eventArgs) { _this.onAudienceSubscriptionResult(eventArgs); });\n    };\n    TrouterConnection.prototype.onNavigatorOnlineStatusUpdate = function () {\n        var state = window.navigator.onLine;\n        this.logger.debug(\"Browser online status update - new state: \".concat(state, \", previously: \").concat(this.isNavigatorOnline));\n        if (state && !this.isNavigatorOnline) {\n            this.isNavigatorOnline = true;\n            this.tokenBackoff.expediteIfPending();\n            this.connectionTracker.trackProgress('browserNet', 'online');\n        }\n        else if (!state && this.isNavigatorOnline) {\n            this.isNavigatorOnline = false;\n            this.connectionTracker.trackProgress('browserNet', 'offline');\n        }\n    };\n    TrouterConnection.prototype.onAllocationResponse = function (allocateResult, token) {\n        this.logger.info(\"Received allocation response \".concat(JSON.stringify(allocateResult)));\n        this.allocateResult = allocateResult;\n        this.populateAndCacheReconnectParams(this.allocateResult, \"\".concat(this.allocateResult.socketio, \"v4/a\"));\n        this.populateConnectionStateFields(this.allocateResult);\n        this.fsm.onAllocationSucceed(token);\n    };\n    TrouterConnection.prototype.populateAndCacheReconnectParams = function (args, reconnectUrl) {\n        this.reconnectParams = __assign({ serviceUrl: this.options.trouterUrl, reconnectUrl: reconnectUrl }, args.connectparams);\n        this.manager.onConnectionParametersUpdated(this.reconnectParams);\n    };\n    TrouterConnection.prototype.populateConnectionStateFields = function (args) {\n        var _a, _b;\n        var ttl = typeof args.ttl === 'string' ? parseInt(args.ttl, 10) : args.ttl;\n        // Don't use allocateResult.connectparams.se here since system clock can be\n        // incorrect on client's machine, so using TTL is safer\n        this.connectionExpireTimestampInSecs = (0, Common_1.calculateExpireTsInSec)(ttl);\n        this.connectionId = (_a = args.id) !== null && _a !== void 0 ? _a : '';\n        this.connectedClientId = args.ccid;\n        this.logger.debug(\"connected client id set {connectedClientId:\".concat(this.connectedClientId, \"}\"));\n        this.c2cUrlBase = (_b = args.curlb) !== null && _b !== void 0 ? _b : '';\n        if (this.c2cUrlBase === '') {\n            // Try to just remove the port as a fallback if the service didn't provide anything\n            var pos = args.surl.indexOf('://');\n            if (pos >= 0) {\n                pos = args.surl.indexOf('/', pos + 3);\n                if (pos >= 5 && args.surl.substr(pos - 5, 5) === ':3443') {\n                    this.c2cUrlBase = args.surl.substr(0, pos - 5);\n                }\n            }\n        }\n    };\n    TrouterConnection.prototype.onPingResponse = function () {\n        this.logger.debug('onPingResponse');\n        this.connectionTracker.increasePingResponseCount();\n        this.clearPingResponseTimer();\n        this.fsm.onPingResponse();\n    };\n    TrouterConnection.prototype.clearPingResponseTimer = function () {\n        if (this.pingResponseTimerId !== undefined) {\n            clearTimeout(this.pingResponseTimerId);\n            this.pingResponseTimerId = undefined;\n        }\n    };\n    TrouterConnection.prototype.buildQuery = function (map) {\n        // TO-DO: Replace this and all other similar functions around with URLSearchParams\n        var components = [];\n        for (var _i = 0, _a = Object.keys(map); _i < _a.length; _i++) {\n            var i = _a[_i];\n            if (map[i] !== undefined) {\n                components.push(\"\".concat(i, \"=\").concat(map[i]));\n            }\n        }\n        return components.join('&');\n    };\n    TrouterConnection.prototype.appendConnectedClientIds = function (url, isParamsOnly) {\n        var params = '';\n        if (!url.includes('ccid=')) {\n            params = \"ccid=\".concat(this.connectedClientId, \"&\");\n        }\n        if (this.domId) {\n            params += \"dom=\".concat(this.domId, \"&\");\n        }\n        if (params.length > 0) {\n            params = params.slice(0, -1);\n        }\n        var sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\n        return this.appendCorrelationIds(url + sep + params, isParamsOnly);\n    };\n    TrouterConnection.prototype.appendEndpointId = function (url, isParamsOnly) {\n        var sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\n        return (!url.includes('epid') && this.options.endpointId)\n            ? \"\".concat(url).concat(sep, \"epid=\").concat(this.options.endpointId)\n            : url;\n    };\n    TrouterConnection.prototype.appendCorrelationIds = function (url, isParamsOnly) {\n        var sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\n        return (!url.includes('cor_id'))\n            ? \"\".concat(url).concat(sep, \"cor_id=\").concat(this.options.clientCorrelationID)\n                + \"&con_num=\".concat(this.clientID, \"_\").concat(this.connectionAttempt)\n            : url;\n    };\n    TrouterConnection.prototype.safeString = function (str) {\n        return (typeof str === 'string') ? str : '';\n    };\n    TrouterConnection.prototype.sendResponse = function (request, responseData) {\n        var _a, _b, _c;\n        if (request.timedout) {\n            this.logger.error(\"Request \".concat(request.id, \" already timed out\"));\n            return 1 /* SendResponseResult.Timeout */;\n        }\n        if (request.replied) {\n            this.logger.error(\"Response for request \".concat(request.id, \" already sent\"));\n            return 2 /* SendResponseResult.Duplicate */;\n        }\n        clearTimeout(request.timeoutTimerId);\n        request.timeoutTimerId = undefined;\n        request.replied = true;\n        responseData.headers = (_a = responseData.headers) !== null && _a !== void 0 ? _a : {};\n        var cv = request.correlationVector;\n        this.logger.info(\"Sending response N \".concat(request.id, \" CV \").concat(cv, \" with status \").concat(responseData.status));\n        if (cv) {\n            responseData.headers[cvHeader] = cv;\n        }\n        // Echo back the incoming \"trouter-request\" header\n        if ((_b = request.headers) === null || _b === void 0 ? void 0 : _b['trouter-request']) {\n            responseData.headers['trouter-request'] = request.headers['trouter-request'];\n        }\n        // Fill in \"trouter-client\" header\n        var latencyMS = Date.now() - request.startTS;\n        responseData.headers['trouter-client'] = (0, Common_1.toJson)({\n            cd: latencyMS\n        });\n        // Echo back \"trouter-is-broadcast\" header\n        if ((_c = request.headers) === null || _c === void 0 ? void 0 : _c['trouter-is-broadcast']) {\n            responseData.headers['trouter-is-broadcast'] = request.headers['trouter-is-broadcast'];\n        }\n        this.logger.debug(\"response: \".concat((0, Common_1.toJson)(responseData)));\n        if (this.socket) {\n            try {\n                this.socket.send((0, Common_1.toJson)(responseData));\n                responseData.sentTS = Date.now();\n                request.incrementCorrelationVector();\n                this.connectionTracker.trackResponse(request, latencyMS, responseData);\n                if (this.transportTypeName === 'websocket') {\n                    // Send ping request immediately to emulate 'ack' from server, so\n                    // client can faster react on network issues\n                    this.sendPingRequest();\n                }\n                return 0 /* SendResponseResult.OK */;\n            }\n            catch (error) {\n                var errorMsg = \"unable to send data on response.end. Error: \".concat(errorStackToJson(error));\n                this.logger.error(errorMsg);\n                this.connectionTracker.sendResponseError(errorMsg, request, responseData);\n                return 4 /* SendResponseResult.Disconnected */;\n            }\n        }\n        else {\n            this.connectionTracker.sendResponseError('no socket', request, responseData);\n            return 4 /* SendResponseResult.Disconnected */;\n        }\n    };\n    /*\n        Sends the activity state event to Trouter.\n        Has implemented support for sending the current state twice (or multiple times)\n        after reconnect, first immediately, and theen the second after configured delay.\n\n        If after the first sent state event the client app changes the state,\n        the new state is sent in the second event after the delay.\n        Meanwhile the new state is also sent immediately upon\n        the change, but the planned second sending (after delay) is triggered anyway,\n        to fulfill it's purpose, which is to prevent server-side race condition.\n     */\n    TrouterConnection.prototype.sendUserActivityStateMultiple = function (remaining) {\n        var _this = this;\n        var activityEvent = new DownstreamEvent('user.activity');\n        var activityEventObject = this.userActivityState.increaseCvAndGetEventObject();\n        activityEvent.args = activityEventObject;\n        this.logger.debug(\"Sending user activity '\".concat(this.userActivityState.toEventJSON(), \"', remaining \").concat(remaining - 1));\n        var timeoutReached = false;\n        this.sendDownstreamEvent(activityEvent, function () {\n            if (timeoutReached === true) {\n                return;\n            }\n            _this.logger.info(\"User activity state: \".concat(activityEventObject.state, \", cv: \").concat(activityEventObject.cv, \" accepted\"));\n            _this.manager.onUserActivityStateAccepted(activityEventObject.cv);\n            _this.clearSentEventTimer(activityEvent.timeoutTimerId);\n            if (remaining > 1) {\n                var timerId_1 = setTimeout(function () {\n                    _this.clearSentEventTimer(timerId_1);\n                    _this.sendUserActivityStateMultiple(remaining - 1);\n                }, _this.options.userActivitySecondResendDelayMs);\n                _this.registerSentEventTimer(timerId_1, 'user.activity/resend');\n            }\n        });\n        activityEvent.timeoutTimerId = setTimeout(function () {\n            _this.logger.error('Activity state response timeout is fired');\n            timeoutReached = true;\n            _this.fsm.onActivityStateResponseTimeout();\n            _this.clearSentEventTimer(activityEvent.timeoutTimerId);\n        }, this.timeoutOptions.userActivityResponseTimeoutMs);\n        this.registerSentEventTimer(activityEvent.timeoutTimerId, 'user.activity/response');\n    };\n    TrouterConnection.prototype.sendDownstreamEvent = function (event, responseCallback) {\n        this.logger.debug(\"Sending downstream event \".concat(event.name));\n        if (this.socket) {\n            this.socket.emit(event.name, event.args, responseCallback);\n        }\n    };\n    TrouterConnection.prototype.registerSentEventTimer = function (timerId, timerDescription) {\n        this.logger.debug(\"registering timer \".concat(timerId, \" -> \").concat(timerDescription));\n        this.pendingSentEventTimers[timerId] = timerDescription;\n    };\n    TrouterConnection.prototype.clearSentEventTimer = function (id) {\n        var timerDescription = this.pendingSentEventTimers[id];\n        this.logger.debug(\"clearing timer \".concat(id, \" -> \").concat(timerDescription));\n        delete this.pendingSentEventTimers[id];\n        clearTimeout(id);\n    };\n    /**\n     * Calculate registration interval. Result is based on configuration parameters\n     * and allocation ttl value from trouter server.\n     * Returns true only if the registration ttl is present and is smaller than known `allocationTtl`.\n     * This means we'll need to re-register to keep the registration alive for the duration of the allocation.\n     */\n    TrouterConnection.prototype.getRegistrationTtl = function () {\n        var _a, _b;\n        var allocationTtl = (0, Common_1.calculateTtlInSec)(this.connectionExpireTimestampInSecs);\n        this.logger.debug(\"Current connectionID will expire in \".concat(allocationTtl, \" seconds\"));\n        if (((_a = this.options.registration) === null || _a === void 0 ? void 0 : _a.registrarTtlSec) && allocationTtl > 0) {\n            var isLower = this.options.registration.registrarTtlSec < allocationTtl;\n            return [Math.min(this.options.registration.registrarTtlSec, allocationTtl), isLower];\n        }\n        else if ((_b = this.options.registration) === null || _b === void 0 ? void 0 : _b.registrarTtlSec) {\n            return [this.options.registration.registrarTtlSec, false];\n        }\n        else if (allocationTtl > 0) {\n            return [allocationTtl, false];\n        }\n        return [DEFAULT_REGISTRATION_TIMEOUT_SEC, false];\n    };\n    TrouterConnection.prototype.clearIncallModeTimerId = function () {\n        if (this.incallModeTimerId !== undefined) {\n            this.logger.debug('Clearing in-call mode timer');\n            clearTimeout(this.incallModeTimerId);\n            this.incallModeTimerId = undefined;\n        }\n    };\n    TrouterConnection.prototype.applyConnectionTrackerOptions = function (options) {\n        try {\n            var eventLoggerSent = (options.eventLogger && typeof options.eventLogger.logEvent === 'function');\n            if (!eventLoggerSent) {\n                this.logger.warn('Trouter client event logging disabled due to invalid configuration.');\n            }\n            else {\n                this.connectionTracker.mergeSettings(options.telemetrySettings);\n                this.connectionTracker.enable(options.eventLogger);\n            }\n        }\n        catch (error) {\n            this.logger.warn(\"Trouter client event logging disabled. Error: \".concat(errorStackToJson(error)));\n            this.connectionTracker.disable();\n        }\n    };\n    /**\n     * Returns boolean indicating if we can retry token fetch\n     * based on value of optional configuration 'retryLimitOnTokenFetch'\n     * @returns boolean\n     */\n    TrouterConnection.prototype.canRetryTokenFetchRequest = function (currentCounter) {\n        var retryLimit = this.options.retryLimitOnTokenFetch;\n        if (retryLimit === null || retryLimit === undefined) {\n            return true;\n        }\n        if (currentCounter < retryLimit) {\n            return true;\n        }\n        this.logger.warn(\"Reached limit on maximum number of token fetch request. Current count: \".concat(currentCounter, \", retry limit: \").concat(retryLimit));\n        return false;\n    };\n    return TrouterConnection;\n}());\nexports.TrouterConnection = TrouterConnection;\nfunction headersFromToken(token, usingLegacyTokenApi) {\n    var migrationHeader = usingLegacyTokenApi ? undefined : { 'X-MS-Migration': 'True' };\n    switch (token.tokenType.toLowerCase()) {\n        case 'skype':\n            return __assign({ 'X-Skypetoken': token.token }, migrationHeader);\n        case 'aad':\n        case 'cae':\n            return __assign({ Authorization: \"Bearer \".concat(token.token) }, migrationHeader);\n        default:\n            throw new Error(\"unsupported token type: \".concat(token.tokenType));\n    }\n}\nfunction safeToStringOrType(value) {\n    if (value !== undefined && value !== null && typeof value.toString === 'function') {\n        return value.toString();\n    }\n    return \"[\".concat(typeof value, \"]\");\n}\nfunction errorStackToJson(error) {\n    if (typeof error === 'object' && error !== null && error.stack !== undefined) {\n        // Keeping this as it was for now, but `error.stack` is usually just a string anyway.\n        // I guess it also converts newlines to '\\n', which some part may need? Or it's completely unnecessary?\n        return (0, Common_1.toJson)(error.stack);\n    }\n    return '\"(no error.stack)\"';\n}\nfunction errorMessageToString(error) {\n    if (typeof error === 'object' && error !== null && typeof error.message === 'string') {\n        return error.message;\n    }\n    return '(no error.message)';\n}\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MessageHandlerRegistry = void 0;\nvar Constants_1 = __webpack_require__(1);\nvar Logger_1 = __webpack_require__(0);\n/**\n * Registry of message handlers.\n * Safely executes individual handlers and aggregates results\n */\nvar MessageHandlerRegistry = /** @class */ (function () {\n    function MessageHandlerRegistry(logProvider) {\n        this.messageHandlers = [];\n        this.logger = new Logger_1.Logger(\"MessageHandlers\", logProvider);\n    }\n    MessageHandlerRegistry.prototype.register = function (handler) {\n        if (this.messageHandlers.some(function (item) { return item === handler; })) {\n            throw new Error('Registering the same handler twice is not allowed');\n        }\n        this.messageHandlers.push(handler);\n    };\n    MessageHandlerRegistry.prototype.clear = function () {\n        this.logger.debug('Clearing message handlers');\n        this.messageHandlers = [];\n    };\n    MessageHandlerRegistry.prototype.active = function () {\n        return (this.messageHandlers.length > 0);\n    };\n    MessageHandlerRegistry.prototype.handleMessage = function (message) {\n        var unhandledMessageResult = {\n            resultCode: Constants_1.UNHANDLED_MESSAGE_ACK,\n            isHandled: false\n        };\n        for (var _i = 0, _a = this.messageHandlers; _i < _a.length; _i++) {\n            var messageHandler = _a[_i];\n            var result = this.safeExecuteHandle(messageHandler, message);\n            if (result !== undefined && (result.isHandled === undefined || result.isHandled)) {\n                if (result.resultCode === undefined) {\n                    result.resultCode = Constants_1.HANDLED_MESSAGE_ACK;\n                }\n                return result;\n            }\n        }\n        return unhandledMessageResult;\n    };\n    MessageHandlerRegistry.prototype.safeExecuteHandle = function (handler, message) {\n        try {\n            return handler.handleMessage(message);\n        }\n        catch (exception) {\n            this.logger.warn(\"Trouter message handler threw an exception: \".concat(exception));\n            return undefined;\n        }\n    };\n    return MessageHandlerRegistry;\n}());\nexports.MessageHandlerRegistry = MessageHandlerRegistry;\n\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.addCacheAsBackupTo = void 0;\nfunction addCacheAsBackupTo(provider) {\n    var _this = this;\n    var cachedToken;\n    return function (forceRefresh) { return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (forceRefresh) {\n                cachedToken = undefined;\n            }\n            return [2 /*return*/, new Promise(function (resolve, reject) {\n                    provider(forceRefresh).then(function (token) {\n                        cachedToken = token;\n                        resolve(token);\n                    }).catch(function (error) {\n                        if (cachedToken !== undefined && cachedToken.length > 0) {\n                            resolve(cachedToken);\n                        }\n                        reject(error);\n                    });\n                })];\n        });\n    }); };\n}\nexports.addCacheAsBackupTo = addCacheAsBackupTo;\n\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterManager = exports.AudienceSubscriptionState = exports.UserActivityObject = void 0;\nvar Common_1 = __webpack_require__(3);\nvar Interfaces_1 = __webpack_require__(2);\nvar InternalInterfaces_1 = __webpack_require__(4);\nvar Logger_1 = __webpack_require__(0);\nvar ProtocolAdapters_1 = __webpack_require__(5);\nvar RegistrationEnforcer_1 = __webpack_require__(18);\nvar TrouterConnection_1 = __webpack_require__(7);\nvar TrouterFsm_1 = __webpack_require__(6);\nvar TrouterManagerFsm_1 = __webpack_require__(19);\n/**\n * UserActivity object\n */\nvar UserActivityObject = /** @class */ (function () {\n    function UserActivityObject(state, correlationVector) {\n        this.state = state;\n        this.correlationVector = correlationVector !== undefined ? correlationVector : Common_1.CorrelationVector.extend();\n    }\n    UserActivityObject.prototype.getStateString = function () {\n        switch (this.state) {\n            case Interfaces_1.UserActivityState.Active:\n                return 'active';\n            case Interfaces_1.UserActivityState.Inactive:\n                return 'inactive';\n            case Interfaces_1.UserActivityState.Unknown:\n                return 'unknown';\n            default:\n                return 'undefined';\n        }\n    };\n    UserActivityObject.prototype.increaseCvAndGetEventObject = function () {\n        this.correlationVector.increase();\n        return this.toEventObject();\n    };\n    UserActivityObject.prototype.toEventObject = function () {\n        return { state: this.getStateString(), cv: this.correlationVector.value() };\n    };\n    UserActivityObject.prototype.toEventJSON = function () {\n        return (0, Common_1.toJson)(this.toEventObject());\n    };\n    return UserActivityObject;\n}());\nexports.UserActivityObject = UserActivityObject;\nvar AudienceSubscriptionState = /** @class */ (function () {\n    function AudienceSubscriptionState(audienceSubscriptionModel, correlationVector) {\n        if (correlationVector === void 0) { correlationVector = Common_1.CorrelationVector.extend(); }\n        this.audienceSubscriptionModel = audienceSubscriptionModel;\n        this.correlationVector = correlationVector;\n    }\n    AudienceSubscriptionState.prototype.increaseCvAndGetEventObject = function () {\n        this.correlationVector.increase();\n        return this.toEventObject();\n    };\n    AudienceSubscriptionState.prototype.toEventObject = function () {\n        return { audiences: this.audienceSubscriptionModel.audienceSubscriptions, cv: this.correlationVector.value() };\n    };\n    AudienceSubscriptionState.prototype.toEventJSON = function () {\n        return (0, Common_1.toJson)(this.toEventObject());\n    };\n    return AudienceSubscriptionState;\n}());\nexports.AudienceSubscriptionState = AudienceSubscriptionState;\n/**\n * Trouter implementation\n */\nvar TrouterManager = /** @class */ (function () {\n    function TrouterManager(logFunc, options, tokenProvider, usingLegacyTokenApi, listener, protocolSelector) {\n        var _this = this;\n        this.logFunc = logFunc;\n        this.options = options;\n        this.tokenProvider = tokenProvider;\n        this.usingLegacyTokenApi = usingLegacyTokenApi;\n        this.listener = listener;\n        this.tokenTypeProtocolSelector = function (tokenType, reconnectParams) {\n            return _this.options.forceV4aProtocol ? 'v4a' : (0, ProtocolAdapters_1.usedProtocol)(tokenType, reconnectParams);\n        };\n        this.logger = new Logger_1.Logger('Manager', logFunc);\n        this.logger.info(\"Created TrouterManager with options \".concat((0, Common_1.toJson)(this.options)));\n        this.fsm = new TrouterManagerFsm_1.TrouterManagerFsm(logFunc, this);\n        this.baseEndpointUrl = '';\n        this.processedMessageLoss = {};\n        this.userActivityObject = new UserActivityObject(Interfaces_1.UserActivityState.Unknown);\n        this.protocolSelector = protocolSelector !== null && protocolSelector !== void 0 ? protocolSelector : this.tokenTypeProtocolSelector.bind(this);\n    }\n    TrouterManager.prototype.start = function () {\n        this.fsm.start();\n    };\n    TrouterManager.prototype.stop = function (dontUnregister) {\n        this.fsm.stop(dontUnregister);\n    };\n    TrouterManager.prototype.configure = function (options) {\n        this.options = options;\n        if (this.firstConnection !== undefined) {\n            this.firstConnection.configure(options);\n        }\n        if (this.secondConnection !== undefined) {\n            this.secondConnection.configure(options);\n        }\n        this.logger.info(\"Reconfigured TrouterManager with options \".concat((0, Common_1.toJson)(this.options)));\n    };\n    TrouterManager.prototype.checkConnection = function (disconnectDetected) {\n        if (this.firstConnection !== undefined) {\n            this.firstConnection.checkConnection(disconnectDetected);\n        }\n        if (this.secondConnection !== undefined) {\n            this.secondConnection.checkConnection(disconnectDetected);\n        }\n    };\n    TrouterManager.prototype.resendRegistration = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (this.secondConnection !== undefined) {\n                    this.logger.info('Resending registration on the second/new connection');\n                    return [2 /*return*/, this.secondConnection.resendRegistration()];\n                }\n                if (this.firstConnection !== undefined) {\n                    this.logger.info('Resending registration on the first/current connection');\n                    return [2 /*return*/, this.firstConnection.resendRegistration()];\n                }\n                this.logger.info('No connection to resend registration on, will be done upon (re)connect');\n                return [2 /*return*/];\n            });\n        });\n    };\n    TrouterManager.prototype.getServerState = function () {\n        if (this.firstConnection !== undefined) {\n            return this.firstConnection.getServerState();\n        }\n        return undefined;\n    };\n    /** Returns current state */\n    TrouterManager.prototype.getState = function () {\n        return this.fsm.getState();\n    };\n    TrouterManager.prototype.isInTerminalState = function () {\n        return this.fsm.getInternalState() === InternalInterfaces_1.TrouterManagerState.TerminalError;\n    };\n    TrouterManager.prototype.reportStateInfo = function () {\n        var firstState = this.firstConnection ? TrouterFsm_1.State[this.firstConnection.getState()] : \"Unknown\";\n        var managerState = InternalInterfaces_1.TrouterManagerState[this.fsm.getInternalState()];\n        if (this.secondConnection) {\n            var secondState = TrouterFsm_1.State[this.secondConnection.getState()];\n            return \"Manager \".concat(managerState, \"; 1st \").concat(firstState, \"; 2nd \").concat(secondState);\n        }\n        return \"Manager \".concat(managerState, \"; Connection \").concat(firstState);\n    };\n    //////////// IManagerWorker ////////////\n    TrouterManager.prototype.startFirstConnection = function () {\n        var connection = new TrouterConnection_1.TrouterConnection(this.logFunc, this.options, this.configuredTrouterManager(), this.tokenProvider, this.usingLegacyTokenApi, this.userActivityObject, this.protocolSelector, this.audienceSubscriptionState);\n        this.firstConnection = connection;\n        this.getConnectionCache()\n            .then(function (connectionCache) {\n            connection.start(connectionCache);\n        })\n            // eslint-disable-next-line @typescript-eslint/no-empty-function\n            .catch(function () { });\n    };\n    TrouterManager.prototype.startSecondConnection = function (useConnectParamsFromCache) {\n        var connection = new TrouterConnection_1.TrouterConnection(this.logFunc, this.options, this.configuredTrouterManager(), this.tokenProvider, this.usingLegacyTokenApi, this.userActivityObject, this.protocolSelector, this.audienceSubscriptionState);\n        this.secondConnection = connection;\n        if (this.firstConnection !== undefined) {\n            this.firstConnection.disableRegistrationsAndAutoReconnect();\n        }\n        if (useConnectParamsFromCache) {\n            this.getConnectionCache()\n                .then(function (connectionCache) {\n                connection.start(connectionCache);\n            })\n                // eslint-disable-next-line @typescript-eslint/no-empty-function\n                .catch(function () { });\n        }\n        else {\n            connection.start();\n        }\n    };\n    TrouterManager.prototype.stopFirstConnection = function (dontUnregister) {\n        if (this.firstConnection !== undefined) {\n            // Store first connection to be able to compare in onDisconnected() handler\n            this.storedFirstConnection = this.firstConnection;\n            this.firstConnection.stop(dontUnregister);\n            this.firstConnection = undefined;\n        }\n    };\n    TrouterManager.prototype.stopSecondConnection = function (dontUnregister) {\n        if (this.secondConnection !== undefined) {\n            this.secondConnection.stop(dontUnregister);\n            this.secondConnection = undefined;\n        }\n    };\n    TrouterManager.prototype.stopSecondConnectionDelayed = function () {\n        if (this.secondConnection !== undefined) {\n            var connection_1 = this.secondConnection;\n            this.secondConnection = undefined;\n            this.logger.info(\"Closing an inactive connection in \".concat(Math.round(this.options.lingeringConnectionDelayMs / 1000), \"s\"));\n            setTimeout(function () {\n                connection_1.stop(true);\n            }, this.options.lingeringConnectionDelayMs);\n        }\n    };\n    TrouterManager.prototype.forceStopLingeringConnection = function () {\n        if (this.storedFirstConnection) {\n            this.storedFirstConnection.stop(false);\n            this.storedFirstConnection = undefined;\n        }\n    };\n    TrouterManager.prototype.switchConnections = function () {\n        var tmp = this.firstConnection;\n        this.firstConnection = this.secondConnection;\n        this.secondConnection = tmp;\n    };\n    TrouterManager.prototype.doesSecondConnectionExist = function () {\n        return this.secondConnection !== undefined;\n    };\n    TrouterManager.prototype.dispatchConnected = function () {\n        if (this.firstConnection !== undefined) {\n            var ss = this.firstConnection.getServerState();\n            var baseEndpointUrl = (ss.url.endsWith('/')) ? ss.url.slice(0, -1) : ss.url;\n            var connectionInfo = {\n                baseEndpointUrl: baseEndpointUrl,\n                newEndpointUrl: (baseEndpointUrl !== this.baseEndpointUrl),\n                c2cUrlBase: ss.c2cUrlBase,\n                clientId: ss.connectedClientId,\n                connectionId: ss.connectionId,\n                connectionTtlSec: ss.getRemainingTtlInSec()\n            };\n            this.baseEndpointUrl = baseEndpointUrl;\n            this.listener.onTrouterConnected(ss.url, connectionInfo);\n        }\n    };\n    TrouterManager.prototype.dispatchDisconnected = function () {\n        if (this.listener.onTrouterDisconnected) {\n            this.listener.onTrouterDisconnected();\n        }\n    };\n    TrouterManager.prototype.dispatchTerminalError = function () {\n        // Emit a disconnected event to listeners too.\n        if (this.listener.onTrouterDisconnected) {\n            this.listener.onTrouterDisconnected();\n        }\n    };\n    TrouterManager.prototype.dispatchRegistrationState = function (isRegistered) {\n        if (this.options.registrationStateCallback) {\n            this.options.registrationStateCallback(isRegistered);\n        }\n    };\n    TrouterManager.prototype.expediteBackoffOnConnections = function () {\n        var _a;\n        if (this.lastExpediteBackoffCallAt !== undefined && Date.now() - this.lastExpediteBackoffCallAt < ((_a = this.options.expediteBackoffOnStartMinimumDelayMs) !== null && _a !== void 0 ? _a : 10000)) {\n            this.logger.info('Expedite backoff due to start() too frequent, skipping');\n            return;\n        }\n        this.lastExpediteBackoffCallAt = Date.now();\n        if (this.firstConnection !== undefined) {\n            this.firstConnection.expediteBackoff();\n        }\n        if (this.secondConnection !== undefined) {\n            this.secondConnection.expediteBackoff();\n        }\n    };\n    //////////// IManagerConsumer ////////////\n    TrouterManager.prototype.onDownstreamRequest = function (connection, request, response) {\n        var req = {\n            id: request.id,\n            method: request.method,\n            path: \"/\".concat(request.shortUrl),\n            body: request.body,\n            headers: request.headers\n        };\n        var rsp = {\n            id: request.id,\n            status: 0,\n            headers: {},\n            body: '',\n            send: function () {\n                if (rsp.status <= 100 || rsp.status >= 999) {\n                    return 3 /* SendResponseResult.Incomplete */;\n                }\n                response.writeHead(rsp.status, rsp.headers);\n                return response.end(rsp.body);\n            }\n        };\n        this.listener.onTrouterRequest(req, rsp);\n    };\n    TrouterManager.prototype.onConnected = function (connection) {\n        this.fsm.onConnected(connection === this.firstConnection);\n    };\n    TrouterManager.prototype.onRegistered = function (connection) {\n        this.fsm.onRegistered(connection === this.firstConnection);\n    };\n    TrouterManager.prototype.onUnregistered = function (connection) {\n        this.fsm.onUnregistered(connection === this.firstConnection || connection === this.storedFirstConnection);\n    };\n    TrouterManager.prototype.onReconnecting = function (connection) {\n        this.fsm.onReconnecting(connection === this.firstConnection);\n    };\n    TrouterManager.prototype.onReconnectIsRequired = function (connection, useConnectParamsFromCache, reason) {\n        this.fsm.onReconnectionRequired(connection === this.firstConnection, useConnectParamsFromCache, reason);\n    };\n    TrouterManager.prototype.onDisconnected = function (connection) {\n        this.fsm.onDisconnected(connection === this.firstConnection || connection == this.storedFirstConnection);\n        this.storedFirstConnection = undefined;\n    };\n    TrouterManager.prototype.onTerminalError = function () {\n        // TODO: the argument passed to onTerminalError is just ignored\n        // this.fsm.onTerminalError(connection === this.firstConnection || connection == this.storedFirstConnection);\n        this.fsm.onTerminalError();\n        this.storedFirstConnection = undefined;\n    };\n    TrouterManager.prototype.onUserActivityStateAccepted = function (cv) {\n        if (this.listener.onTrouterUserActivityStateAccepted) {\n            this.listener.onTrouterUserActivityStateAccepted(cv);\n        }\n    };\n    TrouterManager.prototype.onAudiencesSetResolved = function (audienceSubscriptionsResponse, cv) {\n        var _a, _b;\n        (_b = (_a = this.listener).onAudiencesSetResolved) === null || _b === void 0 ? void 0 : _b.call(_a, audienceSubscriptionsResponse, cv);\n    };\n    TrouterManager.prototype.onConnectionParametersUpdated = function (connectionParameters) {\n        this.setConnectionCache(connectionParameters);\n    };\n    TrouterManager.prototype.setUserActivityState = function (state, correlationVector) {\n        this.userActivityObject = new UserActivityObject(state, Common_1.CorrelationVector.extend(correlationVector));\n        if (this.secondConnection !== undefined) {\n            this.logger.info(\"Setting user activity \".concat(this.userActivityObject.toEventJSON(), \" on the second/new connection\"));\n            this.secondConnection.setUserActivityState(this.userActivityObject);\n            return;\n        }\n        if (this.firstConnection !== undefined) {\n            this.logger.info(\"Setting user activity \".concat(this.userActivityObject.toEventJSON(), \" on the first/current connection\"));\n            this.firstConnection.setUserActivityState(this.userActivityObject);\n            return;\n        }\n    };\n    TrouterManager.prototype.setAudienceSubscriptionsAsync = function (audienceSubscriptionModel, timeoutInMs, correlationVector) {\n        this.audienceSubscriptionState = new AudienceSubscriptionState(audienceSubscriptionModel, Common_1.CorrelationVector.extend(correlationVector));\n        if (this.secondConnection) {\n            this.logger.info(\"Setting audience subscriptions \".concat(this.audienceSubscriptionState.toEventJSON(), \" on second/new connection\"));\n            return this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState, timeoutInMs);\n        }\n        if (this.firstConnection) {\n            this.logger.info(\"Setting audience subscriptions \".concat(this.audienceSubscriptionState.toEventJSON(), \" on first/current connection\"));\n            return this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState, timeoutInMs);\n        }\n        throw new Error('No connection found');\n    };\n    TrouterManager.prototype.onTrouterMessageLost = function (indicators) {\n        var _this = this;\n        if (this.listener.onTrouterMessageLoss) {\n            if (indicators === null || indicators === void 0 ? void 0 : indicators.length) {\n                // Filter out already seen dropped indicators and inform server that they are processed\n                var duplicates = indicators.filter(function (di) { return _this.processedMessageLoss[\"\".concat(di.tag, \"-\").concat(di.etag)] !== undefined; });\n                if (duplicates.length) {\n                    this.logger.info(\"onTrouterMessageLoss - immediately acknowledging \".concat(duplicates.length, \" seen dropped indicators\"));\n                    this.sendProcessedDroppedIndicators(duplicates);\n                    indicators = indicators.filter(function (di) { return _this.processedMessageLoss[\"\".concat(di.tag, \"-\").concat(di.etag)] === undefined; });\n                    if (!indicators.length) {\n                        this.logger.info('onTrouterMessageLoss - all declared dropped indicators have been seen before');\n                        return;\n                    }\n                }\n                // Send the data to the listeners\n                var messageLossProcessed = this.listener.onTrouterMessageLoss(indicators.map(function (di) { return di.tag; }));\n                if (!messageLossProcessed) {\n                    this.logger.warn('onTrouterMessageLoss - some flow tag(s) have not been processed by listeners');\n                    return;\n                }\n                // Update the cache\n                indicators.forEach(function (di) {\n                    _this.processedMessageLoss[\"\".concat(di.tag, \"-\").concat(di.etag)] = '';\n                });\n                this.sendProcessedDroppedIndicators(indicators);\n            }\n            else {\n                this.logger.warn('onTrouterMessageLoss - no flow tags have been provided');\n            }\n        }\n    };\n    TrouterManager.prototype.getConnectionCache = function () {\n        var _this = this;\n        if (!this.options.connectionCache) {\n            return Promise.resolve(this.connectionCache);\n        }\n        this.logger.debug('Querying host\\'s connection cache');\n        return this.options.connectionCache.onGetTrouterConnectionCache()\n            .then(function (serialized) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            var parsed = serialized ? JSON.parse(serialized) : undefined;\n            return typeof parsed === 'object' ? parsed : undefined;\n        })\n            .catch(function (e) {\n            _this.logger.warn(\"Invalid connection cache content provided: \".concat(e));\n            return _this.connectionCache;\n        });\n    };\n    TrouterManager.prototype.setConnectionCache = function (content) {\n        this.connectionCache = content;\n        if (this.options.connectionCache) {\n            try {\n                this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(content));\n            }\n            catch (e) {\n                this.logger.warn(\"Error setting external connection cache: \".concat(e));\n            }\n        }\n    };\n    TrouterManager.prototype.sendProcessedDroppedIndicators = function (messageLossIndicators) {\n        if (this.firstConnection !== undefined) {\n            this.firstConnection.sendProcessedDroppedIndicators(messageLossIndicators);\n            return;\n        }\n        if (this.secondConnection !== undefined) {\n            this.secondConnection.sendProcessedDroppedIndicators(messageLossIndicators);\n            return;\n        }\n    };\n    TrouterManager.prototype.configuredTrouterManager = function () {\n        return new RegistrationEnforcer_1.RegistrationEnforcer(this, this.options.connectionDependsOnRegistration, this.options.delayEventsUntilRegistered);\n    };\n    return TrouterManager;\n}());\nexports.TrouterManager = TrouterManager;\n\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterUrlPromise = void 0;\nvar Logger_1 = __webpack_require__(0);\n/**\n * Util that encapsulates lifecycle of active trouter URL and manages waiter for the URL via promise\n */\nvar TrouterUrlPromise = /** @class */ (function () {\n    function TrouterUrlPromise(logProvider) {\n        this.logger = new Logger_1.Logger('UrlPromise', logProvider);\n    }\n    TrouterUrlPromise.prototype.getPromise = function () {\n        var _this = this;\n        if (this.url !== undefined) {\n            this.logger.debug(\"returning previously resolved url: \".concat(this.url));\n            return Promise.resolve(this.url);\n        }\n        if (this.pendingPromise === undefined) {\n            this.logger.debug('creating and returning promise');\n            this.pendingPromise = new Promise(function (resolve, reject) {\n                _this.pendingPromiseResolveRef = resolve;\n                _this.pendingPromiseRejectRef = reject;\n            });\n        }\n        else {\n            this.logger.debug('returning existing promise');\n        }\n        return this.pendingPromise;\n    };\n    TrouterUrlPromise.prototype.resolveUrl = function (url) {\n        this.url = url;\n        this.logger.debug(\"got url: \".concat(this.url));\n        var resolveCallback = this.pendingPromiseResolveRef;\n        this.pendingPromise = undefined;\n        this.pendingPromiseResolveRef = undefined;\n        this.pendingPromiseRejectRef = undefined;\n        if (resolveCallback !== undefined) {\n            this.logger.debug('resolving promise');\n            resolveCallback(url);\n        }\n    };\n    TrouterUrlPromise.prototype.rejectUrl = function (error) {\n        this.logger.debug('aborting');\n        var rejectCallback = this.pendingPromiseRejectRef;\n        this.url = undefined;\n        this.pendingPromise = undefined;\n        this.pendingPromiseResolveRef = undefined;\n        this.pendingPromiseRejectRef = undefined;\n        if (rejectCallback !== undefined) {\n            this.logger.debug('rejecting promise');\n            rejectCallback(error);\n        }\n    };\n    TrouterUrlPromise.prototype.resetUrl = function () {\n        this.logger.debug('resetting url');\n        this.url = undefined;\n    };\n    return TrouterUrlPromise;\n}());\nexports.TrouterUrlPromise = TrouterUrlPromise;\n\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(global, module) {/** Socket.IO.js build:0.9.6, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, global) {\r\n\r\n  /**\r\n   * IO namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var io = exports;\r\n\r\n  /**\r\n   * Socket.IO version\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.version = '0.9.6';\r\n\r\n  /**\r\n   * Protocol implemented.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.protocol = 1;\r\n\r\n  /**\r\n   * Available transports, these will be populated with the available transports\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.transports = [];\r\n\r\n  /**\r\n   * Keep track of jsonp callbacks.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.j = [];\r\n\r\n  /**\r\n   * Keep track of our io.Sockets\r\n   *\r\n   * @api private\r\n   */\r\n  io.sockets = {};\r\n\r\n\r\n  /**\r\n   * Manages connections to hosts.\r\n   *\r\n   * @param {String} uri\r\n   * @Param {Boolean} force creation of new socket (defaults to false)\r\n   * @api public\r\n   */\r\n\r\n  io.connect = function (host, details) {\r\n    var uri = io.util.parseUri(host)\r\n      , uuri\r\n      , socket;\r\n\r\n    if (global && global.location) {\r\n      uri.protocol = uri.protocol || global.location.protocol.slice(0, -1);\r\n      uri.host = uri.host || (global.document\r\n        ? global.document.domain : global.location.hostname);\r\n      uri.port = uri.port || global.location.port;\r\n    }\r\n\r\n    uuri = io.util.uniqueUri(uri);\r\n\r\n    var options = {\r\n        host: uri.host\r\n      , secure: 'https' == uri.protocol\r\n      , port: uri.port || ('https' == uri.protocol ? 443 : 80)\r\n      , query: uri.query || ''\r\n    };\r\n\r\n    io.util.merge(options, details);\r\n\r\n    if (options['force new connection'] || !io.sockets[uuri]) {\r\n      socket = new io.Socket(options);\r\n    }\r\n\r\n    if (!options['force new connection'] && socket) {\r\n      io.sockets[uuri] = socket;\r\n    }\r\n\r\n    socket = socket || io.sockets[uuri];\r\n\r\n    // Making /v4/c have empty namespace\r\n    if (options['skipped handshake data']) {\r\n      return socket.of('');\r\n    } else {\r\n      // if path is different from '' or /\r\n      return socket.of(uri.path.length > 1 ? uri.path : '');\r\n    }\r\n  };\r\n\r\n})(\r\n     true ? module.exports : (this.io = {})\r\n  , 'undefined' === typeof global ? window : global);\r\n\r\n// Workaround inside webpack\r\nvar io = module.exports;\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, global) {\r\n\r\n  /**\r\n   * Utilities namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var util = exports.util = {};\r\n\r\n  /**\r\n   * Parses an URI\r\n   *\r\n   * @author Steven Levithan <stevenlevithan.com> (MIT license)\r\n   * @api public\r\n   */\r\n\r\n  var re = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\r\n\r\n  var parts = ['source', 'protocol', 'authority', 'userInfo', 'user', 'password',\r\n               'host', 'port', 'relative', 'path', 'directory', 'file', 'query',\r\n               'anchor'];\r\n\r\n  util.parseUri = function (str) {\r\n    var m = re.exec(str || '')\r\n      , uri = {}\r\n      , i = 14;\r\n\r\n    while (i--) {\r\n      uri[parts[i]] = m[i] || '';\r\n    }\r\n\r\n    return uri;\r\n  };\r\n\r\n  /**\r\n   * Produces a unique url that identifies a Socket.IO connection.\r\n   *\r\n   * @param {Object} uri\r\n   * @api public\r\n   */\r\n\r\n  util.uniqueUri = function (uri) {\r\n    var protocol = uri.protocol\r\n      , host = uri.host\r\n      , port = uri.port;\r\n\r\n    if ('document' in global) {\r\n      host = host || document.domain;\r\n      port = port || (protocol == 'https'\r\n        && document.location.protocol !== 'https:' ? 443 : document.location.port);\r\n    } else {\r\n      host = host || 'localhost';\r\n\r\n      if (!port && protocol == 'https') {\r\n        port = 443;\r\n      }\r\n    }\r\n\r\n    return (protocol || 'http') + '://' + host + ':' + (port || 80);\r\n  };\r\n\r\n  /**\r\n   * Mergest 2 query strings in to once unique query string\r\n   *\r\n   * @param {String} base\r\n   * @param {String} addition\r\n   * @api public\r\n   */\r\n\r\n  util.query = function (base, addition) {\r\n    var query = util.chunkQuery(base || '')\r\n      , components = [];\r\n\r\n    util.merge(query, util.chunkQuery(addition || ''));\r\n    for (var part in query) {\r\n      if (query.hasOwnProperty(part)) {\r\n        components.push(part + '=' + query[part]);\r\n      }\r\n    }\r\n\r\n    return components.length ? '?' + components.join('&') : '';\r\n  };\r\n\r\n  /**\r\n   * Transforms a querystring in to an object\r\n   *\r\n   * @param {String} qs\r\n   * @api public\r\n   */\r\n\r\n  util.chunkQuery = function (qs) {\r\n    var query = {}\r\n      , params = qs.split('&')\r\n      , i = 0\r\n      , l = params.length\r\n      , kv;\r\n\r\n    for (; i < l; ++i) {\r\n      kv = params[i].split('=');\r\n      if (kv[0]) {\r\n        query[kv[0]] = kv[1];\r\n      }\r\n    }\r\n\r\n    return query;\r\n  };\r\n\r\n  /**\r\n   * Executes the given function when the page is loaded.\r\n   *\r\n   *     io.util.load(function () { console.log('page loaded'); });\r\n   *\r\n   * @param {Function} fn\r\n   * @api public\r\n   */\r\n\r\n  var pageLoaded = false;\r\n\r\n  util.load = function (fn) {\r\n    if ('document' in global && document.readyState === 'complete' || pageLoaded) {\r\n      return fn();\r\n    }\r\n\r\n    util.on(global, 'load', fn, false);\r\n  };\r\n\r\n  /**\r\n   * Adds an event.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  util.on = function (element, event, fn, capture) {\r\n    if (element.attachEvent) {\r\n      element.attachEvent('on' + event, fn);\r\n    } else if (element.addEventListener) {\r\n      element.addEventListener(event, fn, capture);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generates the correct `XMLHttpRequest` for regular and cross domain requests.\r\n   *\r\n   * @param {Boolean} [xdomain] Create a request that can be used cross domain.\r\n   * @returns {XMLHttpRequest|false} If we can create a XMLHttpRequest.\r\n   * @api private\r\n   */\r\n\r\n  util.request = function (xdomain) {\r\n\r\n    if (xdomain && 'undefined' != typeof XDomainRequest) {\r\n      return new XDomainRequest();\r\n    }\r\n\r\n    if ('undefined' != typeof XMLHttpRequest && (!xdomain || util.ua.hasCORS)) {\r\n      return new XMLHttpRequest();\r\n    }\r\n\r\n    if (!xdomain) {\r\n      try {\r\n        return new window[(['Active'].concat('Object').join('X'))]('Microsoft.XMLHTTP');\r\n      } catch(e) { }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * XHR based transport constructor.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  /**\r\n   * Change the internal pageLoaded value.\r\n   */\r\n\r\n  if ('undefined' != typeof window) {\r\n    util.load(function () {\r\n      pageLoaded = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Defers a function to ensure a spinner is not displayed by the browser\r\n   *\r\n   * @param {Function} fn\r\n   * @api public\r\n   */\r\n\r\n  util.defer = function (fn) {\r\n    if (!util.ua.webkit || 'undefined' != typeof importScripts) {\r\n      return fn();\r\n    }\r\n\r\n    util.load(function () {\r\n      setTimeout(fn, 100);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Merges two objects.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.merge = function merge (target, additional, deep, lastseen) {\r\n    var seen = lastseen || []\r\n      , depth = typeof deep == 'undefined' ? 2 : deep\r\n      , prop;\r\n\r\n    for (prop in additional) {\r\n      if (additional.hasOwnProperty(prop) && util.indexOf(seen, prop) < 0) {\r\n        if (typeof target[prop] !== 'object' || !depth) {\r\n          target[prop] = additional[prop];\r\n          seen.push(additional[prop]);\r\n        } else {\r\n          util.merge(target[prop], additional[prop], depth - 1, seen);\r\n        }\r\n      }\r\n    }\r\n\r\n    return target;\r\n  };\r\n\r\n  /**\r\n   * Merges prototypes from objects\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.mixin = function (ctor, ctor2) {\r\n    util.merge(ctor.prototype, ctor2.prototype);\r\n  };\r\n\r\n  /**\r\n   * Shortcut for prototypical and static inheritance.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  util.inherit = function (ctor, ctor2) {\r\n    function f() {};\r\n    f.prototype = ctor2.prototype;\r\n    ctor.prototype = new f;\r\n  };\r\n\r\n  /**\r\n   * Checks if the given object is an Array.\r\n   *\r\n   *     io.util.isArray([]); // true\r\n   *     io.util.isArray({}); // false\r\n   *\r\n   * @param Object obj\r\n   * @api public\r\n   */\r\n\r\n  util.isArray = Array.isArray || function (obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Array]';\r\n  };\r\n\r\n  /**\r\n   * Intersects values of two arrays into a third\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.intersect = function (arr, arr2) {\r\n    var ret = []\r\n      , longest = arr.length > arr2.length ? arr : arr2\r\n      , shortest = arr.length > arr2.length ? arr2 : arr;\r\n\r\n    for (var i = 0, l = shortest.length; i < l; i++) {\r\n      if (~util.indexOf(longest, shortest[i]))\r\n        ret.push(shortest[i]);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Array indexOf compatibility.\r\n   *\r\n   * @see bit.ly/a5Dxa2\r\n   * @api public\r\n   */\r\n\r\n  util.indexOf = function (arr, o, i) {\r\n\r\n    for (var j = arr.length, i = i < 0 ? i + j < 0 ? 0 : i + j : i || 0;\r\n         i < j && arr[i] !== o; i++) {}\r\n\r\n    return j <= i ? -1 : i;\r\n  };\r\n\r\n  /**\r\n   * Converts enumerables to array.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.toArray = function (enu) {\r\n    var arr = [];\r\n\r\n    for (var i = 0, l = enu.length; i < l; i++)\r\n      arr.push(enu[i]);\r\n\r\n    return arr;\r\n  };\r\n\r\n  /**\r\n   * UA / engines detection namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  util.ua = {};\r\n\r\n  /**\r\n   * Whether the UA supports CORS for XHR.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.ua.hasCORS = 'undefined' != typeof XMLHttpRequest && (function () {\r\n    try {\r\n      var a = new XMLHttpRequest();\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n\r\n    return a.withCredentials != undefined;\r\n  })();\r\n\r\n  /**\r\n   * Detect webkit.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.ua.webkit = 'undefined' != typeof navigator\r\n    && /webkit/i.test(navigator.userAgent);\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' === typeof global ? window : global);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.EventEmitter = EventEmitter;\r\n\r\n  /**\r\n   * Event emitter constructor.\r\n   *\r\n   * @api public.\r\n   */\r\n\r\n  function EventEmitter () {};\r\n\r\n  /**\r\n   * Adds a listener\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.on = function (name, fn) {\r\n    if (!this.$events) {\r\n      this.$events = {};\r\n    }\r\n\r\n    if (!this.$events[name]) {\r\n      this.$events[name] = fn;\r\n    } else if (io.util.isArray(this.$events[name])) {\r\n      this.$events[name].push(fn);\r\n    } else {\r\n      this.$events[name] = [this.$events[name], fn];\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\r\n\r\n  /**\r\n   * Adds a volatile listener.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.once = function (name, fn) {\r\n    var self = this;\r\n\r\n    function on () {\r\n      self.removeListener(name, on);\r\n      fn.apply(this, arguments);\r\n    };\r\n\r\n    on.listener = fn;\r\n    this.on(name, on);\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Removes a listener.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.removeListener = function (name, fn) {\r\n    if (this.$events && this.$events[name]) {\r\n      var list = this.$events[name];\r\n\r\n      if (io.util.isArray(list)) {\r\n        var pos = -1;\r\n\r\n        for (var i = 0, l = list.length; i < l; i++) {\r\n          if (list[i] === fn || (list[i].listener && list[i].listener === fn)) {\r\n            pos = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (pos < 0) {\r\n          return this;\r\n        }\r\n\r\n        list.splice(pos, 1);\r\n\r\n        if (!list.length) {\r\n          delete this.$events[name];\r\n        }\r\n      } else if (list === fn || (list.listener && list.listener === fn)) {\r\n        delete this.$events[name];\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Removes all listeners for an event.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.removeAllListeners = function (name) {\r\n    // TODO: enable this when node 0.5 is stable\r\n    //if (name === undefined) {\r\n      //this.$events = {};\r\n      //return this;\r\n    //}\r\n\r\n    if (this.$events && this.$events[name]) {\r\n      this.$events[name] = null;\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Gets all listeners for a certain event.\r\n   *\r\n   * @api publci\r\n   */\r\n\r\n  EventEmitter.prototype.listeners = function (name) {\r\n    if (!this.$events) {\r\n      this.$events = {};\r\n    }\r\n\r\n    if (!this.$events[name]) {\r\n      this.$events[name] = [];\r\n    }\r\n\r\n    if (!io.util.isArray(this.$events[name])) {\r\n      this.$events[name] = [this.$events[name]];\r\n    }\r\n\r\n    return this.$events[name];\r\n  };\r\n\r\n  /**\r\n   * Emits an event.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.emit = function (name) {\r\n    if (!this.$events) {\r\n      return false;\r\n    }\r\n\r\n    var handler = this.$events[name];\r\n\r\n    if (!handler) {\r\n      return false;\r\n    }\r\n\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n\r\n    if ('function' == typeof handler) {\r\n      handler.apply(this, args);\r\n    } else if (io.util.isArray(handler)) {\r\n      var listeners = handler.slice();\r\n\r\n      for (var i = 0, l = listeners.length; i < l; i++) {\r\n        listeners[i].apply(this, args);\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n/**\r\n * Removed JSON polyfill - obsolete, and we are using native JSON.parse etc. throughout the rest of the codebase anyway\r\n */\r\n\r\n(function (exports, nativeJSON) {\r\n  \"use strict\";\r\n\r\n  // use native JSON if it's available\r\n  if (nativeJSON && nativeJSON.parse){\r\n    return exports.JSON = {\r\n      parse: nativeJSON.parse\r\n    , stringify: nativeJSON.stringify\r\n    }\r\n  }\r\n\r\n  throw new Error(\"JSON not available\");\r\n  \r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , typeof JSON !== 'undefined' ? JSON : undefined\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Parser namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var parser = exports.parser = {};\r\n\r\n  /**\r\n   * Packet types.\r\n   */\r\n\r\n  var packets = parser.packets = [\r\n      'disconnect'\r\n    , 'connect'\r\n    , 'heartbeat'\r\n    , 'message'\r\n    , 'json'\r\n    , 'event'\r\n    , 'ack'\r\n    , 'error'\r\n    , 'noop'\r\n  ];\r\n\r\n  /**\r\n   * Errors reasons.\r\n   */\r\n\r\n  var reasons = parser.reasons = [\r\n      'transport not supported'\r\n    , 'client not handshaken'\r\n    , 'unauthorized'\r\n  ];\r\n\r\n  /**\r\n   * Errors advice.\r\n   */\r\n\r\n  var advice = parser.advice = [\r\n      'reconnect'\r\n  ];\r\n\r\n  /**\r\n   * Shortcuts.\r\n   */\r\n\r\n  var JSON = io.JSON\r\n    , indexOf = io.util.indexOf;\r\n\r\n  /**\r\n   * Encodes a packet.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  parser.encodePacket = function (packet) {\r\n    var type = indexOf(packets, packet.type)\r\n      , id = packet.id || ''\r\n      , endpoint = packet.endpoint || ''\r\n      , ack = packet.ack\r\n      , data = null;\r\n\r\n    switch (packet.type) {\r\n      case 'error':\r\n        var reason = packet.reason ? indexOf(reasons, packet.reason) : ''\r\n          , adv = packet.advice ? indexOf(advice, packet.advice) : '';\r\n\r\n        if (reason !== '' || adv !== '')\r\n          data = reason + (adv !== '' ? ('+' + adv) : '');\r\n\r\n        break;\r\n\r\n      case 'message':\r\n        if (packet.data !== '')\r\n          data = packet.data;\r\n        break;\r\n\r\n      case 'event':\r\n        var ev = { name: packet.name };\r\n\r\n        if (packet.args && packet.args.length) {\r\n          ev.args = packet.args;\r\n        }\r\n\r\n        data = JSON.stringify(ev);\r\n        break;\r\n\r\n      case 'json':\r\n        data = JSON.stringify(packet.data);\r\n        break;\r\n\r\n      case 'connect':\r\n        if (packet.qs)\r\n          data = packet.qs;\r\n        break;\r\n\r\n      case 'ack':\r\n        data = packet.ackId\r\n          + (packet.args && packet.args.length\r\n              ? '+' + JSON.stringify(packet.args) : '');\r\n        break;\r\n    }\r\n\r\n    // construct packet with required fragments\r\n    var encoded = [\r\n        type\r\n      , id + (ack == 'data' ? '+' : '')\r\n      , endpoint\r\n    ];\r\n\r\n    // data fragment is optional\r\n    if (data !== null && data !== undefined)\r\n      encoded.push(data);\r\n\r\n    return encoded.join(':');\r\n  };\r\n\r\n  /**\r\n   * Encodes multiple messages (payload).\r\n   *\r\n   * @param {Array} messages\r\n   * @api private\r\n   */\r\n\r\n  parser.encodePayload = function (packets) {\r\n    var decoded = '';\r\n\r\n    if (packets.length == 1)\r\n      return packets[0];\r\n\r\n    for (var i = 0, l = packets.length; i < l; i++) {\r\n      var packet = packets[i];\r\n      decoded += '\\ufffd' + packet.length + '\\ufffd' + packets[i];\r\n    }\r\n\r\n    return decoded;\r\n  };\r\n\r\n  /**\r\n   * Decodes a packet\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  var regexp = /([^:]+):([0-9]+)?(\\+)?:([^:]+)?:?([\\s\\S]*)?/;\r\n\r\n  parser.decodePacket = function (data) {\r\n    var pieces = data.match(regexp);\r\n\r\n    if (!pieces) return {};\r\n\r\n    var id = pieces[2] || ''\r\n      , data = pieces[5] || ''\r\n      , packet = {\r\n            type: packets[pieces[1]]\r\n          , endpoint: pieces[4] || ''\r\n        };\r\n\r\n    // whether we need to acknowledge the packet\r\n    if (id) {\r\n      packet.id = id;\r\n      if (pieces[3])\r\n        packet.ack = 'data';\r\n      else\r\n        packet.ack = true;\r\n    }\r\n\r\n    // handle different packet types\r\n    switch (packet.type) {\r\n      case 'error':\r\n        var pieces = data.split('+');\r\n        packet.reason = reasons[pieces[0]] || '';\r\n        packet.advice = advice[pieces[1]] || '';\r\n        break;\r\n\r\n      case 'message':\r\n        packet.data = data || '';\r\n        break;\r\n\r\n      case 'event':\r\n        try {\r\n          var opts = JSON.parse(data);\r\n          packet.name = opts.name;\r\n          packet.args = opts.args;\r\n        } catch (e) { }\r\n\r\n        packet.args = packet.args || [];\r\n        break;\r\n\r\n      case 'json':\r\n        try {\r\n          packet.data = JSON.parse(data);\r\n        } catch (e) { }\r\n        break;\r\n\r\n      case 'connect':\r\n        packet.qs = data || '';\r\n        break;\r\n\r\n      case 'ack':\r\n        var pieces = data.match(/^([0-9]+)(\\+)?(.*)/);\r\n        if (pieces) {\r\n          packet.ackId = pieces[1];\r\n          packet.args = [];\r\n\r\n          if (pieces[3]) {\r\n            try {\r\n              packet.args = pieces[3] ? JSON.parse(pieces[3]) : [];\r\n            } catch (e) { }\r\n          }\r\n        }\r\n        break;\r\n\r\n      case 'disconnect':\r\n        packet.reason = data;\r\n        break;\r\n\r\n      case 'heartbeat':\r\n        break;\r\n    };\r\n\r\n    return packet;\r\n  };\r\n\r\n  /**\r\n   * Decodes data payload. Detects multiple messages\r\n   *\r\n   * @return {Array} messages\r\n   * @api public\r\n   */\r\n\r\n  parser.decodePayload = function (data) {\r\n    // IE doesn't like data[i] for unicode chars, charAt works fine\r\n    if (data.charAt(0) == '\\ufffd') {\r\n      var ret = [];\r\n\r\n      for (var i = 1, length = ''; i < data.length; i++) {\r\n        if (data.charAt(i) == '\\ufffd') {\r\n          ret.push(parser.decodePacket(data.substr(i + 1).substr(0, length)));\r\n          i += Number(length) + 1;\r\n          length = '';\r\n        } else {\r\n          length += data.charAt(i);\r\n        }\r\n      }\r\n\r\n      return ret;\r\n    } else {\r\n      return [parser.decodePacket(data)];\r\n    }\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.Transport = Transport;\r\n\r\n  /**\r\n   * This is the transport template for all supported transport methods.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   * @param {exports.Socket} socket\r\n   */\r\n\r\n  function Transport (socket, sessid) {\r\n    this.socket = socket;\r\n    this.sessid = sessid;\r\n    this.connectErrorCallback = undefined;\r\n    this.isOpened = false;\r\n  };\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(Transport, io.EventEmitter);\r\n\r\n  /**\r\n   * Handles the response from the server. When a new response is received\r\n   * it will automatically update the timeout, decode the message and\r\n   * forwards the response to the onMessage function for further processing.\r\n   *\r\n   * @param {String} data Response from the server.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onData = function (data) {\r\n    this.clearCloseTimeout();\r\n\r\n    // If the connection in currently open (or in a reopening state) reset the close\r\n    // timeout since we have just received data. This check is necessary so\r\n    // that we don't reset the timeout on an explicitly disconnected connection.\r\n    if (this.socket.connected || this.socket.connecting || this.socket.reconnecting) {\r\n      this.setCloseTimeout();\r\n    }\r\n\r\n    if (data !== '') {\r\n      // todo: we should only do decodePayload for xhr transports\r\n      var msgs = io.parser.decodePayload(data);\r\n\r\n      if (msgs && msgs.length) {\r\n        for (var i = 0, l = msgs.length; i < l; i++) {\r\n          this.onPacket(msgs[i]);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handles packets.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onPacket = function (packet) {\r\n    this.socket.setHeartbeatTimeout();\r\n\r\n    if (packet.type == 'heartbeat') {\r\n      return this.onHeartbeat();\r\n    }\r\n\r\n    if (packet.type == 'connect' && packet.endpoint == '') {\r\n      this.onConnect();\r\n    }\r\n\r\n    if (packet.type == 'error' && packet.advice == 'reconnect') {\r\n      this.isOpened = false;\r\n    }\r\n\r\n    this.socket.onPacket(packet);\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sets close timeout\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.setCloseTimeout = function () {\r\n    if (!this.closeTimeout) {\r\n      var self = this;\r\n\r\n      this.closeTimeout = setTimeout(function () {\r\n        self.onDisconnect();\r\n      }, this.socket.closeTimeout);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called when transport disconnects.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onDisconnect = function () {\r\n    if (this.close && this.isOpened) this.close();\r\n    this.clearTimeouts();\r\n    this.socket.onDisconnect();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Called when transport connects\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onConnect = function () {\r\n    this.socket.onConnect();\r\n    this.connectErrorCallback = undefined;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Clears close timeout\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.clearCloseTimeout = function () {\r\n    if (this.closeTimeout) {\r\n      clearTimeout(this.closeTimeout);\r\n      this.closeTimeout = null;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Clear timeouts\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.clearTimeouts = function () {\r\n    this.clearCloseTimeout();\r\n\r\n    if (this.reopenTimeout) {\r\n      clearTimeout(this.reopenTimeout);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Sends a packet\r\n   *\r\n   * @param {Object} packet object.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.packet = function (packet) {\r\n    this.send(io.parser.encodePacket(packet));\r\n  };\r\n\r\n  /**\r\n   * Send the received heartbeat message back to server. So the server\r\n   * knows we are still connected.\r\n   *\r\n   * @param {String} heartbeat Heartbeat response from the server.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onHeartbeat = function (heartbeat) {\r\n    this.packet({ type: 'heartbeat' });\r\n  };\r\n\r\n  /**\r\n   * Called when the transport opens.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onOpen = function () {\r\n    this.isOpened = true;\r\n    this.clearCloseTimeout();\r\n    this.socket.onOpen();\r\n  };\r\n\r\n  /**\r\n   * Notifies the base when the connection with the Socket.IO server\r\n   * has been disconnected.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onClose = function () {\r\n    var self = this;\r\n\r\n    /* FIXME: reopen delay causing a infinit loop\r\n    this.reopenTimeout = setTimeout(function () {\r\n      self.open();\r\n    }, this.socket.options['reopen delay']);*/\r\n\r\n    this.isOpened = false;\r\n    this.socket.onClose();\r\n    this.onDisconnect();\r\n  };\r\n\r\n  /**\r\n   * Generates a connection url based on the Socket.IO URL Protocol.\r\n   * See <https://github.com/learnboost/socket.io-node/> for more details.\r\n   *\r\n   * @returns {String} Connection url\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.prepareUrl = function (query) {\r\n    /** @var {ISocketIoOptions} options */\r\n    var options = this.socket.options;\r\n\r\n    if (options['skipped handshake data']) {\r\n      // /v4/c protocol\r\n      return options.rewriteUrlForProxy(options['skipped handshake data'].websocketUrl + (query ? query : ''))\r\n    }\r\n\r\n    var url = this.scheme() + '://'\r\n      + options.host + ':' + options.port + '/'\r\n      + options.resource + '/' + io.protocol\r\n      + '/' + this.name + '/' + this.sessid + (query ? query : '');\r\n\r\n    return options.rewriteUrlForProxy(url);\r\n  };\r\n\r\n  /**\r\n   * Checks if the transport is ready to start a connection.\r\n   *\r\n   * @param {Socket} socket The socket instance that needs a transport\r\n   * @param {Function} fn The callback\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.ready = function (socket, fn) {\r\n    fn.call(this);\r\n  };\r\n\r\n  /**\r\n   * Clears the event handlers attached on to by specific transport implementations.\r\n   *\r\n   * @api private\r\n   */\r\n  Transport.prototype.clearEventHandlers = function () {\r\n      return this;\r\n  };\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.Socket = Socket;\r\n\r\n  /**\r\n   * Create a new `Socket.IO client` which can establish a persistent\r\n   * connection with a Socket.IO enabled server.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  function Socket (options) {\r\n    this.options = {\r\n        port: 80\r\n      , secure: false\r\n      , document: 'document' in global ? document : false\r\n      , resource: 'socket.io'\r\n      , transports: io.transports.slice()\r\n      , 'connect timeout': 10000\r\n      , 'try multiple transports': true\r\n      , 'reconnect': true\r\n      , 'reconnection delay': 500\r\n      , 'reconnection limit': Infinity\r\n      , 'reopen delay': 3000\r\n      , 'max reconnection attempts': 10\r\n      , 'sync disconnect on unload': true\r\n      , 'auto connect': true\r\n      , 'flash policy port': 10843\r\n    };\r\n\r\n    io.util.merge(this.options, options);\r\n\r\n    this.connected = false;\r\n    this.open = false;\r\n    this.connecting = false;\r\n    this.reconnecting = false;\r\n    this.namespaces = {};\r\n    this.buffer = [];\r\n    this.doBuffer = false;\r\n    this.disconnected = false;\r\n\r\n    if (this.options['sync disconnect on unload'] &&\r\n        (!this.isXDomain() || io.util.ua.hasCORS)) {\r\n      var self = this;\r\n\r\n      io.util.on(global, 'unload', function () {\r\n        self.disconnectSync();\r\n      }, false);\r\n    }\r\n\r\n    if (this.options['auto connect']) {\r\n      this.connect();\r\n    }\r\n};\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(Socket, io.EventEmitter);\r\n\r\n  /**\r\n   * Returns a namespace listener/emitter for this socket\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.of = function (name) {\r\n    if (!this.namespaces[name]) {\r\n      this.namespaces[name] = new io.SocketNamespace(this, name);\r\n\r\n      if (name !== '') {\r\n        this.namespaces[name].packet({ type: 'connect' });\r\n      }\r\n    }\r\n\r\n    return this.namespaces[name];\r\n  };\r\n\r\n  /**\r\n   * Emits the given event to the Socket and all namespaces\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.publish = function () {\r\n    this.emit.apply(this, arguments);\r\n\r\n    var nsp;\r\n\r\n    for (var i in this.namespaces) {\r\n      if (this.namespaces.hasOwnProperty(i)) {\r\n        nsp = this.of(i);\r\n        nsp.$emit.apply(nsp, arguments);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Performs the handshake\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function empty () { };\r\n\r\n  Socket.prototype.handshake = function (fn) {\r\n    var self = this\r\n      , options = this.options;\r\n      \r\n    if (self.disconnected) {\r\n      return;\r\n    }\r\n\r\n    function complete (data) {\r\n      if (data instanceof Error) {\r\n        self.onError(data.message);\r\n      } else {\r\n        fn.apply(null, data.split(':'));\r\n      }\r\n    };\r\n\r\n    var url = options.rewriteUrlForProxy([\r\n          'http' + (options.secure ? 's' : '') + ':/'\r\n        , options.host + ':' + options.port\r\n        , options.resource\r\n        , io.protocol\r\n        , io.util.query(this.options.query, 't=' + +new Date)\r\n      ].join('/'));\r\n\r\n    if (this.isXDomain() && !io.util.ua.hasCORS) {\r\n      var insertAt = document.getElementsByTagName('script')[0]\r\n        , script = document.createElement('script');\r\n\r\n      script.src = url + '&jsonp=' + io.j.length;\r\n      insertAt.parentNode.insertBefore(script, insertAt);\r\n\r\n      io.j.push(function (data) {\r\n        complete(data);\r\n        script.parentNode.removeChild(script);\r\n      });\r\n    } else {\r\n      var xhr = io.util.request();\r\n      \r\n      xhr.open('GET', url, true);\r\n\r\n      var headers = this.options.requestHeaders;\r\n      if (headers !== undefined) {\r\n        Object.keys(headers).forEach(function(name) {\r\n          xhr.setRequestHeader(name, headers[name]);\r\n        });\r\n      }\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4) {\r\n          xhr.onreadystatechange = empty;\r\n\r\n          if (xhr.status == 200) {\r\n            complete(xhr.responseText);\r\n          } else {\r\n            !self.reconnecting && self.onError(xhr.responseText);\r\n          }\r\n        }\r\n      };\r\n      xhr.send(null);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Find an available transport based on the options supplied in the constructor.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.getTransport = function (override) {\r\n    var transports = override || this.transports, match;\r\n\r\n    for (var i = 0, transport; transport = transports[i]; i++) {\r\n      if (io.Transport[transport]\r\n        && io.Transport[transport].check(this)\r\n        && (!this.isXDomain() || io.Transport[transport].xdomainCheck())) {\r\n        return new io.Transport[transport](this, this.sessionid);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * Connects to the server.\r\n   *\r\n   * @param {Function} [fn] Callback.\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.connect = function (fn) {\r\n    if (this.connecting || this.disconnected) {\r\n      return this;\r\n    }\r\n\r\n    var self = this;\r\n\r\n    var onHandshakeComplete = (function (sid, heartbeat, close, transports) {\r\n      // Params come from response's body - it's splitted by ':'\r\n      // example: 1178beba4026e2c7-48e62d038b18f416:85:85:websocket,xhr-polling,jsonp-polling\r\n      self.sessionid = sid;\r\n      // Add two seconds, so connection is closed by server, not client - otherwise\r\n      // there will be a onSocketDisconnect event which will start health check, etc\r\n      // This can happen if server returns close/heartbeat timeout equal to 40 which is server's timeout to\r\n      // close long poll connection, in such case client can close connection before server response with empty\r\n      // response and client goes to health check. Server can return such timeout if client send too small ping timeout\r\n      // during handshake\r\n      self.closeTimeout = close * 1000 + 2000;\r\n      self.heartbeatTimeout = heartbeat * 1000 + 2000;\r\n      self.transports = transports ? io.util.intersect(\r\n          transports.split(',')\r\n        , self.options.transports\r\n      ) : self.options.transports;\r\n\r\n      self.setHeartbeatTimeout();\r\n      self.remainingTransports = self.transports.slice(0);\r\n\r\n      function tryNextTransport() {\r\n        if (!self.connected && !self.disconnected) {\r\n          self.connecting = false;\r\n          clearTimeout(self.connectTimeoutTimer);\r\n\r\n          if (self.options['try multiple transports']) {\r\n            while (self.remainingTransports.length > 0\r\n                   && self.remainingTransports.splice(0,1)[0] != self.transport.name) {}\r\n\r\n            if (self.remainingTransports.length){\r\n              connect(self.remainingTransports);\r\n            } else {\r\n              self.publish('connect_failed');\r\n            }\r\n          } else {\r\n            self.publish('connect_failed');\r\n          }\r\n        }\r\n      }\r\n\r\n\r\n      function connect (transports){\r\n        if (self.transport) {\r\n            self.transport.clearTimeouts();\r\n            self.transport.clearEventHandlers();\r\n        }\r\n\r\n        self.transport = self.getTransport(transports);\r\n        if (!self.transport || self.disconnected) return self.publish('connect_failed');\r\n\r\n        // once the transport is ready (i.e. page is fully loaded)\r\n        self.transport.ready(self, function () {\r\n          self.connecting = true;\r\n          self.publish('connecting', self.transport.name);\r\n          self.transport.open(tryNextTransport);\r\n\r\n          if (self.options['connect timeout']) {\r\n            self.connectTimeoutTimer = setTimeout(function () {\r\n              tryNextTransport();\r\n            }, self.options['connect timeout']);\r\n          }\r\n        });\r\n      }\r\n\r\n      connect(self.transports);\r\n\r\n      self.once('connect', function (){\r\n        clearTimeout(self.connectTimeoutTimer);\r\n\r\n        fn && typeof fn == 'function' && fn();\r\n      });\r\n    });\r\n\r\n    if (this.options['skipped handshake data']) {\r\n      // /v4/c protocol\r\n      var data = this.options['skipped handshake data'];\r\n      // There is no need for the client to know a Socket ID with this protocol\r\n      // Can probably just use some dummy/random/timestamp thing as session id, it is completely opaque, on server too\r\n      // It can also be filled retroactively after being sent from the server inside a WS message (trouter.connected),\r\n      // but I don't think we need to bother.\r\n      onHandshakeComplete('v4c-' + new Date().getTime(), data.timeout, data.timeout, 'websocket');\r\n    } else {\r\n      this.handshake(onHandshakeComplete);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Clears and sets a new heartbeat timeout using the value given by the\r\n   * server during the handshake.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.setHeartbeatTimeout = function () {\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n\r\n    var self = this;\r\n    this.heartbeatTimeoutTimer = setTimeout(function () {\r\n      self.transport.onClose();\r\n    }, this.heartbeatTimeout);\r\n  };\r\n\r\n  /**\r\n   * Sends a message.\r\n   *\r\n   * @param {Object} data packet.\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.packet = function (data) {\r\n    if (this.connected && !this.doBuffer) {\r\n      this.transport.packet(data);\r\n    } else {\r\n      this.buffer.push(data);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sets buffer state\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.setBuffer = function (v) {\r\n    this.doBuffer = v;\r\n\r\n    if (!v && this.connected && this.buffer.length) {\r\n      this.transport.payload(this.buffer);\r\n      this.buffer = [];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Disconnect the established connect.\r\n   *\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.disconnect = function () {\r\n    if (this.connected || this.connecting) {\r\n      if (this.open) {\r\n        this.of('').packet({ type: 'disconnect' });\r\n      }\r\n\r\n      // handle disconnection immediately\r\n      this.onDisconnect('booted');\r\n    }\r\n    this.disconnected = true;\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Disconnects the socket with a sync XHR.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.disconnectSync = function () {\r\n    // ensure disconnection\r\n    var xhr = io.util.request()\r\n      , uri = this.resource + '/' + io.protocol + '/' + this.sessionid;\r\n\r\n    xhr.open('GET', uri, true);\r\n\r\n    // handle disconnection immediately\r\n    this.onDisconnect('booted');\r\n  };\r\n\r\n  /**\r\n   * Check if we need to use cross domain enabled transports. Cross domain would\r\n   * be a different port or different domain name.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.isXDomain = function () {\r\n\r\n    var port = global.location.port ||\r\n      ('https:' == global.location.protocol ? 443 : 80);\r\n\r\n    return this.options.host !== global.location.hostname\r\n      || this.options.port != port;\r\n  };\r\n\r\n  /**\r\n   * Called upon handshake.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onConnect = function () {\r\n    if (!this.connected) {\r\n      this.connected = true;\r\n      this.connecting = false;\r\n      if (!this.doBuffer) {\r\n        // make sure to flush the buffer\r\n        this.setBuffer(false);\r\n      }\r\n      this.emit('connect');\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called when the transport opens\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onOpen = function () {\r\n    this.open = true;\r\n  };\r\n\r\n  /**\r\n   * Called when the transport closes.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onClose = function () {\r\n    this.open = false;\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n  };\r\n\r\n  /**\r\n   * Called when the transport first opens a connection\r\n   *\r\n   * @param text\r\n   */\r\n\r\n  Socket.prototype.onPacket = function (packet) {\r\n    this.of(packet.endpoint).onPacket(packet);\r\n  };\r\n\r\n  /**\r\n   * Handles an error.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onError = function (err) {\r\n    if (err && err.advice) {\r\n      if (err.advice === 'reconnect' && (this.connected || this.connecting)) {\r\n        this.disconnect();\r\n        if (this.options.reconnect) {\r\n          this.reconnect();\r\n        }\r\n      }\r\n    }\r\n\r\n    this.publish('error', err && err.reason ? err.reason : err);\r\n  };\r\n\r\n  /**\r\n   * Called when the transport disconnects.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onDisconnect = function (reason) {\r\n    var wasConnected = this.connected\r\n      , wasConnecting = this.connecting;\r\n\r\n    this.connected = false;\r\n    this.connecting = false;\r\n    this.open = false;\r\n\r\n    if (wasConnected || wasConnecting) {\r\n      this.transport.close();\r\n      this.transport.clearTimeouts();\r\n      if (wasConnected) {\r\n        this.publish('disconnect', reason);\r\n\r\n        if ('booted' != reason && this.options.reconnect && !this.reconnecting) {\r\n          this.reconnect();\r\n        }\r\n      } else {\r\n        this.publish('close_during_connecting', reason);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called upon reconnection.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.reconnect = function () {\r\n    this.reconnecting = true;\r\n    this.reconnectionAttempts = 0;\r\n    this.reconnectionDelay = this.options['reconnection delay'];\r\n\r\n    var self = this\r\n      , maxAttempts = this.options['max reconnection attempts']\r\n      , tryMultiple = this.options['try multiple transports']\r\n      , limit = this.options['reconnection limit'];\r\n\r\n    function reset () {\r\n      if (self.connected) {\r\n        for (var i in self.namespaces) {\r\n          if (self.namespaces.hasOwnProperty(i) && '' !== i) {\r\n              self.namespaces[i].packet({ type: 'connect' });\r\n          }\r\n        }\r\n        self.publish('reconnect', self.transport.name, self.reconnectionAttempts);\r\n      }\r\n\r\n      clearTimeout(self.reconnectionTimer);\r\n\r\n      self.removeListener('connect_failed', maybeReconnect);\r\n      self.removeListener('connect', maybeReconnect);\r\n\r\n      self.reconnecting = false;\r\n\r\n      delete self.reconnectionAttempts;\r\n      delete self.reconnectionDelay;\r\n      delete self.reconnectionTimer;\r\n      delete self.redoTransports;\r\n\r\n      self.options['try multiple transports'] = tryMultiple;\r\n    };\r\n\r\n    function maybeReconnect () {\r\n      if (!self.reconnecting) {\r\n        return;\r\n      }\r\n\r\n      if (self.connected) {\r\n        return reset();\r\n      };\r\n\r\n      if (self.connecting && self.reconnecting) {\r\n        return self.reconnectionTimer = setTimeout(maybeReconnect, 1000);\r\n      }\r\n\r\n      if (self.reconnectionAttempts++ >= maxAttempts) {\r\n        if (!self.redoTransports) {\r\n          self.on('connect_failed', maybeReconnect);\r\n          self.options['try multiple transports'] = true;\r\n          self.transport = self.getTransport();\r\n          self.redoTransports = true;\r\n          self.connect();\r\n        } else {\r\n          self.publish('reconnect_failed');\r\n          reset();\r\n        }\r\n      } else {\r\n        if (self.reconnectionDelay < limit) {\r\n          self.reconnectionDelay *= 2; // exponential back off\r\n        }\r\n\r\n        self.connect();\r\n        self.publish('reconnecting', self.reconnectionDelay, self.reconnectionAttempts);\r\n        self.reconnectionTimer = setTimeout(maybeReconnect, self.reconnectionDelay);\r\n      }\r\n    };\r\n\r\n    this.options['try multiple transports'] = false;\r\n    this.reconnectionTimer = setTimeout(maybeReconnect, this.reconnectionDelay);\r\n\r\n    this.on('connect', maybeReconnect);\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.SocketNamespace = SocketNamespace;\r\n\r\n  /**\r\n   * Socket namespace constructor.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function SocketNamespace (socket, name) {\r\n    this.socket = socket;\r\n    this.name = name || '';\r\n    this.flags = {};\r\n    this.json = new Flag(this, 'json');\r\n    this.ackPackets = 0;\r\n    this.acks = {};\r\n  };\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(SocketNamespace, io.EventEmitter);\r\n\r\n  /**\r\n   * Copies emit since we override it\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.$emit = io.EventEmitter.prototype.emit;\r\n\r\n  /**\r\n   * Creates a new namespace, by proxying the request to the socket. This\r\n   * allows us to use the synax as we do on the server.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.of = function () {\r\n    return this.socket.of.apply(this.socket, arguments);\r\n  };\r\n\r\n  /**\r\n   * Sends a packet.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.packet = function (packet) {\r\n    packet.endpoint = this.name;\r\n    this.socket.packet(packet);\r\n    this.flags = {};\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sends a message\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.send = function (data, fn) {\r\n    var packet = {\r\n        type: this.flags.json ? 'json' : 'message'\r\n      , data: data\r\n    };\r\n\r\n    if ('function' == typeof fn) {\r\n      packet.id = ++this.ackPackets;\r\n      packet.ack = true;\r\n      this.acks[packet.id] = fn;\r\n    }\r\n\r\n    return this.packet(packet);\r\n  };\r\n\r\n  /**\r\n   * Emits an event\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.emit = function (name) {\r\n    var args = Array.prototype.slice.call(arguments, 1)\r\n      , lastArg = args[args.length - 1]\r\n      , packet = {\r\n            type: 'event'\r\n          , name: name\r\n        };\r\n\r\n    if ('function' == typeof lastArg) {\r\n      packet.id = ++this.ackPackets;\r\n      packet.ack = 'data';\r\n      this.acks[packet.id] = lastArg;\r\n      args = args.slice(0, args.length - 1);\r\n    }\r\n\r\n    packet.args = args;\r\n\r\n    return this.packet(packet);\r\n  };\r\n\r\n  /**\r\n   * Disconnects the namespace\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.disconnect = function () {\r\n    if (this.name === '') {\r\n      this.socket.disconnect();\r\n    } else {\r\n      this.packet({ type: 'disconnect' });\r\n      this.$emit('disconnect');\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handles a packet\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.onPacket = function (packet) {\r\n    var self = this;\r\n\r\n    function ack () {\r\n      self.packet({\r\n          type: 'ack'\r\n        , args: io.util.toArray(arguments)\r\n        , ackId: packet.id\r\n      });\r\n    };\r\n\r\n    switch (packet.type) {\r\n      case 'connect':\r\n        this.$emit('connect');\r\n        break;\r\n\r\n      case 'disconnect':\r\n        if (this.name === '') {\r\n          this.socket.onDisconnect(packet.reason || 'booted');\r\n        } else {\r\n          this.$emit('disconnect', packet.reason || '');\r\n        }\r\n        break;\r\n\r\n      case 'message':\r\n      case 'json':\r\n        var params = ['message', packet.data];\r\n\r\n        if (packet.ack == 'data') {\r\n          params.push(ack);\r\n        } else if (packet.ack) {\r\n          this.packet({ type: 'ack', ackId: packet.id });\r\n        }\r\n\r\n        this.$emit.apply(this, params);\r\n        break;\r\n\r\n      case 'event':\r\n        var params = [packet.name].concat(packet.args);\r\n\r\n        if (packet.ack == 'data')\r\n          params.push(ack);\r\n\r\n        this.$emit.apply(this, params);\r\n        break;\r\n\r\n      case 'ack':\r\n        if (this.acks[packet.ackId]) {\r\n          this.acks[packet.ackId].apply(this, packet.args);\r\n          delete this.acks[packet.ackId];\r\n        }\r\n        break;\r\n\r\n      case 'error':\r\n        if (packet.advice){\r\n          this.socket.onError(packet);\r\n        } else {\r\n          if (packet.reason == 'unauthorized') {\r\n            this.$emit('connect_failed', packet.reason);\r\n          } else {\r\n            this.$emit('error', packet.reason);\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Flag interface.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function Flag (nsp, name) {\r\n    this.namespace = nsp;\r\n    this.name = name;\r\n  };\r\n\r\n  /**\r\n   * Send a message\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Flag.prototype.send = function () {\r\n    this.namespace.flags[this.name] = true;\r\n    this.namespace.send.apply(this.namespace, arguments);\r\n  };\r\n\r\n  /**\r\n   * Emit an event\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Flag.prototype.emit = function () {\r\n    this.namespace.flags[this.name] = true;\r\n    this.namespace.emit.apply(this.namespace, arguments);\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.websocket = WS;\r\n\r\n  /**\r\n   * The WebSocket transport uses the HTML5 WebSocket API to establish an\r\n   * persistent connection with the Socket.IO server. This transport will also\r\n   * be inherited by the FlashSocket fallback as it provides a API compatible\r\n   * polyfill for the WebSockets.\r\n   *\r\n   * @constructor\r\n   * @extends {io.Transport}\r\n   * @api public\r\n   */\r\n\r\n  function WS (socket) {\r\n    io.Transport.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from Transport.\r\n   */\r\n\r\n  io.util.inherit(WS, io.Transport);\r\n\r\n  /**\r\n   * Transport name\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.name = 'websocket';\r\n\r\n  function empty() { };\r\n\r\n  /**\r\n   * Initializes a new `WebSocket` connection with the Socket.IO server. We attach\r\n   * all the appropriate listeners to handle the responses from the server.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.open = function (connectErrorCallback) {\r\n    var query = io.util.query(this.socket.options.query)\r\n      , self = this\r\n      , Socket\r\n\r\n    this.connectErrorCallback = connectErrorCallback;\r\n\r\n    if (!Socket) {\r\n      Socket = global.MozWebSocket || global.WebSocket;\r\n    }\r\n\r\n    this.websocket = new Socket(this.prepareUrl(query));\r\n\r\n    this.websocket.onopen = function () {\r\n      self.onOpen();\r\n      self.socket.setBuffer(false);\r\n    };\r\n    this.websocket.onmessage = function (ev) {\r\n      self.onData(ev.data);\r\n    };\r\n    this.websocket.onclose = function () {\r\n      self.onClose();\r\n      self.socket.setBuffer(true);\r\n    };\r\n    this.websocket.onerror = function (e) {\r\n      self.onError(e);\r\n    };\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Send a message to the Socket.IO server. The message will automatically be\r\n   * encoded in the correct message format.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.send = function (data) {\r\n    this.websocket.send(data);\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Payload\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  WS.prototype.payload = function (arr) {\r\n    for (var i = 0, l = arr.length; i < l; i++) {\r\n      this.packet(arr[i]);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Disconnect the established `WebSocket` connection.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.close = function () {\r\n    this.websocket.close();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handle the errors that `WebSocket` might be giving when we\r\n   * are attempting to connect or send messages.\r\n   *\r\n   * @param {Error} e The error.\r\n   * @api private\r\n   */\r\n\r\n  WS.prototype.onError = function (e) {\r\n      if (this.connectErrorCallback !== undefined) {\r\n        this.connectErrorCallback();\r\n        this.connectErrorCallback = undefined;\r\n      }\r\n      this.socket.onError(e);\r\n  };\r\n\r\n  /**\r\n   * Returns the appropriate scheme for the URI generation.\r\n   *\r\n   * @api private\r\n   */\r\n  WS.prototype.scheme = function () {\r\n    return this.socket.options.secure ? 'wss' : 'ws';\r\n  };\r\n\r\n  /**\r\n   * Checks if the browser has support for native `WebSockets` and that\r\n   * it's not the polyfill created for the FlashSocket transport.\r\n   *\r\n   * @return {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  WS.check = function () {\r\n    return ('WebSocket' in global && !('__addTask' in WebSocket))\r\n          || 'MozWebSocket' in global;\r\n  };\r\n\r\n  /**\r\n   * Check if the `WebSocket` transport support cross domain communications.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  WS.xdomainCheck = function () {\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * Clears the event listeners attached to the `WebSocket` transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  WS.prototype.clearEventHandlers = function() {\r\n      if (this.websocket) {\r\n          this.websocket.onopen = this.websocket.onmessage = this.websocket.onclose = this.websocket.onerror = empty;\r\n      }\r\n      return this;\r\n  };\r\n\r\n  /**\r\n   * Add the transport to your public io.transports array.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.transports.push('websocket');\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  exports.XHR = XHR;\r\n\r\n  /**\r\n   * XHR constructor\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function XHR (socket) {\r\n    if (!socket) return;\r\n\r\n    io.Transport.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from Transport.\r\n   */\r\n\r\n  io.util.inherit(XHR, io.Transport);\r\n\r\n  /**\r\n   * Establish a connection\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.open = function () {\r\n    this.socket.setBuffer(false);\r\n    this.onOpen();\r\n    this.get();\r\n\r\n    // we need to make sure the request succeeds since we have no indication\r\n    // whether the request opened or not until it succeeded.\r\n    this.setCloseTimeout();\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Check if we need to send data to the Socket.IO server, if we have data in our\r\n   * buffer we encode it and forward it to the `post` method.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.payload = function (payload) {\r\n    var msgs = [];\r\n\r\n    for (var i = 0, l = payload.length; i < l; i++) {\r\n      msgs.push(io.parser.encodePacket(payload[i]));\r\n    }\r\n\r\n    this.send(io.parser.encodePayload(msgs));\r\n  };\r\n\r\n  /**\r\n   * Send data to the Socket.IO server.\r\n   *\r\n   * @param data The message\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.send = function (data) {\r\n    this.post(data);\r\n    return this;\r\n  };\r\n\r\n  function empty () { };\r\n\r\n  /**\r\n   * Posts a encoded message to the Socket.IO server.\r\n   *\r\n   * IMPORTANT: Note that only one of these requests should be in flight at any time,\r\n   * see the mutation of `doBuffer` via `setBuffer`, and where `post` is called from.\r\n   * Subsequent messages will be queued, and sent out on the next call\r\n   * to `setBuffer(false)` (e.g. from the success callback).\r\n   *\r\n   * @param {String} data A encoded message.\r\n   * @api private\r\n   */\r\n  XHR.prototype.post = function (data) {\r\n    var self = this;\r\n    this.socket.setBuffer(true);\r\n\r\n    this.sendXHR = this.request('POST');\r\n\r\n    function stateChange () {\r\n      if (this.readyState == 4) {\r\n        this.onreadystatechange = empty;\r\n\r\n        if (this.status == 200) {\r\n          clearTimeout(this.ackTimeoutTimer);\r\n\r\n          // this flushes the buffer, which can trigger another call to `post`,\r\n          // that will overwrite `self.sendXHR`\r\n          self.socket.setBuffer(false);\r\n\r\n          // at this point, self.sendXHR may already be the subsequent request\r\n        } else {\r\n          self.onClose();\r\n        }\r\n      }\r\n    }\r\n\r\n    function onload () {\r\n      this.onload = empty;\r\n      self.socket.setBuffer(false);\r\n    };\r\n\r\n    if (global.XDomainRequest && this.sendXHR instanceof XDomainRequest) {\r\n      this.sendXHR.onload = this.sendXHR.onerror = onload;\r\n    } else {\r\n      this.sendXHR.onreadystatechange = stateChange;\r\n    }\r\n\r\n    this.sendXHR.send(data);\r\n    self.sendXHR.ackTimeoutTimer = setTimeout(function () {\r\n      self.onClose();\r\n    }, self.socket.options.ackTimeoutMs);\r\n  };\r\n\r\n  /**\r\n   * Disconnects the established `XHR` connection.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.close = function () {\r\n    this.onClose();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Generates a configured XHR request\r\n   *\r\n   * @param {String} url The url that needs to be requested.\r\n   * @param {String} method The method the request should use.\r\n   * @returns {XMLHttpRequest}\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.request = function (method) {\r\n    var req = io.util.request(this.socket.isXDomain())\r\n      , query = io.util.query(this.socket.options.query, 't=' + +new Date);\r\n\r\n    req.open(method || 'GET', this.prepareUrl(query), true);\r\n\r\n    var headers = this.socket.options.requestHeaders;\r\n    if (headers !== undefined) {\r\n      Object.keys(headers).forEach(function(name) {\r\n        req.setRequestHeader(name, headers[name]);\r\n      });\r\n    }\r\n\r\n    if (method == 'POST') {\r\n      try {\r\n        if (req.setRequestHeader) {\r\n          req.setRequestHeader('Content-type', 'text/plain;charset=UTF-8');\r\n        } else {\r\n          // XDomainRequest\r\n          req.contentType = 'text/plain';\r\n        }\r\n      } catch (e) {}\r\n    }\r\n\r\n    return req;\r\n  };\r\n\r\n  /**\r\n   * Returns the scheme to use for the transport URLs.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.scheme = function () {\r\n    return this.socket.options.secure ? 'https' : 'http';\r\n  };\r\n\r\n  /**\r\n   * Check if the XHR transports are supported\r\n   *\r\n   * @param {Boolean} xdomain Check if we support cross domain requests.\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  XHR.check = function (socket, xdomain) {\r\n\r\n    try {\r\n      var request = io.util.request(xdomain),\r\n          usesXDomReq = (global.XDomainRequest && request instanceof XDomainRequest),\r\n          socketProtocol = (socket && socket.options && socket.options.secure ? 'https:' : 'http:'),\r\n          isXProtocol = (socketProtocol != global.location.protocol);\r\n      if (request && !(usesXDomReq && isXProtocol)) {\r\n        return true;\r\n      }\r\n    } catch(e) {}\r\n\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Check if the XHR transport supports cross domain requests.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  XHR.xdomainCheck = function () {\r\n    return XHR.check(null, true);\r\n  };\r\n\r\n  /**\r\n   * Clears the event listeners attached to the XHR transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  XHR.prototype.clearEventHandlers = function () {\r\n      if (this.sendXHR) {\r\n          this.sendXHR.onreadystatechange = this.sendXHR.onload = empty;\r\n      }\r\n      return this;\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports['xhr-polling'] = XHRPolling;\r\n\r\n  /**\r\n   * The XHR-polling transport uses long polling XHR requests to create a\r\n   * \"persistent\" connection with the server.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function XHRPolling () {\r\n    io.Transport.XHR.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from XHR transport.\r\n   */\r\n\r\n  io.util.inherit(XHRPolling, io.Transport.XHR);\r\n\r\n  /**\r\n   * Merge the properties from XHR transport\r\n   */\r\n\r\n  io.util.merge(XHRPolling, io.Transport.XHR);\r\n\r\n  /**\r\n   * Transport name\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  XHRPolling.prototype.name = 'xhr-polling';\r\n\r\n  /**\r\n   * Establish a connection, for iPhone and Android this will be done once the page\r\n   * is loaded.\r\n   *\r\n   * @returns {Transport} Chaining.\r\n   * @api public\r\n   */\r\n\r\n  XHRPolling.prototype.open = function (connectErrorCallback) {\r\n    var self = this;\r\n\r\n    self.connectErrorCallback = connectErrorCallback;\r\n\r\n    io.Transport.XHR.prototype.open.call(self);\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Starts a XHR request to wait for incoming messages.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function empty () {};\r\n\r\n  XHRPolling.prototype.get = function () {\r\n    if (!this.isOpened) return;\r\n\r\n    var self = this;\r\n\r\n    function stateChange () {\r\n      if (this.readyState == 4) {\r\n        this.onreadystatechange = empty;\r\n\r\n        if (this.status == 200) {\r\n          self.connectErrorCallback = undefined;\r\n          self.onData(this.responseText);\r\n          self.get();\r\n        } else {\r\n          self.onClose();\r\n\r\n          if (self.connectErrorCallback !== undefined) {\r\n            self.connectErrorCallback();\r\n            self.connectErrorCallback = undefined;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    function onload () {\r\n      self.connectErrorCallback = undefined;\r\n      this.onload = empty;\r\n      this.onerror = empty;\r\n      self.onData(this.responseText);\r\n      self.get();\r\n    };\r\n\r\n    function onerror () {\r\n      self.onClose();\r\n\r\n      if (self.connectErrorCallback !== undefined) {\r\n        self.connectErrorCallback();\r\n        self.connectErrorCallback = undefined;\r\n      }\r\n    };\r\n\r\n    this.xhr = this.request();\r\n\r\n    if (global.XDomainRequest && this.xhr instanceof XDomainRequest) {\r\n      this.xhr.onload = onload;\r\n      this.xhr.onerror = onerror;\r\n    } else {\r\n      this.xhr.onreadystatechange = stateChange;\r\n    }\r\n\r\n    this.xhr.send(null);\r\n  };\r\n\r\n  /**\r\n   * Handle the unclean close behavior.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHRPolling.prototype.onClose = function () {\r\n    io.Transport.XHR.prototype.onClose.call(this);\r\n\r\n    if (this.xhr) {\r\n      this.xhr.onreadystatechange = this.xhr.onload = this.xhr.onerror = empty;\r\n      try {\r\n        this.xhr.abort();\r\n      } catch(e){}\r\n      this.xhr = null;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Webkit based browsers show a infinit spinner when you start a XHR request\r\n   * before the browsers onload event is called so we need to defer opening of\r\n   * the transport until the onload event is called. Wrapping the cb in our\r\n   * defer method solve this.\r\n   *\r\n   * @param {Socket} socket The socket instance that needs a transport\r\n   * @param {Function} fn The callback\r\n   * @api private\r\n   */\r\n\r\n  XHRPolling.prototype.ready = function (socket, fn) {\r\n    var self = this;\r\n\r\n    io.util.defer(function () {\r\n      fn.call(self);\r\n    });\r\n  };\r\n\r\n   /**\r\n   * Clears the event listeners attached to the XHR transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  XHRPolling.prototype.clearEventHandlers = function () {\r\n      io.Transport.XHR.prototype.clearEventHandlers.call(this);\r\n\r\n      if (this.xhr) {\r\n          this.xhr.onreadystatechange = this.xhr.onload = this.xhr.onerror = empty;\r\n      }\r\n      return this;\r\n  }\r\n\r\n  /**\r\n   * Add the transport to your public io.transports array.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.transports.push('xhr-polling');\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\nexports.io = io;\r\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(13), __webpack_require__(14)(module)))\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports) {\n\nmodule.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ConnectionTracker = exports.Properties = exports.TrackerStep = exports.ClientEventName = exports.ResponseData = void 0;\nvar Common_1 = __webpack_require__(3);\nvar Constants_1 = __webpack_require__(1);\nvar Logger_1 = __webpack_require__(0);\n/**\n * Data for trouter response\n */\nvar ResponseData = /** @class */ (function () {\n    function ResponseData(id) {\n        this.id = id;\n        this.status = 200;\n        this.headers = {};\n        this.body = '';\n    }\n    return ResponseData;\n}());\nexports.ResponseData = ResponseData;\n// Possible telemetry events\nvar ClientEventName;\n(function (ClientEventName) {\n    ClientEventName[\"Connected\"] = \"trouter_js_client_connected\";\n    ClientEventName[\"Disconnected\"] = \"trouter_js_client_disconnected\";\n    ClientEventName[\"Error\"] = \"trouter_js_client_error\";\n    ClientEventName[\"Progress\"] = \"trouter_js_client_progress\";\n    ClientEventName[\"Response\"] = \"trouter_js_client_response\";\n    ClientEventName[\"Request\"] = \"trouter_js_client_request\";\n    ClientEventName[\"CheckConnection\"] = \"trouter_js_client_check_connection\";\n    ClientEventName[\"Registration\"] = \"trouter_js_client_registration\";\n    ClientEventName[\"Unregistration\"] = \"trouter_js_client_unregistration\";\n})(ClientEventName || (exports.ClientEventName = ClientEventName = {}));\n/**\n * Stores one step of connection process\n */\nvar TrackerStep = /** @class */ (function () {\n    function TrackerStep(stepName, operation, delta, ts, error) {\n        this.stepName = stepName;\n        this.operation = operation;\n        this.delta = delta;\n        this.ts = ts;\n        this.error = error;\n    }\n    return TrackerStep;\n}());\nexports.TrackerStep = TrackerStep;\n/**\n * Base class for something that can be used as a property bag\n */\nvar Properties = /** @class */ (function () {\n    function Properties() {\n    }\n    return Properties;\n}());\nexports.Properties = Properties;\n/**\n * Information about connection\n */\nvar ConnectedInfo = /** @class */ (function () {\n    function ConnectedInfo() {\n        this.numberOfPingReplies = 0;\n        this.connectedTimestamp = 0;\n        this.isNewUrl = false;\n        this.transportType = '';\n        this.connectionNumber = 0;\n    }\n    return ConnectedInfo;\n}());\n/**\n * Default values for IEventLogSettings\n */\nvar EventLogSettings = /** @class */ (function () {\n    function EventLogSettings() {\n        this.enabled = false;\n        this.numberOfStepsToMaintain = 40;\n        this.logHealthCheckError = false;\n        this.sendProgressTimeoutSecs = 55;\n        this.logSendPingError = false;\n        this.maxBackoffInMs = 120000;\n        this.trouter_js_client_connected = false;\n        this.trouter_js_client_disconnected = false;\n        this.trouter_js_client_error = false;\n        this.trouter_js_client_progress = false;\n        this.trouter_js_client_response = false;\n        this.trouter_js_client_request = false;\n        this.trouter_js_client_registration = false;\n        this.trouter_js_client_unregistration = false;\n        /** This event is ENABLED by default */\n        this.trouter_js_client_check_connection = true;\n    }\n    return EventLogSettings;\n}());\n/**\n * Telemetry sender\n */\nvar ConnectionTracker = /** @class */ (function () {\n    function ConnectionTracker(logfunc, clientId, clientInfo, getServerState, endpointId, clientCorrelationID, environment) {\n        this.clientId = clientId;\n        this.clientInfo = clientInfo;\n        this.getServerState = getServerState;\n        this.endpointId = endpointId;\n        this.clientCorrelationID = clientCorrelationID;\n        this.environment = environment;\n        this.logger = new Logger_1.Logger('ConnectionTracker', logfunc);\n        this.clientCorrelationID = clientCorrelationID !== undefined ? clientCorrelationID : '';\n        this.steps = [];\n        this.connectionAttempt = 0;\n        this.totalStepCount = 0;\n        this.beginTimestamp = new Common_1.Timespan();\n        this.eventLogSettings = new EventLogSettings();\n        this.connectedInfo = new ConnectedInfo();\n    }\n    ConnectionTracker.prototype.enable = function (telemetrySender) {\n        this.eventLogSettings.enabled = true;\n        this.eventLogger = telemetrySender;\n    };\n    ConnectionTracker.prototype.disable = function () {\n        this.eventLogSettings.enabled = false;\n    };\n    ConnectionTracker.prototype.sendProgress = function (context) {\n        // connect truncates steps array. this check ensures that a progress event is only sent out if the client is not connected\n        if (this.steps.length > 0) {\n            this.sendTelemetry(ClientEventName.Progress, context, this.steps);\n        }\n    };\n    ConnectionTracker.prototype.cancelProgressTimer = function () {\n        if (this.progressTimeout !== undefined) {\n            clearTimeout(this.progressTimeout);\n            this.progressTimeout = undefined;\n        }\n    };\n    ConnectionTracker.prototype.resetProgressSendTimer = function () {\n        var _this = this;\n        this.cancelProgressTimer();\n        // send connection steps after a timeout\n        // this timeout may fire if auth callback never comes or the client is stuck in a loop to get connected\n        if (this.eventLogSettings.sendProgressTimeoutSecs !== undefined && this.eventLogSettings.sendProgressTimeoutSecs > 0) {\n            this.progressTimeout = setTimeout(function () {\n                _this.sendProgress({\n                    reason: 'timeout',\n                    timeoutSecs: _this.eventLogSettings.sendProgressTimeoutSecs\n                });\n            }, 1000 * this.eventLogSettings.sendProgressTimeoutSecs);\n        }\n    };\n    ConnectionTracker.prototype.setConnectedInfo = function (isNewUrl, transportType) {\n        this.connectedInfo.numberOfPingReplies = 0;\n        this.connectedInfo.connectedTimestamp = Date.now();\n        this.connectedInfo.isNewUrl = isNewUrl;\n        this.connectedInfo.transportType = transportType;\n        ++this.connectedInfo.connectionNumber;\n    };\n    ConnectionTracker.prototype.clearConnectedInfo = function () {\n        this.connectedInfo.numberOfPingReplies = 0;\n        this.connectedInfo.connectedTimestamp = 0;\n        this.connectedInfo.isNewUrl = true;\n        this.connectedInfo.transportType = '';\n    };\n    // Copies from\n    // source {\n    //    propName: value\n    // }\n    // to\n    // dest {\n    //    propName: { value: actualValue }\n    // }\n    ConnectionTracker.prototype.copyProperties = function (dest, source) {\n        // copy properties from source and add in a format expected by logger\n        for (var _i = 0, _a = Object.keys(source); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            if (source[prop] !== undefined) {\n                // replace hyphen by _\n                dest[prop.replace(/-/g, '_')] = { value: source[prop] };\n            }\n        }\n    };\n    ConnectionTracker.prototype.increasePingResponseCount = function () {\n        ++this.connectedInfo.numberOfPingReplies;\n    };\n    /**\n     * @param eventName Telemetry event name\n     * @param eventProperties Event property bag\n     * @param progress\n     */\n    ConnectionTracker.prototype.sendTelemetry = function (eventName, eventProperties, progress) {\n        try {\n            if (this.eventLogSettings.enabled === true\n                && this.eventLogSettings[eventName] === true\n                && this.eventLogger !== undefined) {\n                var serverState = this.getServerState();\n                var clientEvent = {\n                    name: eventName,\n                    properties: {\n                        connectionAttempt: { value: this.connectionAttempt },\n                        epid: { value: this.endpointId },\n                        clientCorrelationID: { value: this.clientCorrelationID },\n                        steps: { value: (0, Common_1.toJson)(progress) },\n                        clientID: { value: this.clientId },\n                        eventVersion: { value: 3 },\n                        environment: { value: this.environment },\n                        cv: { value: Constants_1.CLIENT_VERSION },\n                        ua: { value: this.clientInfo.ua },\n                        // Copy ServerState\n                        connectionId: { value: serverState.connectionId },\n                        connectedClientId: { value: serverState.connectedClientId },\n                        domId: { value: serverState.domId },\n                        url: { value: serverState.unsecureUrl },\n                        surl: { value: serverState.url },\n                        ttlInSecs: { value: serverState.getRemainingTtlInSec() },\n                        // Copy this.connectedInfo\n                        numberOfPingReplies: { value: this.connectedInfo.numberOfPingReplies },\n                        connectedTimestamp: { value: this.connectedInfo.connectedTimestamp },\n                        isNewUrl: { value: this.connectedInfo.isNewUrl },\n                        transportType: { value: this.connectedInfo.transportType },\n                        connectionNumber: { value: this.connectedInfo.connectionNumber }\n                    }\n                };\n                this.copyProperties(clientEvent.properties, eventProperties);\n                this.eventLogger.logEvent(clientEvent);\n            }\n        }\n        catch (exc) {\n            this.logger.warn(\"error in sending event \".concat(eventName, \": \").concat((0, Common_1.toJson)(exc)));\n        }\n    };\n    ConnectionTracker.prototype.createStep = function (stepName, operation, error) {\n        return new TrackerStep(stepName, operation, this.beginTimestamp.duration, Date.now(), error);\n    };\n    ConnectionTracker.prototype.addStep = function (tag, progressHint, error) {\n        if (this.eventLogSettings.enabled === false) {\n            return;\n        }\n        if (this.steps.length === 0) {\n            this.beginTimestamp.reset();\n        }\n        this.steps.push(this.createStep(tag, progressHint, error));\n        ++this.totalStepCount;\n        // do not maintain an ever growing list of steps. send a progress event with what is collected so far and clear steps\n        // there should be enough context in any event for the server to group events created for the sameonnection\n        if (this.eventLogSettings.numberOfStepsToMaintain !== undefined\n            && this.steps.length > this.eventLogSettings.numberOfStepsToMaintain) {\n            var progress = this.steps.slice(0);\n            this.steps.length = 0;\n            this.sendTelemetry(ClientEventName.Progress, { reason: 'flush' }, progress);\n        }\n    };\n    ConnectionTracker.prototype.trackStart = function (tag) {\n        this.addStep(tag, 'start');\n    };\n    ConnectionTracker.prototype.trackEnd = function (tag) {\n        this.addStep(tag, 'end');\n    };\n    ConnectionTracker.prototype.trackError = function (tag, error, addStep, subOperation) {\n        if (addStep === void 0) { addStep = true; }\n        if (tag === 'health' && this.eventLogSettings.logHealthCheckError !== true) {\n            return;\n        }\n        if (tag === 'ping' && this.eventLogSettings.logSendPingError === false) {\n            return;\n        }\n        if (subOperation === undefined) {\n            subOperation = 'error';\n        }\n        if (addStep === true) {\n            this.addStep(tag, subOperation, error);\n        }\n        this.sendTelemetry(ClientEventName.Error, {}, [this.createStep(tag, subOperation, error)]);\n    };\n    ConnectionTracker.prototype.trackProgress = function (tag, subOperation) {\n        this.addStep(tag, subOperation);\n    };\n    ConnectionTracker.prototype.trackConnected = function (isNewUrl, transportType) {\n        this.setConnectedInfo(isNewUrl, transportType);\n        var progress = this.steps.slice(0);\n        var totalSteps = this.totalStepCount;\n        var connectionDuration = this.beginTimestamp.duration;\n        // clear steps collected\n        this.steps.length = 0;\n        this.totalStepCount = 0;\n        this.sendTelemetry(ClientEventName.Connected, {\n            stepCount: progress.length,\n            totalStepCount: totalSteps,\n            connectionEstablishmentMs_Total: connectionDuration\n        }, progress);\n        this.cancelProgressTimer();\n    };\n    ConnectionTracker.prototype.getSessionLength = function () {\n        return Date.now() - this.connectedInfo.connectedTimestamp;\n    };\n    ConnectionTracker.prototype.trackDisconnected = function (context) {\n        context.sessionLengthMS = this.getSessionLength();\n        this.sendTelemetry(ClientEventName.Disconnected, context, []);\n        this.resetProgressSendTimer();\n    };\n    ConnectionTracker.prototype.trackNewConnection = function () {\n        ++this.connectionAttempt;\n    };\n    ConnectionTracker.prototype.trackRequest = function (request, errorMsg) {\n        var context = {};\n        if (errorMsg !== undefined) {\n            context.hasError = true;\n            context.error = errorMsg;\n        }\n        try {\n            if (request) {\n                context.requestID = request.id;\n                context.httpMethod = request.method;\n                context.url = request.url;\n                context.bodyLength = request.body.length;\n                context.shortUrl = request.shortUrl;\n                context.requestTimeStamp = request.startTS;\n                context.correlationVector = request.correlationVector;\n                var headers = request.headers;\n                for (var _i = 0, _a = Object.keys(headers); _i < _a.length; _i++) {\n                    var header = _a[_i];\n                    context[header] = headers[header];\n                }\n            }\n        }\n        catch (exc) {\n            context.hasError = true;\n            context.error = \"\".concat(context.error, \" error creating request context \").concat((0, Common_1.toJson)(exc));\n        }\n        this.sendTelemetry(ClientEventName.Request, context, []);\n    };\n    ConnectionTracker.prototype.trackResponse = function (request, latencyMS, responseData, errorMsg) {\n        var context = {};\n        if (errorMsg !== undefined) {\n            context.hasError = true;\n            context.error = errorMsg;\n        }\n        try {\n            context.responseTimestamp = responseData !== undefined ? responseData.sentTS : Date.now();\n            if (request) {\n                context.requestID = request.id;\n                context.httpMethod = request.method;\n                context.shortUrl = request.shortUrl;\n                context.correlationVector = request.correlationVector;\n                var headers = request.headers;\n                for (var _i = 0, _a = Object.keys(headers); _i < _a.length; _i++) {\n                    var header = _a[_i];\n                    context[header] = headers[header];\n                }\n            }\n            if (responseData) {\n                context.latencyMS = latencyMS;\n                context.responseCode = responseData.status;\n                context.responseLength = responseData.body.length;\n            }\n        }\n        catch (exc) {\n            context.hasError = true;\n            context.error = \"\".concat(context.error, \" error creating response context \").concat((0, Common_1.toJson)(exc));\n        }\n        this.sendTelemetry(ClientEventName.Response, context, []);\n    };\n    ConnectionTracker.prototype.sendResponseError = function (errorMsg, request, responseData) {\n        this.trackResponse(request, undefined, responseData, errorMsg);\n    };\n    ConnectionTracker.prototype.close = function () {\n        this.sendProgress({\n            reason: 'closed'\n        });\n        this.steps.length = 0;\n        this.cancelProgressTimer();\n    };\n    ConnectionTracker.prototype.mergeSettings = function (settings) {\n        if (!settings) {\n            return;\n        }\n        this.eventLogSettings.numberOfStepsToMaintain = Math.min(40, Math.max(10, (settings.numberOfStepsToMaintain !== undefined ? settings.numberOfStepsToMaintain : 0)));\n        // min of 55 secs and max allowed is 1 hr\n        var newProgressTimeout = Math.min(3600, Math.max(55, settings.sendProgressTimeoutSecs !== undefined ? settings.sendProgressTimeoutSecs : 0));\n        this.eventLogSettings.logHealthCheckError = settings.logHealthCheckError;\n        this.eventLogSettings.logSendPingError = settings.logSendPingError;\n        // Copy enable/disable flags for all telemetry events\n        for (var _i = 0, _a = Object.keys(ClientEventName).map(function (k) { return ClientEventName[k]; }); _i < _a.length; _i++) {\n            var iterator = _a[_i];\n            if (settings[iterator] !== undefined) {\n                this.eventLogSettings[iterator] = settings[iterator];\n            }\n        }\n        if (this.eventLogSettings.sendProgressTimeoutSecs !== newProgressTimeout) {\n            this.eventLogSettings.sendProgressTimeoutSecs = newProgressTimeout;\n            this.resetProgressSendTimer();\n        }\n    };\n    return ConnectionTracker;\n}());\nexports.ConnectionTracker = ConnectionTracker;\n\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DisconnectReason = void 0;\n/**\n * Disconnect reason format sent when using the /v4/c protocol as part of the socket.io disconnect (`0::`),\n * e.g.\n * - `0::`\n * - `0:::dup`\n * - `0:::{\"reason\":\"unauthorized\",\"claims\":\"Bearer token_types=\\\"skype,aad,cae\\\"\"}`\n *\n * Additionally, it is also used internally for other socket.io events calling `TrouterFsm.onSocketDisconnect` (see usages).\n */\nvar DisconnectReason = /** @class */ (function () {\n    function DisconnectReason(reason, claims, details) {\n        this.reason = reason;\n        this.claims = claims;\n        this.details = details;\n    }\n    DisconnectReason.fromRawReason = function (rawReason, logger) {\n        if (rawReason === '' || rawReason === 'dup') {\n            return new DisconnectReason(rawReason);\n        }\n        try {\n            var parsedReason = JSON.parse(rawReason);\n            if (typeof parsedReason !== 'object' || parsedReason.reason === undefined) {\n                logger === null || logger === void 0 ? void 0 : logger.error('invalid disconnect reason format');\n                return new DisconnectReason('unknown', undefined, rawReason);\n            }\n            return new DisconnectReason(parsedReason.reason, parsedReason.claims, parsedReason.details);\n        }\n        catch (e) {\n            // Non-JSON string from the `0::` socket.io message is just set \"as is\" as details\n            return new DisconnectReason('disconnect', undefined, rawReason);\n        }\n    };\n    DisconnectReason.fromSocketIoEventData = function (event, arg) {\n        return typeof arg === 'string' ? new DisconnectReason(event, undefined, arg) : undefined;\n    };\n    DisconnectReason.prototype.toTelemetryString = function () {\n        if (this.reason === 'socketerror' || this.reason === 'reconnecterror' || this.reason === 'disconnect') {\n            return this.details;\n        }\n        return this.reason;\n    };\n    return DisconnectReason;\n}());\nexports.DisconnectReason = DisconnectReason;\n\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ExponentialBackoff = void 0;\n/**\n * Executes callbacks with exponential backoff\n */\nvar ExponentialBackoff = /** @class */ (function () {\n    function ExponentialBackoff(logger, maxBackoffInMs, gapDetectionSettings) {\n        if (gapDetectionSettings === void 0) { gapDetectionSettings = { tolerance: 2, minimumWaitMs: 10000 }; }\n        this.logger = logger;\n        this.maxBackoffInMs = maxBackoffInMs;\n        this.gapDetectionSettings = gapDetectionSettings;\n        this.backoffId = 0;\n        this.backoffCount = 0;\n    }\n    ExponentialBackoff.calculateNextBackoffMs = function (backoffCount, maxBackoffInMs) {\n        var fudge = 1 + (Math.random() - 0.5) * 0.4; // +/- 20%\n        var backoff = 1000 * Math.pow(2, backoffCount) * fudge; // 1s initial\n        backoff = Math.round(backoff);\n        return Math.min(maxBackoffInMs, backoff);\n    };\n    ExponentialBackoff.prototype.setMaxBackoffMs = function (ms) {\n        this.maxBackoffInMs = ms;\n    };\n    ExponentialBackoff.prototype.backoff = function (taskName, handler) {\n        var _this = this;\n        if (this.timerHandle !== undefined) {\n            this.logger.debug('Clearing current back off');\n            clearTimeout(this.timerHandle);\n            this.timerHandle = undefined;\n        }\n        // This detects a situation where the computer/tab likely went to sleep while NOT waiting on backoff,\n        // but doing other things (e.g. waiting on fetch, waiting on token provider, etc.),\n        // and woke up much later, the operation having failed, triggering a retry after backoff.\n        // If a lot of time has passed in sleep, we want to reset that backoff.\n        //\n        // We are counting on the fact that the operation (fetch, token wait, etc.) should never take significantly longer\n        // than the maximum allowed backoff time, to avoid unwanted resets.\n        //\n        // (If computer woke up while it WAS waiting on backoff, after a long time, it would likely complete that wait\n        // immediately, so previousCompleteTime would be very close to the next attempt, thus not triggering this.)\n        if (this.previousCompleteTime !== undefined) {\n            var elapsed = Date.now() - this.previousCompleteTime;\n            // The time to reset this needs to be much longer here, as the operation itself can take quite a long time even under normal circumstances.\n            // In practice, based on settings as of February 2024, this can be triggered after a sleep that in some cases needs to be over 10 minutes.\n            if (elapsed > this.maxBackoffInMs * this.gapDetectionSettings.tolerance && elapsed > this.gapDetectionSettings.minimumWaitMs) {\n                this.logger.info(\"Back off for \".concat(taskName, \" with ID \").concat(this.backoffId, \" will be reset due to a lot of time having passed since the previous backoff (\").concat(elapsed, \" ms)\"));\n                this.backoffCount = 0;\n                this.previousCompleteTime = undefined;\n            }\n        }\n        var backoffMs = ExponentialBackoff.calculateNextBackoffMs(this.backoffCount, this.maxBackoffInMs);\n        this.backoffId++;\n        this.backoffCount++;\n        this.logger.info(\"Backing off \".concat(taskName, \" for \").concat(backoffMs, \" milliseconds with ID \").concat(this.backoffId));\n        this.callback = function (waitStart, expectedWait) {\n            if (shouldReset(waitStart, expectedWait, _this.gapDetectionSettings)) {\n                // Most likely computer/tab went to sleep while waiting on backoff and woke up much later\n                _this.logger.info(\"Back off for \".concat(taskName, \" with ID \").concat(_this.backoffId, \" will be reset due to the wait (\").concat(Date.now() - (waitStart !== null && waitStart !== void 0 ? waitStart : 0), \" ms) being longer than expected (\").concat(expectedWait, \" ms)\"));\n                _this.backoffCount = 0;\n            }\n            _this.logger.info(\"Back off for \".concat(taskName, \" with ID \").concat(_this.backoffId, \" complete, invoking handler\"));\n            _this.timerHandle = undefined;\n            _this.callback = undefined;\n            _this.previousCompleteTime = Date.now();\n            handler();\n        };\n        var backoffWaitStart = Date.now();\n        this.timerHandle = setTimeout(function () { var _a; return (_a = _this.callback) === null || _a === void 0 ? void 0 : _a.call(_this, backoffWaitStart, backoffMs); }, backoffMs);\n    };\n    /// Stop the backoff if active, do not call the handler and reset to the initial/shortest period again\n    ExponentialBackoff.prototype.reset = function () {\n        if (this.timerHandle !== undefined) {\n            this.logger.debug(\"Resetting back off with ID \".concat(this.backoffId));\n            clearTimeout(this.timerHandle);\n            this.timerHandle = undefined;\n            this.callback = undefined;\n        }\n        this.backoffCount = 0;\n    };\n    /// Call the handler right now if active and reset to the initial/shortest period again\n    ExponentialBackoff.prototype.expediteIfPending = function () {\n        this.backoffCount = 0;\n        if (this.timerHandle !== undefined) {\n            this.logger.debug(\"Expediting back off with ID \".concat(this.backoffId));\n            clearTimeout(this.timerHandle);\n            this.timerHandle = undefined;\n            var callback = this.callback;\n            this.callback = undefined;\n            if (callback) {\n                callback();\n            }\n        }\n    };\n    return ExponentialBackoff;\n}());\nexports.ExponentialBackoff = ExponentialBackoff;\nfunction shouldReset(waitStart, expectedWait, settings) {\n    if (waitStart === undefined || expectedWait === undefined) {\n        return false;\n    }\n    var actualWait = Date.now() - waitStart;\n    return actualWait > expectedWait * settings.tolerance && actualWait > settings.minimumWaitMs;\n}\n\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LoggingManagerConsumer = exports.RegistrationEnforcer = void 0;\nvar TrouterFsm_1 = __webpack_require__(6);\n/**\n * Intercepts calls from TrouterConnection to TrouterManager, to only allow\n * switching to the \"connected\" state after the connection\n * has been successfully registered, and disconnects Trouter if an existing\n * registration expires or gets revoked.\n *\n * One instance of this wrappere exists per each TrouterConnection (though wrapping the same TrouterManger instance),\n * this object thus holds state specific to a particular TrouterConnection.\n */\nvar RegistrationEnforcer = /** @class */ (function () {\n    function RegistrationEnforcer(wrapped, shouldConnectionDependOnRegistration, shouldHoldBackEvents) {\n        this.wrapped = wrapped;\n        this.shouldConnectionDependOnRegistration = shouldConnectionDependOnRegistration;\n        this.shouldHoldBackEvents = shouldHoldBackEvents;\n        this.isRegistered = false;\n        this.heldBackEvents = [];\n    }\n    RegistrationEnforcer.prototype.onDownstreamRequest = function (connection, request, response) {\n        this.passIfRegisteredOrNotNeeded('onDownstreamRequest', connection, request, response);\n    };\n    RegistrationEnforcer.prototype.onConnected = function (connection) {\n        this.passIfRegisteredOrNotNeeded('onConnected', connection);\n    };\n    RegistrationEnforcer.prototype.onRegistered = function (connection) {\n        this.isRegistered = true;\n        this.wrapped.onRegistered(connection);\n        this.fireHeldBackEvents();\n    };\n    RegistrationEnforcer.prototype.onUnregistered = function (connection) {\n        this.isRegistered = false;\n        this.wrapped.onUnregistered(connection);\n        if (connection.getState() === TrouterFsm_1.State.Connected && this.shouldConnectionDependOnRegistration()) {\n            connection.forceReconnectDueToNoRegistration();\n        }\n    };\n    RegistrationEnforcer.prototype.onReconnecting = function (connection) {\n        this.wrapped.onReconnecting(connection);\n    };\n    RegistrationEnforcer.prototype.onReconnectIsRequired = function (connection, useConnectParamsFromCache, reason) {\n        this.wrapped.onReconnectIsRequired(connection, useConnectParamsFromCache, reason);\n    };\n    RegistrationEnforcer.prototype.onDisconnected = function (connection) {\n        this.isRegistered = false;\n        this.dropHeldBackEvents();\n        this.wrapped.onDisconnected(connection);\n    };\n    RegistrationEnforcer.prototype.onTerminalError = function (connection) {\n        this.wrapped.onTerminalError(connection);\n    };\n    RegistrationEnforcer.prototype.onConnectionParametersUpdated = function (connectParams) {\n        this.wrapped.onConnectionParametersUpdated(connectParams);\n    };\n    RegistrationEnforcer.prototype.onTrouterMessageLost = function (flowTags) {\n        this.passIfRegisteredOrNotNeeded('onTrouterMessageLost', flowTags);\n    };\n    RegistrationEnforcer.prototype.onUserActivityStateAccepted = function (cv) {\n        this.passIfRegisteredOrNotNeeded('onUserActivityStateAccepted', cv);\n    };\n    RegistrationEnforcer.prototype.onAudiencesSetResolved = function (audienceSubscriptionsResponse, cv) {\n        this.passIfRegisteredOrNotNeeded('onAudiencesSetResolved', audienceSubscriptionsResponse, cv);\n    };\n    RegistrationEnforcer.prototype.getState = function () {\n        return this.wrapped.getState();\n    };\n    RegistrationEnforcer.prototype.holdBackEvent = function (kind) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        this.heldBackEvents.push({ kind: kind, args: args });\n    };\n    RegistrationEnforcer.prototype.passIfRegisteredOrNotNeeded = function (kind) {\n        var _a;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var connectionDependsOnRegistration = this.shouldConnectionDependOnRegistration();\n        var holdBackEvents = this.shouldHoldBackEvents();\n        // replay existing events if we previously needed registration but now don't, or if we should not hold back events anymore\n        if (!connectionDependsOnRegistration || !holdBackEvents) {\n            this.fireHeldBackEvents(connectionDependsOnRegistration ?\n                function (e) { return e.kind !== 'onConnected'; } :\n                undefined);\n        }\n        if (this.isRegistered || !connectionDependsOnRegistration || (holdBackEvents === false && kind !== 'onConnected')) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-return,@typescript-eslint/no-explicit-any\n            (_a = this.wrapped)[kind].apply(_a, args);\n        }\n        else {\n            this.holdBackEvent.apply(this, __spreadArray([kind], args, false));\n        }\n    };\n    RegistrationEnforcer.prototype.fireHeldBackEvents = function (filter) {\n        var _a;\n        for (var _i = 0, _b = this.heldBackEvents; _i < _b.length; _i++) {\n            var event_1 = _b[_i];\n            if (filter !== undefined && !filter(event_1)) {\n                continue;\n            }\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-return,@typescript-eslint/no-explicit-any\n            (_a = this.wrapped)[event_1.kind].apply(_a, event_1.args);\n        }\n        if (filter === undefined) {\n            this.heldBackEvents = [];\n        }\n        else {\n            // keep everything that wasn't fired\n            this.heldBackEvents = this.heldBackEvents.filter(function (e) { return !filter(e); });\n        }\n    };\n    RegistrationEnforcer.prototype.dropHeldBackEvents = function () {\n        this.heldBackEvents = [];\n    };\n    return RegistrationEnforcer;\n}());\nexports.RegistrationEnforcer = RegistrationEnforcer;\n/**\n * Wrapper for debugging and tests, can be used to compare\n * the original and filtered events, by creating e.g.\n * ```\n * new LoggingManagerConsumer(\n *   new RegistrationEnforcer(\n *     new LoggingManagerConsumer(this, 'inner'),\n *     true\n *   ),\n * 'outer')\n * ```\n * where the outer one will log all the calls from TrouterConnection,\n * and the inner one will only log the calls that go through (with the\n * resulting order/delay/etc.)\n */\nvar LoggingManagerConsumer = /** @class */ (function () {\n    function LoggingManagerConsumer(wrapped, prefix, logger, onEventAction) {\n        this.wrapped = wrapped;\n        this.prefix = prefix;\n        this.logger = logger;\n        this.onEventAction = onEventAction;\n    }\n    LoggingManagerConsumer.prototype.onEvent = function (name, jsonArgs) {\n        var _a;\n        if (this.onEventAction !== undefined) {\n            this.onEventAction(name, jsonArgs);\n        }\n        else {\n            ((_a = this.logger) !== null && _a !== void 0 ? _a : console).log(\"\".concat(this.prefix, \" TracingEnforcer: \").concat(name, \"(\").concat(jsonArgs, \")\"));\n        }\n    };\n    LoggingManagerConsumer.prototype.onDownstreamRequest = function (connection, request, response) {\n        this.onEvent('onDownstreamRequest', JSON.stringify({ request: request, response: response }));\n        this.wrapped.onDownstreamRequest(connection, request, response);\n    };\n    LoggingManagerConsumer.prototype.onConnected = function (connection) {\n        this.onEvent('onConnected', connection.getState().toString());\n        this.wrapped.onConnected(connection);\n    };\n    LoggingManagerConsumer.prototype.onRegistered = function (connection) {\n        this.onEvent('onRegistered', connection.getState().toString());\n        this.wrapped.onRegistered(connection);\n    };\n    LoggingManagerConsumer.prototype.onUnregistered = function (connection) {\n        this.onEvent('onUnregistered', connection.getState().toString());\n        this.wrapped.onUnregistered(connection);\n    };\n    LoggingManagerConsumer.prototype.onReconnecting = function (connection) {\n        this.onEvent('onReconnecting', connection.getState().toString());\n        this.wrapped.onReconnecting(connection);\n    };\n    LoggingManagerConsumer.prototype.onReconnectIsRequired = function (connection, useConnectParamsFromCache, reason) {\n        this.onEvent('onReconnectIsRequired', JSON.stringify({ connection: connection.getState().toString(), useConnectParamsFromCache: useConnectParamsFromCache, reason: reason }));\n        this.wrapped.onReconnectIsRequired(connection, useConnectParamsFromCache, reason);\n    };\n    LoggingManagerConsumer.prototype.onDisconnected = function (connection) {\n        this.onEvent('onDisconnected', connection.getState().toString());\n        this.wrapped.onDisconnected(connection);\n    };\n    LoggingManagerConsumer.prototype.onTerminalError = function (connection) {\n        this.onEvent('onTerminalError', JSON.stringify({ connection: connection }));\n        this.wrapped.onTerminalError(connection);\n    };\n    LoggingManagerConsumer.prototype.onConnectionParametersUpdated = function (connectParams) {\n        this.onEvent('onConnectionParametersUpdated', JSON.stringify({ connectParams: connectParams }));\n        this.wrapped.onConnectionParametersUpdated(connectParams);\n    };\n    LoggingManagerConsumer.prototype.onTrouterMessageLost = function (flowTags) {\n        this.onEvent('onTrouterMessageLost', JSON.stringify({ flowTags: flowTags }));\n        this.wrapped.onTrouterMessageLost(flowTags);\n    };\n    LoggingManagerConsumer.prototype.onUserActivityStateAccepted = function (cv) {\n        this.onEvent('onUserActivityStateAccepted', JSON.stringify({ cv: cv }));\n        this.wrapped.onUserActivityStateAccepted(cv);\n    };\n    LoggingManagerConsumer.prototype.onAudiencesSetResolved = function (audienceSubscriptionsResponse, cv) {\n        this.onEvent('onAudiencesSetResolved', JSON.stringify({ audienceSubscriptionsResponse: audienceSubscriptionsResponse, cv: cv }));\n        this.wrapped.onAudiencesSetResolved(audienceSubscriptionsResponse, cv);\n    };\n    LoggingManagerConsumer.prototype.getState = function () {\n        return this.wrapped.getState();\n    };\n    return LoggingManagerConsumer;\n}());\nexports.LoggingManagerConsumer = LoggingManagerConsumer;\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TrouterManagerFsm = void 0;\nvar Interfaces_1 = __webpack_require__(2);\nvar InternalInterfaces_1 = __webpack_require__(4);\nvar Logger_1 = __webpack_require__(0);\nvar TrouterConnection_1 = __webpack_require__(7);\n/**\n * State machine for manager\n */\nvar TrouterManagerFsm = /** @class */ (function () {\n    function TrouterManagerFsm(logFunc, worker) {\n        this.worker = worker;\n        this.state = InternalInterfaces_1.TrouterManagerState.Unknown;\n        this.logger = new Logger_1.Logger('ManagerFsm', logFunc);\n    }\n    TrouterManagerFsm.prototype.start = function () {\n        if (this.state === InternalInterfaces_1.TrouterManagerState.Unknown) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Disconnected);\n            this.worker.forceStopLingeringConnection();\n            this.worker.startFirstConnection();\n        }\n        else {\n            // Trouter is already running, but external code calling start()\n            // is often triggered by some relevant external event (e.g. computer waking up),\n            // so we want to retry immediately to not create unnecessary delays.\n            this.logger.info(\"start called in state '\".concat(InternalInterfaces_1.TrouterManagerState[this.state], \"', expediting pending backoffs, if any\"));\n            this.worker.expediteBackoffOnConnections();\n        }\n    };\n    TrouterManagerFsm.prototype.stop = function (dontUnregister) {\n        if (this.state !== InternalInterfaces_1.TrouterManagerState.Unknown) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Unknown);\n            this.worker.stopFirstConnection(dontUnregister === true);\n            this.worker.stopSecondConnection(dontUnregister === true);\n        }\n        else {\n            this.showIgnored('stop');\n        }\n    };\n    /** Returns current state */\n    TrouterManagerFsm.prototype.getState = function () {\n        switch (this.state) {\n            case InternalInterfaces_1.TrouterManagerState.Unknown:\n            case InternalInterfaces_1.TrouterManagerState.Connected:\n            case InternalInterfaces_1.TrouterManagerState.Disconnected:\n            case InternalInterfaces_1.TrouterManagerState.Switching:\n                return this.state;\n            case InternalInterfaces_1.TrouterManagerState.TerminalError:\n                return Interfaces_1.TrouterState.Disconnected;\n        }\n    };\n    TrouterManagerFsm.prototype.getInternalState = function () {\n        return this.state;\n    };\n    TrouterManagerFsm.prototype.onConnected = function (first) {\n        if (this.state === InternalInterfaces_1.TrouterManagerState.Disconnected && first) {\n            if (this.worker.doesSecondConnectionExist()) {\n                this.setState(InternalInterfaces_1.TrouterManagerState.Switching);\n            }\n            else {\n                this.setState(InternalInterfaces_1.TrouterManagerState.Connected);\n                this.worker.dispatchConnected();\n            }\n        }\n        else {\n            this.showIgnored(\"onConnected(\".concat(first, \")\"));\n        }\n    };\n    TrouterManagerFsm.prototype.onRegistered = function (first) {\n        if (this.state === InternalInterfaces_1.TrouterManagerState.Disconnected && !first) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Connected);\n            this.worker.switchConnections();\n            this.worker.stopSecondConnection(true);\n            this.worker.dispatchConnected();\n        }\n        else if (this.state === InternalInterfaces_1.TrouterManagerState.Switching && !first) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Connected);\n            this.worker.switchConnections();\n            this.worker.stopSecondConnectionDelayed();\n            this.worker.dispatchConnected();\n        }\n        else if (this.state === InternalInterfaces_1.TrouterManagerState.Disconnected && first) {\n            // happens when reconnect prompts connection to the same instance which dispatches disconnect as duplicate (both on old connection)\n            // at this point `first` is the new connection\n            this.setState(InternalInterfaces_1.TrouterManagerState.Connected);\n            this.worker.dispatchConnected();\n        }\n        this.worker.dispatchRegistrationState(true);\n    };\n    TrouterManagerFsm.prototype.onUnregistered = function (first) {\n        if (first) {\n            this.worker.dispatchRegistrationState(false);\n        }\n    };\n    TrouterManagerFsm.prototype.onReconnecting = function (first) {\n        if ((this.state === InternalInterfaces_1.TrouterManagerState.Connected || this.state === InternalInterfaces_1.TrouterManagerState.Switching) && first) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Disconnected);\n            this.worker.dispatchDisconnected();\n        }\n        else {\n            this.showIgnored(\"onReconnecting(\".concat(first, \")\"));\n        }\n    };\n    TrouterManagerFsm.prototype.onReconnectionRequired = function (first, useConnectParamsFromCache, reason) {\n        if (this.state === InternalInterfaces_1.TrouterManagerState.Connected && first) {\n            this.setState(InternalInterfaces_1.TrouterManagerState.Switching);\n            this.worker.startSecondConnection(useConnectParamsFromCache);\n        }\n        else if (this.state === InternalInterfaces_1.TrouterManagerState.Disconnected && first) {\n            this.worker.startSecondConnection(useConnectParamsFromCache);\n        }\n        else if (this.state === InternalInterfaces_1.TrouterManagerState.Switching && first && reason === TrouterConnection_1.ReconnectReason.Configuration) {\n            // Intentionally ignoring `trouter.reconnect` events arriving during an in-progress switch (on either connection),\n            // only configuration change is handled. This matches the current behavior of the C++ client.\n            // Even in the ignored cases, the client should still end up being connected to the right environment eventually.\n            this.logger.debug('onReconnectionRequired: switch requested while already in Switching state');\n            this.worker.stopSecondConnection(true);\n            this.worker.startSecondConnection(useConnectParamsFromCache);\n        }\n        else {\n            this.showIgnored(\"onReconnectionRequired(\".concat(first, \")\"));\n        }\n    };\n    TrouterManagerFsm.prototype.onDisconnected = function (first) {\n        if (this.state == InternalInterfaces_1.TrouterManagerState.Unknown && first) {\n            // This is executed after an explicit stop()\n            this.worker.dispatchDisconnected();\n        }\n        else if (this.state == InternalInterfaces_1.TrouterManagerState.Switching && first) {\n            // The current/old connection got disconnected during a connection switch\n            // (the disconnect would result only in onReconnecting() at other times,\n            // when automatic reconnects are still enabled)\n            this.worker.switchConnections();\n            this.worker.stopSecondConnection(false);\n            this.setState(InternalInterfaces_1.TrouterManagerState.Disconnected);\n            this.worker.dispatchDisconnected();\n        }\n        else {\n            this.showIgnored(\"onDisconnected(\".concat(first, \")\"));\n        }\n    };\n    TrouterManagerFsm.prototype.onTerminalError = function () {\n        this.setState(InternalInterfaces_1.TrouterManagerState.TerminalError);\n        this.worker.dispatchTerminalError();\n    };\n    TrouterManagerFsm.prototype.showIgnored = function (event) {\n        this.logger.info(\"Ignoring event '\".concat(event, \"' in state '\").concat(InternalInterfaces_1.TrouterManagerState[this.state], \"'\"));\n    };\n    TrouterManagerFsm.prototype.setState = function (state) {\n        this.logger.info(\"Switching from state '\".concat(InternalInterfaces_1.TrouterManagerState[this.state], \"' to state '\").concat(InternalInterfaces_1.TrouterManagerState[state], \"'\"));\n        if (this.state === state) {\n            this.logger.error(\"Attempt to switch to the current state '\".concat(InternalInterfaces_1.TrouterManagerState[state], \"'\"));\n            return;\n        }\n        this.state = state;\n    };\n    return TrouterManagerFsm;\n}());\nexports.TrouterManagerFsm = TrouterManagerFsm;\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/**\n * Copyright (c) Microsoft. All rights reserved.\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.replaceTrouterUrlBase = exports.getTrouterServiceVersion = exports.createTrouterService = exports.TrouterService = exports.UserActivityState = exports.TrouterState = void 0;\nvar Constants_1 = __webpack_require__(1);\nvar Interfaces_1 = __webpack_require__(2);\nObject.defineProperty(exports, \"TrouterState\", { enumerable: true, get: function () { return Interfaces_1.TrouterState; } });\nObject.defineProperty(exports, \"UserActivityState\", { enumerable: true, get: function () { return Interfaces_1.UserActivityState; } });\nvar Logger_1 = __webpack_require__(0);\nvar MessageHandler_1 = __webpack_require__(8);\nvar SkypeTokenProviderWithCache_1 = __webpack_require__(9);\nvar TrouterManager_1 = __webpack_require__(10);\nvar TrouterUrlPromise_1 = __webpack_require__(11);\nfunction populateTelemetryOptions(startingCfg, ecsCfg) {\n    if (!ecsCfg) {\n        return startingCfg;\n    }\n    var res = __assign(__assign({}, startingCfg), {\n        enabled: ecsCfg.TelemetryEnabled\n    });\n    if (ecsCfg.ClientTelemetryEventEnabled !== undefined) {\n        res = __assign(__assign({}, res), ecsCfg.ClientTelemetryEventEnabled);\n    }\n    return res;\n}\nfunction populateTrouterOptions(cfg, logger, ecsCfg) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n    var rewriteUrlForProxyCallback = function (url) {\n        if (cfg.proxyUrlRewrite) {\n            logger.info('Using rewritten URL for proxy');\n            return cfg.proxyUrlRewrite(url);\n        }\n        else {\n            return url;\n        }\n    };\n    return {\n        clientInfo: {\n            ua: cfg.trouterSettings.productName,\n            v: cfg.trouterSettings.version\n        },\n        ioOptions: {\n            // uncomment for manual testing\n            // transports: ['xhr-polling'],\n            // 'connect timeout': XXX, 10000 by default in socket.io code\n            ackTimeoutMs: 5000,\n            rewriteUrlForProxy: rewriteUrlForProxyCallback\n        },\n        clientCorrelationID: cfg.trouterSettings.sessionId,\n        environment: cfg.trouterSettings.environment,\n        telemetrySettings: populateTelemetryOptions(cfg.telemetryConfig.settings, ecsCfg),\n        eventLogger: cfg.telemetryConfig.eventLogger,\n        endpointId: cfg.trouterSettings.registrationId,\n        // keeping existing behavior of || - using default value when there's empty string\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n        trouterUrl: (ecsCfg === null || ecsCfg === void 0 ? void 0 : ecsCfg.TrouterConnectionUrl) || cfg.trouterSettings.trouterServiceUrl,\n        registration: cfg.trouterSettings.registrarServiceUrl\n            ? {\n                registrarUrl: cfg.trouterSettings.registrarServiceUrl,\n                registrationId: (_a = cfg.trouterSettings.registrationId) !== null && _a !== void 0 ? _a : '',\n                pnhAppId: (_b = cfg.trouterSettings.pnhAppId) !== null && _b !== void 0 ? _b : '',\n                platform: (_c = cfg.trouterSettings.platform) !== null && _c !== void 0 ? _c : '',\n                pnhTemplateKey: (_d = cfg.trouterSettings.pnhTemplate) !== null && _d !== void 0 ? _d : '',\n                platformUIVersion: (_e = cfg.trouterSettings.platformUIVersion) !== null && _e !== void 0 ? _e : '',\n                // keeping existing behavior of || - using default value when there's empty string\n                // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n                productContext: cfg.trouterSettings.pnhProductContext || undefined,\n                context: (_f = cfg.trouterSettings.pnhContext) !== null && _f !== void 0 ? _f : '',\n                registrarTtlSec: ((_g = cfg.trouterSettings.maxRegistrationTimeInMs) !== null && _g !== void 0 ? _g : 0) / 1000\n            }\n            : undefined,\n        connectionDependsOnRegistration: cfg.trouterSettings.registrarServiceUrl === undefined ?\n            (function () { return false; }) :\n            ((_h = cfg.trouterSettings.connectionDependsOnRegistration) !== null && _h !== void 0 ? _h : (function () { return false; })),\n        delayEventsUntilRegistered: (_j = cfg.trouterSettings.delayEventsUntilRegistered) !== null && _j !== void 0 ? _j : (function () { return false; }),\n        timeoutOptions: __assign({ \n            // keeping existing behavior of || - using default value when there's 0\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n            connectionTimeoutMs: cfg.trouterSettings.trouterConnectTimeoutInMs || 30000, fetchTimeoutMs: 10000, pingTimeoutMs: 40000, pongTimeoutMs: 5000, \n            /** Followup WI to remove hardcoded value: https://domoreexp.visualstudio.com/MSTeams/_workitems/edit/2307271 */\n            maxBackoffMs: cfg.trouterSettings.productName === 'TeamsCDL' ? 300000 : 30000, requestTimeoutMs: 5000, userActivityResponseTimeoutMs: 10000 }, cfg.trouterSettings.timeoutOptions),\n        incallTimeoutOptions: __assign({ connectionTimeoutMs: 10000, fetchTimeoutMs: 5000, pingTimeoutMs: 5000, pongTimeoutMs: 2000, maxBackoffMs: cfg.trouterSettings.productName === 'TeamsCDL' ? 300000 : 10000, requestTimeoutMs: 5000, userActivityResponseTimeoutMs: 10000 }, cfg.trouterSettings.incallTimeoutOptions),\n        incallModeTimeoutMs: (_k = cfg.trouterSettings.incallModeTimeoutMs) !== null && _k !== void 0 ? _k : 0,\n        lingeringConnectionDelayMs: 60000,\n        // keeping existing behavior of || - using default value when there's 0\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n        userActivitySecondResendDelayMs: cfg.trouterSettings.userActivitySecondResendDelayMs || 10000,\n        duplicateDisconnectThresholdMs: 10000,\n        connectionCache: cfg.connectionCache,\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        registrationStateCallback: cfg.registrationStateCallbackForAcsDoNotUse,\n        rewriteUrlForProxy: rewriteUrlForProxyCallback,\n        retryLimitOnTokenFetch: cfg.trouterSettings.retryLimitOnTokenFetch,\n        extraConnectionHeaders: cfg.trouterSettings.extraConnectionHeaders,\n        expediteBackoffOnStartMinimumDelayMs: 10000,\n        // JSON.stringify() override for dumping options to log as JSON in TrouterManager\n        toJSON: function () {\n            return __assign(__assign({}, this), { \n                // If cache is set to some object of the host app, do not try to serialize it.\n                // It could contain circular references and JSON.stringify() would fully fail.\n                connectionCache: this.connectionCache ? {} : this.connectionCache });\n        }\n    };\n}\n/**\n * TrouterService implementation class\n */\nvar TrouterService = /** @class */ (function () {\n    function TrouterService(logProvider) {\n        this.logProvider = logProvider;\n        this.stateChangedListeners = [];\n        this.logger = new Logger_1.Logger('Trouter', logProvider);\n        this.trouterUrlPromise = new TrouterUrlPromise_1.TrouterUrlPromise(logProvider);\n        this.messageHandlers = new MessageHandler_1.MessageHandlerRegistry(logProvider);\n        this.listeners = {};\n        this.connectionInfo = null;\n        this.logger.info(\"Created TrouterService version \".concat(Constants_1.CLIENT_VERSION));\n    }\n    TrouterService.prototype.start = function (cfg) {\n        var _a;\n        this.logger.info('Start');\n        if (!cfg.skypeTokenProvider && !cfg.authTokenProvider) {\n            throw new Error('no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated');\n        }\n        if (cfg.skypeTokenProvider && !cfg.trouterSettings.disableInternalSkypeTokenCache) {\n            cfg.skypeTokenProvider = (0, SkypeTokenProviderWithCache_1.addCacheAsBackupTo)(cfg.skypeTokenProvider);\n        }\n        this.trouterCfg = cfg;\n        var options = populateTrouterOptions(cfg, this.logger, this.ecsCfg);\n        if (cfg.internalEnableV4cProtocol === false) {\n            options.forceV4aProtocol = true;\n        }\n        var authTokenProvider = authTokenProviderProtector(this.logger, (_a = cfg.authTokenProvider) !== null && _a !== void 0 ? _a : skypeTokenAdapter(cfg.skypeTokenProvider));\n        if (this.trouterServer === undefined) {\n            this.trouterServer = new TrouterManager_1.TrouterManager(this.logProvider, options, authTokenProvider, cfg.authTokenProvider === undefined, this);\n        }\n        if (this.pendingActivityState !== undefined) {\n            this.trouterServer.setUserActivityState(this.pendingActivityState[0], this.pendingActivityState[1]);\n            this.pendingActivityState = undefined;\n        }\n        this.trouterServer.start();\n    };\n    TrouterService.prototype.stop = function (dontUnregister) {\n        this.logger.info('close connection');\n        this.trouterUrlPromise.rejectUrl(new Error('TrouterService is stopped'));\n        if (this.trouterServer !== undefined) {\n            this.trouterServer.stop(dontUnregister);\n        }\n    };\n    TrouterService.prototype.setEcsConfig = function (fullEcsData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve) {\n                        var ecsSection = 'TrouterJScriptClient';\n                        _this.ecsCfg = (fullEcsData[ecsSection]);\n                        _this.logger.info(\"Setting ECS configuration to \".concat(JSON.stringify(_this.ecsCfg)));\n                        if (_this.trouterServer !== undefined && _this.trouterCfg !== undefined) {\n                            var options = populateTrouterOptions(_this.trouterCfg, _this.logger, _this.ecsCfg);\n                            _this.trouterServer.configure(options);\n                        }\n                        resolve();\n                    })];\n            });\n        });\n    };\n    /**\n     * Notifies trouter that network is restored - trouter will try to restore connection immediately\n     */\n    TrouterService.prototype.checkConnection = function (disconnectDetected) {\n        if (this.trouterServer !== undefined) {\n            this.trouterServer.checkConnection(disconnectDetected !== null && disconnectDetected !== void 0 ? disconnectDetected : false);\n        }\n    };\n    TrouterService.prototype.resendRegistration = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.trouterServer) {\n                    throw new Error('resendRegistration called too early');\n                }\n                return [2 /*return*/, this.trouterServer.resendRegistration()];\n            });\n        });\n    };\n    // Listeners\n    TrouterService.prototype.registerListener = function (listener, path) {\n        if (path === '' || !path.startsWith('/') || path.includes('?') || path.includes('#')) {\n            this.logger.error(\"Listener path '\".concat(path, \"' is not valid\"));\n            return false;\n        }\n        if (this.listeners[path]) {\n            this.logger.error(\"Another listener is already registered for path '\".concat(path, \"'\"));\n            return false;\n        }\n        this.listeners[path] = listener;\n        this.logger.debug(\"Listener for path '\".concat(path, \"' registered\"));\n        if (this.connectionInfo) {\n            listener.onTrouterConnected(this.connectionInfo.baseEndpointUrl + path, this.connectionInfo);\n        }\n        return true;\n    };\n    TrouterService.prototype.unregisterListener = function (listener) {\n        var paths = [];\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            if (this.listeners[path] === listener) {\n                paths.push(path);\n            }\n        }\n        if (paths.length === 0) {\n            return false;\n        }\n        for (var _b = 0, paths_1 = paths; _b < paths_1.length; _b++) {\n            var path = paths_1[_b];\n            delete this.listeners[path];\n        }\n        this.logger.debug(\"Listener for path(s) '\".concat(paths.join('\\', \\''), \"' unregistered\"));\n        return true;\n    };\n    TrouterService.prototype.onTrouterConnected = function (endpointUrl, connectionInfo) {\n        this.logger.debug('Trouter is now connected');\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            try {\n                this.listeners[path].onTrouterConnected(connectionInfo.baseEndpointUrl + path, connectionInfo);\n            }\n            catch (e) {\n                this.logger.error(\"Listener '\".concat(path, \"' threw an exception from onTrouterConnected(): \").concat(e));\n            }\n        }\n        this.connectionInfo = connectionInfo;\n        this.trouterUrlPromise.resolveUrl(endpointUrl);\n        this.notifyStateChanged(Interfaces_1.TrouterState.Connected, {\n            url: endpointUrl,\n            getRemainingTtlInSec: function () { return connectionInfo.connectionTtlSec; }\n        });\n    };\n    TrouterService.prototype.onTrouterDisconnected = function () {\n        this.logger.debug('Trouter is now disconnected');\n        this.connectionInfo = null;\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            var listener = this.listeners[path];\n            if (listener.onTrouterDisconnected) {\n                try {\n                    listener.onTrouterDisconnected();\n                }\n                catch (e) {\n                    this.logger.error(\"Listener '\".concat(path, \"' threw an exception from onTrouterDisconnected(): \").concat(e));\n                }\n            }\n        }\n        this.notifyStateChanged(Interfaces_1.TrouterState.Disconnected);\n    };\n    TrouterService.prototype.onTrouterRequest = function (request, response) {\n        var bestPath = '';\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            if (request.path.startsWith(path) && path.length > bestPath.length) {\n                bestPath = path;\n            }\n        }\n        if (bestPath !== '') {\n            try {\n                this.listeners[bestPath].onTrouterRequest(request, response);\n            }\n            catch (e) {\n                this.logger.error(\"Listener '\".concat(bestPath, \"' threw an exception from onTrouterRequest(): \").concat(e));\n                response.status = 500;\n                response.headers = { 'Trouter-Responder': 'ClientLib' };\n                response.send();\n            }\n            return;\n        }\n        if (this.tryMessageHandlers(request, response)) {\n            return;\n        }\n        response.status = 404;\n        response.headers = { 'Trouter-Responder': 'ClientLib' };\n        response.send();\n    };\n    TrouterService.prototype.onTrouterMessageLoss = function (flowTags) {\n        this.logger.info(\"onTrouterMessageLoss called with tags [\".concat(flowTags, \"]\"));\n        var messageLossProcessed = true;\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            var listener = this.listeners[path];\n            if (listener.onTrouterMessageLoss) {\n                try {\n                    messageLossProcessed = listener.onTrouterMessageLoss(flowTags) && messageLossProcessed;\n                    if (messageLossProcessed === undefined) {\n                        this.logger.error(\"Listener '\".concat(path, \"' did not return a boolean value from onTrouterMessageLoss()\"));\n                        messageLossProcessed = false;\n                    }\n                }\n                catch (e) {\n                    this.logger.error(\"Listener '\".concat(path, \"' threw an exception from onTrouterMessageLoss(): \").concat(e));\n                    messageLossProcessed = false;\n                }\n            }\n        }\n        return messageLossProcessed;\n    };\n    TrouterService.prototype.onTrouterUserActivityStateAccepted = function (cv) {\n        this.logger.debug(\"onTrouterUserActivityStateAccepted cv: \".concat(cv));\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            var listener = this.listeners[path];\n            if (listener.onTrouterUserActivityStateAccepted) {\n                try {\n                    listener.onTrouterUserActivityStateAccepted(cv);\n                }\n                catch (e) {\n                    this.logger.error(\"Listener '\".concat(path, \"' threw an exception from onTrouterUserActivityStateAccepted(): \").concat(e));\n                }\n            }\n        }\n    };\n    TrouterService.prototype.onAudiencesSetResolved = function (audienceSubscriptionsResponse, cv) {\n        this.logger.debug(\"onAudiencesSetResolved cv: \".concat(cv));\n        for (var _i = 0, _a = Object.keys(this.listeners); _i < _a.length; _i++) {\n            var path = _a[_i];\n            var listener = this.listeners[path];\n            if (listener.onAudiencesSetResolved) {\n                try {\n                    listener.onAudiencesSetResolved(audienceSubscriptionsResponse, cv);\n                }\n                catch (e) {\n                    this.logger.error(\"Listener '\".concat(path, \"' threw an exception from onAudienceSubscribed(): \").concat(e));\n                }\n            }\n        }\n    };\n    TrouterService.prototype.setUserActivityState = function (state, correlationVector) {\n        if (state !== Interfaces_1.UserActivityState.Active && state !== Interfaces_1.UserActivityState.Inactive) {\n            throw new Error(\"setUserActivityState called with unsupported value \".concat(state));\n        }\n        this.logger.info(\"setUserActivityState called with value \".concat(Interfaces_1.UserActivityState[state]));\n        if (this.trouterServer && this.state() !== Interfaces_1.TrouterState.Unknown) {\n            this.trouterServer.setUserActivityState(state, correlationVector);\n        }\n        else {\n            this.pendingActivityState = [state, correlationVector];\n            this.logger.warn('setUserActivityState called before start() or after stop()');\n        }\n    };\n    TrouterService.prototype.setAudienceSubscriptions = function (audienceSubscriptionModel, correlationVector) {\n        if (audienceSubscriptionModel.audienceSubscriptions.length > 1) {\n            throw new Error(\"Only singular audience subscription is supported\");\n        }\n        if (this.trouterServer && this.state() !== Interfaces_1.TrouterState.Unknown) {\n            return this.trouterServer.setAudienceSubscriptionsAsync(audienceSubscriptionModel, 15000, correlationVector);\n        }\n        throw new Error('audience subscribe called before start() or after stop()');\n    };\n    // Legacy API\n    TrouterService.prototype.state = function () {\n        if (this.trouterServer !== undefined) {\n            return this.trouterServer.getState();\n        }\n        return Interfaces_1.TrouterState.Unknown;\n    };\n    TrouterService.prototype.isInTerminalState = function () {\n        if (this.trouterServer !== undefined) {\n            return this.trouterServer.isInTerminalState();\n        }\n        return false;\n    };\n    TrouterService.prototype.reportStateInfo = function () {\n        if (this.trouterServer === undefined) {\n            return \"\";\n        }\n        return this.trouterServer.reportStateInfo();\n    };\n    TrouterService.prototype.getServerState = function () {\n        if (this.trouterServer !== undefined) {\n            return this.trouterServer.getServerState();\n        }\n        return undefined;\n    };\n    TrouterService.prototype.getTrouterUrlAsync = function () {\n        if (this.trouterServer !== undefined) {\n            return this.trouterUrlPromise.getPromise();\n        }\n        else {\n            return Promise.reject(new Error('TrouterService has not been started'));\n        }\n    };\n    TrouterService.prototype.onStateChanged = function (callback) {\n        this.logger.info('onStateChanged called');\n        if (callback === undefined) {\n            this.stateChangedListeners = this.stateChangedListeners.filter(function (listener) { return (listener.wrappedCallback === undefined); });\n        }\n        else {\n            this.offStateChanged(callback);\n            var wrapper = function (state, info) {\n                callback(state, info ? info.url : '');\n            };\n            wrapper.wrappedCallback = callback;\n            this.stateChangedListeners.push(wrapper);\n        }\n    };\n    TrouterService.prototype.offStateChanged = function (callback) {\n        this.logger.info('offStateChanged called');\n        var sizeBeforeRemoval = this.stateChangedListeners.length;\n        this.stateChangedListeners = this.stateChangedListeners.filter(function (listener) { return (listener.wrappedCallback !== callback); });\n        return (sizeBeforeRemoval > this.stateChangedListeners.length);\n    };\n    TrouterService.prototype.addCallback = function (callback) {\n        this.logger.info('addListener called');\n        var index = this.stateChangedListeners.indexOf(callback, 0);\n        if (index === -1 && callback !== undefined) {\n            this.stateChangedListeners.push(callback);\n        }\n    };\n    TrouterService.prototype.removeCallback = function (callback) {\n        this.logger.info('removeListener called');\n        var index = this.stateChangedListeners.indexOf(callback, 0);\n        if (index > -1) {\n            this.stateChangedListeners.splice(index, 1);\n            return true;\n        }\n        return false;\n    };\n    TrouterService.prototype.registerMessageHandler = function (handler) {\n        this.logger.info('registerMessageHandler is called');\n        this.messageHandlers.register(handler);\n    };\n    TrouterService.prototype.clearMessageHandlers = function () {\n        this.logger.info('clearMessageHandlers is called');\n        this.messageHandlers.clear();\n    };\n    TrouterService.prototype.notifyStateChanged = function (state, info) {\n        var _this = this;\n        this.logger.info(\"notifyStateChanged called, will forward to \".concat(this.stateChangedListeners.length, \" listeners\"));\n        this.stateChangedListeners.forEach(function (callback) {\n            try {\n                callback(state, info);\n            }\n            catch (error) {\n                _this.logger.error(\"Error in callback \".concat(error));\n            }\n        });\n    };\n    TrouterService.prototype.tryMessageHandlers = function (request, response) {\n        if (!this.messageHandlers.active()) {\n            return false;\n        }\n        var body;\n        var eventId = null;\n        try {\n            body = JSON.parse(request.body);\n            eventId = (body && (body.evt || body.eventId)) || null;\n            // eslint-disable-next-line no-empty\n        }\n        catch (e) { }\n        var message = {\n            eventId: eventId,\n            url: (this.connectionInfo ? this.connectionInfo.baseEndpointUrl : '') + request.path,\n            body: body,\n            rawBody: request.body,\n            headers: request.headers\n        };\n        var result = this.messageHandlers.handleMessage(message);\n        if (!result.isHandled) {\n            return false;\n        }\n        response.status = result.resultCode;\n        if (result.responseHeaders) {\n            response.headers = result.responseHeaders;\n        }\n        if (result.responseBody) {\n            response.body = result.responseBody;\n        }\n        response.send();\n        return true;\n    };\n    return TrouterService;\n}());\nexports.TrouterService = TrouterService;\nfunction createTrouterService(logger) {\n    return new TrouterService(logger);\n}\nexports.createTrouterService = createTrouterService;\nfunction getTrouterServiceVersion() {\n    return Constants_1.CLIENT_VERSION;\n}\nexports.getTrouterServiceVersion = getTrouterServiceVersion;\nfunction replaceTrouterUrlBase(existingUrl, newBase) {\n    var schemaSepPos = existingUrl.indexOf('://');\n    if (schemaSepPos >= 0) {\n        var pathSepPos = existingUrl.indexOf('/', schemaSepPos + 3);\n        if (pathSepPos >= 0) {\n            return newBase + existingUrl.substr(pathSepPos);\n        }\n    }\n    return '';\n}\nexports.replaceTrouterUrlBase = replaceTrouterUrlBase;\nfunction skypeTokenAdapter(provider) {\n    var _this = this;\n    return function (req) { return __awaiter(_this, void 0, void 0, function () {\n        var _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    _a = {};\n                    return [4 /*yield*/, provider(req.needFresh)];\n                case 1: return [2 /*return*/, (_a.token = _b.sent(), _a.tokenType = 'skype', _a)];\n            }\n        });\n    }); };\n}\nfunction authTokenProviderProtector(logger, provider) {\n    var _this = this;\n    var previousToken;\n    return function (req) { return __awaiter(_this, void 0, void 0, function () {\n        var requestTime, timerId, rsp;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    requestTime = new Date();\n                    timerId = setInterval(function () {\n                        var delay = Math.round((Date.now() - requestTime.getTime()) / 60000);\n                        logger.warn(\"Note: Trouter auth token request promise from \".concat(requestTime.toISOString(), \" has not been resolved for \").concat(delay, \" minutes. The client is blocked from operating properly\"));\n                    }, 5 * 60000);\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, , 3, 4]);\n                    return [4 /*yield*/, provider(req)];\n                case 2:\n                    rsp = _a.sent();\n                    if (req.needFresh && rsp.token === previousToken) {\n                        logger.error('API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app');\n                    }\n                    previousToken = rsp.token;\n                    return [2 /*return*/, rsp];\n                case 3:\n                    clearInterval(timerId);\n                    return [7 /*endfinally*/];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); };\n}\n\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_21__;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// tstrouter.js","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { LogProvider } from './Interfaces';\r\n\r\n/**\r\n * Logging function\r\n */\r\nexport type LogFunc = (msg: string) => void;\r\n\r\n/**\r\n * Simple logger\r\n */\r\nexport class Logger {\r\n    public constructor(private name: string, private logger: LogProvider) { }\r\n\r\n    public debug(message: string) {\r\n        this.logger.debug(`[${this.name}] ${message}`);\r\n    }\r\n    public info(message: string) {\r\n        this.logger.info(`[${this.name}] ${message}`);\r\n    }\r\n    public warn(message: string) {\r\n        this.logger.warn(`[${this.name}] ${message}`);\r\n    }\r\n    public error(message: string) {\r\n        this.logger.error(`[${this.name}] ${message}`);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/Logger.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nexport const constants = {\r\n    TROUTER_INIT: 'trouterinit',\r\n    TROUTER_READY_EVENT: 'trouterReadyEvent',\r\n    TROUTER_READY_TIMEOUT: 'trouterReadyTimeout',\r\n    TROUTER_TOKEN_REQUEST: 'trouterTokenRequest',\r\n    TROUTER_TOKEN_GET_SUCCEEDED: 'trouterTokenGetSucceeded',\r\n    TROUTER_TOKEN_GET_FAILED: 'trouterTokenGetFailed',\r\n    TROUTER_RECONNECTING: 'trouterReconnecting',\r\n    RENEWAL: 'renewal',\r\n    NEW_CONNECTION: 'newConnection',\r\n    ENDPOINT_REGISTRATION_FAILED: 'endpointRegistrationFailed'\r\n};\r\n\r\nexport const CLIENT_VERSION: string = '2024.14.01.55';\r\nexport const HANDLED_MESSAGE_ACK = 200;\r\nexport const UNHANDLED_MESSAGE_ACK = 404;\r\nexport const FAILED_MESSAGE_ACK = 500;\r\nexport const SUPPORTED_TOKEN_TYPES = <const>['skype', 'aad', 'cae'];\r\nexport const USER_AUTHENTICATE_EVENT_NAME = 'user.authenticate';\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/Constants.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n * Type definitions for Trouter JavaScript Client 2024.14.01.55\r\n */\r\n\r\n/**\r\n * Trouter HTTP-like headers\r\n */\r\nexport type Headers = {\r\n    [name: string]: string;\r\n};\r\n\r\n/**\r\n * Trouter HTTP-like request (service -> Trouter -> app)\r\n *\r\n * Represents one incoming request received by Trouter Client. Its content is\r\n * mostly a verbatim copy of what was sent by the originating service to\r\n * Trouter Service.\r\n */\r\nexport interface Request {\r\n    readonly id: number;        /// Request/response ID, useful for\r\n                                /// logging/debugging/tracing purposes\r\n    readonly method: string;    /// HTTP method (GET, POST, ...)\r\n    readonly path: string;      /// HTTP path, including listener's prefix and\r\n                                /// any provided query parameters\r\n    readonly headers: Headers;  /// HTTP headers\r\n    readonly body: string;      /// HTTP body/content\r\n}\r\n\r\n/**\r\n * Possible return values of Response.send()\r\n */\r\nexport const enum SendResponseResult {\r\n    OK           = 0,  /// Response accepted, will be sent back to the service\r\n    Timeout      = 1,  /// Too late, 504 (Timeout) has been already sent back\r\n    Duplicate    = 2,  /// send() was called multiple times on one Response\r\n    Incomplete   = 3,  /// Mandatory parameters (status code) are not set\r\n    Disconnected = 4   /// Trouter connection dropped, cannot reply now\r\n}\r\n\r\n/**\r\n * Trouter HTTP-like response (app -> Trouter -> service)\r\n *\r\n * Represents one outgoing response to be sent by Trouter Client. Always set\r\n * the status code, add any extra headers or body, then call `send()`.\r\n */\r\nexport interface Response {\r\n    readonly id: number;  /// Request/response ID, useful for\r\n    /// logging/debugging/tracing purposes\r\n    status: number;       /// HTTP status code (200, 404, ...), mandatory\r\n    headers: Headers;     /// HTTP headers, optional\r\n    body: string;         /// HTTP body/content, optional\r\n\r\n    /**\r\n     * Send the response\r\n     *\r\n     * Trouter will add just a few of its own headers and otherwise forward the\r\n     * response to the originating service that had sent the request.\r\n     *\r\n     * A successful return value `OK` means only that the response message has\r\n     * been accepted and prepared for sending back. The actual transmission will\r\n     * happen asynchronously later and might still fail for various reasons.\r\n     *\r\n     * @return SendResponseResult.OK if successful, other code if not\r\n     */\r\n    send(): SendResponseResult;\r\n}\r\n\r\n/**\r\n * Information about the current Trouter connection\r\n *\r\n * Received in `Listener.onTrouterConnected()` every time the connection\r\n * parameters change.\r\n */\r\nexport interface ConnectionInfo {\r\n    readonly baseEndpointUrl: string;   /// Base URL used for routing messages\r\n                                        /// from services to this client\r\n                                        /// instance, i.e. not specific to\r\n                                        /// a particular listener\r\n    readonly newEndpointUrl: boolean;   /// Tells if this `baseEndpointUrl` is\r\n                                        /// different from the previous one and\r\n                                        /// therefore if any dependent service\r\n                                        /// registrations need to be updated to\r\n                                        /// know where to send data\r\n    readonly c2cUrlBase: string;        /// Base URL prefix used for routing\r\n                                        /// messages from clients to this client\r\n                                        /// - replace the URL base (protocol +\r\n                                        /// hostname) of `baseEndpointUrl` (or\r\n                                        /// another per-listener endpoint URL)\r\n                                        /// with this value to obtain the full\r\n                                        /// client-to-client URL\r\n    readonly clientId: string;          /// ID of this Trouter client, should\r\n                                        /// stay the same between reconnects\r\n    readonly connectionId: string;      /// ID of the current Trouter\r\n                                        /// connection, can change between\r\n                                        /// reconnects\r\n    readonly connectionTtlSec: number;  /// Expected lifetime of the current\r\n                                        /// connection (ID) in seconds, as\r\n                                        /// determined by Trouter Service\r\n}\r\n\r\n/**\r\n * Trouter listener\r\n *\r\n * Interface implemented by application to receive Trouter callbacks\r\n */\r\nexport interface Listener {\r\n    /**\r\n     * Called when Trouter connection is (re-)established\r\n     *\r\n     * This is important mostly because of the `endpointUrl` as the URL where\r\n     * messages are sent to by the originating service(s). Only after receiving\r\n     * this callback and learning the Endpoint URL can the application register\r\n     * the established channel for receiving messages.\r\n     *\r\n     * The Endpoint URL is intended for service-to-service communication, only\r\n     * whitelisted authenticated services can access it and initiate Trouter\r\n     * requests. Use `c2cUrlBase` from `connectionInfo` to obtain a similar URL\r\n     * for client-to-client communication - see also `replaceTrouterUrlBase()`.\r\n     *\r\n     * @param endpointUrl    A URL used for routing messages from services to\r\n     *                       this listener\r\n     * @param connectionInfo Additional Trouter connection information\r\n     */\r\n    onTrouterConnected(endpointUrl: string, connectionInfo: ConnectionInfo): void;\r\n\r\n    /**\r\n     * Called when Trouter connection drops\r\n     *\r\n     * No incoming requests can be received for now, no outgoing responses can\r\n     * be sent either. Trouter client will reconnect as soon as possible.\r\n     *\r\n     * This state is most commonly caused by some temporary network issues\r\n     * (switching from Wi-Fi to a wired network, bad signal etc.) or things\r\n     * like a sleep/resume transition on the device.\r\n     *\r\n     * @note This method does not need to be implemented.\r\n     */\r\n    onTrouterDisconnected?(): void;\r\n\r\n    /**\r\n     * Called when Trouter receives a request intended for this listener\r\n     *\r\n     * Application can inspect the contents of the incoming message by looking\r\n     * at `request`, then fill in the outgoing `reponse` and send it back by\r\n     * invoking its method `send()`.\r\n     *\r\n     * This can be done both synchronously when this method is called, or at a\r\n     * later time asynchronously from any other context, if the application\r\n     * stores the `response` object aside.\r\n     *\r\n     * In any case, a response ought to be sent to every received request. If\r\n     * it is not, Trouter client will send a 504 (Timeout) message itself after\r\n     * a configured time, but that will needlessly show up as an error on the\r\n     * service side, even if you have processed the message successfully.\r\n     *\r\n     * For most simple applications, just sending a response with 200 (OK) right\r\n     * away should be good enough.\r\n     *\r\n     * @param request  Incoming request object (read-only)\r\n     * @param response Outgoing response object (to be filled in and sent)\r\n     */\r\n    onTrouterRequest(request: Request, response: Response): void;\r\n\r\n    /**\r\n     * Called when some messages have been dropped on Trouter\r\n     *\r\n     * This can be called at any time by Trouter server\r\n     *\r\n     * Some of the examples of the message loss:\r\n     * The message loss might occur when client queues got full and messages are rejected\r\n     * The message to be delivered are already expired.\r\n     *\r\n     * @param flowTags String array of flows representing the type of messages being lost\r\n     *\r\n     * returns true in case that the flow tags has been processed and the information can be dropped\r\n     */\r\n    onTrouterMessageLoss?(flowTags: string[]): boolean;\r\n\r\n    /**\r\n     * Called when the user activity state has been delivered and accepted by the service\r\n     * The value of correlation vector will be extended,\r\n     * and so only the prefix passed in should be compared, if necessary.\r\n     *\r\n     * @param cv Correlation vector of user activity state update.\r\n     */\r\n    onTrouterUserActivityStateAccepted?(cv: string): void;\r\n\r\n    /**\r\n     * Called on automatic re-subscription of audiences after trouter connection failed and reconnected.\r\n     * \r\n     * @param audienceSubscriptionsResponse Server response containing result for individual audience subscription attempts.\r\n     * @param cv Correlation vector of the audience subscription operation.\r\n     */\r\n    onAudiencesSetResolved?(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void;\r\n}\r\n\r\n/**\r\n * States that a user can reach\r\n *\r\n * Use with the `setUserActivityState()` method.\r\n */\r\nexport enum UserActivityState {\r\n    Unknown  = 0,  /// Initial state\r\n    Active   = 1,  /// User is active according to the application\r\n    Inactive = 2   /// User is not active according to the application\r\n}\r\n\r\n/**\r\n * Trouter client\r\n *\r\n * Use to register and unregister your listeners. Calls are forwarded to the\r\n * underlying implementation, whatever that is on the current platform.\r\n */\r\nexport interface Client {\r\n    /**\r\n     * Register a listener\r\n     *\r\n     * The specified listener will now be notified about any Trouter events. An\r\n     * initial `onTrouterConnected()` callback will be received automatically\r\n     * right away if Trouter is already connected, so that the listener can\r\n     * learn the Endpoint URL etc.\r\n     *\r\n     * There can be only one listener registered for each `path`, but the path\r\n     * can naturally comprise of multiple levels separated with a slash. The\r\n     * listener with the longest, most specific matching path prefix for an\r\n     * incoming message will be invoked to handle it.\r\n     *\r\n     * If a matching listener is found, the incoming message is not passed\r\n     * further to any registered legacy MessageHandler callbacks.\r\n     *\r\n     * This method is very light-weight and can be called at any time.\r\n     *\r\n     * @param listener Listener object to register\r\n     * @param path     HTTP-like relative path to register (e.g. '/foo')\r\n     * @return `true` if successfully registered,\r\n     *         `false` if there already is a registered listener for this exact\r\n     *         path or if the given path is invalid\r\n     */\r\n    registerListener(listener: Listener, path: string): boolean;\r\n\r\n    /**\r\n     * Unregister a listener\r\n     *\r\n     * The specified listener will not be notified about any Trouter events\r\n     * anymore. `onTrouterDisconnected()` will not be called automatically\r\n     * during unregistration.\r\n     *\r\n     * All registrations of this `Listener` object (i.e. possibly more than one,\r\n     * registered with different paths) will be unregistered.\r\n     *\r\n     * This method is very light-weight and can be called at any time.\r\n     *\r\n     * @param listener Listener object to unregister\r\n     * @return `true` if successfully unregistered,\r\n     *         `false` if not registered in the first place\r\n     */\r\n    unregisterListener(listener: Listener): boolean;\r\n\r\n    /**\r\n     * Set user activity state\r\n     *\r\n     * Sets the state of the user activity that is then sent to trouter if it\r\n     * is different from the previous state (including Unknown), or upon\r\n     * reconnect, or under other circumstances fully in the discretion of the\r\n     * client. Can throw an instance of Error if that's not possible.\r\n     *\r\n     * @param state The new state of user activity\r\n     * @param correlationVector Correlation vector for end to end tracking\r\n     */\r\n    setUserActivityState(state: UserActivityState, correlationVector?: string): void;\r\n\r\n    /**\r\n     * Sets new state of the audience subscriptions for given connection\r\n     * \r\n     * When called the input value is understood as a definitive new state of \r\n     * connections audience subscriptions. That means user will be only subscribed to audiences\r\n     * currently presented. Any previously subscribed audience that is not present in \r\n     * the new state will be no longer considered as valid and user will be usubscribed\r\n     * from it.\r\n     * \r\n     * @param audienceSubscriptionModel New state of user audience subscriptions\r\n     * @param correlationVector Correlation vector for end to end tracking\r\n     */\r\n    setAudienceSubscriptions(audienceSubscriptionModel: IAudienceSubscriptionModel, correlationVector?: string): Promise<IAudienceSubscriptionsResponse>\r\n}\r\n\r\nexport type LogProvider = {\r\n    log(...message: string[]): void;\r\n    warn(...message: string[]): void;\r\n    error(...message: string[]): void;\r\n    debug(...message: string[]): void;\r\n    info(...message: string[]): void;\r\n};\r\n\r\n/** Headers for HTTP request */\r\nexport interface HttpHeaders {\r\n    [name: string]: string;\r\n}\r\n\r\nexport type TrouterMessage = {\r\n    eventId: number | null;\r\n    url?: string;\r\n    headers?: HttpHeaders;\r\n    body?: TrouterRequestBody;\r\n    rawBody?: string;\r\n};\r\n\r\nexport type TrouterRequestBody = {\r\n    evt?: number;\r\n    eventId?: number;\r\n    gp?: string;\r\n    nsp?: string;\r\n};\r\n\r\n\r\nexport interface MessageHandler {\r\n    handleMessage(message: TrouterMessage): HandleMessageResult | undefined;\r\n}\r\n\r\nexport interface HandleMessageResult {\r\n    /**\r\n     * @deprecated, return 'undefined' from MessageHandler.handleMessage\r\n     * if you want to indicate the message was not handled\r\n     */\r\n    isHandled?: boolean;\r\n\r\n    resultCode: number;\r\n    responseBody?: string;\r\n    responseHeaders?: HttpHeaders;\r\n}\r\n\r\nexport enum TrouterState {\r\n    /** Initial state */\r\n    Unknown = 0,\r\n\r\n    /** ready to work */\r\n    Connected = 2,\r\n\r\n    /** \r\n     * waiting for 'connected' event\r\n     * Might also be in Terminal State. Users should call `isInTerminalState` to check.\r\n     * For legacy reasons, we cannot change the TrouterState enum any longer.\r\n     */\r\n    Disconnected = 3,\r\n\r\n    /** waiting for 'register' from second connection */\r\n    Switching = 9,\r\n}\r\n\r\nexport interface TelemetryEvent {\r\n    name: string;\r\n    properties: {\r\n        [name: string]: {\r\n            value: string | number | boolean | undefined;\r\n        }\r\n    };\r\n}\r\n\r\nexport interface ITelemetrySender {\r\n    logEvent(clientEvent: TelemetryEvent): void;\r\n}\r\n\r\n/**\r\n * Called once token is required.\r\n * Trouter can cache token - it's defined by config option in TrouterSettings\r\n */\r\nexport type SkypeTokenProvider = (forceRefresh: boolean) => Promise<string>;\r\n\r\nexport type TokenType = 'skype' | 'cae' | 'aad';\r\nexport type TokenRequest = {\r\n    /**\r\n     * Value of the WWW-Authenticate header, passed if this TokenRequest\r\n     * is made immediately after an authentication failure that contained the WWW-Authenticate header\r\n     */\r\n    wwwAuthenticateHeader?: string\r\n\r\n    /** Token types that the client library knows how to use */\r\n    supportedTokenTypes: ReadonlyArray<TokenType>\r\n\r\n    /**\r\n     * A hint signaling that there was a recent authentication failure with the last known token,\r\n     * meaning that a cached token should probably not be returned here\r\n     */\r\n    needFresh: boolean\r\n\r\n    /** Information about which service the requested token is going to be sent to */\r\n    purpose?: 'trouter'|'registrar'\r\n};\r\n\r\nexport type TokenResult = {\r\n    token: string\r\n    tokenType: TokenType\r\n};\r\n\r\nexport type AuthTokenProvider = (request: TokenRequest) => Promise<TokenResult>;\r\n\r\n/**\r\n * Stores timeout values to simplify switch between in-call and normal modes\r\n */\r\nexport interface TimeoutOptions {\r\n    /** Timeout for connection to trouter service, i.e. for whole allocation + socket.io connection (all transports together) */\r\n    connectionTimeoutMs: number;\r\n\r\n    /** Timeout for fetch requests, i.e. for allocation, health, registration, unregistration */\r\n    fetchTimeoutMs: number;\r\n\r\n    /** Interval between ping requests */\r\n    pingTimeoutMs: number;\r\n\r\n    /** Timeout for waiting for pong response (websockets) */\r\n    pongTimeoutMs: number;\r\n\r\n    /** Maximal value for backoff timeout */\r\n    maxBackoffMs: number;\r\n\r\n    /** Timeout for handling of an incoming request before a 504 response is sent back automatically */\r\n    requestTimeoutMs: number;\r\n\r\n    /** For how long to wait for response to activity update event. */\r\n    userActivityResponseTimeoutMs?: number;\r\n}\r\n\r\nexport interface TrouterSettings {\r\n    /**\r\n     * GO allocation url of trouter for V4 - like https://go.trouter.teams.microsoft.com/v4/a\r\n     */\r\n    trouterServiceUrl: string;\r\n    version: string;\r\n    productName: string;\r\n    /**\r\n     * aka Client Correlation ID - for correlation between Trouter and other components. It makes sense to persist it if possible\r\n     */\r\n    sessionId: string;\r\n    /**\r\n     * Environment for telemetry, e.g. \"latest\", \"liveint\", \"dogfood\", \"prod\"\r\n     */\r\n    environment: string;\r\n\r\n    /**\r\n     * full URL of EDF registrar service (like https://prod.registrar.skype.com/v2/registrations), if left undefined then Trouter does not\r\n     * register its connection and other registration params can be left undefined as well\r\n     */\r\n    registrarServiceUrl?: string;\r\n    /** mandatory parameter if registration is required */\r\n    registrationId?: string;\r\n    /**\r\n     * @deprecated and will be removed in next versions. Use maxRegistrationTimeInMs instead\r\n     */\r\n    registrarRefreshTimeoutInMs?: number;\r\n    /** mandatory parameter if registration is required */\r\n    pnhAppId?: string;\r\n    /** mandatory parameter if registration is required */\r\n    pnhTemplate?: string;\r\n    /** optional product context to set with the registration */\r\n    pnhProductContext?: string;\r\n    /** optional context to set with the Trouter transport registration */\r\n    pnhContext?: string;\r\n    /** mandatory parameter if registration is required */\r\n    platform?: string;\r\n    /** mandatory parameter if registration is required */\r\n    platformUIVersion?: string;\r\n    /**\r\n     * @deprecated and will be removed in next versions. Use maxRegistrationTimeInMs instead\r\n     */\r\n    registrarTtlInSeconds?: number;\r\n    /** optional, if set - limits registration TTL in EDF. If not - value from Trouter server is used */\r\n    maxRegistrationTimeInMs?: number;\r\n\r\n    /** Timeouts for normal mode */\r\n    timeoutOptions?: TimeoutOptions;\r\n    /**\r\n     * For historical reasons it exists here and in 'timeoutOptions', but if 'timeoutOptions' is\r\n     * specified - this value will be ignored\r\n     */\r\n    trouterConnectTimeoutInMs?: number;\r\n\r\n    /** Timeout for being in 'in-call' mode, i.e. with aggressive ping/retry policy. If it's zero/undefined - in-call mode is disabled */\r\n    incallModeTimeoutMs?: number;\r\n    /** Timeouts for in-call mode, i.e. with more aggressive timeouts/reconnect policy */\r\n    incallTimeoutOptions?: TimeoutOptions;\r\n\r\n    /** Flag to disable internal token cache and always call provided SkypeTokenProvider */\r\n    disableInternalSkypeTokenCache?: boolean;\r\n\r\n    /** After how long to send the user activity second time after reconnect. */\r\n    userActivitySecondResendDelayMs?: number;\r\n\r\n    retryLimitOnTokenFetch?: number;\r\n\r\n    /**\r\n     * Additional headers to send with Trouter connection requests and Registrar registration requests,\r\n     * originally meant for SEAL telemetry purposes.\r\n     */\r\n    extraConnectionHeaders?: HttpHeaders;\r\n\r\n    /**\r\n     * Will be called to determine whether Trouter shouldn't be report itself as connected\r\n     * (onTrouterConnected in listeners, onStateChanged)\r\n     * until the connection has been successfully registered,\r\n     * and will disconnect if an existing registration expires or gets revoked.\r\n     */\r\n    connectionDependsOnRegistration?: () => boolean;\r\n\r\n    /**\r\n     * Will be called to determine whether Trouter should hold back events (onTrouterRequest, onTrouterMessageLoss),\r\n     * until it's connected and registered. Meant to be used with connectionDependsOnRegistration.\r\n     */\r\n    delayEventsUntilRegistered?: () => boolean;\r\n}\r\n\r\nexport interface TrouterTelemetrySettings {\r\n    enabled: boolean;\r\n\r\n    trouter_js_client_connected?: boolean;\r\n    trouter_js_client_disconnected?: boolean;\r\n    trouter_js_client_error?: boolean;\r\n    trouter_js_client_progress?: boolean;\r\n    trouter_js_client_response?: boolean;\r\n    trouter_js_client_request?: boolean;\r\n    trouter_js_client_registration?: boolean;\r\n    trouter_js_client_unregistration?: boolean;\r\n    trouter_js_client_check_connection?: boolean;\r\n\r\n    /** Send trouter_js_client_progress once this number of steps is accumulated */\r\n    numberOfStepsToMaintain?: number;\r\n    /** Send trouter_js_client_progress with current steps after a given timeout */\r\n    sendProgressTimeoutSecs?: number;\r\n\r\n    /**\r\n     * true if health requests should be sent in telemetry events\r\n     */\r\n    logHealthCheckError?: boolean;\r\n    /**\r\n     * True if ping errors should be sent in telemetry events\r\n     */\r\n    logSendPingError?: boolean;\r\n    /**\r\n     * @deprecated and will be removed in next versions\r\n     */\r\n    maxBackoffInMs?: number;\r\n}\r\n\r\nexport interface TrouterTelemetryConfig {\r\n    eventLogger: ITelemetrySender;\r\n    settings: TrouterTelemetrySettings;\r\n}\r\n\r\n/**\r\n * Connection parameters cache\r\n *\r\n * Implement to allow saving connection parameters across sessions (e.g. in\r\n * window.localStorage) and thus retaining the same Trouter URL longer.\r\n */\r\nexport interface IConnectionCache {\r\n    /** Called when the library is asking the host app for any cached connection data */\r\n    onGetTrouterConnectionCache(): Promise<string | undefined>;\r\n    /** Called when the library has updated data to be externally cached */\r\n    onSetTrouterConnectionCache(content: string): void;\r\n}\r\n\r\n/**\r\n * The main configuration of a Trouter client.\r\n *\r\n * One token provider (either `skypeTokenProvider` or `authTokenProvider`) must be supplied in the config.\r\n */\r\nexport type ITrouterServiceConfig = {\r\n    trouterSettings: TrouterSettings;\r\n    telemetryConfig: TrouterTelemetryConfig;\r\n    connectionCache?: IConnectionCache;\r\n    registrationStateCallbackForAcsDoNotUse?(isRegistered: boolean): void;\r\n    proxyUrlRewrite?(url: string): string;\r\n} & ({\r\n    /**\r\n     * Legacy token provider supporting only Skypetokens, provided for backwards compatibility.\r\n     * Will be used if `authTokenProvider` is not passed, otherwise will be ignored.\r\n     */\r\n    skypeTokenProvider: SkypeTokenProvider;\r\n    authTokenProvider?: never;\r\n} | {\r\n    /**\r\n     * Token provider supporting multiple types of tokens. Should be preferred over `skypeTokenProvider`.\r\n     */\r\n    authTokenProvider: AuthTokenProvider;\r\n    skypeTokenProvider?: never;\r\n});\r\n\r\n/**\r\n * Information about trouter connection\r\n */\r\nexport interface IConnectionInfo {\r\n    /** Secure Trouter url at which client can be reached */\r\n    url: string;\r\n\r\n    /** Return connection TTL, i.e. number of seconds till expiration */\r\n    getRemainingTtlInSec(): number;\r\n}\r\n\r\nexport interface IAudienceSubscription {\r\n    readonly id: string;\r\n}\r\n\r\nexport interface IAudienceSubscriptionModel {\r\n    readonly audienceSubscriptions: IAudienceSubscription[];\r\n}\r\n\r\nexport type AudienceSubscriptionResult =\r\n    { audienceSubscriptionState: 'Subscribed', responseStatus?: number } |\r\n    { audienceSubscriptionState: 'Error', responseStatus?: number } |\r\n    { audienceSubscriptionState: 'Unsubscribed', responseStatus?: number } |\r\n    { audienceSubscriptionState: 'Timeout' } |\r\n    { audienceSubscriptionState: 'BadRequest'}\r\n\r\nexport interface IAudienceSubscriptionResponse{\r\n    audienceId: string;\r\n    result: AudienceSubscriptionResult\r\n}\r\n\r\nexport interface IAudienceSubscriptionsResponse{\r\n    responses: IAudienceSubscriptionResponse[];\r\n}\r\n\r\nexport type StateChangedListener = (state: TrouterState, url: string) => void;\r\n\r\nexport type TrouterConnectionListener = (state: TrouterState, info?: IConnectionInfo) => void;\r\n\r\nexport interface ITrouterServiceBase extends Client {\r\n    start(options: ITrouterServiceConfig): void;\r\n    stop(dontUnregister?: boolean): void;\r\n\r\n    setEcsConfig(fullEcsData: Record<string, unknown>): Promise<void>;\r\n\r\n    /**\r\n     * Can be called in two cases:\r\n     * - either network is down (disconnectDetected === true) - trouter will verify that\r\n     *      connection is really down and will start to restoring it;\r\n     * - network is restored (disconnectDetected === false) - trouter will try to restore connection immediately;\r\n     */\r\n    checkConnection(disconnectDetected?: boolean): void;\r\n\r\n    /**\r\n     * Invalidates current registration state and considers the connection \"not registered\"\r\n     * from now on.\r\n     * This will trigger a re-send of endpoint registration to Registrar if registration is being\r\n     * handled by the Trouter Client internally.\r\n     * Can throw an instance of Error if that's not possible.\r\n     */\r\n    resendRegistration(): Promise<void>;\r\n\r\n    /** If trouter is in the terminal state */\r\n    isInTerminalState(): boolean;\r\n\r\n    // Everything below is legacy API, deprecated, do not use\r\n    registerMessageHandler(handler: MessageHandler): void;\r\n    clearMessageHandlers(): void;\r\n    state(): TrouterState;\r\n    /**\r\n     * Reports information about the current Trouter states as a string. Intended for telemetry and not for acting upon\r\n     */\r\n    reportStateInfo(): string;\r\n    getTrouterUrlAsync(): Promise<string>;\r\n    onStateChanged(callback: StateChangedListener | undefined): void;\r\n    offStateChanged(callback: StateChangedListener): boolean;\r\n    addCallback(callback: TrouterConnectionListener): void;\r\n    removeCallback(callback: TrouterConnectionListener): boolean;\r\n}\r\n\r\n/**\r\n * Creates instance of trouter implementation\r\n */\r\nexport declare function createTrouterService(logger: LogProvider): ITrouterServiceBase;\r\n\r\n/**\r\n * Creates instance of trouter implementation\r\n */\r\nexport declare function getTrouterServiceVersion(): string;\r\n\r\n/**\r\n * Helper function to replace URL base (protocol + hostname)\r\n *\r\n * Useful when converting Trouter Endpoint URL to its client-to-client variant\r\n * with `ConnectionInfo.c2cUrlBase`.\r\n */\r\nexport declare function replaceTrouterUrlBase(existingUrl: string, newBase: string): string;\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/Interfaces.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nexport function toJson(obj: unknown): string {\r\n    try {\r\n        return JSON.stringify(obj);\r\n    } catch (error) {\r\n        return `Unable to serialize object of type ${typeof obj}`;\r\n    }\r\n}\r\n\r\nexport function calculateTtlInSec(expirationTsInSec: number | undefined): number {\r\n    const now = Math.round(new Date().getTime() / 1000);\r\n\r\n    return expirationTsInSec !== undefined && expirationTsInSec > now\r\n        ? expirationTsInSec - now\r\n        : 0;\r\n}\r\n\r\nexport function calculateExpireTsInSec(ttlInSec: number): number {\r\n    return Math.round(new Date().getTime() / 1000) + ttlInSec;\r\n}\r\n\r\n/** Wrapper to send request with specified timeout */\r\nexport async function fetchWithTimeout(request: Request, timeoutMs: number): Promise<Response> {\r\n    let timeoutId: Timeout | undefined;\r\n    const fetchPromise = new Promise<Response>((resolve, reject) => {\r\n        fetch(request).then((response) => {\r\n            clearTimeout(timeoutId);\r\n            resolve(response);\r\n        }).catch((error) => {\r\n            clearTimeout(timeoutId);\r\n            reject(error);\r\n        });\r\n    });\r\n    if (timeoutMs !== 0) {\r\n        const timeoutPromise = new Promise<Response>((resolve, reject) => {\r\n            // We make a compromise on how much information to show in the error message.\r\n            // Having the URL there is useful, but including any query parameters is both\r\n            // cumbersome (millions of different errors in telemetry) and unsafe (secret\r\n            // fields that would need to be redacted). \"Origin\" and \"pathname\" achieve that.\r\n            const url = new URL(request.url);\r\n            const error = new Error(`${request.method} ${url.origin}${url.pathname} timed out`);\r\n            timeoutId = setTimeout(reject, timeoutMs, error);\r\n        });\r\n\r\n        return Promise.race([fetchPromise, timeoutPromise]);\r\n    }\r\n\r\n    return fetchPromise;\r\n}\r\n\r\n/***\r\n * Correlation vector\r\n */\r\nexport class CorrelationVector {\r\n    private base: string;\r\n    private extension: number;\r\n\r\n    private constructor(correlationVector?: string) {\r\n        this.base = (correlationVector !== undefined) ? correlationVector : this.createCorrelationVectorBase();\r\n        this.extension = 0;\r\n    }\r\n\r\n    public static extend(correlationVector?: string): CorrelationVector {\r\n        return new CorrelationVector(correlationVector);\r\n    }\r\n\r\n    public increase() {\r\n        this.extension++;\r\n    }\r\n\r\n    public value(): string {\r\n        return `${this.base}.${this.extension}`;\r\n    }\r\n\r\n    private createCorrelationVectorBase(): string {\r\n        const length = 21;\r\n        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+';\r\n        const endChars = 'AQgw';\r\n        let result = '';\r\n        for (let i = 0; i < length; i++) {\r\n            result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n        }\r\n        result += endChars.charAt(Math.floor(Math.random() * endChars.length));\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\n/**\r\n * Simplify calculation of time intervals\r\n */\r\nexport class Timespan {\r\n    private start: number;\r\n\r\n    constructor() {\r\n        this.start = Date.now();\r\n    }\r\n\r\n    /**\r\n     * Returns number of milliseconds from start\r\n     */\r\n    public get duration(): number {\r\n        return Date.now() - this.start;\r\n    }\r\n\r\n    /**\r\n     * Returns start time\r\n     */\r\n    public get startTime() {\r\n        return this.start;\r\n    }\r\n\r\n    /**\r\n     * Reset start of interval to current timestamp\r\n     */\r\n    public reset() {\r\n        this.start = Date.now();\r\n    }\r\n}\r\n\r\n\r\n// Browser vs. @types/node compatibility - browser (where the client is mainly used) uses `number` as return type of setTimeout,\r\n// node.js (where the tests run) uses its own type.\r\n// The types are compatible at runtime for our purposes, e.g. you can just look at the result of `t + 0` of a node.js-returned timeout,\r\n// and then call clearTimeout with the same number literal, and it will work, so they can still be used as object keys, etc.,\r\nexport type Timeout = ReturnType<typeof setTimeout>;\r\nexport type Interval = ReturnType<typeof setInterval>;\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/Common.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n * Internal type definitions for Trouter JavaScript Client\r\n */\r\n\r\nimport { calculateTtlInSec } from './Common';\r\nimport {\r\n    HttpHeaders, IConnectionCache, IConnectionInfo, ITelemetrySender, SendResponseResult,\r\n    TimeoutOptions, TrouterTelemetrySettings\r\n} from './Interfaces';\r\n\r\n\r\nexport interface ITrouterRequest {\r\n    startTS: number;\r\n    url: string;\r\n    shortUrl: string;\r\n    body: string;\r\n    headers: HttpHeaders;\r\n    id: number;\r\n    method: string;\r\n    correlationVector: string;\r\n}\r\n\r\nexport interface IMessageLossIndicator {\r\n    /** flow tag representing the type of lost messages */\r\n    tag: string;\r\n\r\n    /**\r\n     * etag of the particular flow tag, the etag is used to identify the\r\n     * flow tag on the server when sending trouter.processed_message_loss event\r\n     * to be able to determine if new message loss happened after this one or not\r\n     */\r\n    etag: string;\r\n}\r\n\r\n/**\r\n * Response to downstream service\r\n */\r\nexport interface ITrouterResponse {\r\n    writeHead(status: number, headers?: HttpHeaders): void;\r\n    write(chunk: string): void;\r\n    end(chunk?: string): SendResponseResult;\r\n}\r\n\r\n/**\r\n * Data to generate TC query param and for telemetry\r\n */\r\nexport interface IClientInfo {\r\n    /** User-Agent string, for telemetry tracking */\r\n    ua: string;\r\n    /** Application client version, for telemetry tracking */\r\n    v: string;\r\n    /** Trouter client version */\r\n    cv?: string;\r\n}\r\n\r\n/**\r\n * Socket.IO (aka \"transport\") options\r\n */\r\nexport interface ISocketIoOptions {\r\n    'force new connection'?: boolean;\r\n    'reconnect'?: boolean;\r\n    'query'?: string;\r\n    /** timeout for each transport */\r\n    'connect timeout'?: number;\r\n    transports?: string[];\r\n    /**\r\n     * Timeout for waiting for ACK from server for trouter response (i.e. POST HTTP request) in XHR mode\r\n     */\r\n    ackTimeoutMs: number;\r\n\r\n    /**\r\n     * Additional request headers that will be added both to the socket.io handshake request,\r\n     * and to every longpoll GET/POST request\r\n     */\r\n    requestHeaders?: Record<string, string>;\r\n    /**\r\n     * When using the /v4/c protocol, the socket.io handshake request will not be sent, instead\r\n     * the values that would normally be part of the response to it will be provided\r\n     * by the client in this option. Only the WebSocket transport will be available, fallback to longpoll\r\n     * will be performed in a different way (restarting the connection process from the beginning)\r\n     * @property websocketUrl needs to be a wss:// URL, not https://\r\n     */\r\n    'skipped handshake data'?: { timeout: number, websocketUrl: string };\r\n    rewriteUrlForProxy(url: string): string;\r\n}\r\n\r\n/**\r\n * EDF registrar options\r\n */\r\nexport interface IRegistrarOptions {\r\n    registrarUrl: string;\r\n    registrationId: string;\r\n\r\n    pnhAppId: string;\r\n    platform: string;\r\n    pnhTemplateKey: string;\r\n    platformUIVersion: string;\r\n    productContext?: string;\r\n    context: string;\r\n\r\n    /** If set - limits registration TTL in EDF. If not - value from Trouter is used */\r\n    registrarTtlSec?: number;\r\n}\r\n\r\n/**\r\n * Options passed from outside\r\n */\r\nexport interface IConfiguration {\r\n    clientInfo: IClientInfo;\r\n\r\n    eventLogger: ITelemetrySender;\r\n    telemetrySettings: TrouterTelemetrySettings;  // Client telemetry configuration settings\r\n\r\n    clientCorrelationID: string;  // Client telemetry correlation ID, for correlation between Trouter and other components\r\n    environment: string;  // Environment for telemetry, e.g. \"latest\", \"liveint\", \"dogfood\", \"prod\"\r\n\r\n    ioOptions?: ISocketIoOptions;  // Socket.IO options\r\n    io?: Record<string, unknown>;  // Socket.IO override; for tests only\r\n}\r\n\r\n/**\r\n * Options passed from outside\r\n */\r\nexport interface ITrouterOptions extends IConfiguration {\r\n    endpointId?: string;\r\n    trouterUrl: string;\r\n    registration?: IRegistrarOptions;\r\n    connectionDependsOnRegistration: () => boolean;\r\n    delayEventsUntilRegistered: () => boolean;\r\n\r\n    /**\r\n     * timeouts for normal mode\r\n     */\r\n    timeoutOptions: TimeoutOptions;\r\n\r\n    /**\r\n     * timeouts for in-call mode, i.e. with more aggressive timeouts/reconnect policy\r\n     */\r\n    incallTimeoutOptions: TimeoutOptions;\r\n\r\n    /**\r\n     * Timeout for being in 'in-call' mode, i.e. with aggressive ping/retry policy. If it's zero - in-call mode is disabled\r\n     */\r\n    incallModeTimeoutMs: number;\r\n\r\n    /**\r\n     * Delay for keeping a previous connection open after connection switching.\r\n     */\r\n    lingeringConnectionDelayMs: number;\r\n\r\n    /**\r\n     * After how long to send the user activity second time after reconnect.\r\n     */\r\n    userActivitySecondResendDelayMs: number;\r\n\r\n    /**\r\n     * How soon after a connection is established must a disconnect packet with\r\n     * the \"dup\" reason come to be recognized as a \"duplicate loop/storm\" with\r\n     * another client sharing the same connection cache and trigger recovery.\r\n     */\r\n    duplicateDisconnectThresholdMs: number;\r\n\r\n    connectionCache?: IConnectionCache;\r\n\r\n    /**\r\n     * Optional setting to put a limit on maximum number of token fetch retries\r\n     */\r\n    retryLimitOnTokenFetch?: number;\r\n\r\n    /**\r\n     * The goal is that normally, getting an AAD token will make the client use the /v4/c protocol.\r\n     * This setting can be used by tests to make sure that even the /v4/a protocol works with AAD tokens.\r\n     * It can also be used to delay the rollout of the /v4/c protocol until we want to use it everywhere.\r\n     */\r\n    forceV4aProtocol?: boolean;\r\n\r\n    /** See TrouterSettings.extraConnectionHeaders */\r\n    extraConnectionHeaders?: Record<string, string>;\r\n\r\n    /**\r\n     * When calling start() when Trouter is already running, any pending backoffs will be reset.\r\n     * To avoid resetting it too often (e.g. when an event that triggers start() is called too often),\r\n     * this behavior is additionally throttled to only once per time period specified here.\r\n     */\r\n    expediteBackoffOnStartMinimumDelayMs?: number;\r\n\r\n    registrationStateCallback?(isRegistered: boolean): void;\r\n\r\n    rewriteUrlForProxy(this: void, url: string): string;\r\n\r\n    toJSON?(): unknown;\r\n}\r\n\r\n/**\r\n * Information about server connection\r\n */\r\nexport class ServerState implements IConnectionInfo {\r\n    public constructor(\r\n        /** Trouter client connection ID */\r\n        public connectionId: string,\r\n        /** Trouter client connected client ID */\r\n        public connectedClientId: string,\r\n        /** window.location.hostname */\r\n        public domId: string,\r\n        /** Unsecure Trouter url at which client can be reached */\r\n        public unsecureUrl: string,\r\n        /** Secure Trouter url at which client can be reached */\r\n        public url: string,\r\n        /** URL base to use for client-to-client requests */\r\n        public c2cUrlBase: string,\r\n        /** expiration timestamp for connection in seconds */\r\n        public expirationTsSec?: number\r\n    ) {\r\n    }\r\n\r\n    /** Return connection TTL, i.e. number of seconds till expiration */\r\n    public getRemainingTtlInSec(): number {\r\n        return calculateTtlInSec(this.expirationTsSec);\r\n    }\r\n}\r\n\r\n/**\r\n * Interface for trouter URL promise resolver\r\n */\r\nexport interface ITrouterUrlPromise {\r\n    resolveUrl(url: string): void;\r\n    resetUrl(): void;\r\n}\r\n\r\nexport enum UserActivityEventReason {\r\n    Unknown = 0,\r\n    Modified = 1,\r\n    Snapshot = 2,\r\n    Connected = 3\r\n}\r\n\r\nexport type SignatureData = {\r\n    sr: string,\r\n    issuer: string,\r\n    sp: string,\r\n    se: string,\r\n    st: string,\r\n    scae?: string,\r\n    sig: string\r\n};\r\n\r\nexport type AnonymousWebsocketAuthentication = {\r\n    headers: Record<string, string>\r\n    connectparams?: Partial<SignatureData>\r\n};\r\n\r\n/**\r\n * Duplicating TrouterState since too many parts of SCC depend on it for us to change it internally.\r\n * Don't expose this to the outside world, to avoid another repeat of this issue.\r\n */\r\nexport enum TrouterManagerState {\r\n    /** Initial state */\r\n    Unknown = 0,\r\n\r\n    /** ready to work */\r\n    Connected = 2,\r\n\r\n    /** waiting for 'connected' event */\r\n    Disconnected = 3,\r\n\r\n    /** waiting for 'register' from second connection */\r\n    Switching = 9,\r\n\r\n    /** Unable to continue, in final state. */\r\n    TerminalError = 10,\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/InternalInterfaces.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { TokenType } from './Interfaces';\r\nimport { SignatureData } from './InternalInterfaces';\r\nimport { IReconnectParameters, ITrouterConnectedEventArgs, ITrouterConnectedEventArgsV4c } from './TrouterConnection';\r\nimport { FallbackReason } from './TrouterFsm';\r\n\r\nexport type Protocol = 'v4a' | 'v4c';\r\n\r\nexport function usedProtocol(tokenType: TokenType, reconnectParams: IReconnectParameters | undefined): Protocol {\r\n    return (tokenType === 'skype' && safeToString(reconnectParams?.scae) !== '1') ? 'v4a' : 'v4c';\r\n}\r\n\r\nfunction safeToString(value: unknown) {\r\n    if (typeof value === 'string') {\r\n        return value;\r\n    } else if (typeof value === 'number') {\r\n        return value.toString();\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function usedProtocolAfterFallback(protocol: Protocol, fallbackReason?: FallbackReason): Protocol {\r\n    if (fallbackReason?.kind === 'v4c-websocket-failure') {\r\n        return 'v4a';\r\n    }\r\n\r\n    return protocol;\r\n}\r\n\r\nexport function isV4ConnectEvent(args: ITrouterConnectedEventArgs | ITrouterConnectedEventArgsV4c) {\r\n    return Object.prototype.hasOwnProperty.call(args, 'connectparams');\r\n}\r\n\r\n/**\r\n * Needed because we want to have cache with reconnectUrl, serviceUrl working\r\n * independent of protocol (see IReconnectParameters and its uses)\r\n */\r\nexport function adaptUrl(url: string, protocol: Protocol): string {\r\n    if (protocol === 'v4a') {\r\n        // The insecure (http://, ws://) versions would only ever be used by a test application,\r\n        // the connection URL is normally determined by the consumer of the library.\r\n        // eslint-disable-next-line @microsoft/sdl/no-insecure-url\r\n        return url.replace(/\\/v4\\/c\\b/, '/v4/a').replace('wss://', 'https://').replace('ws://', 'http://');\r\n    } else {\r\n        // eslint-disable-next-line @microsoft/sdl/no-insecure-url\r\n        return url.replace(/\\/v4\\/a\\b/, '/v4/c').replace('https://', 'wss://').replace('http://', 'ws://');\r\n    }\r\n}\r\n\r\n/**\r\n * Unfortunately the pre-existing cache format doesn't separate connectparams into its own property so it could be easily sent back,\r\n * instead it manually removes `reconnectUrl` and `serviceUrl` and send everything else, so we need to do the same here\r\n */\r\nexport function reconnectParamsWithoutUrls(reconnectParams: IReconnectParameters | undefined) {\r\n    if (reconnectParams === undefined) {\r\n        return undefined;\r\n    }\r\n\r\n    return <Partial<SignatureData>>{ ...reconnectParams, reconnectUrl: undefined, serviceUrl: undefined };\r\n}\r\n\r\nexport function ensureNumber(value: string | number): number {\r\n    return typeof value === 'string' ? parseInt(value, 10) : value;\r\n}\r\n\r\nexport function redirectUrlIfPresent(reason: FallbackReason | undefined): string | undefined {\r\n    if (reason?.kind !== 'redirect' || reason.host === undefined) {\r\n        return undefined;\r\n    }\r\n\r\n    let redirectHost = reason.host;\r\n    if (redirectHost.endsWith('/')) {\r\n        redirectHost = redirectHost.substring(0, redirectHost.length - 1);\r\n    }\r\n\r\n    if (!redirectHost.endsWith('/v4/c') && !redirectHost.endsWith('/v4/a')) {\r\n        redirectHost += '/v4/c';\r\n    }\r\n\r\n    return redirectHost;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/ProtocolAdapters.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { DisconnectReason } from './DisconnectReason';\r\nimport { LogProvider, TokenResult } from './Interfaces';\r\nimport { IMessageLossIndicator, ITrouterRequest, UserActivityEventReason } from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\nimport { usedProtocol, usedProtocolAfterFallback } from './ProtocolAdapters';\r\nimport { IReconnectParameters, ITrouterReconnectEventArgs, ReconnectReason } from './TrouterConnection';\r\n\r\nexport type FallbackReason = { kind: 'redirect', host: string } | { kind: 'redirect-no-host' } | { kind: 'v4c-websocket-failure' };\r\n\r\nexport interface IWorker {\r\n    getToken(useCache: boolean, backoff: boolean, claimsChallenge: string | undefined, reason?: FallbackReason): void;\r\n\r\n    startConnectionTimer(): void;\r\n    stopConnectionTimer(): void;\r\n    startPingTimer(): void;\r\n    stopPingTimer(): void;\r\n\r\n    /** Returns true if config mandates to not register connection URL with EDF Registrar */\r\n    shouldSkipRegistration(): boolean;\r\n    /** Returns true if user specified a custom TTL for registration */\r\n    hasCustomRegistrationTtl(): boolean;\r\n    startRegistrationTimer(): void;\r\n    startRegistrationRetryTimer(): void;\r\n    stopRegistrationTimer(): void;\r\n\r\n    startSocketIo(token: TokenResult): void;\r\n    stopSocketIo(): void;\r\n    isIncallMode(): boolean;\r\n    restartIncallModeTimer(): void;\r\n    enterIncallMode(): void;\r\n    exitIncallMode(): void;\r\n\r\n    dispatchConnected(): void;\r\n    dispatchRegistered(): void;\r\n    dispatchUnregistered(): void;\r\n    dispatchDownstreamRequest(request: ITrouterRequest): void;\r\n    /** Start reconnecting due to socket error */\r\n    dispatchReconnecting(): void;\r\n    /** Reconnection is requested by server (current connection is still valid) */\r\n    dispatchReconnectIsRequired(useConnectParamsFromCache: boolean, reason: ReconnectReason): void;\r\n    dispatchDisconnected(): void;\r\n    dispatchTerminalError(): void;\r\n    dispatchTrouterMessageLost(flowTags: IMessageLossIndicator[]): void;\r\n    /** Notify the connection that the client has failed to connect. */\r\n    countDisconnectBeforeConnectionEstablishment(): void;\r\n\r\n    sendAllocateRequest(token: TokenResult): void;\r\n    sendPingRequest(): void;\r\n\r\n    connectV4c(token: TokenResult, reason?: FallbackReason): void;\r\n    sendV4cAuthenticationEvent(token: TokenResult): void;\r\n\r\n    sendUserActivityState(reason: UserActivityEventReason, connected: boolean, correlationVector?: string): void;\r\n\r\n    sendRegisterRequest(): void;\r\n    sendUnregisterRequest(): void;\r\n\r\n    /** Reset planned token request (if any) and backoff interval */\r\n    resetTokenBackoff(): void;\r\n    /** Cancel pending registration requests (if any) */\r\n    cancelPendingRegistrationRequests(): void;\r\n    /** Cancel all pending downstream events related timers. */\r\n    clearSentEventTimers(): void;\r\n    sendDisconnectTelemetryEvent(error?: string): void;\r\n}\r\n\r\nexport enum State {\r\n    Initial,\r\n    /** waiting for token from User */\r\n    RetrievingToken,\r\n    /** waiting for allocation response from service */\r\n    Allocating,\r\n    /**\r\n     * waiting for Socket.IO handshake to be finished. After that Socket.IO will\r\n     * start to try transports and send 'connecting' event\r\n     */\r\n    Handshaking,\r\n    /**\r\n     * waiting for 'connected' event - socket.io is trying different transports.\r\n     * onSocketError event should be ignored, as it's expected event. So, only ConnectFailed or\r\n     * connection timeout meas failed connection\r\n     */\r\n    Connecting,\r\n    /**\r\n     * connecting to a websocket /v4/c URL\r\n     *\r\n     * this is the equivalent of the \"Allocating -> Handshaking -> Connecting\" chain\r\n     * from the /v4/a protocol\r\n     */\r\n    AnonymousConnecting,\r\n    /**\r\n     * connected to a websocket /v4/c URL, sending the authentication message,\r\n     * and waiting to receive a `trouter.connected` event back\r\n     */\r\n    WebsocketAuthenticating,\r\n    /** ready to work */\r\n    Connected,\r\n    /** waiting for a successful 'unregister' response */\r\n    Unregistering,\r\n    /**\r\n     * Unrecoverable state\r\n     * Trouter cannot start once in this state\r\n     */\r\n    TerminalError\r\n}\r\n\r\nenum RegistrationState {\r\n    Initial,\r\n    /** Waiting for a successful 'register' response */\r\n    Registering,\r\n    /** like the above, but another registration must happen when done because of resendRegistration() */\r\n    RegisteringButResendPending,\r\n    /** Registration failed, waiting to retry */\r\n    Retrying,\r\n    /** Registration succeeded */\r\n    Registered,\r\n    /** Registration is skipped */\r\n    RegistrationDisabled\r\n}\r\n\r\ntype ReconnectOptions = { backoff: boolean, allowCachedToken: boolean, claimsChallenge?: string, fallbackReason?: FallbackReason };\r\n\r\n/**\r\n * State machine for trouter\r\n */\r\nexport class TrouterFsm {\r\n    private logger: Logger;\r\n    private state: State = State.Initial;\r\n    private registrationState: RegistrationState;\r\n    private autoReconnect = true;\r\n\r\n    constructor(\r\n        logfunc: LogProvider,\r\n        private worker: IWorker,\r\n        private incallModeEnabled: boolean,\r\n        private protocolSelector: typeof usedProtocol\r\n    ) {\r\n        this.logger = new Logger('ConnectionFsm', logfunc);\r\n        this.registrationState = RegistrationState.Initial;\r\n    }\r\n\r\n    /** Returns current state */\r\n    public getState(): State {\r\n        return this.state;\r\n    }\r\n\r\n    public isActive(): boolean {\r\n        return this.state === State.Allocating\r\n            || this.state === State.Connected\r\n            || this.state === State.Handshaking\r\n            || this.state === State.Connecting\r\n            || this.state === State.RetrievingToken\r\n            || this.state === State.AnonymousConnecting\r\n            || this.state === State.WebsocketAuthenticating;\r\n    }\r\n\r\n    public isConnecting(): boolean {\r\n        return this.state === State.Allocating\r\n            || this.state === State.Handshaking\r\n            || this.state === State.Connecting\r\n            || this.state === State.AnonymousConnecting;\r\n    }\r\n\r\n    //////////// Events ////////////\r\n    /**\r\n     * Start trouter\r\n     */\r\n    public start(): boolean {\r\n        if (this.state === State.Initial) {\r\n            this.setState(State.RetrievingToken);\r\n            this.worker.getToken(true, false, undefined);\r\n\r\n            return true;\r\n        } else {\r\n            this.showIgnored('start');\r\n\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stop trouter\r\n     * @param dontUnregister    if true, FSM will not unregister. It's needed in case of two simultaneous\r\n     *                          connections, to replace first connection with second - registrar just updates\r\n     *                          the existing record for the user, by registrationId (see their API docs),\r\n     *                          that id does not change during the lifetime of a TrouterService instance.\r\n     * @param isTerminalError   if true, FSM will transition into the terminal state\r\n     */\r\n    public stop(\r\n       dontUnregister: boolean,\r\n       isTerminalError?: boolean,\r\n    ) {\r\n        if (dontUnregister) {\r\n            this.registrationState = RegistrationState.Initial;\r\n        }\r\n\r\n        if (this.worker.isIncallMode()) {\r\n            this.worker.exitIncallMode();\r\n        }\r\n\r\n        this.worker.resetTokenBackoff();\r\n        this.worker.cancelPendingRegistrationRequests();\r\n        this.worker.stopConnectionTimer();\r\n        this.worker.stopPingTimer();\r\n        this.worker.clearSentEventTimers();\r\n        this.worker.stopRegistrationTimer();\r\n        this.worker.stopSocketIo();\r\n\r\n        if (this.state === State.Connected) {\r\n            this.worker.sendDisconnectTelemetryEvent('connection stopped');\r\n        }\r\n\r\n        // Stop can happen in any state - the only difference is if registration exists or not.\r\n        // It can be also called a second time, just to stop a stuck unregistration.\r\n        if ((this.registrationState === RegistrationState.Registered\r\n             || this.registrationState === RegistrationState.Registering\r\n             || this.registrationState === RegistrationState.RegisteringButResendPending)\r\n            && this.state !== State.Unregistering\r\n        ) {\r\n            this.registrationState = RegistrationState.Initial;\r\n            this.setState(State.Unregistering);\r\n            this.worker.sendUnregisterRequest();\r\n        } else {\r\n            if (isTerminalError) {\r\n                this.setState(State.TerminalError);\r\n                this.worker.dispatchTerminalError();\r\n            } else {\r\n                this.setState(State.Initial);\r\n                this.worker.dispatchDisconnected();\r\n            }\r\n        }\r\n    }\r\n\r\n    public onTokenReceived(token: TokenResult, reason?: FallbackReason, reconnectParams?: IReconnectParameters) {\r\n        if (this.state === State.RetrievingToken) {\r\n            if (usedProtocolAfterFallback(this.protocolSelector(token.tokenType, reconnectParams), reason) === 'v4c') {\r\n                this.setState(State.AnonymousConnecting);\r\n                this.worker.startConnectionTimer();\r\n                this.worker.connectV4c(token, reason);\r\n            } else {\r\n                this.setState(State.Allocating);\r\n                this.worker.startConnectionTimer();\r\n                this.worker.sendAllocateRequest(token);\r\n            }\r\n        } else {\r\n            this.showIgnored('onTokenReceived');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * if disconnectDetected - need to send ping to check if connection is really dead,\r\n     * otherwise - network is available\r\n     */\r\n    public checkConnection(disconnectDetected: boolean) {\r\n        if (disconnectDetected) {\r\n            this.onPingInterval();\r\n        }\r\n    }\r\n\r\n    /** Allocation request succeed with 200 */\r\n    public onAllocationSucceed(token: TokenResult): boolean {\r\n        // Call to dispatchUnregistered a little bit earlier takes into account the case when the state\r\n        // of the state machine can change inside the callback, for example if Trouter.stop() is called inside the callback.\r\n        if (this.state === State.Allocating && this.registrationState === RegistrationState.Registered) {\r\n            this.worker.dispatchUnregistered();\r\n        }\r\n\r\n        if (this.state === State.Allocating) {\r\n            this.setState(State.Handshaking);\r\n            this.registrationState = RegistrationState.Initial;\r\n            this.worker.startSocketIo(token);\r\n\r\n            return true;\r\n        } else {\r\n            this.showIgnored('onAllocationSucceed');\r\n\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /** Allocation request failed */\r\n    public onAllocationFailed(unauthorized: boolean, claimsChallenge: string | undefined) {\r\n        if (this.state === State.Allocating) {\r\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: !unauthorized, claimsChallenge });\r\n        } else {\r\n            this.showIgnored('onAllocationFailed');\r\n        }\r\n    }\r\n\r\n    public onV4cException() {\r\n        if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\r\n            this.logger.error('v4c exception, falling back to longpoll');\r\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'v4c-websocket-failure' }});\r\n        }\r\n    }\r\n\r\n    /** Connection didn't succeed in given timeout */\r\n    public onConnectingTimeout() {\r\n        // implementation note: this also called from onConnectingFailed\r\n        if (this.state === State.Allocating\r\n            || this.state === State.Connecting\r\n            || this.state === State.Handshaking\r\n            || this.state === State.AnonymousConnecting\r\n            || this.state === State.WebsocketAuthenticating\r\n        ) {\r\n            this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\r\n        } else {\r\n            this.showIgnored('onConnectingTimeout');\r\n        }\r\n    }\r\n\r\n    /** socket.io handshake succeed and socket.io is trying next transport */\r\n    public onConnecting() {\r\n        if (this.state === State.Handshaking) {\r\n            this.setState(State.Connecting);\r\n        } else {\r\n            this.showIgnored('onConnecting');\r\n        }\r\n    }\r\n\r\n    /** socket.io connected (1::), but trouter.connected event has not arrived yet */\r\n    public onSocketConnect(token: TokenResult) {\r\n        if (this.state === State.AnonymousConnecting) {\r\n            this.setState(State.WebsocketAuthenticating);\r\n            this.worker.sendV4cAuthenticationEvent(token);\r\n        } else {\r\n            this.showIgnored('onSocketConnect');\r\n        }\r\n    }\r\n\r\n    /** Socket.io connection wasn't established */\r\n    public onConnectingFailed() {\r\n        // This callback will be called when all transports failed to connect, i.e. socket.io can't proceed\r\n        if (this.state === State.Connecting) {\r\n            this.onConnectingTimeout();\r\n        } else if (this.state === State.Handshaking) {\r\n            // It should never happen, because socket.io should try at least one transport\r\n            this.logger.error('Unexpected error in Socket.io - no valid transports');\r\n            this.onConnectingTimeout();\r\n        } else if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\r\n            this.logger.info('/v4/c falling back to longpoll');\r\n            this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'v4c-websocket-failure' }});\r\n        } else {\r\n            this.showIgnored('onConnectingFailed');\r\n        }\r\n    }\r\n\r\n    /** Socket.io error (or disconnect) */\r\n    public onSocketDisconnect(disconnectReason?: DisconnectReason) {\r\n        if (this.state === State.Handshaking || this.state === State.Connected || this.state === State.WebsocketAuthenticating) {\r\n            if (this.state === State.Connected) {\r\n                this.worker.sendDisconnectTelemetryEvent(disconnectReason?.toTelemetryString());\r\n            }\r\n            if (this.state === State.WebsocketAuthenticating) {\r\n                this.worker.countDisconnectBeforeConnectionEstablishment();\r\n            }\r\n            if (disconnectReason?.reason === 'skypetoken-deprecated') {\r\n                this.logger.error('Skypetoken deprecated response, not retrying any further');\r\n                this.onTerminalError();\r\n            } else {\r\n                this.cleanUpAndInitiateReconnect({\r\n                    // If client was already successfully connected, no backoff is needed (we want to reconnect quickly).\r\n                    // If however connection failed before the `trouter.connected` event arrived,\r\n                    // that means some sort of error where we don't want to retry immediately.\r\n                    backoff: this.state !== State.Connected && disconnectReason?.reason !== 'dup',\r\n                    allowCachedToken: disconnectReason?.reason !== 'unauthorized',\r\n                    claimsChallenge: disconnectReason?.claims});\r\n            }\r\n        } else {\r\n            // Disconnect can be called because of an error.\r\n            // Such error can happen in Connecting state, which means that\r\n            // websocket transport failed to establish connection\r\n            this.showIgnored('onSocketDisconnect');\r\n        }\r\n    }\r\n\r\n    /** Received 'trouter.connected' event from service */\r\n    public onTrouterConnected() {\r\n        if (this.state === State.Connecting || this.state === State.WebsocketAuthenticating) {\r\n            this.setState(State.Connected);\r\n            this.worker.resetTokenBackoff();\r\n            this.worker.stopConnectionTimer();\r\n            this.worker.sendUserActivityState(UserActivityEventReason.Connected, true);\r\n            this.worker.startPingTimer();\r\n            this.worker.dispatchConnected();\r\n            if (this.worker.shouldSkipRegistration()) {\r\n                this.registrationState = RegistrationState.RegistrationDisabled;\r\n                this.worker.dispatchRegistered();\r\n            } else {\r\n                this.registrationState = RegistrationState.Registering;\r\n                this.worker.sendRegisterRequest();\r\n            }\r\n        } else {\r\n            this.showIgnored('onTrouterConnected');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Received 'trouter.reconnect' event from service, or URL in configuration has changed,\r\n     * need to establish a new connection\r\n     */\r\n    public onReconnectRequired(useConnectParamsFromCache: boolean, reason: ReconnectReason, eventArgs?: ITrouterReconnectEventArgs) {\r\n        if (this.state === State.AnonymousConnecting || this.state === State.WebsocketAuthenticating) {\r\n            if (eventArgs === undefined || eventArgs.target !== 'host' || eventArgs.url === undefined || eventArgs.url === '') {\r\n                this.logger.error(`unexpected reconnect arguments: ${eventArgs?.target} ${eventArgs?.url}, reconnecting without cache`);\r\n                this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'redirect-no-host' }});\r\n            } else {\r\n                this.cleanUpAndInitiateReconnect({ backoff: true, allowCachedToken: true, fallbackReason: { kind: 'redirect', host: eventArgs.url }});\r\n            }\r\n        } else {\r\n            this.worker.dispatchReconnectIsRequired(useConnectParamsFromCache, reason);\r\n        }\r\n    }\r\n\r\n    public disableAutoReconnect() {\r\n        this.autoReconnect = false;\r\n    }\r\n\r\n    /** Request from downstream is received */\r\n    public onDownstreamRequest(request: ITrouterRequest) {\r\n        if (this.state === State.Connected) {\r\n            this.switchToIncallModeIfEnabled();\r\n            this.worker.dispatchDownstreamRequest(request);\r\n        } else {\r\n            this.showIgnored('onDownstreamRequest');\r\n        }\r\n    }\r\n\r\n    public onTrouterMessageLost(messageLossIndicators: IMessageLossIndicator[]) {\r\n        if (this.state === State.Connected) {\r\n            this.worker.dispatchTrouterMessageLost(messageLossIndicators);\r\n        } else {\r\n            this.showIgnored('onTrouterMessageLost');\r\n        }\r\n    }\r\n\r\n    /** Timer for ping request fired */\r\n    public onPingInterval() {\r\n        if (this.state === State.Connected) {\r\n            this.worker.sendPingRequest();\r\n        } else {\r\n            this.showIgnored('onPingInterval');\r\n        }\r\n    }\r\n\r\n    /** No pong response from service within timeout */\r\n    public onPingResponseTimeout() {\r\n        this.onMissedResponse('onPingResponseTimeout');\r\n    }\r\n\r\n    /** Pong response */\r\n    public onPingResponse() {\r\n        if (this.state === State.Connected) {\r\n            // do nothing\r\n        } else {\r\n            this.showIgnored('onPingResponse');\r\n        }\r\n    }\r\n\r\n    public onRegistrationFailed() {\r\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\r\n            this.worker.dispatchUnregistered();\r\n            this.registrationState = RegistrationState.Retrying;\r\n            this.worker.startRegistrationRetryTimer();\r\n        } else if (this.state === State.Connected && this.registrationState === RegistrationState.RegisteringButResendPending) {\r\n            this.registrationState = RegistrationState.Registering;\r\n            this.worker.sendRegisterRequest();\r\n        } else {\r\n            this.showIgnored('onRegistrationFailed');\r\n        }\r\n    }\r\n\r\n    public onRetryRegistration() {\r\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Retrying) {\r\n            this.registrationState = RegistrationState.Registering;\r\n            this.worker.sendRegisterRequest();\r\n        } else {\r\n            this.showIgnored('onRetryRegistration');\r\n        }\r\n    }\r\n\r\n    public onRegistrationSucceeded() {\r\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\r\n            this.registrationState = RegistrationState.Registered;\r\n            this.worker.dispatchRegistered();\r\n            this.worker.startRegistrationTimer();\r\n        } else if (this.state === State.Connected && this.registrationState === RegistrationState.RegisteringButResendPending) {\r\n            this.registrationState = RegistrationState.Registering;\r\n            this.worker.sendRegisterRequest();\r\n        } else {\r\n            this.showIgnored('onRegistrationSucceeded');\r\n        }\r\n    }\r\n\r\n    /** Registration TTL is about to expire */\r\n    public onRegistrationNearExpiry() {\r\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registered) {\r\n            this.registrationState = RegistrationState.Registering;\r\n            this.worker.sendRegisterRequest();\r\n        } else {\r\n            this.showIgnored('onRegistrationNearExpiry');\r\n        }\r\n    }\r\n\r\n    public onUnregistrationDone() {\r\n        if (this.state === State.Unregistering) {\r\n            this.setState(State.Initial);\r\n            this.worker.dispatchUnregistered();\r\n            this.worker.dispatchDisconnected(); // TODO: only sending \"disconneted\" upon unregistration makes no sense\r\n        } else {\r\n            this.showIgnored('onUnregistrationDone');\r\n        }\r\n    }\r\n\r\n    public onResendRegistration() {\r\n        this.worker.dispatchUnregistered();\r\n\r\n        if (this.state === State.Connected && this.registrationState === RegistrationState.Registered) {\r\n            this.registrationState = RegistrationState.Registering;\r\n            this.worker.stopRegistrationTimer();\r\n            this.worker.sendRegisterRequest();\r\n        } else if (this.state === State.Connected && this.registrationState === RegistrationState.Registering) {\r\n            this.registrationState = RegistrationState.RegisteringButResendPending;\r\n        }\r\n    }\r\n\r\n    public onIncallModeTimer() {\r\n        this.worker.exitIncallMode();\r\n\r\n        if (this.state === State.Connected) {\r\n            this.worker.stopPingTimer();\r\n            this.worker.startPingTimer();\r\n        } else {\r\n            this.showIgnored('onIncallModeTimer');\r\n        }\r\n    }\r\n\r\n    public onSetNewUserActivityState() {\r\n        this.worker.sendUserActivityState(UserActivityEventReason.Modified, this.state === State.Connected);\r\n    }\r\n\r\n    public onActivityStateResponseTimeout() {\r\n        this.onMissedResponse('onActivityStateResponseTimeout');\r\n    }\r\n\r\n    public forceReconnect(reason: string) {\r\n        if (this.state === State.Connected) {\r\n            this.worker.sendDisconnectTelemetryEvent(reason);\r\n        }\r\n        this.worker.resetTokenBackoff();\r\n        this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\r\n    }\r\n\r\n    public onTerminalError() {\r\n        this.logger.error(`Cannot proceed, reached terminal state. Switching from state '${State[this.state]}' to ${State[State.TerminalError]}`);\r\n        this.stop(\r\n            /* dontUnregister */ true,\r\n            /* isTerminalError */ true\r\n        );\r\n        this.setState(State.TerminalError);\r\n    }\r\n\r\n    private onMissedResponse(onResponseHandlerName: string) {\r\n        if (this.state === State.Connected) {\r\n            this.worker.sendDisconnectTelemetryEvent(onResponseHandlerName);\r\n            this.cleanUpAndInitiateReconnect({ backoff: false, allowCachedToken: true });\r\n        } else {\r\n            this.showIgnored(onResponseHandlerName);\r\n        }\r\n    }\r\n\r\n    private showIgnored(event: string) {\r\n        this.logger.debug(`Ignoring event '${event}' in state '${State[this.state]}'`);\r\n    }\r\n\r\n    private setState(state: State) {\r\n        this.logger.info(`Switching from state '${State[this.state]}' to state '${State[state]}'`);\r\n        if (this.state === state) {\r\n            this.logger.error(`Attempt to switch to the current state '${State[state]}'`);\r\n\r\n            return;\r\n        }\r\n        this.state = state;\r\n    }\r\n\r\n    private switchToIncallModeIfEnabled() {\r\n        if (this.incallModeEnabled) {\r\n            if (!this.worker.isIncallMode()) {\r\n                this.worker.enterIncallMode();\r\n                this.worker.stopPingTimer();\r\n                this.worker.startPingTimer();\r\n            }\r\n            this.worker.restartIncallModeTimer();\r\n        }\r\n    }\r\n\r\n    private cleanUpAndInitiateReconnect(options: ReconnectOptions)\r\n    {\r\n        if (!this.autoReconnect) {\r\n            this.logger.info('Automatic reconnect is disabled, stopping this connection');\r\n            this.stop(true);\r\n            return;\r\n        }\r\n\r\n        this.worker.cancelPendingRegistrationRequests();\r\n        this.worker.stopConnectionTimer();\r\n        this.worker.stopPingTimer();\r\n        this.worker.clearSentEventTimers();\r\n        this.worker.stopRegistrationTimer();\r\n        this.worker.stopSocketIo();\r\n\r\n        this.setState(State.RetrievingToken);\r\n        this.worker.dispatchReconnecting();\r\n        this.worker.getToken(options.allowCachedToken, options.backoff, options.claimsChallenge, options.fallbackReason);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TrouterFsm.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { createRegistrarClient, IRegistrarClient, IRegistrarClientOptions } from '@skype/tsregistrar';\r\nimport { calculateExpireTsInSec, calculateTtlInSec, fetchWithTimeout, Interval, Timeout, Timespan, toJson } from './Common';\r\nimport { ClientEventName, ConnectionTracker, Properties, ResponseData } from './ConnectionTracker';\r\nimport { CLIENT_VERSION, SUPPORTED_TOKEN_TYPES, USER_AUTHENTICATE_EVENT_NAME } from './Constants';\r\nimport { DisconnectReason } from './DisconnectReason';\r\nimport { ExponentialBackoff } from './ExponentialBackoff';\r\nimport {\r\n    AuthTokenProvider,\r\n    HttpHeaders, LogProvider, SendResponseResult, TimeoutOptions,\r\n    TokenRequest,\r\n    TokenResult,\r\n    UserActivityState,\r\n    IAudienceSubscriptionsResponse, IAudienceSubscriptionResponse, AudienceSubscriptionResult, IAudienceSubscription, TrouterState\r\n} from './Interfaces';\r\nimport {\r\n    AnonymousWebsocketAuthentication,\r\n    IClientInfo, IMessageLossIndicator, ISocketIoOptions, ITrouterOptions, ITrouterRequest, ITrouterResponse,\r\n    ServerState, UserActivityEventReason\r\n} from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\nimport { adaptUrl, ensureNumber, isV4ConnectEvent, reconnectParamsWithoutUrls, redirectUrlIfPresent, usedProtocol } from './ProtocolAdapters';\r\nimport { FallbackReason, IWorker, TrouterFsm, State } from './TrouterFsm';\r\nimport { UserActivityObject, UserActivitySnapshot, AudienceSubscriptionState, AudienceSubscriptionSnapshot } from './TrouterManager';\r\n\r\n// This is the current API version\r\nconst VERSION: string = 'v4';\r\n\r\n// Default value for registration timeout\r\nconst DEFAULT_REGISTRATION_TIMEOUT_SEC = 3600;\r\n\r\n// socket.io library is very much disconnected from the rest of the project\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ndeclare function require(arg: string): any;\r\n// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-explicit-any\r\nconst io: any = require('./socket.io');\r\n\r\n/**\r\n * Stub for IClientInfo\r\n */\r\nclass ClientInfo implements IClientInfo {\r\n    public cv: string = CLIENT_VERSION;\r\n    public ua: string = '';\r\n    public hr: string = '';\r\n    public v: string = '';\r\n}\r\n\r\n/**\r\n * Stub for ISocketIoOptions\r\n */\r\nclass SocketIoOptions implements ISocketIoOptions {\r\n    public 'force new connection'?: boolean = true;\r\n    public 'reconnect'?: boolean = false;\r\n    public 'query'?: string = '';\r\n    public ackTimeoutMs = 5000;\r\n    public rewriteUrlForProxy(url: string) { return url; }\r\n}\r\n\r\n/**\r\n * Interface to work with SocketIO library\r\n */\r\ninterface ISocketIo {\r\n    socketNumber: number;\r\n    socket: { options: ISocketIoOptions };\r\n\r\n    emit(event: string, handler?: () => void): void;\r\n    emit(event: string, args: Record<string, unknown>, handler?: (name: string, args?: unknown) => void): void;\r\n    // Some event arguments are from the socket.io library, others are directly coming from the server,\r\n    // we currently don't type check them.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    on(event: string, handler: (...eventArgs: any[]) => void): void;\r\n    disconnect(): void;\r\n    send(msg: string): void;\r\n    removeAllListeners(event: string): void;\r\n}\r\n\r\n/**\r\n * Params received during handshake\r\n */\r\nexport interface ITrouterConnectedEventArgs {\r\n    // Time it took Trouter to perform the handshake request internally, in milliseconds. Number in quotes, e.g. \"123\"\r\n    dur: string;\r\n    // Connection valid TTL in seconds as returned by service.\r\n    ttl: number;\r\n}\r\n\r\n/**\r\n * As there is no separate allocation request in /v4/c, all of the information comes as part of the trouter.connected event\r\n */\r\nexport type ITrouterConnectedEventArgsV4c = IAllocateResult & Omit<ITrouterConnectedEventArgs, 'ttl'> & { reconnectUrl: string };\r\n\r\n/**\r\n * Params received during trouter.reconnect event\r\n */\r\nexport interface ITrouterReconnectEventArgs {\r\n    // Reconnect target: self, host or global\r\n    target: string;\r\n    // Url of the deployment to reconnect to\r\n    url?: string;\r\n}\r\n\r\n/**\r\n * Params received on message lost event\r\n */\r\ninterface ITrouterMessageLossEventArgs {\r\n    droppedIndicators: IMessageLossIndicator[];\r\n}\r\n\r\ntype TrouterRequestCallbackType = (val: string) => void;\r\n\r\nconst cvHeader: string = 'MS-CV';\r\n\r\n/**\r\n * Request from downstream service\r\n */\r\nclass TrouterRequest implements ITrouterRequest {\r\n    public startTS: number;\r\n    public url: string;\r\n    public shortUrl: string;\r\n    public body: string;\r\n    public headers: HttpHeaders;\r\n    public id: number;\r\n    public method: string;\r\n    public replied: boolean;\r\n    public timedout: boolean;\r\n    public timeoutTimerId: Timeout | undefined;\r\n\r\n    private dataCallback: TrouterRequestCallbackType | undefined;\r\n    private cvCounter: number = 0;\r\n    private receivedCv: string;\r\n\r\n    public constructor(requestJson: string, private logger?: Logger) {\r\n        const json: unknown = JSON.parse(requestJson);\r\n\r\n        this.startTS = this.safeJsonNumber(json, 'startTS', 0);\r\n        this.url = this.safeJsonString(json, 'url', '');\r\n        this.shortUrl = this.safeJsonString(json, 'shortUrl', '');\r\n        this.body = this.safeJsonString(json, 'body', '');\r\n        this.headers = this.safeJsonRecord(json, 'headers', {});\r\n        this.id = this.safeJsonNumber(json, 'id', -1);\r\n        this.method = this.safeJsonString(json, 'method', '');\r\n\r\n        this.replied = false;\r\n        this.timedout = false;\r\n\r\n        this.receivedCv = this.headers[cvHeader];\r\n        this.updateCvHeader();\r\n    }\r\n\r\n    public get correlationVector(): string {\r\n        return this.receivedCv ? `${this.receivedCv}.${this.cvCounter}` : '';\r\n    }\r\n\r\n    public on(target: string, targetCallback: (val?: string) => void) {\r\n        if (target === 'data') {\r\n            this.dataCallback = targetCallback;\r\n        } else if (target === 'end') {\r\n            if (typeof this.dataCallback === 'function') {\r\n                this.dataCallback(this.body);\r\n            }\r\n            targetCallback();\r\n        }\r\n    }\r\n\r\n    public incrementCorrelationVector() {\r\n        ++this.cvCounter;\r\n        this.updateCvHeader();\r\n    }\r\n\r\n    private updateCvHeader(): void {\r\n        const cv: string = this.correlationVector;\r\n        if (cv) {\r\n            this.headers[cvHeader] = cv;\r\n        }\r\n    }\r\n\r\n    private safeJsonNumber(json: unknown, property: string, defaultValue: number) {\r\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\r\n            const jsonRecord = <Record<string, unknown>>json;\r\n            if (typeof jsonRecord[property] === 'number') {\r\n                return <number>(jsonRecord[property]);\r\n            } else if (typeof jsonRecord[property] === 'string') {\r\n                return parseFloat(<string>(jsonRecord[property]));\r\n            } else {\r\n                this.logger?.warn(`unexpected type of '${property}': ${typeof jsonRecord[property]}`);\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private safeJsonString(json: unknown, property: string, defaultValue: string) {\r\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\r\n            const jsonRecord = <Record<string, unknown>>json;\r\n            if (typeof jsonRecord[property] === 'string') {\r\n                return <string>(jsonRecord[property]);\r\n            } else {\r\n                this.logger?.warn(`unexpected type of '${property}': ${typeof jsonRecord[property]}`);\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n\r\n    private safeJsonRecord(json: unknown, property: string, defaultValue: Record<string, string>) {\r\n        if (json !== null && json !== undefined && Object.prototype.hasOwnProperty.call(json, property)) {\r\n            const jsonRecord = <Record<string, unknown>>json;\r\n            if (typeof jsonRecord[property] === 'object') {\r\n                return <Record<string, string>>(jsonRecord[property]);\r\n            } else {\r\n                this.logger?.warn(`unexpected type of '${property}': ${typeof jsonRecord[property]}`);\r\n            }\r\n        }\r\n        return defaultValue;\r\n    }\r\n}\r\n\r\n/**\r\n * Response to downstream service\r\n */\r\nclass TrouterResponse implements ITrouterResponse {\r\n    public constructor(\r\n        private request: TrouterRequest,\r\n        private responseData: ResponseData,\r\n        private sendResponse: (request: TrouterRequest, responseData: ResponseData) => SendResponseResult) {\r\n    }\r\n\r\n    public writeHead(status: number, headers?: HttpHeaders) {\r\n        this.responseData.status = status;\r\n        this.responseData.headers = headers;\r\n    }\r\n\r\n    public write(chunk: string) {\r\n        this.responseData.body += chunk;\r\n    }\r\n\r\n    public end(chunk?: string): SendResponseResult {\r\n        if (chunk) {\r\n            this.responseData.body += chunk;\r\n        }\r\n\r\n        return this.sendResponse(this.request, this.responseData);\r\n    }\r\n}\r\n\r\n/**\r\n * An client-initiated event that is to be sent to trouter.\r\n */\r\nclass DownstreamEvent {\r\n    public name: string;\r\n    public args: Record<string, unknown>;\r\n    public timeoutTimerId: Timeout;\r\n\r\n    public constructor(name: string) {\r\n        this.name = name;\r\n        this.args = {};\r\n        this.timeoutTimerId = <Timeout><unknown>0;\r\n    }\r\n}\r\n\r\n/**\r\n * Reason why a connection switch is happening.\r\n */\r\nexport enum ReconnectReason {\r\n    /** Configuration change coming from ECS, containing different URL */\r\n    Configuration,\r\n\r\n    /** In response to a `trouter.reconnect` socket.io event */\r\n    ServerInitiated\r\n}\r\n\r\n/**\r\n * Interface to be implemented by Trouter consumer\r\n */\r\nexport interface IManagerConsumer {\r\n    /** Called on received request */\r\n    onDownstreamRequest(connection: TrouterConnection, request: ITrouterRequest, response: ITrouterResponse): void;\r\n    /** Called once connection is established */\r\n    onConnected(connection: TrouterConnection): void;\r\n    /** Called once registration in EDF is succeed */\r\n    onRegistered(connection: TrouterConnection): void;\r\n    /** Called if registration in EDF fails or expires */\r\n    onUnregistered(connection: TrouterConnection): void;\r\n    /** Called once connection failed */\r\n    onReconnecting(connection: TrouterConnection): void;\r\n    /** Called when server asked to reconnect */\r\n    onReconnectIsRequired(connection: TrouterConnection, useConnectParamsFromCache: boolean, reason: ReconnectReason): void;\r\n    /** Called once connection is unregistered and closed */\r\n    onDisconnected(connection: TrouterConnection): void;\r\n    /** Called once connection is reaches the terminal state */\r\n    onTerminalError(connection: TrouterConnection): void;\r\n    /** Called when connection parameters are updated */\r\n    onConnectionParametersUpdated(connectParams: Record<string, unknown>): void;\r\n    /** Called when message loss indicator received */\r\n    onTrouterMessageLost(flowTags: IMessageLossIndicator[]): void;\r\n    /** Called once user activity state is accepted */\r\n    onUserActivityStateAccepted(cv: string): void;\r\n    /** Called when audience subscription set finishes */\r\n    onAudiencesSetResolved(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void;\r\n    /** Returns the current state of the connection state machine */\r\n    getState(): TrouterState;\r\n}\r\n\r\n/**\r\n * Allocation result from Trouter server.\r\n * With /v4/a protocol, this corresponds to the data returned from the /v4/a HTTP request\r\n * With /v4/c protocol, this is returned as part of the `trouter.connected` event\r\n */\r\nexport interface IAllocateResult {\r\n    url: string;\r\n    surl: string;\r\n    curlb: string;\r\n    connectparams: Record<string, unknown>;\r\n    socketio: string;\r\n    id: string;\r\n    ccid: string;\r\n    ttl: string;\r\n}\r\n\r\n/**\r\n * Locally cached reconnection parameters\r\n *\r\n * Allows reconnecting to the same deployment and retaining the\r\n * allocated Connection ID, Trouter Endpoint URL, etc.\r\n * Consists of IAllocateResult.connectparams (opaque to the client)\r\n * extended with a bit more info about the deployment it came from.\r\n */\r\nexport type IReconnectParameters = {\r\n    /** URL that was sent by the server during a previous connection, typically URL of a specific Trouter deployment */\r\n    reconnectUrl?: string\r\n\r\n    /** URL that was passed to the client in settings, typically a \"go URL\" (load balancer) */\r\n    serviceUrl?: string\r\n\r\n    /** connectparams / signature data */\r\n    [param: string]: unknown\r\n};\r\n\r\ntype PendingAudienceSubscription = {\r\n    readonly audienceSetResolve: (response: IAudienceSubscriptionsResponse) => void;\r\n    readonly timeoutId: Timeout;\r\n}\r\n\r\n/**\r\n * Trouter + registration flow implementation\r\n */\r\nexport class TrouterConnection implements IWorker {\r\n    private readonly WEBSOCKET_TRANSPORT_NAME = 'websocket';\r\n    private readonly XHR_POLLING_TRANSPORT_NAME = 'xhr-polling';\r\n\r\n    private readonly AUDIENCE_SUBSCRIPTION_RESULT_ERROR = 'Error';\r\n    private readonly AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED = 'Unsubscribed';\r\n    private readonly AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT = 'Timeout';\r\n    private readonly AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST = \"BadRequest\";\r\n\r\n    private readonly AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX = /&audienceSubscriptionState=[^&]*|^audienceSubscriptionState=[^&]*&?/;\r\n\r\n    private readonly logger: Logger;\r\n    private readonly tokenBackoff: ExponentialBackoff;\r\n    private readonly fsm: TrouterFsm;\r\n    private readonly connectionTracker: ConnectionTracker;\r\n    private readonly registrarClient?: IRegistrarClient;\r\n\r\n    private connectionId = '';\r\n\r\n    private inIncallMode = false;\r\n    private timeoutOptions: TimeoutOptions;\r\n    private connectionTimeoutId?: Timeout;\r\n    private pingTimerId?: Interval;\r\n    private pingResponseTimerId?: Timeout;\r\n    private registrationTimerId?: Timeout;  // Used for three kinds of registration-related timers:\r\n                                            // 1) TTL near expiration, 2) TTL fully expired, 3) retry after failure\r\n    private incallModeTimerId?: Timeout;\r\n\r\n    private socket?: ISocketIo;\r\n    private allocateResult?: IAllocateResult;\r\n    /** expiration's timestamp of allocated connectionID */\r\n    private connectionExpireTimestampInSecs?: number;\r\n    /** Seeded by externally cached connection parameters at startup, updated by each successful allocation result.\r\n     *  The contents might be mangled in various ways (especially if coming from the external connection cache),\r\n     *  so all code working with it must make no assumptions about which fields are actually present etc.\r\n     */\r\n    private reconnectParams?: IReconnectParameters;\r\n\r\n    /** Allocated URL where library was able to successfully connect */\r\n    private connectedUrl?: string;\r\n\r\n    /** Name of currently used transport */\r\n    private transportTypeName: string | undefined;\r\n\r\n    private clientID: number;\r\n    private connectionAttempt = 0;\r\n    private connectedClientId = '';\r\n    private domId: string | undefined;\r\n    private isNavigatorOnline: boolean = true;\r\n    private onNavigatorOnlineStatusUpdateBound = this.onNavigatorOnlineStatusUpdate.bind(this);  // Bound to allow removing the listener\r\n    private c2cUrlBase: string = '';\r\n    private connectingErrorsInRow = 0;\r\n\r\n    /** Keeps track of 401s */\r\n    private unauthorizedErrorCount = 0;\r\n\r\n    private readonly clientInfo: Readonly<IClientInfo>;\r\n    /** Used to calculate short URL in requests */\r\n    private urlPath: string | undefined;\r\n    private userActivityState: UserActivityObject;\r\n    private pendingSentEventTimers: { [id: number]: string; } = {};\r\n\r\n    private lastDisconnectReason: string = '';\r\n\r\n    private readonly UNKNOWN_TRANSPORT = 'unknown_transport';\r\n    private readonly connectingErrorsThreshold = 3;\r\n\r\n    // this variable represents and ongoing audience subscription operation that has been initiated by user\r\n    // if the operation value exists it means that user requested a subscription but there has not been an answer from server yet\r\n    // valid only for longpoll \r\n    private pendingAudienceSubscription?: PendingAudienceSubscription = undefined;\r\n\r\n    constructor(\r\n        logProvider: LogProvider,\r\n        private options: ITrouterOptions,\r\n        private manager: IManagerConsumer,\r\n        private tokenProvider: AuthTokenProvider,\r\n        private usingLegacyTokenApi: boolean,\r\n        initialUserActivityState: UserActivityObject,\r\n        private protocolSelector: typeof usedProtocol,\r\n        private audienceSubscriptionState?: AudienceSubscriptionState\r\n    ) {\r\n        this.logger = new Logger('Connection', logProvider);\r\n        this.timeoutOptions = this.options.timeoutOptions;\r\n        this.tokenBackoff = new ExponentialBackoff(this.logger, this.timeoutOptions.maxBackoffMs);\r\n        this.clientID = Date.now();\r\n\r\n        if ((typeof window !== 'undefined') && window.location) {\r\n            this.domId = window.location.hostname;\r\n        }\r\n\r\n        const clientInfo = new ClientInfo();\r\n        clientInfo.cv = CLIENT_VERSION;\r\n        clientInfo.ua = '';\r\n\r\n        if (this.options?.clientInfo) {\r\n            clientInfo.ua = this.safeString(this.options.clientInfo.ua);\r\n            clientInfo.v = this.safeString(this.options.clientInfo.v);\r\n        }\r\n\r\n        this.clientInfo = clientInfo;\r\n\r\n        this.connectionTracker = new ConnectionTracker(\r\n            logProvider,\r\n            this.clientID,\r\n            this.clientInfo,\r\n            () => { return this.getServerState(); },\r\n            this.options.endpointId,\r\n            this.options.clientCorrelationID,\r\n            this.options.environment\r\n        );\r\n        this.applyConnectionTrackerOptions(options);\r\n\r\n        const useIncallMode = this.options.incallModeTimeoutMs > 0;\r\n        this.fsm = new TrouterFsm(logProvider, this, useIncallMode, this.protocolSelector);\r\n\r\n        if (options.registration) {\r\n            const registrarOptions: IRegistrarClientOptions = {\r\n                registrarUrl: options.registration.registrarUrl,\r\n                proxyUrlRewrite: options.rewriteUrlForProxy,\r\n                registrationId: options.registration.registrationId,\r\n                requestTimeoutMs: options.timeoutOptions.fetchTimeoutMs,\r\n                initialRetryDelayMs: 1000,\r\n                maxRetryDelayMs: options.timeoutOptions.maxBackoffMs,\r\n                usingLegacyTokenApi: this.usingLegacyTokenApi,\r\n                maxRetriesForGetToken: options.retryLimitOnTokenFetch,\r\n                extraRegistrationHeaders: options.extraConnectionHeaders\r\n            };\r\n            this.registrarClient = createRegistrarClient(logProvider, this.tokenProvider, registrarOptions);\r\n        }\r\n\r\n        this.userActivityState = initialUserActivityState;\r\n    }\r\n\r\n    public start(externalConnectParams?: IReconnectParameters) {\r\n        this.logger.info('Starting');\r\n\r\n        this.reconnectParams = externalConnectParams;\r\n\r\n        if (typeof window !== 'undefined' && window.navigator && window.addEventListener) {\r\n            this.isNavigatorOnline = window.navigator.onLine;\r\n            window.addEventListener('online', this.onNavigatorOnlineStatusUpdateBound);\r\n            window.addEventListener('offline', this.onNavigatorOnlineStatusUpdateBound);\r\n            this.logger.debug(`Registered for browser online notifications - current state: ${this.isNavigatorOnline}`);\r\n        } else {\r\n            this.isNavigatorOnline = true;  // Assume always online if the API is not available\r\n        }\r\n\r\n        this.fsm.start();\r\n    }\r\n\r\n    public stop(dontUnregister: boolean) {\r\n        this.logger.info('Stopping');\r\n\r\n        if (typeof window !== 'undefined' && window.navigator) {\r\n            window.removeEventListener('online', this.onNavigatorOnlineStatusUpdateBound);\r\n            window.removeEventListener('offline', this.onNavigatorOnlineStatusUpdateBound);\r\n        }\r\n\r\n        this.fsm.stop(dontUnregister);\r\n        this.connectionTracker.close();\r\n    }\r\n\r\n    public configure(options: ITrouterOptions) {\r\n        // Currently only baseUrl and telemetrySettings options are supported for reconfiguration\r\n        const urlChanged = this.options.trouterUrl !== options.trouterUrl;\r\n        this.options = options;\r\n\r\n        this.applyConnectionTrackerOptions(options);\r\n\r\n        if (urlChanged) {\r\n            this.logger.info('Configuration changed. Reconnection required.');\r\n            this.fsm.onReconnectRequired(false, ReconnectReason.Configuration);\r\n        }\r\n    }\r\n\r\n    public checkConnection(disconnectDetected: boolean) {\r\n        this.logger.info(`checkConnection called with ${disconnectDetected}`);\r\n\r\n        this.fsm.checkConnection(disconnectDetected);\r\n\r\n        // Don't send on disconnectDetected === false, because Teams client calls it on timer\r\n        if (disconnectDetected) {\r\n            this.connectionTracker.sendTelemetry(ClientEventName.CheckConnection, {\r\n                disconnectDetected: disconnectDetected\r\n            }, []);\r\n        }\r\n    }\r\n\r\n    public disableRegistrationsAndAutoReconnect() {\r\n        this.stopRegistrationTimer();\r\n        this.cancelPendingRegistrationRequests();\r\n        this.fsm.disableAutoReconnect();\r\n    }\r\n\r\n    /** Returns info about connection */\r\n    public getServerState(): ServerState {\r\n        return new ServerState(\r\n            this.connectionId,\r\n            this.connectedClientId,\r\n            this.domId ? this.domId : '',\r\n            this.allocateResult ? this.allocateResult.url : '',\r\n            this.allocateResult ? this.allocateResult.surl : '',\r\n            this.c2cUrlBase,\r\n            this.connectionExpireTimestampInSecs);\r\n    }\r\n\r\n    public getState(): State {\r\n        return this.fsm.getState();\r\n    }\r\n\r\n    //////// Implement IWorker ////////\r\n\r\n    public getToken(\r\n        useCache: boolean,\r\n        backoff: boolean,\r\n        claimsChallenge: string | undefined,\r\n        reason?: FallbackReason,\r\n        retryCounter: number = 0\r\n    ) {\r\n        this.logger.info(`Getting token ${backoff ? 'with backoff' : 'without backoff'}`);\r\n\r\n        const requestFunction = () => {\r\n            this.connectionTracker.trackStart('token');\r\n            const tokenRequest: TokenRequest = {\r\n                needFresh: !useCache,\r\n                wwwAuthenticateHeader: claimsChallenge,\r\n                supportedTokenTypes: SUPPORTED_TOKEN_TYPES,\r\n                purpose: 'trouter'\r\n            };\r\n            this.logger.info(\r\n                `Requesting token: needFresh=${tokenRequest.needFresh} ` +\r\n                `types=[${SUPPORTED_TOKEN_TYPES}], ` +\r\n                `wwwAuthenticateHeader is ${tokenRequest.wwwAuthenticateHeader ? 'non empty' : 'empty'}`);\r\n\r\n            this.tokenProvider(tokenRequest).then((token) => {\r\n                this.logger.debug(`${token.tokenType} token is received`);\r\n                this.connectionTracker.trackEnd('token');\r\n                this.fsm.onTokenReceived(token, reason, this.reconnectParams);\r\n            }).catch((error: Error) => {\r\n                const msg = toJson(error.stack);\r\n                this.logger.error(`Getting token failed, will retry after timeout. Error: ${msg}`);\r\n                this.connectionTracker.trackError('token', msg);\r\n\r\n                // Can't retry getToken request, which means client would not receive any notifications from trouter.\r\n                // Unrecoverable error unless client tries to reconnect with Trouter\r\n                //     - retryCounter tracks internal loop\r\n                //     - unauthorizedErrorCount tracks external loop (consecutive number of sendAllocationFailures as a result of 401s)\r\n                if (!this.canRetryTokenFetchRequest(retryCounter + this.unauthorizedErrorCount)) {\r\n                    const errorMessage = 'getToken retry limit hit, reached terminal error state';\r\n                    this.connectionTracker.trackError('token', errorMessage);\r\n                    this.resetTokenBackoff();\r\n                    this.fsm.onTerminalError();\r\n\r\n                    return;\r\n                }\r\n                this.getToken(useCache, true, claimsChallenge, reason, retryCounter + 1);\r\n            });\r\n        };\r\n\r\n        if (backoff) {\r\n            this.tokenBackoff.backoff('getting token', requestFunction);\r\n        } else {\r\n            this.resetTokenBackoff();\r\n            requestFunction();\r\n        }\r\n    }\r\n\r\n    public startConnectionTimer() {\r\n        this.stopConnectionTimer();\r\n        this.logger.debug(`Starting connection timeout for ${this.timeoutOptions.connectionTimeoutMs} ms`);\r\n        this.connectionTimeoutId = setTimeout(() => {\r\n            this.logger.info('Connection timeout is fired');\r\n            this.fsm.onConnectingTimeout();\r\n        }, this.timeoutOptions.connectionTimeoutMs);\r\n    }\r\n\r\n    public stopConnectionTimer() {\r\n        if (this.connectionTimeoutId) {\r\n            this.logger.debug('Stopping connection timeout');\r\n            clearTimeout(this.connectionTimeoutId);\r\n            this.connectionTimeoutId = undefined;\r\n        }\r\n    }\r\n\r\n    public startPingTimer() {\r\n        if (this.transportTypeName === 'websocket') {\r\n            this.logger.debug(`Starting ping timeout for ${this.timeoutOptions.pingTimeoutMs} ms`);\r\n            this.pingTimerId = setInterval(() => {\r\n                this.logger.info('Ping interval fired');\r\n                this.fsm.onPingInterval();\r\n            }, this.timeoutOptions.pingTimeoutMs);\r\n        } else {\r\n            this.logger.debug(`Not starting ping for transport ${this.transportTypeName}`);\r\n        }\r\n    }\r\n\r\n    public stopPingTimer() {\r\n        if (this.pingTimerId) {\r\n            this.logger.debug('Stopping ping timeout');\r\n            this.clearPingResponseTimer();\r\n            clearInterval(this.pingTimerId);\r\n            this.pingTimerId = undefined;\r\n        }\r\n    }\r\n\r\n    public shouldSkipRegistration() {\r\n        return this.options.registration === undefined;\r\n    }\r\n\r\n    public hasCustomRegistrationTtl() {\r\n        return this.options.registration?.registrarTtlSec !== undefined && this.options.registration?.registrarTtlSec !== 0;\r\n    }\r\n\r\n    public startRegistrationTimer() {\r\n        this.stopRegistrationTimer();\r\n\r\n        const timeForReregistrationSec = 30;\r\n        const [ttl, isTtlReduced] = this.getRegistrationTtl();\r\n\r\n        if (ttl <= timeForReregistrationSec || !isTtlReduced) {\r\n            this.logger.debug(`Starting registration expiration timer (TTL ${ttl} sec)`);\r\n\r\n            this.registrationTimerId = setTimeout(() => {\r\n                this.registrationTimerId = undefined;\r\n                this.logger.warn('Registration expired but the connection is still alive. Should never happen');\r\n                this.dispatchUnregistered();\r\n            }, ttl * 1000);\r\n\r\n            return;\r\n        }\r\n\r\n        const delay = ttl - timeForReregistrationSec;\r\n        this.logger.debug(`Starting registration extension timer for ${delay} sec`);\r\n        this.registrationTimerId = setTimeout(() => {\r\n            this.logger.info('Registration extension timer fired');\r\n            this.registrationTimerId = setTimeout(() => {\r\n                this.registrationTimerId = undefined;\r\n                this.logger.debug('Registration extension did not happen in time');\r\n                this.dispatchUnregistered();\r\n            }, timeForReregistrationSec * 1000);\r\n            this.fsm.onRegistrationNearExpiry();\r\n        }, delay * 1000);\r\n    }\r\n\r\n    public startRegistrationRetryTimer() {\r\n        this.stopRegistrationTimer();\r\n\r\n        // A simple static delay for now, per discussion in PR 870422.\r\n        const registrationRetryDelaySec = 123;\r\n        this.registrationTimerId = setTimeout(() => {\r\n            this.registrationTimerId = undefined;\r\n            this.fsm.onRetryRegistration();\r\n        }, registrationRetryDelaySec * 1000);\r\n    }\r\n\r\n    public stopRegistrationTimer() {\r\n        if (this.registrationTimerId) {\r\n            this.logger.debug('Stopping registration timeout');\r\n            clearTimeout(this.registrationTimerId);\r\n            this.registrationTimerId = undefined;\r\n        }\r\n    }\r\n\r\n    public resendRegistration(): Promise<void> {\r\n        if (!this.registrarClient) {\r\n            throw new Error('Trouter Client not configured to handle registrations');\r\n        }\r\n\r\n        this.fsm.onResendRegistration();\r\n\r\n        return Promise.resolve();\r\n    }\r\n\r\n    public buildSocketIoUrlParams(userActivitySnapshot?: UserActivitySnapshot, audienceSubscriptionSnapshot?: AudienceSubscriptionSnapshot): string {\r\n        if (!this.allocateResult) {\r\n            throw new Error('Allocate result is undefined in buildSocketIoUrlParams()');\r\n        }\r\n\r\n        const urlParams: Record<string, string | number> = {};\r\n\r\n        // Copy connection parameters (i.e. signature) from allocation response\r\n        const signatureData = this.allocateResult.connectparams;\r\n        for (const i of Object.keys(signatureData)) {\r\n            if (signatureData[i] !== undefined) {\r\n                const value = signatureData[i];\r\n                if (typeof value === 'string' || typeof value === 'number') {\r\n                    urlParams[i] = value;\r\n                } else {\r\n                    this.logger.error(`signatureData[${i}] has unsupported type ${typeof value}`);\r\n                }\r\n            }\r\n        }\r\n\r\n        // And add some more fields\r\n        urlParams.v = VERSION;\r\n        urlParams.tc = encodeURI(toJson(this.clientInfo));\r\n        urlParams.timeout = this.timeoutOptions.pingTimeoutMs / 1000;\r\n        urlParams.auth = 'true';\r\n\r\n        if (this.options.endpointId) {\r\n            urlParams.epid = this.options.endpointId;\r\n        }\r\n\r\n        if (userActivitySnapshot) {\r\n            urlParams.userActivity = encodeURI(toJson(userActivitySnapshot));\r\n        }\r\n\r\n        if (audienceSubscriptionSnapshot) {\r\n            urlParams.audienceSubscriptionState = encodeURIComponent(toJson(audienceSubscriptionSnapshot));\r\n        }\r\n\r\n        return this.appendConnectedClientIds(this.buildQuery(urlParams), true);\r\n    }\r\n\r\n    public startSocketIo(token: TokenResult) {\r\n        this.logger.debug('Starting socket io');\r\n        this.connectionTracker.trackStart('connectSocket');\r\n        if (!this.allocateResult) {\r\n            throw new Error('Allocate result is undefined in startSocketIo()');\r\n        }\r\n\r\n        const options: ISocketIoOptions = this.options.ioOptions ? { ...this.options.ioOptions } : new SocketIoOptions();\r\n        // Take user activity snapshot (if a state isn't unknown) to make sure it's consistent between the function calls below.\r\n        const userActivitySnapshot = this.userActivityState.state !== UserActivityState.Unknown\r\n            ? this.userActivityState.increaseCvAndGetEventObject()\r\n            : undefined;\r\n\r\n        const audienceSubscriptionStateSnapshot = this.audienceSubscriptionState?.increaseCvAndGetEventObject();\r\n\r\n        // Regardless of any passed in socket.io options, force the following settings.\r\n        options['force new connection'] = true;\r\n        options.reconnect = false;\r\n        options.rewriteUrlForProxy = this.options.rewriteUrlForProxy;\r\n        options.requestHeaders = {\r\n            ...this.options.extraConnectionHeaders,\r\n            ...headersFromToken(token, this.usingLegacyTokenApi)\r\n        };\r\n\r\n        // Query params to each socket.io request\r\n        options.query = this.buildSocketIoUrlParams(userActivitySnapshot, audienceSubscriptionStateSnapshot);\r\n        this.logger.info(`connecting to ${this.allocateResult.socketio}?${options.query}`);\r\n\r\n        // msg868 - clear all events and disconnect\r\n        this.stopSocketIo();\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment,@typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call\r\n        this.socket = (this.options.io ?? io).connect(this.allocateResult.socketio, options);\r\n        if (this.socket === undefined) {\r\n            throw new Error('Can\\'t create Socket.io object');\r\n        }\r\n\r\n        this.attachSocketIoHandlers(this.socket, token, userActivitySnapshot, audienceSubscriptionStateSnapshot);\r\n    }\r\n\r\n    public stopSocketIo() {\r\n        if (this.socket) {\r\n            this.logger.debug('clearing socket.io');\r\n            try {\r\n                for (const event of [\r\n                    'connecting', 'connect', 'connect_failed', 'close_during_connecting', 'disconnect', 'reconnect', 'reconnect_failed',\r\n                    'reconnecting', 'error', 'message', 'trouter.connected', 'trouter.reconnect', 'trouter.message_loss'\r\n                ]) {\r\n                    this.socket.removeAllListeners(event);\r\n                }\r\n\r\n                this.socket.disconnect();\r\n                this.logger.debug('cleared socket');\r\n                this.socket = undefined;\r\n            } catch (error) {\r\n                this.logger.error(`exception in disconnecting previous socket. Error: ${errorStackToJson(error)}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    public dispatchConnected() {\r\n        this.logger.info('dispatching connected');\r\n        this.manager.onConnected(this);\r\n    }\r\n\r\n    public dispatchRegistered() {\r\n        this.logger.info('dispatching registered');\r\n        this.manager.onRegistered(this);\r\n    }\r\n\r\n    public dispatchUnregistered() {\r\n        this.logger.info('dispatching unregistered');\r\n        this.manager.onUnregistered(this);\r\n    }\r\n\r\n    public dispatchDownstreamRequest(request: ITrouterRequest) {\r\n        this.logger.debug('dispatching downstream request');\r\n\r\n        try {\r\n            const response = new TrouterResponse(<TrouterRequest>request, new ResponseData(request.id),\r\n                (req: TrouterRequest, responseData: ResponseData) => {\r\n                    this.logger.debug('sending response to downstream');\r\n\r\n                    return this.sendResponse(req, responseData);\r\n                });\r\n            this.manager.onDownstreamRequest(this, request, response);\r\n        } catch (error) {\r\n            this.logger.error(`exception in socket.on message. Error : ${errorStackToJson(error)}`);\r\n        }\r\n    }\r\n\r\n    public dispatchReconnecting() {\r\n        this.logger.info('dispatching reconnecting');\r\n        this.manager.onReconnecting(this);\r\n    }\r\n\r\n    public dispatchReconnectIsRequired(useConnectParamsFromCache: boolean, reason: ReconnectReason) {\r\n        this.logger.info('dispatching reconnect is required by server');\r\n        this.manager.onReconnectIsRequired(this, useConnectParamsFromCache, reason);\r\n    }\r\n\r\n    public dispatchDisconnected() {\r\n        this.logger.info('dispatching disconnected');\r\n        this.manager.onDisconnected(this);\r\n    }\r\n\r\n    public dispatchTerminalError() {\r\n        this.logger.info('dispatching terminal error');\r\n        this.manager.onTerminalError(this);\r\n    }\r\n\r\n    public dispatchTrouterMessageLost(messageLossIndicators: IMessageLossIndicator[]) {\r\n        this.logger.info('dispatching trouter message lost');\r\n        this.manager.onTrouterMessageLost(messageLossIndicators);\r\n    }\r\n\r\n    public countDisconnectBeforeConnectionEstablishment() {\r\n        this.logger.warn('counting disconnect before connection was fully established as a connection failure');\r\n        this.connectingErrorsInRow++;\r\n        if (this.connectingErrorsInRow >= this.connectingErrorsThreshold) {\r\n            this.resetReconnectParamsOnErrorThreshold();\r\n        }\r\n    }\r\n\r\n    public sendProcessedDroppedIndicators(messageLossIndicators: IMessageLossIndicator[]) {\r\n        try {\r\n            this.logger.debug('emitting processed flow tags to the server');\r\n            const processedMessageLossEvent = new DownstreamEvent('trouter.processed_message_loss');\r\n            processedMessageLossEvent.args = { droppedIndicators: messageLossIndicators };\r\n            this.sendDownstreamEvent(processedMessageLossEvent, () => {\r\n                this.logger.info('emitted processed flow tags to the server');\r\n            });\r\n        } catch (error) {\r\n            const msg = errorStackToJson(error);\r\n            this.logger.error(`unable to send processed message loss event. Error: ${msg}`);\r\n            this.connectionTracker.trackError('trouter.processed_message_loss', msg, false);\r\n        }\r\n    }\r\n\r\n    public sendAllocateRequest(token: TokenResult) {\r\n        this.connectionAttempt++;\r\n        this.connectionTracker.trackNewConnection();\r\n\r\n        let url = this.options.trouterUrl;\r\n        let connectParams: Record<string, unknown> | null;\r\n\r\n        let rp = this.reconnectParams;\r\n        const expiration = typeof rp?.se === 'string' ? parseInt(rp.se, 10) : (typeof rp?.se === 'number' ? rp.se : undefined);\r\n        if (expiration && expiration <= Date.now() + 3600000) {  // 1 hour\r\n            this.logger.warn(`Dropping expired cached connection parameters: ${new Date(expiration)}`);\r\n            this.reconnectParams = rp = undefined;\r\n        }\r\n        if (rp && rp.serviceUrl !== url) {\r\n            this.logger.warn(`Dropping cached connection parameters for a different environment (${rp.serviceUrl}, now ${url})`);\r\n            this.reconnectParams = rp = undefined;\r\n        }\r\n        if (rp?.reconnectUrl) {\r\n            url = rp.reconnectUrl;\r\n        }\r\n        if (rp) {\r\n            // Do not append serviceUrl and reconnectUrl as query parameters\r\n            connectParams = { ...rp, serviceUrl: undefined, reconnectUrl: undefined };\r\n        } else {\r\n            connectParams = null;\r\n        }\r\n\r\n        url = adaptUrl(url, 'v4a');\r\n        url = this.appendCorrelationIds(url, false);\r\n        url = this.appendEndpointId(url, false);\r\n        if (connectParams) {\r\n            url += `&${this.buildQuery(connectParams)}`;\r\n            // Currently server doesn't return \"v\" in allocate result, but it\r\n            // can be changed, so implement it this way just in case\r\n            if (!connectParams.v) {\r\n                url += `&v=${VERSION}`;\r\n            }\r\n        }\r\n\r\n        url = this.options.rewriteUrlForProxy(url);\r\n\r\n        const allocateRequest = new Request(url, {\r\n            method: 'POST',\r\n            mode: 'cors',\r\n            headers: new Headers({\r\n                'Content-Type': 'text/plain',\r\n                ...this.options.extraConnectionHeaders,\r\n                ...headersFromToken(token, this.usingLegacyTokenApi),\r\n            })\r\n        });\r\n\r\n        this.logger.info(`sendAllocateRequest: POST ${url}`);\r\n        this.connectionTracker.trackStart('allocation');\r\n        const startTimestamp = Date.now();\r\n        let responseStatusCode = -1;\r\n        let responseClaimsChallenge: string | undefined;\r\n        let responseSkypetokenDeprecated = false;\r\n        fetchWithTimeout(allocateRequest, this.timeoutOptions.fetchTimeoutMs).then((response: Response) => {\r\n            responseStatusCode = response.status;\r\n            if (!response.ok) {\r\n                responseClaimsChallenge = response.headers.get('www-authenticate') ?? undefined;\r\n                responseSkypetokenDeprecated = response.headers.get('x-trouter-skypetoken-deprecated') === '1';\r\n                this.logger.warn(`Allocation request got response status ${response.status}, www-authenticate header was ${responseClaimsChallenge ? 'not empty' : 'empty'}`);\r\n                throw new Error(response.statusText);\r\n            }\r\n\r\n            const contentType = response.headers.get('content-type');\r\n            if (!contentType || (contentType !== 'application/json' && !contentType.startsWith('application/json;'))) {\r\n                throw new Error(`Content-type '${contentType}' is unexpected`);\r\n            }\r\n            this.connectionTracker.trackEnd('allocation');\r\n\r\n            return response.json();\r\n        }).then((responseObj) => {\r\n            this.unauthorizedErrorCount = 0;\r\n            // We perform no parsing/validation of the response received from server\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\r\n            this.onAllocationResponse(responseObj, token);\r\n        }).catch((error: Error) => {\r\n            this.connectingErrorsInRow++;\r\n            const msg = `${error}${responseStatusCode >= 0 ? `, status code ${responseStatusCode}` : ''}`;\r\n            this.logger.error(`${this.connectingErrorsInRow} failed connecting attempt(s) in a row. ${msg}`);\r\n            this.connectionTracker.trackError('allocation', msg);\r\n\r\n            if (responseSkypetokenDeprecated) {\r\n                const errorMessage = 'Skypetoken deprecated response, not retrying any further';\r\n                this.logger.error(errorMessage);\r\n                this.connectionTracker.trackError('allocation', errorMessage);\r\n                this.fsm.onTerminalError();\r\n\r\n                return;\r\n            }\r\n            if (responseStatusCode === 401) {\r\n                this.unauthorizedErrorCount++;\r\n            }\r\n            if (!this.canRetryTokenFetchRequest(this.unauthorizedErrorCount)) {\r\n                const errorMessage = 'getToken retry limit hit, reached terminal error state';\r\n                this.connectionTracker.trackError('allocation', errorMessage);\r\n                this.fsm.onTerminalError();\r\n\r\n                return;\r\n            }\r\n\r\n            if (responseStatusCode === -1 && !this.isNavigatorOnline) {\r\n                this.logger.info('Expected failure, the browser says it is not online at the moment');\r\n            } else if (this.reconnectParams && this.connectingErrorsInRow >= this.connectingErrorsThreshold) {\r\n                if (responseStatusCode >= 400 && responseStatusCode <= 599) {\r\n                    this.resetReconnectParamsOnErrorThreshold();\r\n                } else if (this.reconnectParams.reconnectUrl && this.connectingErrorsInRow % 3 === 0) {\r\n                    this.logger.warn(`${this.connectingErrorsInRow} connection attempts, testing nominal service URL`);\r\n                    // Make sure to finish the check before connection timeout passes to avoid unexpected FSM calls\r\n                    const timeoutMs = Math.min(\r\n                        this.timeoutOptions.connectionTimeoutMs - (Date.now() - startTimestamp) - 500,\r\n                        this.timeoutOptions.fetchTimeoutMs);\r\n                    this.testNominalUrlConnectivity(timeoutMs)\r\n                        .then(result => {\r\n                            this.connectionTracker.trackProgress('nomcheck', result ? 'ok' : 'failed');\r\n                            if (result) {\r\n                                this.logger.warn('Nominal service URL is reachable, erasing cached reconnect URL');\r\n                                if (this.reconnectParams) {\r\n                                    delete this.reconnectParams.reconnectUrl;\r\n                                }\r\n                            } else {\r\n                                this.logger.warn('Nominal service URL is not reachable either, keeping cached reconnect URL');\r\n                            }\r\n\r\n                            this.fsm.onAllocationFailed(false, undefined);\r\n                        }, () => {\r\n                            // Should not happen, but removes no-floating-promises warning\r\n                            this.fsm.onAllocationFailed(false, undefined);\r\n                        });\r\n\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.fsm.onAllocationFailed(responseStatusCode === 401, responseClaimsChallenge);\r\n        });\r\n    }\r\n\r\n    public testNominalUrlConnectivity(timeoutMs: number): Promise<boolean> {\r\n        if (timeoutMs < 1000) {\r\n            this.logger.warn(`There is no time left to reasonably perform the nominal service URL connectivity check (${timeoutMs} ms), falling back to assuming that the connectivity is fine`);\r\n\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        let testRequest: Request;\r\n        try {\r\n            const url = new URL(this.options.trouterUrl);\r\n            // Modify the URL to reach the root page (which returns a plain text string \"Trouter\")\r\n            url.pathname = '/';\r\n            // Add a few query parameters for possible classification and troubleshooting\r\n            url.search = '?' + this.buildQuery({\r\n                check: Date.now(),\r\n                cor_id: encodeURIComponent(this.options.clientCorrelationID),\r\n                epid: encodeURIComponent(this.options.endpointId ? this.options.endpointId : ''),\r\n                tc: encodeURIComponent(toJson(this.clientInfo))\r\n            });\r\n            testRequest = new Request(this.options.rewriteUrlForProxy(url.toString()), {\r\n                method: 'GET',\r\n                headers: { Accept: 'text/plain' }\r\n            });\r\n        } catch (error) {\r\n            this.logger.warn(`Nominal service URL connectivity test request could not be created (${error}), falling back to assuming that the connectivity is fine`);\r\n\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return fetchWithTimeout(testRequest, timeoutMs)\r\n            .then((response: Response) => {\r\n                if (response.status !== 200) {\r\n                    throw new Error(`Not 200 OK: ${response.status} ${response.statusText}`);\r\n                }\r\n\r\n                return response.text();\r\n            })\r\n            .then((body: string) => {\r\n                if (body !== 'Trouter') {\r\n                    throw new Error(`Not \"Trouter\": ${body.substring(0, 16)}${body.length > 16 ? '...' : ''}`);\r\n                }\r\n\r\n                return true;\r\n            })\r\n            .catch((error) => {\r\n                this.logger.error(`Nominal service URL connectivity test failed: ${error}`);\r\n\r\n                return false;\r\n            });\r\n    }\r\n\r\n    public sendPingRequest() {\r\n        if (this.socket && this.pingResponseTimerId === undefined) {\r\n            try {\r\n                this.logger.debug('emitting ping event');\r\n                let timeoutReached = false;\r\n                this.socket.emit('ping', () => {\r\n                    if (timeoutReached === true) {\r\n                        return;\r\n                    }\r\n                    this.onPingResponse();\r\n                });\r\n                this.pingResponseTimerId = setTimeout(() => {\r\n                    this.logger.error('Ping response timeout is fired');\r\n                    timeoutReached = true;\r\n                    this.clearPingResponseTimer();\r\n                    this.fsm.onPingResponseTimeout();\r\n                }, this.timeoutOptions.pongTimeoutMs);\r\n            } catch (error) {\r\n                const msg = errorStackToJson(error);\r\n                this.logger.error(`unable to send ping. Error: ${msg}`);\r\n                this.connectionTracker.trackError('ping', msg, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    public connectV4c(token: TokenResult, reason?: FallbackReason) {\r\n        const options: ISocketIoOptions = this.options.ioOptions ? { ...this.options.ioOptions } : new SocketIoOptions();\r\n\r\n        // Regardless of any passed in socket.io options, force the following settings.\r\n        options['force new connection'] = true;\r\n        options.reconnect = false;\r\n\r\n        if (\r\n            this.reconnectParams?.serviceUrl &&\r\n            // previous input URL != current input URL (passed via `start()`)\r\n            adaptUrl(this.reconnectParams.serviceUrl, 'v4c') !== adaptUrl(this.options.trouterUrl, 'v4c')\r\n        ) {\r\n            this.logger.warn(`Dropping cached connection parameters for a different environment (${this.reconnectParams.serviceUrl}, now ${this.options.trouterUrl})`);\r\n            this.reconnectParams = undefined;\r\n        }\r\n\r\n        const inputUrl =\r\n            redirectUrlIfPresent(reason) ??\r\n            (reason?.kind !== 'redirect-no-host' ? this.reconnectParams?.reconnectUrl : undefined) ??\r\n            this.options.trouterUrl;\r\n\r\n        const url = adaptUrl(inputUrl, 'v4c');\r\n\r\n        options['skipped handshake data'] = {\r\n            timeout: 70,\r\n            websocketUrl: url\r\n        };\r\n\r\n        options.query = this.buildV4cUrlParams();\r\n        options.rewriteUrlForProxy = this.options.rewriteUrlForProxy;\r\n\r\n        try {\r\n            this.stopSocketIo();\r\n\r\n            this.transportTypeName = 'websocket';\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-assignment\r\n            this.socket = (this.options.io ?? io).connect(this.options.trouterUrl, options);\r\n            if (this.socket === undefined) {\r\n                throw new Error('failed to create Socket.io object');\r\n            }\r\n\r\n            const audienceSubscriptionStateSnapshot = this.audienceSubscriptionState?.increaseCvAndGetEventObject();\r\n\r\n            this.attachSocketIoHandlers(this.socket, token, undefined, audienceSubscriptionStateSnapshot);\r\n        } catch (e: unknown) {\r\n            this.logger.error(`${e}`);\r\n            this.connectionTracker.trackError('v4c', `${e}`);\r\n            this.fsm.onV4cException();\r\n        }\r\n    }\r\n\r\n    public sendV4cAuthenticationEvent(token: TokenResult): void {\r\n        const payload: AnonymousWebsocketAuthentication = {\r\n            headers: {\r\n                ...this.options.extraConnectionHeaders,\r\n                ...headersFromToken(token, this.usingLegacyTokenApi)\r\n            },\r\n            connectparams: reconnectParamsWithoutUrls(this.reconnectParams)\r\n        };\r\n        this.socket?.emit(USER_AUTHENTICATE_EVENT_NAME, payload);\r\n    }\r\n\r\n    public setUserActivityState(userActivityObject: UserActivityObject) {\r\n        const changed: boolean = (userActivityObject.state !== this.userActivityState.state);\r\n        this.userActivityState = userActivityObject;\r\n        if(changed) {\r\n            this.logger.info(`Changing user activity state to '${userActivityObject.toEventJSON()}'`);\r\n            this.fsm.onSetNewUserActivityState();\r\n        } else {\r\n            this.logger.debug(`Not changing the same user activity state '${userActivityObject.toEventJSON()}'`);\r\n            this.manager.onUserActivityStateAccepted(userActivityObject.correlationVector.value());\r\n        }\r\n    }\r\n\r\n    public sendUserActivityState(reason: UserActivityEventReason, connected: boolean) {\r\n        if (this.userActivityState.state === UserActivityState.Unknown) {\r\n            return;\r\n        }\r\n        if (this.transportTypeName === 'websocket' && connected) {\r\n            if (reason === UserActivityEventReason.Connected) {\r\n                this.sendUserActivityStateMultiple(2);\r\n            } else {\r\n                this.sendUserActivityStateMultiple(1);\r\n            }\r\n        } else if (this.transportTypeName === 'xhr-polling') { // ignoring the connected flag\r\n            if (reason === UserActivityEventReason.Modified) {\r\n                this.fsm.forceReconnect('user activity/force reconnect');\r\n            }\r\n        }\r\n    }\r\n\r\n    public setAudienceSubscriptionsAsync(audienceSubscriptionState: AudienceSubscriptionState, timeoutInMs: number): Promise<IAudienceSubscriptionsResponse> {\r\n        const previousAudienceSubscriptionState = this.audienceSubscriptionState;\r\n        this.audienceSubscriptionState = audienceSubscriptionState;\r\n\r\n        if (this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\r\n            return this.setAudienceSubscriptionsInternalAsync(audienceSubscriptionState.increaseCvAndGetEventObject(), timeoutInMs);\r\n        }\r\n\r\n        if (this.transportTypeName === this.XHR_POLLING_TRANSPORT_NAME) {\r\n            const setAudienceSubscriptionsPromise = this.setAudienceSubscriptionsLongpollInternalAsync(audienceSubscriptionState.increaseCvAndGetEventObject(), timeoutInMs, previousAudienceSubscriptionState);\r\n            this.fsm.forceReconnect('set audience subscription force reconnect');\r\n            return setAudienceSubscriptionsPromise;\r\n        }\r\n\r\n        throw new Error('set audience subscription executed on an unknown transport');\r\n    }\r\n\r\n    private setAudienceSubscriptionsUnsafeAsync(audienceSubscriptionSnapshot?: AudienceSubscriptionSnapshot): Promise<IAudienceSubscriptionsResponse> | undefined {\r\n        if (!audienceSubscriptionSnapshot) {\r\n            return undefined;\r\n        }\r\n\r\n        if (this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\r\n            return this.setAudienceSubscriptionsInternalAsync(audienceSubscriptionSnapshot, 15000);\r\n        }\r\n    }\r\n\r\n    private async setAudienceSubscriptionsInternalAsync(audienceSubscriptionSnapshot: AudienceSubscriptionSnapshot, timeoutInMs: number): Promise<IAudienceSubscriptionsResponse> {\r\n        this.logger.info('[WebSocket] Audience subscription set requested.');\r\n\r\n        const audienceSubscriptionEvent = new DownstreamEvent('audience.subscribe');\r\n        audienceSubscriptionEvent.args = audienceSubscriptionSnapshot;\r\n\r\n        const result = await new Promise((resolve: (response: IAudienceSubscriptionsResponse) => void) => {\r\n            let hasTimedOut = false;\r\n\r\n            const timeoutId = setTimeout(() => {\r\n                hasTimedOut = true;\r\n                return resolve(this.buildAudienceSubscriptionsTimeoutResponse(audienceSubscriptionSnapshot));\r\n            }, timeoutInMs);\r\n\r\n            this.sendDownstreamEvent(audienceSubscriptionEvent, (_: string, args?: unknown) => {\r\n                if (hasTimedOut) {\r\n                    return;\r\n                }\r\n\r\n                clearTimeout(timeoutId);\r\n                this.logger.debug(`[Websocket] Audience subscription response: ${args}`);\r\n\r\n                if (this.pendingAudienceSubscription) {\r\n                    this.onAudienceSubscriptionResult(args as IAudienceSubscriptionsResponse);\r\n                }\r\n\r\n                resolve(args as IAudienceSubscriptionsResponse);\r\n            });\r\n        });\r\n\r\n        this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\r\n        return result;\r\n    }\r\n\r\n    private async setAudienceSubscriptionsLongpollInternalAsync(audienceSubscriptionSnapshot: AudienceSubscriptionSnapshot, timeoutInMs: number, previousSubscriptionState?: AudienceSubscriptionState): Promise<IAudienceSubscriptionsResponse> {\r\n        this.logger.info('[XHR Polling] Audience subscription set requested.');\r\n\r\n        if (this.pendingAudienceSubscription) {\r\n            this.logger.error('Racing audience subscriptions occured. This situation resolves into undefined scenario and/or nasal demons.');\r\n            clearTimeout(this.pendingAudienceSubscription.timeoutId);\r\n        }\r\n\r\n        if (audienceSubscriptionSnapshot.audiences.length === 0) {\r\n            return this.handleAudienceUnsubscribeLongpoll(audienceSubscriptionSnapshot.cv, previousSubscriptionState);\r\n        }\r\n\r\n        const result = await new Promise((resolve: (response: IAudienceSubscriptionsResponse) => void) => {\r\n            const timeoutId = setTimeout(() => {\r\n                this.pendingAudienceSubscription = undefined;\r\n                return resolve(this.buildAudienceSubscriptionsTimeoutResponse(audienceSubscriptionSnapshot));\r\n            }, timeoutInMs);\r\n\r\n            this.pendingAudienceSubscription = {\r\n                audienceSetResolve: resolve,\r\n                timeoutId\r\n            };\r\n        });\r\n\r\n        if (this.manager.getState() === TrouterState.Unknown || this.transportTypeName === this.WEBSOCKET_TRANSPORT_NAME) {\r\n            return result;\r\n        }\r\n\r\n        const currentResponse = result.responses[0];\r\n        if (currentResponse?.result.audienceSubscriptionState === this.AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST) {\r\n            this.clearAudienceSubscriptionStateQueryParam();\r\n\r\n            this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\r\n            return result;\r\n        }\r\n\r\n        const currentAudienceResponse = result.responses.find(r => r.audienceId === audienceSubscriptionSnapshot.audiences[0].id);\r\n        if (currentAudienceResponse?.result.audienceSubscriptionState === this.AUDIENCE_SUBSCRIPTION_RESULT_ERROR) {\r\n            this.clearAudienceSubscriptionStateQueryParam();\r\n\r\n            this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\r\n            return result;\r\n        }\r\n\r\n        // only notify user abount un-subscription if the target audience actually changed\r\n        const subscribesToDifferentAudience = previousSubscriptionState?.audienceSubscriptionModel.audienceSubscriptions[0]?.id !== currentResponse?.audienceId;\r\n        if (previousSubscriptionState && subscribesToDifferentAudience) {\r\n            const synthResponses = this.mapToSyntheticAudienceSubscriptionResponses(previousSubscriptionState.audienceSubscriptionModel.audienceSubscriptions, this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED, 200);\r\n            result.responses.push(...synthResponses);\r\n        }\r\n\r\n        this.manager.onAudiencesSetResolved(result, audienceSubscriptionSnapshot.cv);\r\n        return result;\r\n    }\r\n\r\n    // remove the `audienceSubscriptionState` param from longpoll query string so the subscription is not attempted over and over creating loop\r\n    private clearAudienceSubscriptionStateQueryParam() {\r\n        if (this.socket?.socket?.options?.query) {\r\n            this.socket.socket.options.query = this.socket.socket.options.query.replace(this.AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX, '');\r\n        }\r\n    }\r\n\r\n    private handleAudienceUnsubscribeLongpoll(correlationVector: string, previousSubscriptionState?: AudienceSubscriptionState): IAudienceSubscriptionsResponse {\r\n        this.audienceSubscriptionState = undefined;\r\n\r\n        const result = {\r\n            responses: []\r\n        } as IAudienceSubscriptionsResponse;\r\n\r\n        if (previousSubscriptionState) {\r\n            const synthResponses = this.mapToSyntheticAudienceSubscriptionResponses(previousSubscriptionState.audienceSubscriptionModel.audienceSubscriptions, this.AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED, 200);\r\n            result.responses.push(...synthResponses);\r\n        }\r\n\r\n        this.manager.onAudiencesSetResolved(result, correlationVector);\r\n        return result;\r\n    }\r\n\r\n    private buildAudienceSubscriptionsTimeoutResponse(audienceSubscriptionSnapshot: AudienceSubscriptionSnapshot) {\r\n        this.logger.error(\"Audience subscription attempt has timed out.\");\r\n\r\n        return {\r\n            responses: this.mapToSyntheticAudienceSubscriptionResponses(audienceSubscriptionSnapshot.audiences, this.AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT)\r\n        } as IAudienceSubscriptionsResponse;\r\n    }\r\n\r\n    private mapToSyntheticAudienceSubscriptionResponses(audiences: IAudienceSubscription[], synthState: string, synthResponseStatus?: number): IAudienceSubscriptionResponse[] {\r\n        return audiences\r\n            .map(audSub => ({\r\n                audienceId: audSub.id,\r\n                result: {\r\n                    audienceSubscriptionState: synthState,\r\n                    responseStatus: synthResponseStatus\r\n                } as AudienceSubscriptionResult\r\n            } as IAudienceSubscriptionResponse));\r\n    }\r\n\r\n    public expediteBackoff() {\r\n        this.tokenBackoff.expediteIfPending();\r\n    }\r\n\r\n    public sendRegisterRequest() {\r\n        if (!this.options.registration || !this.registrarClient) {\r\n            throw new Error('Internal error - options.registration is undefined');\r\n        }\r\n        if (!this.allocateResult) {\r\n            throw new Error('Allocate result is undefined in sendRegisterRequest()');\r\n        }\r\n\r\n        this.logger.info('sending register request');\r\n        const span = new Timespan();\r\n        this.connectionTracker.trackStart('registration');\r\n        const [registrationTtl,] = this.getRegistrationTtl();\r\n        this.registrarClient.register({\r\n            appId: this.options.registration.pnhAppId,\r\n            aesKey: '',\r\n            languageId: 'en-US',\r\n            platform: this.options.registration.platform,\r\n            templateKey: this.options.registration.pnhTemplateKey,\r\n            platformUIVersion: this.options.registration.platformUIVersion,\r\n            productContext: this.options.registration.productContext\r\n        }, {\r\n            TROUTER: [{\r\n                context: this.options.registration.context,\r\n                path: this.allocateResult.surl,\r\n                ttl: registrationTtl\r\n            }]\r\n        }).then(() => {\r\n            this.logger.info('Register request successful');\r\n            this.connectionTracker.trackEnd('registration');\r\n            this.fsm.onRegistrationSucceeded();\r\n            this.connectionTracker.sendTelemetry(ClientEventName.Registration, {\r\n                duration: span.duration\r\n            }, []);\r\n        }).catch(error => {\r\n            this.logger.error(`Register request failed. Error: ${error}`);\r\n            this.connectionTracker.trackError('registration', errorMessageToString(error));\r\n            this.fsm.onRegistrationFailed();\r\n            this.connectionTracker.sendTelemetry(ClientEventName.Registration, {\r\n                duration: span.duration\r\n            }, []);\r\n        });\r\n    }\r\n\r\n    public sendUnregisterRequest() {\r\n        this.logger.info('sending unregister request');\r\n        const span = new Timespan();\r\n        if (!this.options.registration || !this.registrarClient) {\r\n            throw new Error('Internal error - options.registration is undefined');\r\n        }\r\n\r\n        this.connectionTracker.trackStart('unregistration');\r\n        this.registrarClient.unregister().then(() => {\r\n            this.logger.info('Unregister request successful');\r\n            this.connectionTracker.trackEnd('unregistration');\r\n            this.fsm.onUnregistrationDone();\r\n            this.connectionTracker.sendTelemetry(ClientEventName.Unregistration, {\r\n                duration: span.duration\r\n            }, []);\r\n        }).catch(error => {\r\n            this.logger.error(`Unregister request failed. Error: ${error}`);\r\n            this.connectionTracker.trackError('unregistration', errorMessageToString(error));\r\n\r\n            // The Registrar Client library already does internal retries on 5xx HTTP responses etc.\r\n            // So if we end up here, something more exceptional must have happened. There is little\r\n            // point delaying the stopping further by trying again, just finish as if successful.\r\n            this.fsm.onUnregistrationDone();\r\n\r\n            this.connectionTracker.sendTelemetry(ClientEventName.Unregistration, {\r\n                duration: span.duration\r\n            }, []);\r\n        });\r\n    }\r\n\r\n    public resetTokenBackoff() {\r\n        this.tokenBackoff.reset();\r\n    }\r\n\r\n    public cancelPendingRegistrationRequests() {\r\n        if (this.registrarClient) {\r\n            this.registrarClient.cancelPendingRequests();\r\n        }\r\n    }\r\n\r\n    public clearSentEventTimers() {\r\n        const keys = Object.keys(this.pendingSentEventTimers);\r\n        if (keys.length > 0) {\r\n            this.logger.debug('Clearing all pending downstream events related timers');\r\n            for (const key of keys) {\r\n                this.clearSentEventTimer(<Timeout><unknown>Number(key));\r\n            }\r\n        }\r\n    }\r\n\r\n    public restartIncallModeTimer() {\r\n        this.clearIncallModeTimerId();\r\n        this.logger.debug('Restarting incall mode timer');\r\n        this.incallModeTimerId = setTimeout(() => {\r\n            this.logger.info('Call mode timer fired');\r\n            this.fsm.onIncallModeTimer();\r\n        }, this.options.incallModeTimeoutMs);\r\n    }\r\n\r\n    public enterIncallMode() {\r\n        this.logger.info('Entering incall mode');\r\n        this.timeoutOptions = this.options.incallTimeoutOptions;\r\n        this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs);\r\n        // Uncomment to enable change of timeout in XHR mode - do it once server start to support it\r\n        // if (this.socket) {\r\n        //     this.socket.socket.options.query = this.buildSocketIoUrlParams();\r\n        // }\r\n        this.inIncallMode = true;\r\n    }\r\n\r\n    public exitIncallMode() {\r\n        this.logger.info('Exiting incall mode');\r\n        this.clearIncallModeTimerId();\r\n        this.timeoutOptions = this.options.timeoutOptions;\r\n        this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs);\r\n        // Uncomment to enable change of timeout in XHR mode - do it once server start to support it\r\n        // if (this.socket) {\r\n        //     this.socket.socket.options.query = this.buildSocketIoUrlParams();\r\n        // }\r\n        this.inIncallMode = false;\r\n    }\r\n\r\n    public isIncallMode() {\r\n        return this.inIncallMode;\r\n    }\r\n\r\n    public sendDisconnectTelemetryEvent(reason?: string) {\r\n        const props = <Properties>{ reason: reason, serverClosed: !this.fsm.isActive() };\r\n        this.connectionTracker.trackDisconnected(props);\r\n        this.connectionTracker.clearConnectedInfo();\r\n    }\r\n\r\n    public forceReconnectDueToNoRegistration() {\r\n        this.fsm.forceReconnect('force reconnect due to no registration');\r\n    }\r\n\r\n    private resetReconnectParamsOnErrorThreshold() {\r\n        this.logger.warn(`${this.connectingErrorsInRow} connection attempts, server-side failure: erasing cached connection parameters`);\r\n        this.reconnectParams = undefined;\r\n    }\r\n\r\n    ////////// SocketIO callbacks //////////\r\n    private onSocketConnecting(transportTypeName: string) {\r\n        this.logger.info(`onSocketConnecting(${transportTypeName})`);\r\n        this.transportTypeName = transportTypeName;\r\n        this.connectionTracker.trackProgress('connecting', this.transportTypeName);\r\n        this.fsm.onConnecting();\r\n    }\r\n    private onSocketConnect(token: TokenResult) {\r\n        this.logger.info('onSocketConnect');\r\n        this.fsm.onSocketConnect(token);\r\n    }\r\n    private onSocketConnectFailed(reason: string): void {\r\n        this.logger.error('onSocketConnectFailed');\r\n        this.connectionTracker.trackError(\r\n            'connect_failed', reason, true, this.transportTypeName ? this.transportTypeName : this.UNKNOWN_TRANSPORT);\r\n        this.fsm.onConnectingFailed();\r\n    }\r\n    private onSocketDisconnect(rawReason: string): void {\r\n        const sessionLengthMs = this.connectionTracker.getSessionLength() || 0;\r\n        const reason = DisconnectReason.fromRawReason(rawReason);\r\n\r\n        this.logger.error(`onSocketDisconnect, reason: ${reason.reason}`);\r\n\r\n        if (reason.reason === 'dup' && this.lastDisconnectReason === 'dup' &&\r\n            sessionLengthMs < this.options.duplicateDisconnectThresholdMs) {\r\n            this.logger.warn(\r\n                'Socket was closed by server as Duplicate for the second time in a row ' +\r\n                `after ${sessionLengthMs} ms which is below the threshold of ` +\r\n                `${this.options.duplicateDisconnectThresholdMs} ms. Resetting cached ` +\r\n                'connection parameters and making a new allocation.');\r\n            this.reconnectParams = undefined;\r\n        }\r\n        this.lastDisconnectReason = reason.reason;\r\n\r\n        this.fsm.onSocketDisconnect(reason);\r\n        this.connectionExpireTimestampInSecs = undefined;\r\n    }\r\n\r\n    private onSocketReconnect(): void {\r\n        // this callback should not be called, because reconnect on socket.io is disabled, but\r\n        // leave it here in case error in socket.io\r\n        this.logger.error('onSocketReconnect');\r\n        this.fsm.onTrouterConnected();\r\n    }\r\n    private onSocketReconnectFailed(reason: unknown): void {\r\n        // this callback should not be called, because reconnect on socket.io is disabled, but\r\n        // leave it here in case error in socket.io\r\n        this.logger.error(`onSocketReconnectFailed with '${reason}'`);\r\n        this.fsm.onSocketDisconnect(DisconnectReason.fromSocketIoEventData('reconnecterror', reason));\r\n    }\r\n    private onSocketReconnecting(): void {\r\n        // this callback should not be called, because reconnect on socket.io is disabled, but\r\n        // leave it here in case error in socket.io\r\n        this.logger.error('onSocketReconnecting');\r\n    }\r\n    private onSocketError(errorObject: unknown): void {\r\n        this.logger.error(`onSocketError with '${toJson(errorObject)}'`);\r\n        if (this.fsm.isConnecting()) {\r\n            this.connectingErrorsInRow++;\r\n            if (this.connectingErrorsInRow >= this.connectingErrorsThreshold) {\r\n                this.resetReconnectParamsOnErrorThreshold();\r\n            }\r\n        }\r\n        this.connectionTracker.trackError('connectSocket', safeToStringOrType(errorObject));\r\n        this.fsm.onSocketDisconnect(DisconnectReason.fromSocketIoEventData('socketerror', errorObject));\r\n    }\r\n    private onSocketMessage(requestJson: string): void {\r\n        this.logger.debug('onSocketMessage');\r\n\r\n        let request: TrouterRequest;\r\n        try {\r\n            request = new TrouterRequest(requestJson, this.logger);\r\n            const chainId = request.headers?.['X-Microsoft-Skype-Chain-ID'];\r\n            const chainIdLogText = chainId ? ` Chain-Id ${chainId}` : '';\r\n            this.logger.info(`Received request N ${request.id}${chainIdLogText} CV ${request.correlationVector} to '${request.url}'`);\r\n            request.startTS = Date.now();\r\n\r\n            if (request.url && this.urlPath && request.url.startsWith(this.urlPath)) {\r\n                request.shortUrl = request.url.substring(this.urlPath.length);\r\n            }\r\n        } catch (error) {\r\n            const msg = errorStackToJson(error);\r\n            this.logger.error(`unable to parse request. Error: ${msg}`);\r\n            this.connectionTracker.trackRequest(undefined, msg);\r\n            this.connectionTracker.sendResponseError(`unable to parse request, error: ${error}`);\r\n\r\n            return;\r\n        }\r\n\r\n        request.timeoutTimerId = setTimeout(() => {\r\n            if (request.replied) {\r\n                return;\r\n            }\r\n            this.logger.error(`Request ${request.id} timed out`);\r\n            const responseData = new ResponseData(request.id);\r\n            responseData.status = 504;\r\n            responseData.headers = { 'Trouter-Responder': 'ClientLib' };\r\n            this.sendResponse(request, responseData);\r\n            request.timedout = true;\r\n        }, this.timeoutOptions.requestTimeoutMs);\r\n\r\n        try {\r\n            this.connectionTracker.trackRequest(request);\r\n            this.fsm.onDownstreamRequest(request);\r\n        } catch (error) {\r\n            this.logger.error(`exception in socket.on message. Error: ${errorStackToJson(error)}`);\r\n            this.connectionTracker.sendResponseError(errorMessageToString(error), request, undefined);\r\n        }\r\n    }\r\n    private onTrouterConnected(\r\n        eventArgs: ITrouterConnectedEventArgs | ITrouterConnectedEventArgsV4c,\r\n        userActivitySnapshot?: UserActivitySnapshot,\r\n        audienceSubscriptionSnapshot?: AudienceSubscriptionSnapshot\r\n    ): void {\r\n        if (isV4ConnectEvent(eventArgs)) {\r\n            const v4cArgs = <ITrouterConnectedEventArgsV4c>eventArgs;\r\n            this.allocateResult = { ...v4cArgs, ttl: eventArgs.ttl.toString() };\r\n            this.populateAndCacheReconnectParams(v4cArgs, v4cArgs.reconnectUrl);\r\n            this.populateConnectionStateFields(v4cArgs);\r\n        } else if (!this.allocateResult) {\r\n            this.logger.error('Invalid internal state - received onTrouterConnected while allocateResult is not set');\r\n\r\n            return;\r\n        }\r\n\r\n        this.connectingErrorsInRow = 0;\r\n        this.logger.info(`onTrouterConnected: ${this.allocateResult.url}`);\r\n\r\n        if (this.transportTypeName === 'xhr-polling' && userActivitySnapshot) {\r\n            this.manager.onUserActivityStateAccepted(userActivitySnapshot.cv);\r\n        }\r\n\r\n        // Prevent next 'trouter.connected' responses from other trouter nodes\r\n        // hackish way, since socket.io doesn't have API for that\r\n        if (this.socket?.socket?.options?.query) {\r\n            this.socket.socket.options.query += '&connected=true';\r\n        }\r\n\r\n        // Strip off the first part of the URL, up to the path\r\n        // eslint-disable-next-line no-useless-escape\r\n        this.urlPath = this.allocateResult.url.replace(/https?:\\/\\/([A-z0-9\\:\\$\\-\\_\\.\\+\\!\\*\\\"\\(\\)\\,]*)\\//, '/');\r\n\r\n        const isNewUrl = (this.connectedUrl !== this.allocateResult.url);\r\n        this.connectedUrl = this.allocateResult.url;\r\n        this.connectionExpireTimestampInSecs = calculateExpireTsInSec(ensureNumber(eventArgs.ttl));\r\n\r\n        this.connectionTracker.trackEnd('connectSocket');\r\n        this.connectionTracker.trackConnected(isNewUrl, this.transportTypeName ? this.transportTypeName : this.UNKNOWN_TRANSPORT);\r\n\r\n        this.setAudienceSubscriptionsUnsafeAsync(audienceSubscriptionSnapshot)?.catch(reason => this.logger.error(`Re-subscribe to audiences has failed with ${reason}`));\r\n\r\n        this.fsm.onTrouterConnected();\r\n    }\r\n\r\n    private onTrouterReconnect(eventArgs: ITrouterReconnectEventArgs): void {\r\n        const target = eventArgs.target;\r\n\r\n        this.logger.info(`onTrouterReconnect target: ${target}`);\r\n\r\n        if (target === 'self') {\r\n            this.fsm.onReconnectRequired(true, ReconnectReason.ServerInitiated);\r\n        } else {\r\n            this.fsm.onReconnectRequired(false, ReconnectReason.ServerInitiated, eventArgs);\r\n        }\r\n    }\r\n\r\n    private onTrouterMessageLoss(eventArgs: ITrouterMessageLossEventArgs): void {\r\n        this.logger.debug('onTrouterMessageLoss');\r\n\r\n        // Send only array of tags for further processing\r\n        this.fsm.onTrouterMessageLost(eventArgs.droppedIndicators);\r\n    }\r\n\r\n    private onAudienceSubscriptionResult(eventArgs: IAudienceSubscriptionsResponse): void {\r\n        this.logger.info('onAudienceSubscriptionResult');\r\n\r\n        if (!this.pendingAudienceSubscription) {\r\n            return;\r\n        }\r\n\r\n        clearTimeout(this.pendingAudienceSubscription.timeoutId);\r\n        this.pendingAudienceSubscription.audienceSetResolve(eventArgs);\r\n        this.pendingAudienceSubscription = undefined;\r\n    }\r\n\r\n    ////////// Other functions //////////\r\n\r\n    private buildV4cUrlParams(): string {\r\n        const urlParams: Record<string, string | number> = {};\r\n\r\n        urlParams.tc = encodeURI(toJson(this.clientInfo));\r\n        urlParams.timeout = Math.floor(this.timeoutOptions.pingTimeoutMs / 1000);\r\n\r\n        if (this.options.endpointId) {\r\n            urlParams.epid = this.options.endpointId;\r\n        }\r\n\r\n        return this.appendConnectedClientIds(this.buildQuery(urlParams), true);\r\n    }\r\n\r\n    private attachSocketIoHandlers(socket: ISocketIo, token: TokenResult, userActivitySnapshot?: UserActivitySnapshot, audienceSubscriptionSnapshot?: AudienceSubscriptionSnapshot) {\r\n        socket.on('connecting', (transportTypeName: string) => { this.onSocketConnecting(transportTypeName); });\r\n        socket.on('connect', () => { this.onSocketConnect(token); });\r\n        socket.on('connect_failed', (reason: string) => { this.onSocketConnectFailed(reason); });\r\n        socket.on('close_during_connecting', (reason: string) => { this.onSocketConnectFailed(reason); });\r\n        socket.on('disconnect', (reason: string) => { this.onSocketDisconnect(reason); });\r\n        socket.on('reconnect', () => { this.onSocketReconnect(); });\r\n        socket.on('reconnect_failed', (reason: unknown) => { this.onSocketReconnectFailed(reason); });\r\n        socket.on('reconnecting', () => { this.onSocketReconnecting(); });\r\n        socket.on('error', (error: unknown) => { this.onSocketError(error); });\r\n        socket.on('message', (request: string) => { this.onSocketMessage(request); });\r\n        socket.on('trouter.connected',\r\n            (eventArgs: ITrouterConnectedEventArgs) => { this.onTrouterConnected(eventArgs, userActivitySnapshot, audienceSubscriptionSnapshot); });\r\n        socket.on('trouter.reconnect',\r\n            (eventArgs: ITrouterReconnectEventArgs) => { this.onTrouterReconnect(eventArgs); });\r\n        socket.on('trouter.message_loss',\r\n            (eventArgs: ITrouterMessageLossEventArgs) => { this.onTrouterMessageLoss(eventArgs); });\r\n\r\n        // event valid only for long polling\r\n        // when user subscribes for audience events a query param `audienceSubscriptionState` is added to all long poll GETs \r\n        // if the audience subscription state differs from the one defined on server, it will adjust its state to be identical\r\n        // after audience set opeartion finished server side `audience.subscriptionresult` is fired marking the end of asynchronous operation\r\n        socket.on('audience.subscriptionresult',\r\n            (_: string, eventArgs: IAudienceSubscriptionsResponse) => { this.onAudienceSubscriptionResult(eventArgs); });\r\n    }\r\n\r\n    private onNavigatorOnlineStatusUpdate() {\r\n        const state = window.navigator.onLine;\r\n        this.logger.debug(`Browser online status update - new state: ${state}, previously: ${this.isNavigatorOnline}`);\r\n        if (state && !this.isNavigatorOnline) {\r\n            this.isNavigatorOnline = true;\r\n            this.tokenBackoff.expediteIfPending();\r\n            this.connectionTracker.trackProgress('browserNet', 'online');\r\n        } else if (!state && this.isNavigatorOnline) {\r\n            this.isNavigatorOnline = false;\r\n            this.connectionTracker.trackProgress('browserNet', 'offline');\r\n        }\r\n    }\r\n\r\n    private onAllocationResponse(allocateResult: IAllocateResult, token: TokenResult) {\r\n        this.logger.info(`Received allocation response ${JSON.stringify(allocateResult)}`);\r\n        this.allocateResult = allocateResult;\r\n        this.populateAndCacheReconnectParams(this.allocateResult, `${this.allocateResult.socketio}v4/a`);\r\n        this.populateConnectionStateFields(this.allocateResult);\r\n        this.fsm.onAllocationSucceed(token);\r\n    }\r\n\r\n    private populateAndCacheReconnectParams(args: ITrouterConnectedEventArgsV4c | IAllocateResult, reconnectUrl: string) {\r\n        this.reconnectParams = {\r\n            serviceUrl: this.options.trouterUrl,\r\n            reconnectUrl,\r\n            ...args.connectparams\r\n        };\r\n        this.manager.onConnectionParametersUpdated(this.reconnectParams);\r\n    }\r\n\r\n    private populateConnectionStateFields(args: IAllocateResult | ITrouterConnectedEventArgsV4c) {\r\n        const ttl: number = typeof args.ttl === 'string' ? parseInt(args.ttl, 10) : args.ttl;\r\n        // Don't use allocateResult.connectparams.se here since system clock can be\r\n        // incorrect on client's machine, so using TTL is safer\r\n        this.connectionExpireTimestampInSecs = calculateExpireTsInSec(ttl);\r\n        this.connectionId = args.id ?? '';\r\n\r\n        this.connectedClientId = args.ccid;\r\n        this.logger.debug(`connected client id set {connectedClientId:${this.connectedClientId}}`);\r\n\r\n        this.c2cUrlBase = args.curlb ?? '';\r\n        if (this.c2cUrlBase === '') {\r\n            // Try to just remove the port as a fallback if the service didn't provide anything\r\n            let pos = args.surl.indexOf('://');\r\n            if (pos >= 0) {\r\n                pos = args.surl.indexOf('/', pos + 3);\r\n                if (pos >= 5 && args.surl.substr(pos - 5, 5) === ':3443') {\r\n                    this.c2cUrlBase = args.surl.substr(0, pos - 5);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private onPingResponse() {\r\n        this.logger.debug('onPingResponse');\r\n        this.connectionTracker.increasePingResponseCount();\r\n        this.clearPingResponseTimer();\r\n        this.fsm.onPingResponse();\r\n    }\r\n\r\n    private clearPingResponseTimer() {\r\n        if (this.pingResponseTimerId !== undefined) {\r\n            clearTimeout(this.pingResponseTimerId);\r\n            this.pingResponseTimerId = undefined;\r\n        }\r\n    }\r\n\r\n    private buildQuery(map: Record<string, unknown>): string {\r\n        // TO-DO: Replace this and all other similar functions around with URLSearchParams\r\n        const components: string[] = [];\r\n        for (const i of Object.keys(map)) {\r\n            if (map[i] !== undefined) {\r\n                components.push(`${i}=${map[i]}`);\r\n            }\r\n        }\r\n\r\n        return components.join('&');\r\n    }\r\n\r\n    private appendConnectedClientIds(url: string, isParamsOnly: boolean) {\r\n        let params = '';\r\n        if (!url.includes('ccid=')) {\r\n            params = `ccid=${this.connectedClientId}&`;\r\n        }\r\n        if (this.domId) {\r\n            params += `dom=${this.domId}&`;\r\n        }\r\n        if (params.length > 0) {\r\n            params = params.slice(0, -1);\r\n        }\r\n        const sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\r\n\r\n        return this.appendCorrelationIds(url + sep + params, isParamsOnly);\r\n    }\r\n\r\n    private appendEndpointId(url: string, isParamsOnly: boolean): string {\r\n        const sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\r\n\r\n        return (!url.includes('epid') && this.options.endpointId)\r\n            ? `${url}${sep}epid=${this.options.endpointId}`\r\n            : url;\r\n    }\r\n\r\n    private appendCorrelationIds(url: string, isParamsOnly: boolean): string {\r\n        const sep = (isParamsOnly || url.includes('?')) ? ('&') : ('?');\r\n\r\n        return (!url.includes('cor_id'))\r\n            ? `${url}${sep}cor_id=${this.options.clientCorrelationID}`\r\n            + `&con_num=${this.clientID}_${this.connectionAttempt}`\r\n            : url;\r\n    }\r\n\r\n    private safeString(str: unknown): string {\r\n        return (typeof str === 'string') ? str : '';\r\n    }\r\n\r\n    private sendResponse(request: TrouterRequest, responseData: ResponseData): SendResponseResult {\r\n        if (request.timedout) {\r\n            this.logger.error(`Request ${request.id} already timed out`);\r\n\r\n            return SendResponseResult.Timeout;\r\n        }\r\n        if (request.replied) {\r\n            this.logger.error(`Response for request ${request.id} already sent`);\r\n\r\n            return SendResponseResult.Duplicate;\r\n        }\r\n        clearTimeout(request.timeoutTimerId);\r\n        request.timeoutTimerId = undefined;\r\n        request.replied = true;\r\n\r\n        responseData.headers = responseData.headers ?? {};\r\n\r\n        const cv = request.correlationVector;\r\n        this.logger.info(`Sending response N ${request.id} CV ${cv} with status ${responseData.status}`);\r\n        if (cv) {\r\n            responseData.headers[cvHeader] = cv;\r\n        }\r\n\r\n        // Echo back the incoming \"trouter-request\" header\r\n        if (request.headers?.['trouter-request']) {\r\n            responseData.headers['trouter-request'] = request.headers['trouter-request'];\r\n        }\r\n        // Fill in \"trouter-client\" header\r\n        const latencyMS = Date.now() - request.startTS;\r\n        responseData.headers['trouter-client'] = toJson({\r\n            cd: latencyMS\r\n        });\r\n\r\n        // Echo back \"trouter-is-broadcast\" header\r\n        if (request.headers?.['trouter-is-broadcast']) {\r\n            responseData.headers['trouter-is-broadcast'] = request.headers['trouter-is-broadcast'];\r\n        }\r\n\r\n        this.logger.debug(`response: ${toJson(responseData)}`);\r\n\r\n        if (this.socket) {\r\n            try {\r\n                this.socket.send(toJson(responseData));\r\n                responseData.sentTS = Date.now();\r\n                request.incrementCorrelationVector();\r\n                this.connectionTracker.trackResponse(request, latencyMS, responseData);\r\n                if (this.transportTypeName === 'websocket') {\r\n                    // Send ping request immediately to emulate 'ack' from server, so\r\n                    // client can faster react on network issues\r\n                    this.sendPingRequest();\r\n                }\r\n\r\n                return SendResponseResult.OK;\r\n            } catch (error) {\r\n                const errorMsg = `unable to send data on response.end. Error: ${errorStackToJson(error)}`;\r\n                this.logger.error(errorMsg);\r\n                this.connectionTracker.sendResponseError(errorMsg, request, responseData);\r\n\r\n                return SendResponseResult.Disconnected;\r\n            }\r\n        } else {\r\n            this.connectionTracker.sendResponseError('no socket', request, responseData);\r\n\r\n            return SendResponseResult.Disconnected;\r\n        }\r\n    }\r\n\r\n    /*\r\n        Sends the activity state event to Trouter.\r\n        Has implemented support for sending the current state twice (or multiple times)\r\n        after reconnect, first immediately, and theen the second after configured delay.\r\n\r\n        If after the first sent state event the client app changes the state,\r\n        the new state is sent in the second event after the delay.\r\n        Meanwhile the new state is also sent immediately upon\r\n        the change, but the planned second sending (after delay) is triggered anyway,\r\n        to fulfill it's purpose, which is to prevent server-side race condition.\r\n     */\r\n    private sendUserActivityStateMultiple(remaining: number): void {\r\n        const activityEvent = new DownstreamEvent('user.activity');\r\n        const activityEventObject = this.userActivityState.increaseCvAndGetEventObject();\r\n        activityEvent.args = activityEventObject;\r\n\r\n        this.logger.debug(`Sending user activity '${this.userActivityState.toEventJSON()}', remaining ${remaining - 1}`);\r\n        let timeoutReached = false;\r\n        this.sendDownstreamEvent(activityEvent, () => {\r\n            if (timeoutReached === true) {\r\n                return;\r\n            }\r\n            this.logger.info(`User activity state: ${activityEventObject.state}, cv: ${activityEventObject.cv} accepted`);\r\n            this.manager.onUserActivityStateAccepted(activityEventObject.cv);\r\n            this.clearSentEventTimer(activityEvent.timeoutTimerId);\r\n            if (remaining > 1) {\r\n                const timerId = setTimeout(() => {\r\n                    this.clearSentEventTimer(timerId);\r\n                    this.sendUserActivityStateMultiple(remaining - 1);\r\n                }, this.options.userActivitySecondResendDelayMs);\r\n                this.registerSentEventTimer(timerId, 'user.activity/resend');\r\n            }\r\n        });\r\n\r\n        activityEvent.timeoutTimerId = setTimeout(() => {\r\n            this.logger.error('Activity state response timeout is fired');\r\n            timeoutReached = true;\r\n            this.fsm.onActivityStateResponseTimeout();\r\n            this.clearSentEventTimer(activityEvent.timeoutTimerId);\r\n        }, this.timeoutOptions.userActivityResponseTimeoutMs);\r\n        this.registerSentEventTimer(activityEvent.timeoutTimerId, 'user.activity/response');\r\n    }\r\n\r\n    private sendDownstreamEvent(event: DownstreamEvent, responseCallback: (name: string, args?: unknown) => void) {\r\n        this.logger.debug(`Sending downstream event ${event.name}`);\r\n\r\n        if (this.socket) {\r\n            this.socket.emit(event.name, event.args, responseCallback);\r\n        }\r\n    }\r\n\r\n    private registerSentEventTimer(timerId: Timeout, timerDescription: string): void {\r\n        this.logger.debug(`registering timer ${timerId} -> ${timerDescription}`);\r\n        this.pendingSentEventTimers[<number><unknown>timerId] = timerDescription;\r\n    }\r\n\r\n    private clearSentEventTimer(id: Timeout): void {\r\n        const timerDescription: string = this.pendingSentEventTimers[<number><unknown>id];\r\n        this.logger.debug(`clearing timer ${id} -> ${timerDescription}`);\r\n        delete this.pendingSentEventTimers[<number><unknown>id];\r\n        clearTimeout(id);\r\n    }\r\n\r\n    /**\r\n     * Calculate registration interval. Result is based on configuration parameters\r\n     * and allocation ttl value from trouter server.\r\n     * Returns true only if the registration ttl is present and is smaller than known `allocationTtl`.\r\n     * This means we'll need to re-register to keep the registration alive for the duration of the allocation.\r\n     */\r\n    private getRegistrationTtl(): [number, boolean] {\r\n        const allocationTtl = calculateTtlInSec(this.connectionExpireTimestampInSecs);\r\n        this.logger.debug(`Current connectionID will expire in ${allocationTtl} seconds`);\r\n\r\n        if (this.options.registration?.registrarTtlSec && allocationTtl > 0) {\r\n            const isLower: boolean = this.options.registration.registrarTtlSec < allocationTtl;\r\n\r\n            return [Math.min(this.options.registration.registrarTtlSec, allocationTtl), isLower];\r\n        } else if (this.options.registration?.registrarTtlSec) {\r\n            return [this.options.registration.registrarTtlSec, false];\r\n        } else if (allocationTtl > 0) {\r\n            return [allocationTtl, false];\r\n        }\r\n\r\n        return [DEFAULT_REGISTRATION_TIMEOUT_SEC, false];\r\n    }\r\n\r\n    private clearIncallModeTimerId() {\r\n        if (this.incallModeTimerId !== undefined) {\r\n            this.logger.debug('Clearing in-call mode timer');\r\n            clearTimeout(this.incallModeTimerId);\r\n            this.incallModeTimerId = undefined;\r\n        }\r\n    }\r\n\r\n    private applyConnectionTrackerOptions(options: ITrouterOptions) {\r\n        try {\r\n            const eventLoggerSent = (options.eventLogger && typeof options.eventLogger.logEvent === 'function');\r\n            if (!eventLoggerSent) {\r\n                this.logger.warn('Trouter client event logging disabled due to invalid configuration.');\r\n            } else {\r\n                this.connectionTracker.mergeSettings(options.telemetrySettings);\r\n                this.connectionTracker.enable(options.eventLogger);\r\n            }\r\n        } catch (error) {\r\n            this.logger.warn(`Trouter client event logging disabled. Error: ${errorStackToJson(error)}`);\r\n            this.connectionTracker.disable();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns boolean indicating if we can retry token fetch\r\n     * based on value of optional configuration 'retryLimitOnTokenFetch'\r\n     * @returns boolean\r\n     */\r\n    private canRetryTokenFetchRequest(currentCounter: number) {\r\n        const retryLimit = this.options.retryLimitOnTokenFetch;\r\n\r\n        if (retryLimit === null || retryLimit === undefined) {\r\n\r\n            return true;\r\n        }\r\n\r\n        if (currentCounter < retryLimit) {\r\n\r\n            return true;\r\n        }\r\n\r\n        this.logger.warn(\r\n            `Reached limit on maximum number of token fetch request. Current count: ${currentCounter}, retry limit: ${retryLimit}`\r\n        );\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction headersFromToken(token: TokenResult, usingLegacyTokenApi: boolean): Record<string, string> {\r\n    const migrationHeader = usingLegacyTokenApi ? undefined : { 'X-MS-Migration': 'True' };\r\n    switch (token.tokenType.toLowerCase()) {\r\n        case 'skype':\r\n            return { 'X-Skypetoken': token.token, ...migrationHeader };\r\n\r\n        case 'aad':\r\n        case 'cae':\r\n            return { Authorization: `Bearer ${token.token}`, ...migrationHeader };\r\n\r\n        default:\r\n            throw new Error(`unsupported token type: ${token.tokenType}`);\r\n    }\r\n}\r\n\r\nfunction safeToStringOrType(value: unknown): string {\r\n    if (value !== undefined && value !== null && typeof value.toString === 'function') {\r\n        return value.toString();\r\n    }\r\n    return `[${typeof value}]`;\r\n}\r\n\r\nfunction errorStackToJson(error: unknown): string {\r\n    if (typeof error === 'object' && error !== null && (<Record<string, unknown>>error).stack !== undefined) {\r\n        // Keeping this as it was for now, but `error.stack` is usually just a string anyway.\r\n        // I guess it also converts newlines to '\\n', which some part may need? Or it's completely unnecessary?\r\n        return toJson((<Record<string, unknown>>error).stack);\r\n    }\r\n    return '\"(no error.stack)\"';\r\n}\r\n\r\nfunction errorMessageToString(error: unknown): string {\r\n    if (typeof error === 'object' && error !== null && typeof (<Record<string, unknown>>error).message === 'string') {\r\n        return (<Record<string, string>>error).message;\r\n    }\r\n    return '(no error.message)';\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TrouterConnection.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { HANDLED_MESSAGE_ACK, UNHANDLED_MESSAGE_ACK } from './Constants';\r\nimport { HandleMessageResult, LogProvider, MessageHandler, TrouterMessage } from './Interfaces';\r\nimport { Logger } from './Logger';\r\n\r\n/**\r\n * Registry of message handlers.\r\n * Safely executes individual handlers and aggregates results\r\n */\r\nexport class MessageHandlerRegistry {\r\n    private messageHandlers: MessageHandler[] = [];\r\n    private logger: Logger;\r\n\r\n    public constructor(logProvider: LogProvider) {\r\n        this.logger = new Logger(\"MessageHandlers\", logProvider);\r\n    }\r\n\r\n    public register(handler: MessageHandler) {\r\n        if (this.messageHandlers.some(item => item === handler)) {\r\n            throw new Error('Registering the same handler twice is not allowed');\r\n        }\r\n        this.messageHandlers.push(handler);\r\n    }\r\n\r\n    public clear() {\r\n        this.logger.debug('Clearing message handlers');\r\n        this.messageHandlers = [];\r\n    }\r\n\r\n    public active(): boolean {\r\n        return (this.messageHandlers.length > 0);\r\n    }\r\n\r\n    public handleMessage(message: TrouterMessage): HandleMessageResult {\r\n        const unhandledMessageResult = {\r\n            resultCode: UNHANDLED_MESSAGE_ACK,\r\n            isHandled: false\r\n        };\r\n\r\n        for (const messageHandler of this.messageHandlers) {\r\n            const result = this.safeExecuteHandle(messageHandler, message);\r\n            if (result !== undefined && (result.isHandled === undefined || result.isHandled)) {\r\n                if (result.resultCode === undefined) {\r\n                    result.resultCode = HANDLED_MESSAGE_ACK;\r\n                }\r\n\r\n                return result;\r\n            }\r\n        }\r\n\r\n        return unhandledMessageResult;\r\n    }\r\n\r\n    private safeExecuteHandle(handler: MessageHandler, message: TrouterMessage): HandleMessageResult | undefined {\r\n        try {\r\n            return handler.handleMessage(message);\r\n        } catch (exception) {\r\n            this.logger.warn(`Trouter message handler threw an exception: ${exception}`);\r\n\r\n            return undefined;\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/MessageHandler.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { SkypeTokenProvider } from './Interfaces';\r\n\r\nexport function addCacheAsBackupTo(provider: SkypeTokenProvider): SkypeTokenProvider {\r\n    let cachedToken: string | undefined;\r\n\r\n    return async (forceRefresh: boolean): Promise<string> => {\r\n        if (forceRefresh) {\r\n            cachedToken = undefined;\r\n        }\r\n\r\n        return new Promise<string>((resolve, reject) => {\r\n            provider(forceRefresh).then((token: string) => {\r\n                cachedToken = token;\r\n                resolve(token);\r\n            }).catch((error) => {\r\n                if (cachedToken !== undefined && cachedToken.length > 0) {\r\n                    resolve(cachedToken);\r\n                }\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/SkypeTokenProviderWithCache.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { CorrelationVector, toJson } from './Common';\r\nimport {\r\n    AuthTokenProvider,\r\n    ConnectionInfo, Listener, LogProvider, Request, Response, SendResponseResult, TokenType, TrouterState,\r\n    UserActivityState,\r\n    IAudienceSubscriptionModel, IAudienceSubscriptionsResponse, IAudienceSubscription\r\n} from './Interfaces';\r\nimport { IMessageLossIndicator, ITrouterOptions, ITrouterRequest, ITrouterResponse, ServerState, TrouterManagerState } from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\nimport { usedProtocol } from './ProtocolAdapters';\r\nimport { RegistrationEnforcer } from './RegistrationEnforcer';\r\nimport { IManagerConsumer, IReconnectParameters, ReconnectReason, TrouterConnection } from './TrouterConnection';\r\nimport { State } from './TrouterFsm';\r\nimport { IManagerWorker, TrouterManagerFsm } from './TrouterManagerFsm';\r\n\r\n/**\r\n * Type alias for {@link UserActivityObject.toEventObject()}\r\n */\r\nexport type UserActivitySnapshot = { state: string, cv: string };\r\n\r\n/**\r\n * Type alias for {@link AudienceSubscriptionState.increaseCvAndGetEventObject()}\r\n */\r\nexport type AudienceSubscriptionSnapshot = { audiences: IAudienceSubscription[], cv: string }\r\n\r\n/**\r\n * UserActivity object\r\n */\r\nexport class UserActivityObject {\r\n    public readonly correlationVector: CorrelationVector;\r\n\r\n    constructor(readonly state: UserActivityState, correlationVector?: CorrelationVector) {\r\n        this.correlationVector = correlationVector !== undefined ? correlationVector : CorrelationVector.extend();\r\n    }\r\n\r\n    public getStateString() {\r\n        switch (this.state) {\r\n            case UserActivityState.Active:\r\n                return 'active';\r\n            case UserActivityState.Inactive:\r\n                return 'inactive';\r\n            case UserActivityState.Unknown:\r\n                return 'unknown';\r\n            default:\r\n                return 'undefined';\r\n        }\r\n    }\r\n\r\n    public increaseCvAndGetEventObject() {\r\n        this.correlationVector.increase();\r\n\r\n        return this.toEventObject();\r\n    }\r\n\r\n    public toEventObject() {\r\n        return { state: this.getStateString(), cv: this.correlationVector.value() };\r\n    }\r\n\r\n    public toEventJSON() {\r\n        return toJson(this.toEventObject());\r\n    }\r\n}\r\n\r\nexport class AudienceSubscriptionState {\r\n    constructor(\r\n        readonly audienceSubscriptionModel: IAudienceSubscriptionModel,\r\n        readonly correlationVector: CorrelationVector = CorrelationVector.extend()) {\r\n    }\r\n\r\n    public increaseCvAndGetEventObject(): AudienceSubscriptionSnapshot {\r\n        this.correlationVector.increase();\r\n\r\n        return this.toEventObject();\r\n    }\r\n\r\n    public toEventObject(): AudienceSubscriptionSnapshot {\r\n        return { audiences: this.audienceSubscriptionModel.audienceSubscriptions, cv: this.correlationVector.value() };\r\n    }\r\n\r\n    public toEventJSON() {\r\n        return toJson(this.toEventObject());\r\n    }\r\n}\r\n\r\n/**\r\n * Trouter implementation\r\n */\r\nexport class TrouterManager implements IManagerWorker, IManagerConsumer {\r\n    private logger: Logger;\r\n    private fsm: TrouterManagerFsm;\r\n    private firstConnection?: TrouterConnection;\r\n    private secondConnection?: TrouterConnection;\r\n    /** Value of first connection before stop() - to dispatch onDisconnected() of first connection */\r\n    private storedFirstConnection?: TrouterConnection;\r\n    private baseEndpointUrl: string;\r\n    private connectionCache?: Record<string, unknown>;\r\n    private lastExpediteBackoffCallAt?: number;\r\n\r\n    /** Cache for processed message loss to catch duplicates and to not pass them to the listeners */\r\n    private processedMessageLoss: { [flowTag: string]: '' };\r\n    private userActivityObject: UserActivityObject;\r\n    private audienceSubscriptionState: AudienceSubscriptionState | undefined;\r\n\r\n    private readonly protocolSelector: typeof usedProtocol;\r\n\r\n    public constructor(\r\n        private logFunc: LogProvider,\r\n        private options: ITrouterOptions,\r\n        private tokenProvider: AuthTokenProvider,\r\n        private usingLegacyTokenApi: boolean,\r\n        private listener: Listener,\r\n        protocolSelector?: typeof usedProtocol\r\n    ) {\r\n        this.logger = new Logger('Manager', logFunc);\r\n        this.logger.info(`Created TrouterManager with options ${toJson(this.options)}`);\r\n        this.fsm = new TrouterManagerFsm(logFunc, this);\r\n        this.baseEndpointUrl = '';\r\n        this.processedMessageLoss = {};\r\n        this.userActivityObject = new UserActivityObject(UserActivityState.Unknown);\r\n        this.protocolSelector = protocolSelector ?? this.tokenTypeProtocolSelector.bind(this);\r\n    }\r\n\r\n    public start() {\r\n        this.fsm.start();\r\n    }\r\n\r\n    public stop(dontUnregister?: boolean) {\r\n        this.fsm.stop(dontUnregister);\r\n    }\r\n\r\n    public configure(options: ITrouterOptions) {\r\n        this.options = options;\r\n        if (this.firstConnection !== undefined) {\r\n            this.firstConnection.configure(options);\r\n        }\r\n\r\n        if (this.secondConnection !== undefined) {\r\n            this.secondConnection.configure(options);\r\n        }\r\n        this.logger.info(`Reconfigured TrouterManager with options ${toJson(this.options)}`);\r\n    }\r\n\r\n    public checkConnection(disconnectDetected: boolean) {\r\n        if (this.firstConnection !== undefined) {\r\n            this.firstConnection.checkConnection(disconnectDetected);\r\n        }\r\n\r\n        if (this.secondConnection !== undefined) {\r\n            this.secondConnection.checkConnection(disconnectDetected);\r\n        }\r\n    }\r\n\r\n    public async resendRegistration(): Promise<void> {\r\n        if (this.secondConnection !== undefined) {\r\n            this.logger.info('Resending registration on the second/new connection');\r\n\r\n            return this.secondConnection.resendRegistration();\r\n        }\r\n\r\n        if (this.firstConnection !== undefined) {\r\n            this.logger.info('Resending registration on the first/current connection');\r\n\r\n            return this.firstConnection.resendRegistration();\r\n        }\r\n\r\n        this.logger.info('No connection to resend registration on, will be done upon (re)connect');\r\n    }\r\n\r\n    public getServerState(): ServerState | undefined {\r\n        if (this.firstConnection !== undefined) {\r\n            return this.firstConnection.getServerState();\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    /** Returns current state */\r\n    public getState(): TrouterState {\r\n        return this.fsm.getState();\r\n    }\r\n\r\n    public isInTerminalState(): boolean {\r\n        return this.fsm.getInternalState() === TrouterManagerState.TerminalError;\r\n    }\r\n\r\n    public reportStateInfo(): string {\r\n        const firstState = this.firstConnection ? State[this.firstConnection.getState()] : \"Unknown\";\r\n        const managerState = TrouterManagerState[this.fsm.getInternalState()];\r\n        if (this.secondConnection) {\r\n            const secondState = State[this.secondConnection.getState()];\r\n            return `Manager ${managerState}; 1st ${firstState}; 2nd ${secondState}`;\r\n        }\r\n        return `Manager ${managerState}; Connection ${firstState}`;\r\n    }\r\n\r\n    //////////// IManagerWorker ////////////\r\n    public startFirstConnection() {\r\n        const connection = new TrouterConnection(\r\n            this.logFunc,\r\n            this.options,\r\n            this.configuredTrouterManager(),\r\n            this.tokenProvider,\r\n            this.usingLegacyTokenApi,\r\n            this.userActivityObject,\r\n            this.protocolSelector,\r\n            this.audienceSubscriptionState);\r\n        this.firstConnection = connection;\r\n\r\n        this.getConnectionCache()\r\n            .then(connectionCache => {\r\n                connection.start(connectionCache);\r\n            })\r\n            // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n            .catch(() => { });\r\n    }\r\n\r\n    public startSecondConnection(useConnectParamsFromCache: boolean) {\r\n        const connection = new TrouterConnection(\r\n            this.logFunc,\r\n            this.options,\r\n            this.configuredTrouterManager(),\r\n            this.tokenProvider,\r\n            this.usingLegacyTokenApi,\r\n            this.userActivityObject,\r\n            this.protocolSelector,\r\n            this.audienceSubscriptionState);\r\n        this.secondConnection = connection;\r\n        if (this.firstConnection !== undefined) {\r\n            this.firstConnection.disableRegistrationsAndAutoReconnect();\r\n        }\r\n\r\n        if (useConnectParamsFromCache) {\r\n            this.getConnectionCache()\r\n                .then(connectionCache => {\r\n                    connection.start(connectionCache);\r\n                })\r\n                // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n                .catch(() => { });\r\n        } else {\r\n            connection.start();\r\n        }\r\n    }\r\n\r\n    public stopFirstConnection(dontUnregister: boolean) {\r\n        if (this.firstConnection !== undefined) {\r\n            // Store first connection to be able to compare in onDisconnected() handler\r\n            this.storedFirstConnection = this.firstConnection;\r\n            this.firstConnection.stop(dontUnregister);\r\n            this.firstConnection = undefined;\r\n        }\r\n    }\r\n\r\n    public stopSecondConnection(dontUnregister: boolean) {\r\n        if (this.secondConnection !== undefined) {\r\n            this.secondConnection.stop(dontUnregister);\r\n            this.secondConnection = undefined;\r\n        }\r\n    }\r\n\r\n    public stopSecondConnectionDelayed() {\r\n        if (this.secondConnection !== undefined) {\r\n            const connection = this.secondConnection;\r\n            this.secondConnection = undefined;\r\n            this.logger.info(`Closing an inactive connection in ${Math.round(this.options.lingeringConnectionDelayMs / 1000)}s`);\r\n            setTimeout(() => {\r\n                connection.stop(true);\r\n            }, this.options.lingeringConnectionDelayMs);\r\n        }\r\n    }\r\n\r\n    public forceStopLingeringConnection() {\r\n        if (this.storedFirstConnection) {\r\n            this.storedFirstConnection.stop(false);\r\n            this.storedFirstConnection = undefined;\r\n        }\r\n    }\r\n\r\n    public switchConnections() {\r\n        const tmp = this.firstConnection;\r\n        this.firstConnection = this.secondConnection;\r\n        this.secondConnection = tmp;\r\n    }\r\n\r\n    public doesSecondConnectionExist(): boolean {\r\n        return this.secondConnection !== undefined;\r\n    }\r\n\r\n    public dispatchConnected() {\r\n        if (this.firstConnection !== undefined) {\r\n            const ss = this.firstConnection.getServerState();\r\n            const baseEndpointUrl = (ss.url.endsWith('/')) ? ss.url.slice(0, -1) : ss.url;\r\n            const connectionInfo: ConnectionInfo = {\r\n                baseEndpointUrl: baseEndpointUrl,\r\n                newEndpointUrl: (baseEndpointUrl !== this.baseEndpointUrl),\r\n                c2cUrlBase: ss.c2cUrlBase,\r\n                clientId: ss.connectedClientId,\r\n                connectionId: ss.connectionId,\r\n                connectionTtlSec: ss.getRemainingTtlInSec()\r\n            };\r\n            this.baseEndpointUrl = baseEndpointUrl;\r\n            this.listener.onTrouterConnected(ss.url, connectionInfo);\r\n        }\r\n    }\r\n\r\n    public dispatchDisconnected() {\r\n        if (this.listener.onTrouterDisconnected) {\r\n            this.listener.onTrouterDisconnected();\r\n        }\r\n    }\r\n\r\n    public dispatchTerminalError() {\r\n        // Emit a disconnected event to listeners too.\r\n        if (this.listener.onTrouterDisconnected) {\r\n            this.listener.onTrouterDisconnected();\r\n        }\r\n    }\r\n\r\n    public dispatchRegistrationState(isRegistered: boolean) {\r\n        if (this.options.registrationStateCallback) {\r\n            this.options.registrationStateCallback(isRegistered);\r\n        }\r\n    }\r\n\r\n    public expediteBackoffOnConnections() {\r\n        if (this.lastExpediteBackoffCallAt !== undefined && Date.now() - this.lastExpediteBackoffCallAt < (this.options.expediteBackoffOnStartMinimumDelayMs ?? 10000)) {\r\n            this.logger.info('Expedite backoff due to start() too frequent, skipping');\r\n            return;\r\n        }\r\n\r\n        this.lastExpediteBackoffCallAt = Date.now();\r\n\r\n        if (this.firstConnection !== undefined) {\r\n            this.firstConnection.expediteBackoff();\r\n        }\r\n\r\n        if (this.secondConnection !== undefined) {\r\n            this.secondConnection.expediteBackoff();\r\n        }\r\n    }\r\n\r\n    //////////// IManagerConsumer ////////////\r\n    public onDownstreamRequest(connection: TrouterConnection, request: ITrouterRequest, response: ITrouterResponse) {\r\n        const req: Request = {\r\n            id: request.id,\r\n            method: request.method,\r\n            path: `/${request.shortUrl}`,\r\n            body: request.body,\r\n            headers: request.headers\r\n        };\r\n        const rsp: Response = {\r\n            id: request.id,\r\n            status: 0,\r\n            headers: {},\r\n            body: '',\r\n            send: () => {\r\n                if (rsp.status <= 100 || rsp.status >= 999) {\r\n\r\n                    return SendResponseResult.Incomplete;\r\n                }\r\n                response.writeHead(rsp.status, rsp.headers);\r\n\r\n                return response.end(rsp.body);\r\n            }\r\n        };\r\n        this.listener.onTrouterRequest(req, rsp);\r\n    }\r\n\r\n    public onConnected(connection: TrouterConnection) {\r\n        this.fsm.onConnected(connection === this.firstConnection);\r\n    }\r\n\r\n    public onRegistered(connection: TrouterConnection) {\r\n        this.fsm.onRegistered(connection === this.firstConnection);\r\n    }\r\n\r\n    public onUnregistered(connection: TrouterConnection) {\r\n        this.fsm.onUnregistered(connection === this.firstConnection || connection === this.storedFirstConnection);\r\n    }\r\n\r\n    public onReconnecting(connection: TrouterConnection) {\r\n        this.fsm.onReconnecting(connection === this.firstConnection);\r\n    }\r\n\r\n    public onReconnectIsRequired(connection: TrouterConnection, useConnectParamsFromCache: boolean, reason: ReconnectReason) {\r\n        this.fsm.onReconnectionRequired(connection === this.firstConnection, useConnectParamsFromCache, reason);\r\n    }\r\n\r\n    public onDisconnected(connection: TrouterConnection) {\r\n        this.fsm.onDisconnected(connection === this.firstConnection || connection == this.storedFirstConnection);\r\n        this.storedFirstConnection = undefined;\r\n    }\r\n\r\n    public onTerminalError() {\r\n        // TODO: the argument passed to onTerminalError is just ignored\r\n        // this.fsm.onTerminalError(connection === this.firstConnection || connection == this.storedFirstConnection);\r\n        this.fsm.onTerminalError();\r\n        this.storedFirstConnection = undefined;\r\n    }\r\n\r\n    public onUserActivityStateAccepted(cv: string) {\r\n        if (this.listener.onTrouterUserActivityStateAccepted) {\r\n            this.listener.onTrouterUserActivityStateAccepted(cv);\r\n        }\r\n    }\r\n\r\n    onAudiencesSetResolved(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void {\r\n        this.listener.onAudiencesSetResolved?.(audienceSubscriptionsResponse, cv);\r\n    }\r\n\r\n    public onConnectionParametersUpdated(connectionParameters: Record<string, unknown>) {\r\n        this.setConnectionCache(connectionParameters);\r\n    }\r\n\r\n    public setUserActivityState(state: UserActivityState, correlationVector?: string): void {\r\n        this.userActivityObject = new UserActivityObject(state, CorrelationVector.extend(correlationVector));\r\n        if (this.secondConnection !== undefined) {\r\n            this.logger.info(`Setting user activity ${this.userActivityObject.toEventJSON()} on the second/new connection`);\r\n            this.secondConnection.setUserActivityState(this.userActivityObject);\r\n\r\n            return;\r\n        }\r\n\r\n        if (this.firstConnection !== undefined) {\r\n            this.logger.info(`Setting user activity ${this.userActivityObject.toEventJSON()} on the first/current connection`);\r\n            this.firstConnection.setUserActivityState(this.userActivityObject);\r\n\r\n            return;\r\n        }\r\n    }\r\n\r\n    public setAudienceSubscriptionsAsync(audienceSubscriptionModel: IAudienceSubscriptionModel, timeoutInMs: number, correlationVector?: string): Promise<IAudienceSubscriptionsResponse> {\r\n        this.audienceSubscriptionState = new AudienceSubscriptionState(audienceSubscriptionModel, CorrelationVector.extend(correlationVector));\r\n\r\n        if (this.secondConnection) {\r\n            this.logger.info(`Setting audience subscriptions ${this.audienceSubscriptionState.toEventJSON()} on second/new connection`);\r\n\r\n            return this.secondConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState, timeoutInMs);\r\n        }\r\n\r\n        if (this.firstConnection) {\r\n            this.logger.info(`Setting audience subscriptions ${this.audienceSubscriptionState.toEventJSON()} on first/current connection`);\r\n\r\n            return this.firstConnection.setAudienceSubscriptionsAsync(this.audienceSubscriptionState, timeoutInMs);\r\n        }\r\n\r\n        throw new Error('No connection found');\r\n    }\r\n\r\n    public onTrouterMessageLost(indicators: IMessageLossIndicator[]) {\r\n        if (this.listener.onTrouterMessageLoss) {\r\n            if (indicators?.length) {\r\n                // Filter out already seen dropped indicators and inform server that they are processed\r\n                const duplicates = indicators.filter(di => this.processedMessageLoss[`${di.tag}-${di.etag}`] !== undefined);\r\n                if (duplicates.length) {\r\n                    this.logger.info(`onTrouterMessageLoss - immediately acknowledging ${duplicates.length} seen dropped indicators`);\r\n                    this.sendProcessedDroppedIndicators(duplicates);\r\n                    indicators = indicators.filter(di => this.processedMessageLoss[`${di.tag}-${di.etag}`] === undefined);\r\n\r\n                    if (!indicators.length) {\r\n                        this.logger.info('onTrouterMessageLoss - all declared dropped indicators have been seen before');\r\n\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // Send the data to the listeners\r\n                const messageLossProcessed = this.listener.onTrouterMessageLoss(indicators.map(di => di.tag));\r\n                if (!messageLossProcessed) {\r\n                    this.logger.warn('onTrouterMessageLoss - some flow tag(s) have not been processed by listeners');\r\n\r\n                    return;\r\n                }\r\n\r\n                // Update the cache\r\n                indicators.forEach(di => {\r\n                    this.processedMessageLoss[`${di.tag}-${di.etag}`] = '';\r\n                });\r\n                this.sendProcessedDroppedIndicators(indicators);\r\n            } else {\r\n                this.logger.warn('onTrouterMessageLoss - no flow tags have been provided');\r\n            }\r\n        }\r\n    }\r\n\r\n    private getConnectionCache(): Promise<IReconnectParameters | undefined> {\r\n        if (!this.options.connectionCache) {\r\n\r\n            return Promise.resolve(this.connectionCache);\r\n        }\r\n\r\n        this.logger.debug('Querying host\\'s connection cache');\r\n\r\n        return this.options.connectionCache.onGetTrouterConnectionCache()\r\n            .then((serialized) => {\r\n\r\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n                const parsed = serialized ? JSON.parse(serialized) : undefined;\r\n                return typeof parsed === 'object' ? <Record<string, unknown>>parsed : undefined;\r\n            })\r\n            .catch((e) => {\r\n                this.logger.warn(`Invalid connection cache content provided: ${e}`);\r\n\r\n                return this.connectionCache;\r\n            });\r\n    }\r\n\r\n    private setConnectionCache(content: Record<string, unknown>) {\r\n        this.connectionCache = content;\r\n        if (this.options.connectionCache) {\r\n            try {\r\n                this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(content));\r\n            } catch (e) {\r\n                this.logger.warn(`Error setting external connection cache: ${e}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    private sendProcessedDroppedIndicators(messageLossIndicators: IMessageLossIndicator[]) {\r\n        if (this.firstConnection !== undefined) {\r\n            this.firstConnection.sendProcessedDroppedIndicators(messageLossIndicators);\r\n\r\n            return;\r\n        }\r\n\r\n        if (this.secondConnection !== undefined) {\r\n            this.secondConnection.sendProcessedDroppedIndicators(messageLossIndicators);\r\n\r\n            return;\r\n        }\r\n    }\r\n\r\n    private configuredTrouterManager(): IManagerConsumer {\r\n        return new RegistrationEnforcer(\r\n            this,\r\n            this.options.connectionDependsOnRegistration,\r\n            this.options.delayEventsUntilRegistered\r\n        );\r\n    }\r\n\r\n    private tokenTypeProtocolSelector = (tokenType: TokenType, reconnectParams: IReconnectParameters | undefined) =>\r\n        this.options.forceV4aProtocol ? 'v4a' : usedProtocol(tokenType, reconnectParams);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TrouterManager.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { LogProvider } from './Interfaces';\r\nimport { Logger } from './Logger';\r\n\r\n/**\r\n * Util that encapsulates lifecycle of active trouter URL and manages waiter for the URL via promise\r\n */\r\nexport class TrouterUrlPromise {\r\n    private url?: string;\r\n    private pendingPromise?: Promise<string>;\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    private pendingPromiseResolveRef?: Function;\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    private pendingPromiseRejectRef?: Function;\r\n    private logger: Logger;\r\n\r\n    public constructor(logProvider: LogProvider) {\r\n        this.logger = new Logger('UrlPromise', logProvider);\r\n    }\r\n\r\n    public getPromise(): Promise<string> {\r\n        if (this.url !== undefined) {\r\n            this.logger.debug(`returning previously resolved url: ${this.url}`);\r\n\r\n            return Promise.resolve(this.url);\r\n        }\r\n\r\n        if (this.pendingPromise === undefined) {\r\n            this.logger.debug('creating and returning promise');\r\n            this.pendingPromise = new Promise<string>((resolve, reject) => {\r\n                this.pendingPromiseResolveRef = resolve;\r\n                this.pendingPromiseRejectRef = reject;\r\n            });\r\n        } else {\r\n            this.logger.debug('returning existing promise');\r\n        }\r\n\r\n        return this.pendingPromise;\r\n    }\r\n\r\n    public resolveUrl(url: string) {\r\n        this.url = url;\r\n        this.logger.debug(`got url: ${this.url}`);\r\n\r\n        const resolveCallback = this.pendingPromiseResolveRef;\r\n        this.pendingPromise = undefined;\r\n        this.pendingPromiseResolveRef = undefined;\r\n        this.pendingPromiseRejectRef = undefined;\r\n\r\n        if (resolveCallback !== undefined) {\r\n            this.logger.debug('resolving promise');\r\n            resolveCallback(url);\r\n        }\r\n    }\r\n\r\n    public rejectUrl(error: Error) {\r\n        this.logger.debug('aborting');\r\n        const rejectCallback = this.pendingPromiseRejectRef;\r\n        this.url = undefined;\r\n        this.pendingPromise = undefined;\r\n        this.pendingPromiseResolveRef = undefined;\r\n        this.pendingPromiseRejectRef = undefined;\r\n\r\n        if (rejectCallback !== undefined) {\r\n            this.logger.debug('rejecting promise');\r\n            rejectCallback(error);\r\n        }\r\n    }\r\n\r\n    public resetUrl() {\r\n        this.logger.debug('resetting url');\r\n        this.url = undefined;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TrouterUrlPromise.ts","/** Socket.IO.js build:0.9.6, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, global) {\r\n\r\n  /**\r\n   * IO namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var io = exports;\r\n\r\n  /**\r\n   * Socket.IO version\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.version = '0.9.6';\r\n\r\n  /**\r\n   * Protocol implemented.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.protocol = 1;\r\n\r\n  /**\r\n   * Available transports, these will be populated with the available transports\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  io.transports = [];\r\n\r\n  /**\r\n   * Keep track of jsonp callbacks.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.j = [];\r\n\r\n  /**\r\n   * Keep track of our io.Sockets\r\n   *\r\n   * @api private\r\n   */\r\n  io.sockets = {};\r\n\r\n\r\n  /**\r\n   * Manages connections to hosts.\r\n   *\r\n   * @param {String} uri\r\n   * @Param {Boolean} force creation of new socket (defaults to false)\r\n   * @api public\r\n   */\r\n\r\n  io.connect = function (host, details) {\r\n    var uri = io.util.parseUri(host)\r\n      , uuri\r\n      , socket;\r\n\r\n    if (global && global.location) {\r\n      uri.protocol = uri.protocol || global.location.protocol.slice(0, -1);\r\n      uri.host = uri.host || (global.document\r\n        ? global.document.domain : global.location.hostname);\r\n      uri.port = uri.port || global.location.port;\r\n    }\r\n\r\n    uuri = io.util.uniqueUri(uri);\r\n\r\n    var options = {\r\n        host: uri.host\r\n      , secure: 'https' == uri.protocol\r\n      , port: uri.port || ('https' == uri.protocol ? 443 : 80)\r\n      , query: uri.query || ''\r\n    };\r\n\r\n    io.util.merge(options, details);\r\n\r\n    if (options['force new connection'] || !io.sockets[uuri]) {\r\n      socket = new io.Socket(options);\r\n    }\r\n\r\n    if (!options['force new connection'] && socket) {\r\n      io.sockets[uuri] = socket;\r\n    }\r\n\r\n    socket = socket || io.sockets[uuri];\r\n\r\n    // Making /v4/c have empty namespace\r\n    if (options['skipped handshake data']) {\r\n      return socket.of('');\r\n    } else {\r\n      // if path is different from '' or /\r\n      return socket.of(uri.path.length > 1 ? uri.path : '');\r\n    }\r\n  };\r\n\r\n})(\r\n    'object' === typeof module ? module.exports : (this.io = {})\r\n  , 'undefined' === typeof global ? window : global);\r\n\r\n// Workaround inside webpack\r\nvar io = module.exports;\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, global) {\r\n\r\n  /**\r\n   * Utilities namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var util = exports.util = {};\r\n\r\n  /**\r\n   * Parses an URI\r\n   *\r\n   * @author Steven Levithan <stevenlevithan.com> (MIT license)\r\n   * @api public\r\n   */\r\n\r\n  var re = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\r\n\r\n  var parts = ['source', 'protocol', 'authority', 'userInfo', 'user', 'password',\r\n               'host', 'port', 'relative', 'path', 'directory', 'file', 'query',\r\n               'anchor'];\r\n\r\n  util.parseUri = function (str) {\r\n    var m = re.exec(str || '')\r\n      , uri = {}\r\n      , i = 14;\r\n\r\n    while (i--) {\r\n      uri[parts[i]] = m[i] || '';\r\n    }\r\n\r\n    return uri;\r\n  };\r\n\r\n  /**\r\n   * Produces a unique url that identifies a Socket.IO connection.\r\n   *\r\n   * @param {Object} uri\r\n   * @api public\r\n   */\r\n\r\n  util.uniqueUri = function (uri) {\r\n    var protocol = uri.protocol\r\n      , host = uri.host\r\n      , port = uri.port;\r\n\r\n    if ('document' in global) {\r\n      host = host || document.domain;\r\n      port = port || (protocol == 'https'\r\n        && document.location.protocol !== 'https:' ? 443 : document.location.port);\r\n    } else {\r\n      host = host || 'localhost';\r\n\r\n      if (!port && protocol == 'https') {\r\n        port = 443;\r\n      }\r\n    }\r\n\r\n    return (protocol || 'http') + '://' + host + ':' + (port || 80);\r\n  };\r\n\r\n  /**\r\n   * Mergest 2 query strings in to once unique query string\r\n   *\r\n   * @param {String} base\r\n   * @param {String} addition\r\n   * @api public\r\n   */\r\n\r\n  util.query = function (base, addition) {\r\n    var query = util.chunkQuery(base || '')\r\n      , components = [];\r\n\r\n    util.merge(query, util.chunkQuery(addition || ''));\r\n    for (var part in query) {\r\n      if (query.hasOwnProperty(part)) {\r\n        components.push(part + '=' + query[part]);\r\n      }\r\n    }\r\n\r\n    return components.length ? '?' + components.join('&') : '';\r\n  };\r\n\r\n  /**\r\n   * Transforms a querystring in to an object\r\n   *\r\n   * @param {String} qs\r\n   * @api public\r\n   */\r\n\r\n  util.chunkQuery = function (qs) {\r\n    var query = {}\r\n      , params = qs.split('&')\r\n      , i = 0\r\n      , l = params.length\r\n      , kv;\r\n\r\n    for (; i < l; ++i) {\r\n      kv = params[i].split('=');\r\n      if (kv[0]) {\r\n        query[kv[0]] = kv[1];\r\n      }\r\n    }\r\n\r\n    return query;\r\n  };\r\n\r\n  /**\r\n   * Executes the given function when the page is loaded.\r\n   *\r\n   *     io.util.load(function () { console.log('page loaded'); });\r\n   *\r\n   * @param {Function} fn\r\n   * @api public\r\n   */\r\n\r\n  var pageLoaded = false;\r\n\r\n  util.load = function (fn) {\r\n    if ('document' in global && document.readyState === 'complete' || pageLoaded) {\r\n      return fn();\r\n    }\r\n\r\n    util.on(global, 'load', fn, false);\r\n  };\r\n\r\n  /**\r\n   * Adds an event.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  util.on = function (element, event, fn, capture) {\r\n    if (element.attachEvent) {\r\n      element.attachEvent('on' + event, fn);\r\n    } else if (element.addEventListener) {\r\n      element.addEventListener(event, fn, capture);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generates the correct `XMLHttpRequest` for regular and cross domain requests.\r\n   *\r\n   * @param {Boolean} [xdomain] Create a request that can be used cross domain.\r\n   * @returns {XMLHttpRequest|false} If we can create a XMLHttpRequest.\r\n   * @api private\r\n   */\r\n\r\n  util.request = function (xdomain) {\r\n\r\n    if (xdomain && 'undefined' != typeof XDomainRequest) {\r\n      return new XDomainRequest();\r\n    }\r\n\r\n    if ('undefined' != typeof XMLHttpRequest && (!xdomain || util.ua.hasCORS)) {\r\n      return new XMLHttpRequest();\r\n    }\r\n\r\n    if (!xdomain) {\r\n      try {\r\n        return new window[(['Active'].concat('Object').join('X'))]('Microsoft.XMLHTTP');\r\n      } catch(e) { }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * XHR based transport constructor.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  /**\r\n   * Change the internal pageLoaded value.\r\n   */\r\n\r\n  if ('undefined' != typeof window) {\r\n    util.load(function () {\r\n      pageLoaded = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Defers a function to ensure a spinner is not displayed by the browser\r\n   *\r\n   * @param {Function} fn\r\n   * @api public\r\n   */\r\n\r\n  util.defer = function (fn) {\r\n    if (!util.ua.webkit || 'undefined' != typeof importScripts) {\r\n      return fn();\r\n    }\r\n\r\n    util.load(function () {\r\n      setTimeout(fn, 100);\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Merges two objects.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.merge = function merge (target, additional, deep, lastseen) {\r\n    var seen = lastseen || []\r\n      , depth = typeof deep == 'undefined' ? 2 : deep\r\n      , prop;\r\n\r\n    for (prop in additional) {\r\n      if (additional.hasOwnProperty(prop) && util.indexOf(seen, prop) < 0) {\r\n        if (typeof target[prop] !== 'object' || !depth) {\r\n          target[prop] = additional[prop];\r\n          seen.push(additional[prop]);\r\n        } else {\r\n          util.merge(target[prop], additional[prop], depth - 1, seen);\r\n        }\r\n      }\r\n    }\r\n\r\n    return target;\r\n  };\r\n\r\n  /**\r\n   * Merges prototypes from objects\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.mixin = function (ctor, ctor2) {\r\n    util.merge(ctor.prototype, ctor2.prototype);\r\n  };\r\n\r\n  /**\r\n   * Shortcut for prototypical and static inheritance.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  util.inherit = function (ctor, ctor2) {\r\n    function f() {};\r\n    f.prototype = ctor2.prototype;\r\n    ctor.prototype = new f;\r\n  };\r\n\r\n  /**\r\n   * Checks if the given object is an Array.\r\n   *\r\n   *     io.util.isArray([]); // true\r\n   *     io.util.isArray({}); // false\r\n   *\r\n   * @param Object obj\r\n   * @api public\r\n   */\r\n\r\n  util.isArray = Array.isArray || function (obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Array]';\r\n  };\r\n\r\n  /**\r\n   * Intersects values of two arrays into a third\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.intersect = function (arr, arr2) {\r\n    var ret = []\r\n      , longest = arr.length > arr2.length ? arr : arr2\r\n      , shortest = arr.length > arr2.length ? arr2 : arr;\r\n\r\n    for (var i = 0, l = shortest.length; i < l; i++) {\r\n      if (~util.indexOf(longest, shortest[i]))\r\n        ret.push(shortest[i]);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n\r\n  /**\r\n   * Array indexOf compatibility.\r\n   *\r\n   * @see bit.ly/a5Dxa2\r\n   * @api public\r\n   */\r\n\r\n  util.indexOf = function (arr, o, i) {\r\n\r\n    for (var j = arr.length, i = i < 0 ? i + j < 0 ? 0 : i + j : i || 0;\r\n         i < j && arr[i] !== o; i++) {}\r\n\r\n    return j <= i ? -1 : i;\r\n  };\r\n\r\n  /**\r\n   * Converts enumerables to array.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.toArray = function (enu) {\r\n    var arr = [];\r\n\r\n    for (var i = 0, l = enu.length; i < l; i++)\r\n      arr.push(enu[i]);\r\n\r\n    return arr;\r\n  };\r\n\r\n  /**\r\n   * UA / engines detection namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  util.ua = {};\r\n\r\n  /**\r\n   * Whether the UA supports CORS for XHR.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.ua.hasCORS = 'undefined' != typeof XMLHttpRequest && (function () {\r\n    try {\r\n      var a = new XMLHttpRequest();\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n\r\n    return a.withCredentials != undefined;\r\n  })();\r\n\r\n  /**\r\n   * Detect webkit.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  util.ua.webkit = 'undefined' != typeof navigator\r\n    && /webkit/i.test(navigator.userAgent);\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' === typeof global ? window : global);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.EventEmitter = EventEmitter;\r\n\r\n  /**\r\n   * Event emitter constructor.\r\n   *\r\n   * @api public.\r\n   */\r\n\r\n  function EventEmitter () {};\r\n\r\n  /**\r\n   * Adds a listener\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.on = function (name, fn) {\r\n    if (!this.$events) {\r\n      this.$events = {};\r\n    }\r\n\r\n    if (!this.$events[name]) {\r\n      this.$events[name] = fn;\r\n    } else if (io.util.isArray(this.$events[name])) {\r\n      this.$events[name].push(fn);\r\n    } else {\r\n      this.$events[name] = [this.$events[name], fn];\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\r\n\r\n  /**\r\n   * Adds a volatile listener.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.once = function (name, fn) {\r\n    var self = this;\r\n\r\n    function on () {\r\n      self.removeListener(name, on);\r\n      fn.apply(this, arguments);\r\n    };\r\n\r\n    on.listener = fn;\r\n    this.on(name, on);\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Removes a listener.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.removeListener = function (name, fn) {\r\n    if (this.$events && this.$events[name]) {\r\n      var list = this.$events[name];\r\n\r\n      if (io.util.isArray(list)) {\r\n        var pos = -1;\r\n\r\n        for (var i = 0, l = list.length; i < l; i++) {\r\n          if (list[i] === fn || (list[i].listener && list[i].listener === fn)) {\r\n            pos = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (pos < 0) {\r\n          return this;\r\n        }\r\n\r\n        list.splice(pos, 1);\r\n\r\n        if (!list.length) {\r\n          delete this.$events[name];\r\n        }\r\n      } else if (list === fn || (list.listener && list.listener === fn)) {\r\n        delete this.$events[name];\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Removes all listeners for an event.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.removeAllListeners = function (name) {\r\n    // TODO: enable this when node 0.5 is stable\r\n    //if (name === undefined) {\r\n      //this.$events = {};\r\n      //return this;\r\n    //}\r\n\r\n    if (this.$events && this.$events[name]) {\r\n      this.$events[name] = null;\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Gets all listeners for a certain event.\r\n   *\r\n   * @api publci\r\n   */\r\n\r\n  EventEmitter.prototype.listeners = function (name) {\r\n    if (!this.$events) {\r\n      this.$events = {};\r\n    }\r\n\r\n    if (!this.$events[name]) {\r\n      this.$events[name] = [];\r\n    }\r\n\r\n    if (!io.util.isArray(this.$events[name])) {\r\n      this.$events[name] = [this.$events[name]];\r\n    }\r\n\r\n    return this.$events[name];\r\n  };\r\n\r\n  /**\r\n   * Emits an event.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  EventEmitter.prototype.emit = function (name) {\r\n    if (!this.$events) {\r\n      return false;\r\n    }\r\n\r\n    var handler = this.$events[name];\r\n\r\n    if (!handler) {\r\n      return false;\r\n    }\r\n\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n\r\n    if ('function' == typeof handler) {\r\n      handler.apply(this, args);\r\n    } else if (io.util.isArray(handler)) {\r\n      var listeners = handler.slice();\r\n\r\n      for (var i = 0, l = listeners.length; i < l; i++) {\r\n        listeners[i].apply(this, args);\r\n      }\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n/**\r\n * Removed JSON polyfill - obsolete, and we are using native JSON.parse etc. throughout the rest of the codebase anyway\r\n */\r\n\r\n(function (exports, nativeJSON) {\r\n  \"use strict\";\r\n\r\n  // use native JSON if it's available\r\n  if (nativeJSON && nativeJSON.parse){\r\n    return exports.JSON = {\r\n      parse: nativeJSON.parse\r\n    , stringify: nativeJSON.stringify\r\n    }\r\n  }\r\n\r\n  throw new Error(\"JSON not available\");\r\n  \r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , typeof JSON !== 'undefined' ? JSON : undefined\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Parser namespace.\r\n   *\r\n   * @namespace\r\n   */\r\n\r\n  var parser = exports.parser = {};\r\n\r\n  /**\r\n   * Packet types.\r\n   */\r\n\r\n  var packets = parser.packets = [\r\n      'disconnect'\r\n    , 'connect'\r\n    , 'heartbeat'\r\n    , 'message'\r\n    , 'json'\r\n    , 'event'\r\n    , 'ack'\r\n    , 'error'\r\n    , 'noop'\r\n  ];\r\n\r\n  /**\r\n   * Errors reasons.\r\n   */\r\n\r\n  var reasons = parser.reasons = [\r\n      'transport not supported'\r\n    , 'client not handshaken'\r\n    , 'unauthorized'\r\n  ];\r\n\r\n  /**\r\n   * Errors advice.\r\n   */\r\n\r\n  var advice = parser.advice = [\r\n      'reconnect'\r\n  ];\r\n\r\n  /**\r\n   * Shortcuts.\r\n   */\r\n\r\n  var JSON = io.JSON\r\n    , indexOf = io.util.indexOf;\r\n\r\n  /**\r\n   * Encodes a packet.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  parser.encodePacket = function (packet) {\r\n    var type = indexOf(packets, packet.type)\r\n      , id = packet.id || ''\r\n      , endpoint = packet.endpoint || ''\r\n      , ack = packet.ack\r\n      , data = null;\r\n\r\n    switch (packet.type) {\r\n      case 'error':\r\n        var reason = packet.reason ? indexOf(reasons, packet.reason) : ''\r\n          , adv = packet.advice ? indexOf(advice, packet.advice) : '';\r\n\r\n        if (reason !== '' || adv !== '')\r\n          data = reason + (adv !== '' ? ('+' + adv) : '');\r\n\r\n        break;\r\n\r\n      case 'message':\r\n        if (packet.data !== '')\r\n          data = packet.data;\r\n        break;\r\n\r\n      case 'event':\r\n        var ev = { name: packet.name };\r\n\r\n        if (packet.args && packet.args.length) {\r\n          ev.args = packet.args;\r\n        }\r\n\r\n        data = JSON.stringify(ev);\r\n        break;\r\n\r\n      case 'json':\r\n        data = JSON.stringify(packet.data);\r\n        break;\r\n\r\n      case 'connect':\r\n        if (packet.qs)\r\n          data = packet.qs;\r\n        break;\r\n\r\n      case 'ack':\r\n        data = packet.ackId\r\n          + (packet.args && packet.args.length\r\n              ? '+' + JSON.stringify(packet.args) : '');\r\n        break;\r\n    }\r\n\r\n    // construct packet with required fragments\r\n    var encoded = [\r\n        type\r\n      , id + (ack == 'data' ? '+' : '')\r\n      , endpoint\r\n    ];\r\n\r\n    // data fragment is optional\r\n    if (data !== null && data !== undefined)\r\n      encoded.push(data);\r\n\r\n    return encoded.join(':');\r\n  };\r\n\r\n  /**\r\n   * Encodes multiple messages (payload).\r\n   *\r\n   * @param {Array} messages\r\n   * @api private\r\n   */\r\n\r\n  parser.encodePayload = function (packets) {\r\n    var decoded = '';\r\n\r\n    if (packets.length == 1)\r\n      return packets[0];\r\n\r\n    for (var i = 0, l = packets.length; i < l; i++) {\r\n      var packet = packets[i];\r\n      decoded += '\\ufffd' + packet.length + '\\ufffd' + packets[i];\r\n    }\r\n\r\n    return decoded;\r\n  };\r\n\r\n  /**\r\n   * Decodes a packet\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  var regexp = /([^:]+):([0-9]+)?(\\+)?:([^:]+)?:?([\\s\\S]*)?/;\r\n\r\n  parser.decodePacket = function (data) {\r\n    var pieces = data.match(regexp);\r\n\r\n    if (!pieces) return {};\r\n\r\n    var id = pieces[2] || ''\r\n      , data = pieces[5] || ''\r\n      , packet = {\r\n            type: packets[pieces[1]]\r\n          , endpoint: pieces[4] || ''\r\n        };\r\n\r\n    // whether we need to acknowledge the packet\r\n    if (id) {\r\n      packet.id = id;\r\n      if (pieces[3])\r\n        packet.ack = 'data';\r\n      else\r\n        packet.ack = true;\r\n    }\r\n\r\n    // handle different packet types\r\n    switch (packet.type) {\r\n      case 'error':\r\n        var pieces = data.split('+');\r\n        packet.reason = reasons[pieces[0]] || '';\r\n        packet.advice = advice[pieces[1]] || '';\r\n        break;\r\n\r\n      case 'message':\r\n        packet.data = data || '';\r\n        break;\r\n\r\n      case 'event':\r\n        try {\r\n          var opts = JSON.parse(data);\r\n          packet.name = opts.name;\r\n          packet.args = opts.args;\r\n        } catch (e) { }\r\n\r\n        packet.args = packet.args || [];\r\n        break;\r\n\r\n      case 'json':\r\n        try {\r\n          packet.data = JSON.parse(data);\r\n        } catch (e) { }\r\n        break;\r\n\r\n      case 'connect':\r\n        packet.qs = data || '';\r\n        break;\r\n\r\n      case 'ack':\r\n        var pieces = data.match(/^([0-9]+)(\\+)?(.*)/);\r\n        if (pieces) {\r\n          packet.ackId = pieces[1];\r\n          packet.args = [];\r\n\r\n          if (pieces[3]) {\r\n            try {\r\n              packet.args = pieces[3] ? JSON.parse(pieces[3]) : [];\r\n            } catch (e) { }\r\n          }\r\n        }\r\n        break;\r\n\r\n      case 'disconnect':\r\n        packet.reason = data;\r\n        break;\r\n\r\n      case 'heartbeat':\r\n        break;\r\n    };\r\n\r\n    return packet;\r\n  };\r\n\r\n  /**\r\n   * Decodes data payload. Detects multiple messages\r\n   *\r\n   * @return {Array} messages\r\n   * @api public\r\n   */\r\n\r\n  parser.decodePayload = function (data) {\r\n    // IE doesn't like data[i] for unicode chars, charAt works fine\r\n    if (data.charAt(0) == '\\ufffd') {\r\n      var ret = [];\r\n\r\n      for (var i = 1, length = ''; i < data.length; i++) {\r\n        if (data.charAt(i) == '\\ufffd') {\r\n          ret.push(parser.decodePacket(data.substr(i + 1).substr(0, length)));\r\n          i += Number(length) + 1;\r\n          length = '';\r\n        } else {\r\n          length += data.charAt(i);\r\n        }\r\n      }\r\n\r\n      return ret;\r\n    } else {\r\n      return [parser.decodePacket(data)];\r\n    }\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.Transport = Transport;\r\n\r\n  /**\r\n   * This is the transport template for all supported transport methods.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   * @param {exports.Socket} socket\r\n   */\r\n\r\n  function Transport (socket, sessid) {\r\n    this.socket = socket;\r\n    this.sessid = sessid;\r\n    this.connectErrorCallback = undefined;\r\n    this.isOpened = false;\r\n  };\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(Transport, io.EventEmitter);\r\n\r\n  /**\r\n   * Handles the response from the server. When a new response is received\r\n   * it will automatically update the timeout, decode the message and\r\n   * forwards the response to the onMessage function for further processing.\r\n   *\r\n   * @param {String} data Response from the server.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onData = function (data) {\r\n    this.clearCloseTimeout();\r\n\r\n    // If the connection in currently open (or in a reopening state) reset the close\r\n    // timeout since we have just received data. This check is necessary so\r\n    // that we don't reset the timeout on an explicitly disconnected connection.\r\n    if (this.socket.connected || this.socket.connecting || this.socket.reconnecting) {\r\n      this.setCloseTimeout();\r\n    }\r\n\r\n    if (data !== '') {\r\n      // todo: we should only do decodePayload for xhr transports\r\n      var msgs = io.parser.decodePayload(data);\r\n\r\n      if (msgs && msgs.length) {\r\n        for (var i = 0, l = msgs.length; i < l; i++) {\r\n          this.onPacket(msgs[i]);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handles packets.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onPacket = function (packet) {\r\n    this.socket.setHeartbeatTimeout();\r\n\r\n    if (packet.type == 'heartbeat') {\r\n      return this.onHeartbeat();\r\n    }\r\n\r\n    if (packet.type == 'connect' && packet.endpoint == '') {\r\n      this.onConnect();\r\n    }\r\n\r\n    if (packet.type == 'error' && packet.advice == 'reconnect') {\r\n      this.isOpened = false;\r\n    }\r\n\r\n    this.socket.onPacket(packet);\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sets close timeout\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.setCloseTimeout = function () {\r\n    if (!this.closeTimeout) {\r\n      var self = this;\r\n\r\n      this.closeTimeout = setTimeout(function () {\r\n        self.onDisconnect();\r\n      }, this.socket.closeTimeout);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called when transport disconnects.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onDisconnect = function () {\r\n    if (this.close && this.isOpened) this.close();\r\n    this.clearTimeouts();\r\n    this.socket.onDisconnect();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Called when transport connects\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onConnect = function () {\r\n    this.socket.onConnect();\r\n    this.connectErrorCallback = undefined;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Clears close timeout\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.clearCloseTimeout = function () {\r\n    if (this.closeTimeout) {\r\n      clearTimeout(this.closeTimeout);\r\n      this.closeTimeout = null;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Clear timeouts\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.clearTimeouts = function () {\r\n    this.clearCloseTimeout();\r\n\r\n    if (this.reopenTimeout) {\r\n      clearTimeout(this.reopenTimeout);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Sends a packet\r\n   *\r\n   * @param {Object} packet object.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.packet = function (packet) {\r\n    this.send(io.parser.encodePacket(packet));\r\n  };\r\n\r\n  /**\r\n   * Send the received heartbeat message back to server. So the server\r\n   * knows we are still connected.\r\n   *\r\n   * @param {String} heartbeat Heartbeat response from the server.\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onHeartbeat = function (heartbeat) {\r\n    this.packet({ type: 'heartbeat' });\r\n  };\r\n\r\n  /**\r\n   * Called when the transport opens.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onOpen = function () {\r\n    this.isOpened = true;\r\n    this.clearCloseTimeout();\r\n    this.socket.onOpen();\r\n  };\r\n\r\n  /**\r\n   * Notifies the base when the connection with the Socket.IO server\r\n   * has been disconnected.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.onClose = function () {\r\n    var self = this;\r\n\r\n    /* FIXME: reopen delay causing a infinit loop\r\n    this.reopenTimeout = setTimeout(function () {\r\n      self.open();\r\n    }, this.socket.options['reopen delay']);*/\r\n\r\n    this.isOpened = false;\r\n    this.socket.onClose();\r\n    this.onDisconnect();\r\n  };\r\n\r\n  /**\r\n   * Generates a connection url based on the Socket.IO URL Protocol.\r\n   * See <https://github.com/learnboost/socket.io-node/> for more details.\r\n   *\r\n   * @returns {String} Connection url\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.prepareUrl = function (query) {\r\n    /** @var {ISocketIoOptions} options */\r\n    var options = this.socket.options;\r\n\r\n    if (options['skipped handshake data']) {\r\n      // /v4/c protocol\r\n      return options.rewriteUrlForProxy(options['skipped handshake data'].websocketUrl + (query ? query : ''))\r\n    }\r\n\r\n    var url = this.scheme() + '://'\r\n      + options.host + ':' + options.port + '/'\r\n      + options.resource + '/' + io.protocol\r\n      + '/' + this.name + '/' + this.sessid + (query ? query : '');\r\n\r\n    return options.rewriteUrlForProxy(url);\r\n  };\r\n\r\n  /**\r\n   * Checks if the transport is ready to start a connection.\r\n   *\r\n   * @param {Socket} socket The socket instance that needs a transport\r\n   * @param {Function} fn The callback\r\n   * @api private\r\n   */\r\n\r\n  Transport.prototype.ready = function (socket, fn) {\r\n    fn.call(this);\r\n  };\r\n\r\n  /**\r\n   * Clears the event handlers attached on to by specific transport implementations.\r\n   *\r\n   * @api private\r\n   */\r\n  Transport.prototype.clearEventHandlers = function () {\r\n      return this;\r\n  };\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.Socket = Socket;\r\n\r\n  /**\r\n   * Create a new `Socket.IO client` which can establish a persistent\r\n   * connection with a Socket.IO enabled server.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  function Socket (options) {\r\n    this.options = {\r\n        port: 80\r\n      , secure: false\r\n      , document: 'document' in global ? document : false\r\n      , resource: 'socket.io'\r\n      , transports: io.transports.slice()\r\n      , 'connect timeout': 10000\r\n      , 'try multiple transports': true\r\n      , 'reconnect': true\r\n      , 'reconnection delay': 500\r\n      , 'reconnection limit': Infinity\r\n      , 'reopen delay': 3000\r\n      , 'max reconnection attempts': 10\r\n      , 'sync disconnect on unload': true\r\n      , 'auto connect': true\r\n      , 'flash policy port': 10843\r\n    };\r\n\r\n    io.util.merge(this.options, options);\r\n\r\n    this.connected = false;\r\n    this.open = false;\r\n    this.connecting = false;\r\n    this.reconnecting = false;\r\n    this.namespaces = {};\r\n    this.buffer = [];\r\n    this.doBuffer = false;\r\n    this.disconnected = false;\r\n\r\n    if (this.options['sync disconnect on unload'] &&\r\n        (!this.isXDomain() || io.util.ua.hasCORS)) {\r\n      var self = this;\r\n\r\n      io.util.on(global, 'unload', function () {\r\n        self.disconnectSync();\r\n      }, false);\r\n    }\r\n\r\n    if (this.options['auto connect']) {\r\n      this.connect();\r\n    }\r\n};\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(Socket, io.EventEmitter);\r\n\r\n  /**\r\n   * Returns a namespace listener/emitter for this socket\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.of = function (name) {\r\n    if (!this.namespaces[name]) {\r\n      this.namespaces[name] = new io.SocketNamespace(this, name);\r\n\r\n      if (name !== '') {\r\n        this.namespaces[name].packet({ type: 'connect' });\r\n      }\r\n    }\r\n\r\n    return this.namespaces[name];\r\n  };\r\n\r\n  /**\r\n   * Emits the given event to the Socket and all namespaces\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.publish = function () {\r\n    this.emit.apply(this, arguments);\r\n\r\n    var nsp;\r\n\r\n    for (var i in this.namespaces) {\r\n      if (this.namespaces.hasOwnProperty(i)) {\r\n        nsp = this.of(i);\r\n        nsp.$emit.apply(nsp, arguments);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Performs the handshake\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function empty () { };\r\n\r\n  Socket.prototype.handshake = function (fn) {\r\n    var self = this\r\n      , options = this.options;\r\n      \r\n    if (self.disconnected) {\r\n      return;\r\n    }\r\n\r\n    function complete (data) {\r\n      if (data instanceof Error) {\r\n        self.onError(data.message);\r\n      } else {\r\n        fn.apply(null, data.split(':'));\r\n      }\r\n    };\r\n\r\n    var url = options.rewriteUrlForProxy([\r\n          'http' + (options.secure ? 's' : '') + ':/'\r\n        , options.host + ':' + options.port\r\n        , options.resource\r\n        , io.protocol\r\n        , io.util.query(this.options.query, 't=' + +new Date)\r\n      ].join('/'));\r\n\r\n    if (this.isXDomain() && !io.util.ua.hasCORS) {\r\n      var insertAt = document.getElementsByTagName('script')[0]\r\n        , script = document.createElement('script');\r\n\r\n      script.src = url + '&jsonp=' + io.j.length;\r\n      insertAt.parentNode.insertBefore(script, insertAt);\r\n\r\n      io.j.push(function (data) {\r\n        complete(data);\r\n        script.parentNode.removeChild(script);\r\n      });\r\n    } else {\r\n      var xhr = io.util.request();\r\n      \r\n      xhr.open('GET', url, true);\r\n\r\n      var headers = this.options.requestHeaders;\r\n      if (headers !== undefined) {\r\n        Object.keys(headers).forEach(function(name) {\r\n          xhr.setRequestHeader(name, headers[name]);\r\n        });\r\n      }\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState == 4) {\r\n          xhr.onreadystatechange = empty;\r\n\r\n          if (xhr.status == 200) {\r\n            complete(xhr.responseText);\r\n          } else {\r\n            !self.reconnecting && self.onError(xhr.responseText);\r\n          }\r\n        }\r\n      };\r\n      xhr.send(null);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Find an available transport based on the options supplied in the constructor.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.getTransport = function (override) {\r\n    var transports = override || this.transports, match;\r\n\r\n    for (var i = 0, transport; transport = transports[i]; i++) {\r\n      if (io.Transport[transport]\r\n        && io.Transport[transport].check(this)\r\n        && (!this.isXDomain() || io.Transport[transport].xdomainCheck())) {\r\n        return new io.Transport[transport](this, this.sessionid);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * Connects to the server.\r\n   *\r\n   * @param {Function} [fn] Callback.\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.connect = function (fn) {\r\n    if (this.connecting || this.disconnected) {\r\n      return this;\r\n    }\r\n\r\n    var self = this;\r\n\r\n    var onHandshakeComplete = (function (sid, heartbeat, close, transports) {\r\n      // Params come from response's body - it's splitted by ':'\r\n      // example: 1178beba4026e2c7-48e62d038b18f416:85:85:websocket,xhr-polling,jsonp-polling\r\n      self.sessionid = sid;\r\n      // Add two seconds, so connection is closed by server, not client - otherwise\r\n      // there will be a onSocketDisconnect event which will start health check, etc\r\n      // This can happen if server returns close/heartbeat timeout equal to 40 which is server's timeout to\r\n      // close long poll connection, in such case client can close connection before server response with empty\r\n      // response and client goes to health check. Server can return such timeout if client send too small ping timeout\r\n      // during handshake\r\n      self.closeTimeout = close * 1000 + 2000;\r\n      self.heartbeatTimeout = heartbeat * 1000 + 2000;\r\n      self.transports = transports ? io.util.intersect(\r\n          transports.split(',')\r\n        , self.options.transports\r\n      ) : self.options.transports;\r\n\r\n      self.setHeartbeatTimeout();\r\n      self.remainingTransports = self.transports.slice(0);\r\n\r\n      function tryNextTransport() {\r\n        if (!self.connected && !self.disconnected) {\r\n          self.connecting = false;\r\n          clearTimeout(self.connectTimeoutTimer);\r\n\r\n          if (self.options['try multiple transports']) {\r\n            while (self.remainingTransports.length > 0\r\n                   && self.remainingTransports.splice(0,1)[0] != self.transport.name) {}\r\n\r\n            if (self.remainingTransports.length){\r\n              connect(self.remainingTransports);\r\n            } else {\r\n              self.publish('connect_failed');\r\n            }\r\n          } else {\r\n            self.publish('connect_failed');\r\n          }\r\n        }\r\n      }\r\n\r\n\r\n      function connect (transports){\r\n        if (self.transport) {\r\n            self.transport.clearTimeouts();\r\n            self.transport.clearEventHandlers();\r\n        }\r\n\r\n        self.transport = self.getTransport(transports);\r\n        if (!self.transport || self.disconnected) return self.publish('connect_failed');\r\n\r\n        // once the transport is ready (i.e. page is fully loaded)\r\n        self.transport.ready(self, function () {\r\n          self.connecting = true;\r\n          self.publish('connecting', self.transport.name);\r\n          self.transport.open(tryNextTransport);\r\n\r\n          if (self.options['connect timeout']) {\r\n            self.connectTimeoutTimer = setTimeout(function () {\r\n              tryNextTransport();\r\n            }, self.options['connect timeout']);\r\n          }\r\n        });\r\n      }\r\n\r\n      connect(self.transports);\r\n\r\n      self.once('connect', function (){\r\n        clearTimeout(self.connectTimeoutTimer);\r\n\r\n        fn && typeof fn == 'function' && fn();\r\n      });\r\n    });\r\n\r\n    if (this.options['skipped handshake data']) {\r\n      // /v4/c protocol\r\n      var data = this.options['skipped handshake data'];\r\n      // There is no need for the client to know a Socket ID with this protocol\r\n      // Can probably just use some dummy/random/timestamp thing as session id, it is completely opaque, on server too\r\n      // It can also be filled retroactively after being sent from the server inside a WS message (trouter.connected),\r\n      // but I don't think we need to bother.\r\n      onHandshakeComplete('v4c-' + new Date().getTime(), data.timeout, data.timeout, 'websocket');\r\n    } else {\r\n      this.handshake(onHandshakeComplete);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Clears and sets a new heartbeat timeout using the value given by the\r\n   * server during the handshake.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.setHeartbeatTimeout = function () {\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n\r\n    var self = this;\r\n    this.heartbeatTimeoutTimer = setTimeout(function () {\r\n      self.transport.onClose();\r\n    }, this.heartbeatTimeout);\r\n  };\r\n\r\n  /**\r\n   * Sends a message.\r\n   *\r\n   * @param {Object} data packet.\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.packet = function (data) {\r\n    if (this.connected && !this.doBuffer) {\r\n      this.transport.packet(data);\r\n    } else {\r\n      this.buffer.push(data);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sets buffer state\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.setBuffer = function (v) {\r\n    this.doBuffer = v;\r\n\r\n    if (!v && this.connected && this.buffer.length) {\r\n      this.transport.payload(this.buffer);\r\n      this.buffer = [];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Disconnect the established connect.\r\n   *\r\n   * @returns {io.Socket}\r\n   * @api public\r\n   */\r\n\r\n  Socket.prototype.disconnect = function () {\r\n    if (this.connected || this.connecting) {\r\n      if (this.open) {\r\n        this.of('').packet({ type: 'disconnect' });\r\n      }\r\n\r\n      // handle disconnection immediately\r\n      this.onDisconnect('booted');\r\n    }\r\n    this.disconnected = true;\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Disconnects the socket with a sync XHR.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.disconnectSync = function () {\r\n    // ensure disconnection\r\n    var xhr = io.util.request()\r\n      , uri = this.resource + '/' + io.protocol + '/' + this.sessionid;\r\n\r\n    xhr.open('GET', uri, true);\r\n\r\n    // handle disconnection immediately\r\n    this.onDisconnect('booted');\r\n  };\r\n\r\n  /**\r\n   * Check if we need to use cross domain enabled transports. Cross domain would\r\n   * be a different port or different domain name.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.isXDomain = function () {\r\n\r\n    var port = global.location.port ||\r\n      ('https:' == global.location.protocol ? 443 : 80);\r\n\r\n    return this.options.host !== global.location.hostname\r\n      || this.options.port != port;\r\n  };\r\n\r\n  /**\r\n   * Called upon handshake.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onConnect = function () {\r\n    if (!this.connected) {\r\n      this.connected = true;\r\n      this.connecting = false;\r\n      if (!this.doBuffer) {\r\n        // make sure to flush the buffer\r\n        this.setBuffer(false);\r\n      }\r\n      this.emit('connect');\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called when the transport opens\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onOpen = function () {\r\n    this.open = true;\r\n  };\r\n\r\n  /**\r\n   * Called when the transport closes.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onClose = function () {\r\n    this.open = false;\r\n    clearTimeout(this.heartbeatTimeoutTimer);\r\n  };\r\n\r\n  /**\r\n   * Called when the transport first opens a connection\r\n   *\r\n   * @param text\r\n   */\r\n\r\n  Socket.prototype.onPacket = function (packet) {\r\n    this.of(packet.endpoint).onPacket(packet);\r\n  };\r\n\r\n  /**\r\n   * Handles an error.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onError = function (err) {\r\n    if (err && err.advice) {\r\n      if (err.advice === 'reconnect' && (this.connected || this.connecting)) {\r\n        this.disconnect();\r\n        if (this.options.reconnect) {\r\n          this.reconnect();\r\n        }\r\n      }\r\n    }\r\n\r\n    this.publish('error', err && err.reason ? err.reason : err);\r\n  };\r\n\r\n  /**\r\n   * Called when the transport disconnects.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.onDisconnect = function (reason) {\r\n    var wasConnected = this.connected\r\n      , wasConnecting = this.connecting;\r\n\r\n    this.connected = false;\r\n    this.connecting = false;\r\n    this.open = false;\r\n\r\n    if (wasConnected || wasConnecting) {\r\n      this.transport.close();\r\n      this.transport.clearTimeouts();\r\n      if (wasConnected) {\r\n        this.publish('disconnect', reason);\r\n\r\n        if ('booted' != reason && this.options.reconnect && !this.reconnecting) {\r\n          this.reconnect();\r\n        }\r\n      } else {\r\n        this.publish('close_during_connecting', reason);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Called upon reconnection.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  Socket.prototype.reconnect = function () {\r\n    this.reconnecting = true;\r\n    this.reconnectionAttempts = 0;\r\n    this.reconnectionDelay = this.options['reconnection delay'];\r\n\r\n    var self = this\r\n      , maxAttempts = this.options['max reconnection attempts']\r\n      , tryMultiple = this.options['try multiple transports']\r\n      , limit = this.options['reconnection limit'];\r\n\r\n    function reset () {\r\n      if (self.connected) {\r\n        for (var i in self.namespaces) {\r\n          if (self.namespaces.hasOwnProperty(i) && '' !== i) {\r\n              self.namespaces[i].packet({ type: 'connect' });\r\n          }\r\n        }\r\n        self.publish('reconnect', self.transport.name, self.reconnectionAttempts);\r\n      }\r\n\r\n      clearTimeout(self.reconnectionTimer);\r\n\r\n      self.removeListener('connect_failed', maybeReconnect);\r\n      self.removeListener('connect', maybeReconnect);\r\n\r\n      self.reconnecting = false;\r\n\r\n      delete self.reconnectionAttempts;\r\n      delete self.reconnectionDelay;\r\n      delete self.reconnectionTimer;\r\n      delete self.redoTransports;\r\n\r\n      self.options['try multiple transports'] = tryMultiple;\r\n    };\r\n\r\n    function maybeReconnect () {\r\n      if (!self.reconnecting) {\r\n        return;\r\n      }\r\n\r\n      if (self.connected) {\r\n        return reset();\r\n      };\r\n\r\n      if (self.connecting && self.reconnecting) {\r\n        return self.reconnectionTimer = setTimeout(maybeReconnect, 1000);\r\n      }\r\n\r\n      if (self.reconnectionAttempts++ >= maxAttempts) {\r\n        if (!self.redoTransports) {\r\n          self.on('connect_failed', maybeReconnect);\r\n          self.options['try multiple transports'] = true;\r\n          self.transport = self.getTransport();\r\n          self.redoTransports = true;\r\n          self.connect();\r\n        } else {\r\n          self.publish('reconnect_failed');\r\n          reset();\r\n        }\r\n      } else {\r\n        if (self.reconnectionDelay < limit) {\r\n          self.reconnectionDelay *= 2; // exponential back off\r\n        }\r\n\r\n        self.connect();\r\n        self.publish('reconnecting', self.reconnectionDelay, self.reconnectionAttempts);\r\n        self.reconnectionTimer = setTimeout(maybeReconnect, self.reconnectionDelay);\r\n      }\r\n    };\r\n\r\n    this.options['try multiple transports'] = false;\r\n    this.reconnectionTimer = setTimeout(maybeReconnect, this.reconnectionDelay);\r\n\r\n    this.on('connect', maybeReconnect);\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.SocketNamespace = SocketNamespace;\r\n\r\n  /**\r\n   * Socket namespace constructor.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function SocketNamespace (socket, name) {\r\n    this.socket = socket;\r\n    this.name = name || '';\r\n    this.flags = {};\r\n    this.json = new Flag(this, 'json');\r\n    this.ackPackets = 0;\r\n    this.acks = {};\r\n  };\r\n\r\n  /**\r\n   * Apply EventEmitter mixin.\r\n   */\r\n\r\n  io.util.mixin(SocketNamespace, io.EventEmitter);\r\n\r\n  /**\r\n   * Copies emit since we override it\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.$emit = io.EventEmitter.prototype.emit;\r\n\r\n  /**\r\n   * Creates a new namespace, by proxying the request to the socket. This\r\n   * allows us to use the synax as we do on the server.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.of = function () {\r\n    return this.socket.of.apply(this.socket, arguments);\r\n  };\r\n\r\n  /**\r\n   * Sends a packet.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.packet = function (packet) {\r\n    packet.endpoint = this.name;\r\n    this.socket.packet(packet);\r\n    this.flags = {};\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Sends a message\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.send = function (data, fn) {\r\n    var packet = {\r\n        type: this.flags.json ? 'json' : 'message'\r\n      , data: data\r\n    };\r\n\r\n    if ('function' == typeof fn) {\r\n      packet.id = ++this.ackPackets;\r\n      packet.ack = true;\r\n      this.acks[packet.id] = fn;\r\n    }\r\n\r\n    return this.packet(packet);\r\n  };\r\n\r\n  /**\r\n   * Emits an event\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  SocketNamespace.prototype.emit = function (name) {\r\n    var args = Array.prototype.slice.call(arguments, 1)\r\n      , lastArg = args[args.length - 1]\r\n      , packet = {\r\n            type: 'event'\r\n          , name: name\r\n        };\r\n\r\n    if ('function' == typeof lastArg) {\r\n      packet.id = ++this.ackPackets;\r\n      packet.ack = 'data';\r\n      this.acks[packet.id] = lastArg;\r\n      args = args.slice(0, args.length - 1);\r\n    }\r\n\r\n    packet.args = args;\r\n\r\n    return this.packet(packet);\r\n  };\r\n\r\n  /**\r\n   * Disconnects the namespace\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.disconnect = function () {\r\n    if (this.name === '') {\r\n      this.socket.disconnect();\r\n    } else {\r\n      this.packet({ type: 'disconnect' });\r\n      this.$emit('disconnect');\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handles a packet\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  SocketNamespace.prototype.onPacket = function (packet) {\r\n    var self = this;\r\n\r\n    function ack () {\r\n      self.packet({\r\n          type: 'ack'\r\n        , args: io.util.toArray(arguments)\r\n        , ackId: packet.id\r\n      });\r\n    };\r\n\r\n    switch (packet.type) {\r\n      case 'connect':\r\n        this.$emit('connect');\r\n        break;\r\n\r\n      case 'disconnect':\r\n        if (this.name === '') {\r\n          this.socket.onDisconnect(packet.reason || 'booted');\r\n        } else {\r\n          this.$emit('disconnect', packet.reason || '');\r\n        }\r\n        break;\r\n\r\n      case 'message':\r\n      case 'json':\r\n        var params = ['message', packet.data];\r\n\r\n        if (packet.ack == 'data') {\r\n          params.push(ack);\r\n        } else if (packet.ack) {\r\n          this.packet({ type: 'ack', ackId: packet.id });\r\n        }\r\n\r\n        this.$emit.apply(this, params);\r\n        break;\r\n\r\n      case 'event':\r\n        var params = [packet.name].concat(packet.args);\r\n\r\n        if (packet.ack == 'data')\r\n          params.push(ack);\r\n\r\n        this.$emit.apply(this, params);\r\n        break;\r\n\r\n      case 'ack':\r\n        if (this.acks[packet.ackId]) {\r\n          this.acks[packet.ackId].apply(this, packet.args);\r\n          delete this.acks[packet.ackId];\r\n        }\r\n        break;\r\n\r\n      case 'error':\r\n        if (packet.advice){\r\n          this.socket.onError(packet);\r\n        } else {\r\n          if (packet.reason == 'unauthorized') {\r\n            this.$emit('connect_failed', packet.reason);\r\n          } else {\r\n            this.$emit('error', packet.reason);\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Flag interface.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function Flag (nsp, name) {\r\n    this.namespace = nsp;\r\n    this.name = name;\r\n  };\r\n\r\n  /**\r\n   * Send a message\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Flag.prototype.send = function () {\r\n    this.namespace.flags[this.name] = true;\r\n    this.namespace.send.apply(this.namespace, arguments);\r\n  };\r\n\r\n  /**\r\n   * Emit an event\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  Flag.prototype.emit = function () {\r\n    this.namespace.flags[this.name] = true;\r\n    this.namespace.emit.apply(this.namespace, arguments);\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports.websocket = WS;\r\n\r\n  /**\r\n   * The WebSocket transport uses the HTML5 WebSocket API to establish an\r\n   * persistent connection with the Socket.IO server. This transport will also\r\n   * be inherited by the FlashSocket fallback as it provides a API compatible\r\n   * polyfill for the WebSockets.\r\n   *\r\n   * @constructor\r\n   * @extends {io.Transport}\r\n   * @api public\r\n   */\r\n\r\n  function WS (socket) {\r\n    io.Transport.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from Transport.\r\n   */\r\n\r\n  io.util.inherit(WS, io.Transport);\r\n\r\n  /**\r\n   * Transport name\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.name = 'websocket';\r\n\r\n  function empty() { };\r\n\r\n  /**\r\n   * Initializes a new `WebSocket` connection with the Socket.IO server. We attach\r\n   * all the appropriate listeners to handle the responses from the server.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.open = function (connectErrorCallback) {\r\n    var query = io.util.query(this.socket.options.query)\r\n      , self = this\r\n      , Socket\r\n\r\n    this.connectErrorCallback = connectErrorCallback;\r\n\r\n    if (!Socket) {\r\n      Socket = global.MozWebSocket || global.WebSocket;\r\n    }\r\n\r\n    this.websocket = new Socket(this.prepareUrl(query));\r\n\r\n    this.websocket.onopen = function () {\r\n      self.onOpen();\r\n      self.socket.setBuffer(false);\r\n    };\r\n    this.websocket.onmessage = function (ev) {\r\n      self.onData(ev.data);\r\n    };\r\n    this.websocket.onclose = function () {\r\n      self.onClose();\r\n      self.socket.setBuffer(true);\r\n    };\r\n    this.websocket.onerror = function (e) {\r\n      self.onError(e);\r\n    };\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Send a message to the Socket.IO server. The message will automatically be\r\n   * encoded in the correct message format.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.send = function (data) {\r\n    this.websocket.send(data);\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Payload\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  WS.prototype.payload = function (arr) {\r\n    for (var i = 0, l = arr.length; i < l; i++) {\r\n      this.packet(arr[i]);\r\n    }\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Disconnect the established `WebSocket` connection.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  WS.prototype.close = function () {\r\n    this.websocket.close();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Handle the errors that `WebSocket` might be giving when we\r\n   * are attempting to connect or send messages.\r\n   *\r\n   * @param {Error} e The error.\r\n   * @api private\r\n   */\r\n\r\n  WS.prototype.onError = function (e) {\r\n      if (this.connectErrorCallback !== undefined) {\r\n        this.connectErrorCallback();\r\n        this.connectErrorCallback = undefined;\r\n      }\r\n      this.socket.onError(e);\r\n  };\r\n\r\n  /**\r\n   * Returns the appropriate scheme for the URI generation.\r\n   *\r\n   * @api private\r\n   */\r\n  WS.prototype.scheme = function () {\r\n    return this.socket.options.secure ? 'wss' : 'ws';\r\n  };\r\n\r\n  /**\r\n   * Checks if the browser has support for native `WebSockets` and that\r\n   * it's not the polyfill created for the FlashSocket transport.\r\n   *\r\n   * @return {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  WS.check = function () {\r\n    return ('WebSocket' in global && !('__addTask' in WebSocket))\r\n          || 'MozWebSocket' in global;\r\n  };\r\n\r\n  /**\r\n   * Check if the `WebSocket` transport support cross domain communications.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  WS.xdomainCheck = function () {\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * Clears the event listeners attached to the `WebSocket` transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  WS.prototype.clearEventHandlers = function() {\r\n      if (this.websocket) {\r\n          this.websocket.onopen = this.websocket.onmessage = this.websocket.onclose = this.websocket.onerror = empty;\r\n      }\r\n      return this;\r\n  };\r\n\r\n  /**\r\n   * Add the transport to your public io.transports array.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.transports.push('websocket');\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  exports.XHR = XHR;\r\n\r\n  /**\r\n   * XHR constructor\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function XHR (socket) {\r\n    if (!socket) return;\r\n\r\n    io.Transport.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from Transport.\r\n   */\r\n\r\n  io.util.inherit(XHR, io.Transport);\r\n\r\n  /**\r\n   * Establish a connection\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.open = function () {\r\n    this.socket.setBuffer(false);\r\n    this.onOpen();\r\n    this.get();\r\n\r\n    // we need to make sure the request succeeds since we have no indication\r\n    // whether the request opened or not until it succeeded.\r\n    this.setCloseTimeout();\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Check if we need to send data to the Socket.IO server, if we have data in our\r\n   * buffer we encode it and forward it to the `post` method.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.payload = function (payload) {\r\n    var msgs = [];\r\n\r\n    for (var i = 0, l = payload.length; i < l; i++) {\r\n      msgs.push(io.parser.encodePacket(payload[i]));\r\n    }\r\n\r\n    this.send(io.parser.encodePayload(msgs));\r\n  };\r\n\r\n  /**\r\n   * Send data to the Socket.IO server.\r\n   *\r\n   * @param data The message\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.send = function (data) {\r\n    this.post(data);\r\n    return this;\r\n  };\r\n\r\n  function empty () { };\r\n\r\n  /**\r\n   * Posts a encoded message to the Socket.IO server.\r\n   *\r\n   * IMPORTANT: Note that only one of these requests should be in flight at any time,\r\n   * see the mutation of `doBuffer` via `setBuffer`, and where `post` is called from.\r\n   * Subsequent messages will be queued, and sent out on the next call\r\n   * to `setBuffer(false)` (e.g. from the success callback).\r\n   *\r\n   * @param {String} data A encoded message.\r\n   * @api private\r\n   */\r\n  XHR.prototype.post = function (data) {\r\n    var self = this;\r\n    this.socket.setBuffer(true);\r\n\r\n    this.sendXHR = this.request('POST');\r\n\r\n    function stateChange () {\r\n      if (this.readyState == 4) {\r\n        this.onreadystatechange = empty;\r\n\r\n        if (this.status == 200) {\r\n          clearTimeout(this.ackTimeoutTimer);\r\n\r\n          // this flushes the buffer, which can trigger another call to `post`,\r\n          // that will overwrite `self.sendXHR`\r\n          self.socket.setBuffer(false);\r\n\r\n          // at this point, self.sendXHR may already be the subsequent request\r\n        } else {\r\n          self.onClose();\r\n        }\r\n      }\r\n    }\r\n\r\n    function onload () {\r\n      this.onload = empty;\r\n      self.socket.setBuffer(false);\r\n    };\r\n\r\n    if (global.XDomainRequest && this.sendXHR instanceof XDomainRequest) {\r\n      this.sendXHR.onload = this.sendXHR.onerror = onload;\r\n    } else {\r\n      this.sendXHR.onreadystatechange = stateChange;\r\n    }\r\n\r\n    this.sendXHR.send(data);\r\n    self.sendXHR.ackTimeoutTimer = setTimeout(function () {\r\n      self.onClose();\r\n    }, self.socket.options.ackTimeoutMs);\r\n  };\r\n\r\n  /**\r\n   * Disconnects the established `XHR` connection.\r\n   *\r\n   * @returns {Transport}\r\n   * @api public\r\n   */\r\n\r\n  XHR.prototype.close = function () {\r\n    this.onClose();\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Generates a configured XHR request\r\n   *\r\n   * @param {String} url The url that needs to be requested.\r\n   * @param {String} method The method the request should use.\r\n   * @returns {XMLHttpRequest}\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.request = function (method) {\r\n    var req = io.util.request(this.socket.isXDomain())\r\n      , query = io.util.query(this.socket.options.query, 't=' + +new Date);\r\n\r\n    req.open(method || 'GET', this.prepareUrl(query), true);\r\n\r\n    var headers = this.socket.options.requestHeaders;\r\n    if (headers !== undefined) {\r\n      Object.keys(headers).forEach(function(name) {\r\n        req.setRequestHeader(name, headers[name]);\r\n      });\r\n    }\r\n\r\n    if (method == 'POST') {\r\n      try {\r\n        if (req.setRequestHeader) {\r\n          req.setRequestHeader('Content-type', 'text/plain;charset=UTF-8');\r\n        } else {\r\n          // XDomainRequest\r\n          req.contentType = 'text/plain';\r\n        }\r\n      } catch (e) {}\r\n    }\r\n\r\n    return req;\r\n  };\r\n\r\n  /**\r\n   * Returns the scheme to use for the transport URLs.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHR.prototype.scheme = function () {\r\n    return this.socket.options.secure ? 'https' : 'http';\r\n  };\r\n\r\n  /**\r\n   * Check if the XHR transports are supported\r\n   *\r\n   * @param {Boolean} xdomain Check if we support cross domain requests.\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  XHR.check = function (socket, xdomain) {\r\n\r\n    try {\r\n      var request = io.util.request(xdomain),\r\n          usesXDomReq = (global.XDomainRequest && request instanceof XDomainRequest),\r\n          socketProtocol = (socket && socket.options && socket.options.secure ? 'https:' : 'http:'),\r\n          isXProtocol = (socketProtocol != global.location.protocol);\r\n      if (request && !(usesXDomReq && isXProtocol)) {\r\n        return true;\r\n      }\r\n    } catch(e) {}\r\n\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Check if the XHR transport supports cross domain requests.\r\n   *\r\n   * @returns {Boolean}\r\n   * @api public\r\n   */\r\n\r\n  XHR.xdomainCheck = function () {\r\n    return XHR.check(null, true);\r\n  };\r\n\r\n  /**\r\n   * Clears the event listeners attached to the XHR transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  XHR.prototype.clearEventHandlers = function () {\r\n      if (this.sendXHR) {\r\n          this.sendXHR.onreadystatechange = this.sendXHR.onload = empty;\r\n      }\r\n      return this;\r\n  };\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\n/**\r\n * socket.io\r\n * Copyright(c) 2011 LearnBoost <dev@learnboost.com>\r\n * MIT Licensed\r\n */\r\n\r\n(function (exports, io, global) {\r\n\r\n  /**\r\n   * Expose constructor.\r\n   */\r\n\r\n  exports['xhr-polling'] = XHRPolling;\r\n\r\n  /**\r\n   * The XHR-polling transport uses long polling XHR requests to create a\r\n   * \"persistent\" connection with the server.\r\n   *\r\n   * @constructor\r\n   * @api public\r\n   */\r\n\r\n  function XHRPolling () {\r\n    io.Transport.XHR.apply(this, arguments);\r\n  };\r\n\r\n  /**\r\n   * Inherits from XHR transport.\r\n   */\r\n\r\n  io.util.inherit(XHRPolling, io.Transport.XHR);\r\n\r\n  /**\r\n   * Merge the properties from XHR transport\r\n   */\r\n\r\n  io.util.merge(XHRPolling, io.Transport.XHR);\r\n\r\n  /**\r\n   * Transport name\r\n   *\r\n   * @api public\r\n   */\r\n\r\n  XHRPolling.prototype.name = 'xhr-polling';\r\n\r\n  /**\r\n   * Establish a connection, for iPhone and Android this will be done once the page\r\n   * is loaded.\r\n   *\r\n   * @returns {Transport} Chaining.\r\n   * @api public\r\n   */\r\n\r\n  XHRPolling.prototype.open = function (connectErrorCallback) {\r\n    var self = this;\r\n\r\n    self.connectErrorCallback = connectErrorCallback;\r\n\r\n    io.Transport.XHR.prototype.open.call(self);\r\n    return false;\r\n  };\r\n\r\n  /**\r\n   * Starts a XHR request to wait for incoming messages.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  function empty () {};\r\n\r\n  XHRPolling.prototype.get = function () {\r\n    if (!this.isOpened) return;\r\n\r\n    var self = this;\r\n\r\n    function stateChange () {\r\n      if (this.readyState == 4) {\r\n        this.onreadystatechange = empty;\r\n\r\n        if (this.status == 200) {\r\n          self.connectErrorCallback = undefined;\r\n          self.onData(this.responseText);\r\n          self.get();\r\n        } else {\r\n          self.onClose();\r\n\r\n          if (self.connectErrorCallback !== undefined) {\r\n            self.connectErrorCallback();\r\n            self.connectErrorCallback = undefined;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    function onload () {\r\n      self.connectErrorCallback = undefined;\r\n      this.onload = empty;\r\n      this.onerror = empty;\r\n      self.onData(this.responseText);\r\n      self.get();\r\n    };\r\n\r\n    function onerror () {\r\n      self.onClose();\r\n\r\n      if (self.connectErrorCallback !== undefined) {\r\n        self.connectErrorCallback();\r\n        self.connectErrorCallback = undefined;\r\n      }\r\n    };\r\n\r\n    this.xhr = this.request();\r\n\r\n    if (global.XDomainRequest && this.xhr instanceof XDomainRequest) {\r\n      this.xhr.onload = onload;\r\n      this.xhr.onerror = onerror;\r\n    } else {\r\n      this.xhr.onreadystatechange = stateChange;\r\n    }\r\n\r\n    this.xhr.send(null);\r\n  };\r\n\r\n  /**\r\n   * Handle the unclean close behavior.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  XHRPolling.prototype.onClose = function () {\r\n    io.Transport.XHR.prototype.onClose.call(this);\r\n\r\n    if (this.xhr) {\r\n      this.xhr.onreadystatechange = this.xhr.onload = this.xhr.onerror = empty;\r\n      try {\r\n        this.xhr.abort();\r\n      } catch(e){}\r\n      this.xhr = null;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Webkit based browsers show a infinit spinner when you start a XHR request\r\n   * before the browsers onload event is called so we need to defer opening of\r\n   * the transport until the onload event is called. Wrapping the cb in our\r\n   * defer method solve this.\r\n   *\r\n   * @param {Socket} socket The socket instance that needs a transport\r\n   * @param {Function} fn The callback\r\n   * @api private\r\n   */\r\n\r\n  XHRPolling.prototype.ready = function (socket, fn) {\r\n    var self = this;\r\n\r\n    io.util.defer(function () {\r\n      fn.call(self);\r\n    });\r\n  };\r\n\r\n   /**\r\n   * Clears the event listeners attached to the XHR transport object.\r\n   *\r\n   * @api private\r\n   */\r\n  XHRPolling.prototype.clearEventHandlers = function () {\r\n      io.Transport.XHR.prototype.clearEventHandlers.call(this);\r\n\r\n      if (this.xhr) {\r\n          this.xhr.onreadystatechange = this.xhr.onload = this.xhr.onerror = empty;\r\n      }\r\n      return this;\r\n  }\r\n\r\n  /**\r\n   * Add the transport to your public io.transports array.\r\n   *\r\n   * @api private\r\n   */\r\n\r\n  io.transports.push('xhr-polling');\r\n\r\n})(\r\n    'undefined' != typeof io ? io.Transport : module.exports\r\n  , 'undefined' != typeof io ? io : module.parent.exports\r\n  , 'undefined' === typeof global ? window : global\r\n);\r\n\r\nexports.io = io;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib_temp/socket.io.js\n// module id = 12\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 13\n// module chunks = 0","module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/module.js\n// module id = 14\n// module chunks = 0","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { Timeout, Timespan, toJson } from './Common';\r\nimport { CLIENT_VERSION } from './Constants';\r\nimport { HttpHeaders, ITelemetrySender, LogProvider, TrouterTelemetrySettings } from './Interfaces';\r\nimport { IClientInfo, ITrouterRequest, ServerState } from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\n\r\n/**\r\n * Data for trouter response\r\n */\r\nexport class ResponseData {\r\n    public status: number = 200;\r\n    public headers?: HttpHeaders = {};\r\n    public body: string = '';\r\n    public sentTS: number | undefined;\r\n\r\n    public constructor(public id: number) { }\r\n}\r\n\r\n// Possible telemetry events\r\nexport enum ClientEventName {\r\n    Connected = 'trouter_js_client_connected',\r\n    Disconnected = 'trouter_js_client_disconnected',\r\n    Error = 'trouter_js_client_error',\r\n    Progress = 'trouter_js_client_progress',\r\n    Response = 'trouter_js_client_response',\r\n    Request = 'trouter_js_client_request',\r\n    CheckConnection = 'trouter_js_client_check_connection',\r\n    Registration = 'trouter_js_client_registration',\r\n    Unregistration = 'trouter_js_client_unregistration'\r\n}\r\nexport type EnabledEvents = { [key in ClientEventName]: boolean };\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\r\nexport interface IAllTelemetryEventsSettings extends EnabledEvents {\r\n}\r\n\r\n/**\r\n * Stores one step of connection process\r\n */\r\nexport class TrackerStep {\r\n    public constructor(\r\n        public stepName: string,\r\n        public operation: string,\r\n        public delta: number,\r\n        public ts: number,\r\n        public error?: string\r\n    ) { }\r\n}\r\n\r\ntype PropertyBagValue = number | string | boolean | { [key: number]: boolean } | undefined;\r\n\r\n/**\r\n * Base class for something that can be used as a property bag\r\n */\r\nexport class Properties {\r\n    hasError?: boolean;\r\n    error?: string;\r\n    [index: string]: PropertyBagValue;\r\n}\r\n\r\n/**\r\n * Information about connection\r\n */\r\nclass ConnectedInfo {\r\n    public numberOfPingReplies: number = 0;\r\n    public connectedTimestamp: number = 0;\r\n    public isNewUrl: boolean = false;\r\n    public transportType: string = '';\r\n    public connectionNumber: number = 0;\r\n}\r\n\r\n/**\r\n * Default values for IEventLogSettings\r\n */\r\nclass EventLogSettings implements TrouterTelemetrySettings, IAllTelemetryEventsSettings {\r\n    public enabled = false;\r\n    public numberOfStepsToMaintain = 40;\r\n    public logHealthCheckError = false;\r\n    public sendProgressTimeoutSecs = 55;\r\n    public logSendPingError = false;\r\n    public maxBackoffInMs = 120000;\r\n\r\n    public trouter_js_client_connected = false;\r\n    public trouter_js_client_disconnected = false;\r\n    public trouter_js_client_error = false;\r\n    public trouter_js_client_progress = false;\r\n    public trouter_js_client_response = false;\r\n    public trouter_js_client_request = false;\r\n    public trouter_js_client_registration = false;\r\n    public trouter_js_client_unregistration = false;\r\n\r\n    /** This event is ENABLED by default */\r\n    public trouter_js_client_check_connection = true;\r\n}\r\n\r\n/**\r\n * Telemetry sender\r\n */\r\nexport class ConnectionTracker {\r\n    private logger: Logger;\r\n    private steps: TrackerStep[];\r\n    private connectionAttempt: number;\r\n    private totalStepCount: number;\r\n    private beginTimestamp: Timespan;\r\n    private eventLogSettings: TrouterTelemetrySettings;\r\n    private connectedInfo: ConnectedInfo;\r\n    private progressTimeout?: Timeout;\r\n    private eventLogger?: ITelemetrySender;\r\n\r\n    public constructor(\r\n        logfunc: LogProvider,\r\n        private clientId: number,\r\n        private clientInfo: Readonly<IClientInfo>,\r\n        private getServerState: () => ServerState,\r\n        private endpointId?: string,\r\n        public clientCorrelationID?: string,\r\n        private environment?: string\r\n    ) {\r\n        this.logger = new Logger('ConnectionTracker', logfunc);\r\n        this.clientCorrelationID = clientCorrelationID !== undefined ? clientCorrelationID : '';\r\n        this.steps = [];\r\n        this.connectionAttempt = 0;\r\n        this.totalStepCount = 0;\r\n        this.beginTimestamp = new Timespan();\r\n        this.eventLogSettings = new EventLogSettings();\r\n        this.connectedInfo = new ConnectedInfo();\r\n    }\r\n\r\n    public enable(telemetrySender: ITelemetrySender) {\r\n        this.eventLogSettings.enabled = true;\r\n        this.eventLogger = telemetrySender;\r\n    }\r\n\r\n    public disable() {\r\n        this.eventLogSettings.enabled = false;\r\n    }\r\n\r\n    public sendProgress(context: Properties): void {\r\n        // connect truncates steps array. this check ensures that a progress event is only sent out if the client is not connected\r\n        if (this.steps.length > 0) {\r\n            this.sendTelemetry(ClientEventName.Progress, context, this.steps);\r\n        }\r\n    }\r\n\r\n    public cancelProgressTimer(): void {\r\n        if (this.progressTimeout !== undefined) {\r\n            clearTimeout(this.progressTimeout);\r\n            this.progressTimeout = undefined;\r\n        }\r\n    }\r\n\r\n    public resetProgressSendTimer() {\r\n        this.cancelProgressTimer();\r\n\r\n        // send connection steps after a timeout\r\n        // this timeout may fire if auth callback never comes or the client is stuck in a loop to get connected\r\n        if (this.eventLogSettings.sendProgressTimeoutSecs !== undefined && this.eventLogSettings.sendProgressTimeoutSecs > 0) {\r\n            this.progressTimeout = setTimeout(() => {\r\n                this.sendProgress({\r\n                    reason: 'timeout',\r\n                    timeoutSecs: this.eventLogSettings.sendProgressTimeoutSecs\r\n                });\r\n            }, 1000 * this.eventLogSettings.sendProgressTimeoutSecs);\r\n        }\r\n    }\r\n\r\n    public setConnectedInfo(isNewUrl: boolean, transportType: string): void {\r\n        this.connectedInfo.numberOfPingReplies = 0;\r\n        this.connectedInfo.connectedTimestamp = Date.now();\r\n        this.connectedInfo.isNewUrl = isNewUrl;\r\n        this.connectedInfo.transportType = transportType;\r\n        ++this.connectedInfo.connectionNumber;\r\n    }\r\n\r\n    public clearConnectedInfo(): void {\r\n        this.connectedInfo.numberOfPingReplies = 0;\r\n        this.connectedInfo.connectedTimestamp = 0;\r\n        this.connectedInfo.isNewUrl = true;\r\n        this.connectedInfo.transportType = '';\r\n    }\r\n\r\n    // Copies from\r\n    // source {\r\n    //    propName: value\r\n    // }\r\n    // to\r\n    // dest {\r\n    //    propName: { value: actualValue }\r\n    // }\r\n    public copyProperties(dest: Record<string, { value: PropertyBagValue }>, source: Properties): void {\r\n        // copy properties from source and add in a format expected by logger\r\n        for (const prop of Object.keys(source)) {\r\n            if (source[prop] !== undefined) {\r\n                // replace hyphen by _\r\n                dest[prop.replace(/-/g, '_')] = { value: source[prop] };\r\n            }\r\n        }\r\n    }\r\n\r\n    public increasePingResponseCount() {\r\n        ++this.connectedInfo.numberOfPingReplies;\r\n    }\r\n\r\n    /**\r\n     * @param eventName Telemetry event name\r\n     * @param eventProperties Event property bag\r\n     * @param progress\r\n     */\r\n    public sendTelemetry(\r\n        eventName: ClientEventName,\r\n        eventProperties: Properties,\r\n        progress: unknown[]\r\n    ) {\r\n        try {\r\n            if (this.eventLogSettings.enabled === true\r\n                && this.eventLogSettings[eventName] === true\r\n                && this.eventLogger !== undefined\r\n            ) {\r\n                const serverState = this.getServerState();\r\n                const clientEvent = {\r\n                    name: eventName,\r\n                    properties: {\r\n                        connectionAttempt: { value: this.connectionAttempt },\r\n                        epid: { value: this.endpointId },\r\n                        clientCorrelationID: { value: this.clientCorrelationID },\r\n                        steps: { value: toJson(progress) },\r\n                        clientID: { value: this.clientId },\r\n                        eventVersion: { value: 3 }, // version of telemetry events,\r\n                        environment: { value: this.environment },\r\n                        cv: { value: CLIENT_VERSION },\r\n                        ua: { value: this.clientInfo.ua },\r\n\r\n                        // Copy ServerState\r\n                        connectionId: { value: serverState.connectionId },\r\n                        connectedClientId: { value: serverState.connectedClientId },\r\n                        domId: { value: serverState.domId },\r\n                        url: { value: serverState.unsecureUrl },\r\n                        surl: { value: serverState.url },\r\n                        ttlInSecs: { value: serverState.getRemainingTtlInSec() },\r\n\r\n                        // Copy this.connectedInfo\r\n                        numberOfPingReplies: { value: this.connectedInfo.numberOfPingReplies },\r\n                        connectedTimestamp: { value: this.connectedInfo.connectedTimestamp },\r\n                        isNewUrl: { value: this.connectedInfo.isNewUrl },\r\n                        transportType: { value: this.connectedInfo.transportType },\r\n                        connectionNumber: { value: this.connectedInfo.connectionNumber }\r\n                    }\r\n                };\r\n\r\n                this.copyProperties(clientEvent.properties, eventProperties);\r\n\r\n                this.eventLogger.logEvent(clientEvent);\r\n            }\r\n        } catch (exc) {\r\n            this.logger.warn(`error in sending event ${eventName}: ${toJson(exc)}`);\r\n        }\r\n    }\r\n\r\n    public createStep(stepName: string, operation: string, error?: string): TrackerStep {\r\n        return new TrackerStep(\r\n            stepName,\r\n            operation,\r\n            this.beginTimestamp.duration,\r\n            Date.now(),\r\n            error);\r\n    }\r\n\r\n    public addStep(tag: string, progressHint: string, error?: string): void {\r\n        if (this.eventLogSettings.enabled === false) {\r\n            return;\r\n        }\r\n\r\n        if (this.steps.length === 0) {\r\n            this.beginTimestamp.reset();\r\n        }\r\n        this.steps.push(this.createStep(tag, progressHint, error));\r\n        ++this.totalStepCount;\r\n        // do not maintain an ever growing list of steps. send a progress event with what is collected so far and clear steps\r\n        // there should be enough context in any event for the server to group events created for the sameonnection\r\n        if (this.eventLogSettings.numberOfStepsToMaintain !== undefined\r\n            && this.steps.length > this.eventLogSettings.numberOfStepsToMaintain\r\n        ) {\r\n            const progress = this.steps.slice(0);\r\n            this.steps.length = 0;\r\n            this.sendTelemetry(ClientEventName.Progress, { reason: 'flush' }, progress);\r\n        }\r\n    }\r\n\r\n    public trackStart(tag: string): void {\r\n        this.addStep(tag, 'start');\r\n    }\r\n\r\n    public trackEnd(tag: string): void {\r\n        this.addStep(tag, 'end');\r\n    }\r\n\r\n    public trackError(tag: string, error: string, addStep: boolean = true, subOperation?: string) {\r\n        if (tag === 'health' && this.eventLogSettings.logHealthCheckError !== true) {\r\n            return;\r\n        }\r\n        if (tag === 'ping' && this.eventLogSettings.logSendPingError === false) {\r\n            return;\r\n        }\r\n\r\n        if (subOperation === undefined) {\r\n            subOperation = 'error';\r\n        }\r\n\r\n        if (addStep === true) {\r\n            this.addStep(tag, subOperation, error);\r\n        }\r\n        this.sendTelemetry(ClientEventName.Error, {}, [this.createStep(tag, subOperation, error)]);\r\n    }\r\n\r\n    public trackProgress(tag: string, subOperation: string): void {\r\n        this.addStep(tag, subOperation);\r\n    }\r\n\r\n    public trackConnected(isNewUrl: boolean, transportType: string): void {\r\n        this.setConnectedInfo(isNewUrl, transportType);\r\n        const progress = this.steps.slice(0);\r\n        const totalSteps = this.totalStepCount;\r\n        const connectionDuration = this.beginTimestamp.duration;\r\n\r\n        // clear steps collected\r\n        this.steps.length = 0;\r\n        this.totalStepCount = 0;\r\n\r\n        this.sendTelemetry(ClientEventName.Connected, {\r\n            stepCount: progress.length,\r\n            totalStepCount: totalSteps,\r\n            connectionEstablishmentMs_Total: connectionDuration\r\n        }, progress);\r\n\r\n        this.cancelProgressTimer();\r\n    }\r\n\r\n    public getSessionLength(): number {\r\n        return Date.now() - this.connectedInfo.connectedTimestamp;\r\n    }\r\n\r\n    public trackDisconnected(context: Properties): void {\r\n        context.sessionLengthMS = this.getSessionLength();\r\n        this.sendTelemetry(ClientEventName.Disconnected, context, []);\r\n        this.resetProgressSendTimer();\r\n    }\r\n\r\n    public trackNewConnection(): void {\r\n        ++this.connectionAttempt;\r\n    }\r\n\r\n    public trackRequest(request?: ITrouterRequest, errorMsg?: string): void {\r\n        const context: Properties = {};\r\n        if (errorMsg !== undefined) {\r\n            context.hasError = true;\r\n            context.error = errorMsg;\r\n        }\r\n        try {\r\n            if (request) {\r\n                context.requestID = request.id;\r\n                context.httpMethod = request.method;\r\n                context.url = request.url;\r\n                context.bodyLength = request.body.length;\r\n                context.shortUrl = request.shortUrl;\r\n                context.requestTimeStamp = request.startTS;\r\n                context.correlationVector = request.correlationVector;\r\n                const headers = request.headers;\r\n                for (const header of Object.keys(headers)) {\r\n                    context[header] = headers[header];\r\n                }\r\n            }\r\n        } catch (exc) {\r\n            context.hasError = true;\r\n            context.error = `${context.error} error creating request context ${toJson(exc)}`;\r\n        }\r\n\r\n        this.sendTelemetry(ClientEventName.Request, context, []);\r\n    }\r\n\r\n    public trackResponse(request?: ITrouterRequest, latencyMS?: number, responseData?: ResponseData, errorMsg?: string): void {\r\n        const context: Properties = {};\r\n        if (errorMsg !== undefined) {\r\n            context.hasError = true;\r\n            context.error = errorMsg;\r\n        }\r\n\r\n        try {\r\n            context.responseTimestamp = responseData !== undefined ? responseData.sentTS : Date.now();\r\n            if (request) {\r\n                context.requestID = request.id;\r\n                context.httpMethod = request.method;\r\n                context.shortUrl = request.shortUrl;\r\n                context.correlationVector = request.correlationVector;\r\n                const headers = request.headers;\r\n                for (const header of Object.keys(headers)) {\r\n                    context[header] = headers[header];\r\n                }\r\n            }\r\n\r\n            if (responseData) {\r\n                context.latencyMS = latencyMS;\r\n                context.responseCode = responseData.status;\r\n                context.responseLength = responseData.body.length;\r\n            }\r\n        } catch (exc) {\r\n            context.hasError = true;\r\n            context.error = `${context.error} error creating response context ${toJson(exc)}`;\r\n        }\r\n\r\n        this.sendTelemetry(ClientEventName.Response, context, []);\r\n    }\r\n\r\n    public sendResponseError(errorMsg: string, request?: ITrouterRequest, responseData?: ResponseData): void {\r\n        this.trackResponse(request, undefined, responseData, errorMsg);\r\n    }\r\n\r\n    public close(): void {\r\n        this.sendProgress({\r\n            reason: 'closed'\r\n        });\r\n        this.steps.length = 0;\r\n        this.cancelProgressTimer();\r\n    }\r\n\r\n    public mergeSettings(settings?: TrouterTelemetrySettings) {\r\n        if (!settings) {\r\n            return;\r\n        }\r\n\r\n        this.eventLogSettings.numberOfStepsToMaintain = Math.min(40,\r\n            Math.max(10, (settings.numberOfStepsToMaintain !== undefined ? settings.numberOfStepsToMaintain : 0)));\r\n\r\n        // min of 55 secs and max allowed is 1 hr\r\n        const newProgressTimeout = Math.min(3600,\r\n            Math.max(55, settings.sendProgressTimeoutSecs !== undefined ? settings.sendProgressTimeoutSecs : 0));\r\n\r\n        this.eventLogSettings.logHealthCheckError = settings.logHealthCheckError;\r\n        this.eventLogSettings.logSendPingError = settings.logSendPingError;\r\n\r\n        // Copy enable/disable flags for all telemetry events\r\n        for (const iterator of Object.keys(ClientEventName).map(k => ClientEventName[<keyof typeof ClientEventName>k])) {\r\n            if (settings[iterator] !== undefined) {\r\n                this.eventLogSettings[iterator] = settings[iterator];\r\n            }\r\n        }\r\n\r\n        if (this.eventLogSettings.sendProgressTimeoutSecs !== newProgressTimeout) {\r\n            this.eventLogSettings.sendProgressTimeoutSecs = newProgressTimeout;\r\n            this.resetProgressSendTimer();\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/ConnectionTracker.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { Logger } from './Logger';\r\nexport type SocketIoEventKind = 'socketerror' | 'reconnecterror' | 'disconnect';\r\n// Empty string means normal disconnect\r\nexport type DisconnectReasonKind = '' | 'dup' | 'unauthorized' | 'badrequest' | 'serviceunavailable' | SocketIoEventKind | 'unknown' | 'skypetoken-deprecated';\r\n\r\n/**\r\n * Disconnect reason format sent when using the /v4/c protocol as part of the socket.io disconnect (`0::`),\r\n * e.g.\r\n * - `0::`\r\n * - `0:::dup`\r\n * - `0:::{\"reason\":\"unauthorized\",\"claims\":\"Bearer token_types=\\\"skype,aad,cae\\\"\"}`\r\n *\r\n * Additionally, it is also used internally for other socket.io events calling `TrouterFsm.onSocketDisconnect` (see usages).\r\n */\r\nexport class DisconnectReason {\r\n    constructor(\r\n        public readonly reason: DisconnectReasonKind,\r\n        public readonly claims?: string,\r\n        public readonly details?: string\r\n    ) { }\r\n\r\n    public static fromRawReason(rawReason: string, logger?: Logger): DisconnectReason {\r\n        if (rawReason === '' || rawReason === 'dup') {\r\n            return new DisconnectReason(rawReason);\r\n        }\r\n\r\n        try {\r\n            const parsedReason = <Partial<DisconnectReason>>JSON.parse(rawReason);\r\n            if (typeof parsedReason !== 'object' || parsedReason.reason === undefined) {\r\n                logger?.error('invalid disconnect reason format');\r\n\r\n                return new DisconnectReason('unknown', undefined, rawReason);\r\n            }\r\n\r\n            return new DisconnectReason(parsedReason.reason, parsedReason.claims, parsedReason.details);\r\n        } catch (e) {\r\n            // Non-JSON string from the `0::` socket.io message is just set \"as is\" as details\r\n            return new DisconnectReason('disconnect', undefined, rawReason);\r\n        }\r\n    }\r\n\r\n    public static fromSocketIoEventData(event: SocketIoEventKind, arg: unknown): DisconnectReason | undefined {\r\n        return typeof arg === 'string' ? new DisconnectReason(event, undefined, arg) : undefined;\r\n    }\r\n\r\n    public toTelemetryString(): string | undefined {\r\n        if (this.reason === 'socketerror' || this.reason === 'reconnecterror' || this.reason === 'disconnect') {\r\n            return this.details;\r\n        }\r\n\r\n        return this.reason;\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/DisconnectReason.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { Timeout } from './Common';\r\nimport { Logger } from './Logger';\r\n\r\n/**\r\n * Settings for detecting times when the timeouts were not called - such as computer sleeping,\r\n * where we want to reset the backoff afterwards\r\n */\r\nexport type GapDetectionSettings = {\r\n    /** backoff will be reset if the detected wait was this times the expected wait */\r\n    tolerance: number,\r\n\r\n    /** minimum wait after which backoff will be reset, to avoid spurious resets due to lack of timer precision */\r\n    minimumWaitMs: number\r\n}\r\n\r\n/**\r\n * Executes callbacks with exponential backoff\r\n */\r\nexport class ExponentialBackoff {\r\n    private backoffId = 0;\r\n    private backoffCount = 0;\r\n    private timerHandle?: Timeout;\r\n    private callback?: (waitStart?: number, expectedWait?: number) => void;\r\n    private previousCompleteTime?: number;\r\n\r\n    public constructor(\r\n        private logger: Logger,\r\n        private maxBackoffInMs: number,\r\n        private gapDetectionSettings: GapDetectionSettings = { tolerance: 2, minimumWaitMs: 10_000 }\r\n    ) { }\r\n\r\n    private static calculateNextBackoffMs(backoffCount: number, maxBackoffInMs: number): number {\r\n        const fudge = 1 + (Math.random() - 0.5) * 0.4; // +/- 20%\r\n        let backoff = 1000 * Math.pow(2, backoffCount) * fudge; // 1s initial\r\n        backoff = Math.round(backoff);\r\n\r\n        return Math.min(maxBackoffInMs, backoff);\r\n    }\r\n\r\n    public setMaxBackoffMs(ms: number) {\r\n        this.maxBackoffInMs = ms;\r\n    }\r\n\r\n    public backoff(taskName: string, handler: () => void): void {\r\n        if (this.timerHandle !== undefined) {\r\n            this.logger.debug('Clearing current back off');\r\n            clearTimeout(this.timerHandle);\r\n            this.timerHandle = undefined;\r\n        }\r\n\r\n        // This detects a situation where the computer/tab likely went to sleep while NOT waiting on backoff,\r\n        // but doing other things (e.g. waiting on fetch, waiting on token provider, etc.),\r\n        // and woke up much later, the operation having failed, triggering a retry after backoff.\r\n        // If a lot of time has passed in sleep, we want to reset that backoff.\r\n        //\r\n        // We are counting on the fact that the operation (fetch, token wait, etc.) should never take significantly longer\r\n        // than the maximum allowed backoff time, to avoid unwanted resets.\r\n        //\r\n        // (If computer woke up while it WAS waiting on backoff, after a long time, it would likely complete that wait\r\n        // immediately, so previousCompleteTime would be very close to the next attempt, thus not triggering this.)\r\n        if (this.previousCompleteTime !== undefined) {\r\n            const elapsed = Date.now() - this.previousCompleteTime;\r\n            // The time to reset this needs to be much longer here, as the operation itself can take quite a long time even under normal circumstances.\r\n            // In practice, based on settings as of February 2024, this can be triggered after a sleep that in some cases needs to be over 10 minutes.\r\n            if (elapsed > this.maxBackoffInMs * this.gapDetectionSettings.tolerance && elapsed > this.gapDetectionSettings.minimumWaitMs) {\r\n                this.logger.info(`Back off for ${taskName} with ID ${this.backoffId} will be reset due to a lot of time having passed since the previous backoff (${elapsed} ms)`);\r\n                this.backoffCount = 0;\r\n                this.previousCompleteTime = undefined;\r\n            }\r\n        }\r\n\r\n        const backoffMs = ExponentialBackoff.calculateNextBackoffMs(this.backoffCount, this.maxBackoffInMs);\r\n        this.backoffId++;\r\n        this.backoffCount++;\r\n        this.logger.info(`Backing off ${taskName} for ${backoffMs} milliseconds with ID ${this.backoffId}`);\r\n        this.callback = (waitStart?: number, expectedWait?: number) => {\r\n            if (shouldReset(waitStart, expectedWait, this.gapDetectionSettings)) {\r\n                // Most likely computer/tab went to sleep while waiting on backoff and woke up much later\r\n                this.logger.info(`Back off for ${taskName} with ID ${this.backoffId} will be reset due to the wait (${Date.now() - (waitStart ?? 0)} ms) being longer than expected (${expectedWait} ms)`);\r\n                this.backoffCount = 0;\r\n            }\r\n            this.logger.info(`Back off for ${taskName} with ID ${this.backoffId} complete, invoking handler`);\r\n            this.timerHandle = undefined;\r\n            this.callback = undefined;\r\n            this.previousCompleteTime = Date.now();\r\n            handler();\r\n        };\r\n        const backoffWaitStart = Date.now();\r\n        this.timerHandle = setTimeout(\r\n            () => this.callback?.(backoffWaitStart, backoffMs),\r\n            backoffMs\r\n        );\r\n    }\r\n\r\n    /// Stop the backoff if active, do not call the handler and reset to the initial/shortest period again\r\n    public reset(): void {\r\n        if (this.timerHandle !== undefined) {\r\n            this.logger.debug(`Resetting back off with ID ${this.backoffId}`);\r\n            clearTimeout(this.timerHandle);\r\n            this.timerHandle = undefined;\r\n            this.callback = undefined;\r\n        }\r\n        this.backoffCount = 0;\r\n    }\r\n\r\n    /// Call the handler right now if active and reset to the initial/shortest period again\r\n    public expediteIfPending(): void {\r\n        this.backoffCount = 0;\r\n        if (this.timerHandle !== undefined) {\r\n            this.logger.debug(`Expediting back off with ID ${this.backoffId}`);\r\n            clearTimeout(this.timerHandle);\r\n            this.timerHandle = undefined;\r\n            const callback = this.callback;\r\n            this.callback = undefined;\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction shouldReset(waitStart: number|undefined, expectedWait: number|undefined, settings: GapDetectionSettings): boolean {\r\n    if (waitStart === undefined || expectedWait === undefined) {\r\n        return false;\r\n    }\r\n    const actualWait = Date.now() - waitStart;\r\n    return actualWait > expectedWait * settings.tolerance && actualWait > settings.minimumWaitMs;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/ExponentialBackoff.ts","import { IAudienceSubscriptionsResponse, LogProvider, TrouterState } from \"./Interfaces\";\r\nimport { ITrouterRequest, ITrouterResponse, IMessageLossIndicator } from \"./InternalInterfaces\";\r\nimport { IManagerConsumer, ReconnectReason, TrouterConnection } from \"./TrouterConnection\";\r\nimport { State } from \"./TrouterFsm\";\r\n\r\n/**\r\n * Intercepts calls from TrouterConnection to TrouterManager, to only allow\r\n * switching to the \"connected\" state after the connection\r\n * has been successfully registered, and disconnects Trouter if an existing\r\n * registration expires or gets revoked.\r\n * \r\n * One instance of this wrappere exists per each TrouterConnection (though wrapping the same TrouterManger instance),\r\n * this object thus holds state specific to a particular TrouterConnection.\r\n */\r\nexport class RegistrationEnforcer implements IManagerConsumer {\r\n    constructor(\r\n        private wrapped: IManagerConsumer,\r\n        private shouldConnectionDependOnRegistration: () => boolean,\r\n        private shouldHoldBackEvents: () => boolean\r\n    ) {\r\n    }\r\n\r\n    private isRegistered = false;\r\n\r\n    private heldBackEvents: Array<HeldBackEvent> = [];\r\n\r\n    onDownstreamRequest(connection: TrouterConnection, request: ITrouterRequest, response: ITrouterResponse): void {\r\n        this.passIfRegisteredOrNotNeeded('onDownstreamRequest', connection, request, response);\r\n    }\r\n\r\n    onConnected(connection: TrouterConnection): void {\r\n        this.passIfRegisteredOrNotNeeded('onConnected', connection);\r\n    }\r\n\r\n    onRegistered(connection: TrouterConnection): void {\r\n        this.isRegistered = true;\r\n        this.wrapped.onRegistered(connection);\r\n        this.fireHeldBackEvents();\r\n    }\r\n\r\n    onUnregistered(connection: TrouterConnection): void {\r\n        this.isRegistered = false;\r\n        this.wrapped.onUnregistered(connection);\r\n        if (connection.getState() === State.Connected && this.shouldConnectionDependOnRegistration()) {\r\n            connection.forceReconnectDueToNoRegistration();\r\n        }\r\n    }\r\n\r\n    onReconnecting(connection: TrouterConnection): void {\r\n        this.wrapped.onReconnecting(connection);\r\n    }\r\n\r\n    onReconnectIsRequired(connection: TrouterConnection, useConnectParamsFromCache: boolean, reason: ReconnectReason): void {\r\n        this.wrapped.onReconnectIsRequired(connection, useConnectParamsFromCache, reason);\r\n    }\r\n\r\n    onDisconnected(connection: TrouterConnection): void {\r\n        this.isRegistered = false;\r\n        this.dropHeldBackEvents();\r\n        this.wrapped.onDisconnected(connection);\r\n    }\r\n\r\n    onTerminalError(connection: TrouterConnection): void {\r\n        this.wrapped.onTerminalError(connection);\r\n    }\r\n\r\n    onConnectionParametersUpdated(connectParams: Record<string, unknown>): void {\r\n        this.wrapped.onConnectionParametersUpdated(connectParams);\r\n    }\r\n\r\n    onTrouterMessageLost(flowTags: IMessageLossIndicator[]): void {\r\n        this.passIfRegisteredOrNotNeeded('onTrouterMessageLost', flowTags);\r\n    }\r\n\r\n    onUserActivityStateAccepted(cv: string): void {\r\n        this.passIfRegisteredOrNotNeeded('onUserActivityStateAccepted', cv);\r\n    }\r\n\r\n    onAudiencesSetResolved(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void {\r\n        this.passIfRegisteredOrNotNeeded('onAudiencesSetResolved', audienceSubscriptionsResponse, cv);\r\n    }\r\n\r\n    getState(): TrouterState {\r\n        return this.wrapped.getState();\r\n    }\r\n\r\n    private holdBackEvent<T extends HeldBackEventKind>(\r\n        kind: T,\r\n        ...args: Parameters<RegistrationEnforcer[T]>\r\n    ) {\r\n        this.heldBackEvents.push({ kind, args });\r\n    }\r\n\r\n    private passIfRegisteredOrNotNeeded<T extends HeldBackEventKind>(kind: T, ...args: Parameters<RegistrationEnforcer[T]>) {\r\n        const connectionDependsOnRegistration = this.shouldConnectionDependOnRegistration();\r\n        const holdBackEvents = this.shouldHoldBackEvents();\r\n        // replay existing events if we previously needed registration but now don't, or if we should not hold back events anymore\r\n        if (!connectionDependsOnRegistration || !holdBackEvents) {\r\n            this.fireHeldBackEvents(\r\n                connectionDependsOnRegistration ?\r\n                    e => e.kind !== 'onConnected' :\r\n                    undefined\r\n            );\r\n        }\r\n\r\n        if (this.isRegistered || !connectionDependsOnRegistration || (holdBackEvents === false && kind !== 'onConnected')) {\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-return,@typescript-eslint/no-explicit-any\r\n            (this.wrapped[kind] as any)(...args);\r\n        } else {\r\n            this.holdBackEvent(kind, ...args);\r\n        }\r\n    }\r\n\r\n    private fireHeldBackEvents(filter?: (e: HeldBackEvent) => boolean){\r\n        for (const event of this.heldBackEvents) {\r\n            if (filter !== undefined && !filter(event)) {\r\n                continue;\r\n            }\r\n\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call,@typescript-eslint/no-unsafe-return,@typescript-eslint/no-explicit-any\r\n            (this.wrapped[event.kind] as any)(...event.args);\r\n        }\r\n        \r\n        if (filter === undefined) {\r\n            this.heldBackEvents = [];\r\n        } else {\r\n            // keep everything that wasn't fired\r\n            this.heldBackEvents = this.heldBackEvents.filter(e => !filter(e));\r\n        }\r\n    }\r\n\r\n    private dropHeldBackEvents() {\r\n        this.heldBackEvents = [];\r\n    }\r\n}\r\n\r\n/**\r\n * Wrapper for debugging and tests, can be used to compare\r\n * the original and filtered events, by creating e.g.\r\n * ```\r\n * new LoggingManagerConsumer(\r\n *   new RegistrationEnforcer(\r\n *     new LoggingManagerConsumer(this, 'inner'),\r\n *     true\r\n *   ),\r\n * 'outer')\r\n * ```\r\n * where the outer one will log all the calls from TrouterConnection,\r\n * and the inner one will only log the calls that go through (with the\r\n * resulting order/delay/etc.)\r\n */\r\nexport class LoggingManagerConsumer implements IManagerConsumer {\r\n    constructor(\r\n        private wrapped: IManagerConsumer,\r\n        private prefix: string,\r\n        private logger?: LogProvider,\r\n        private onEventAction?: (name: string, jsonArgs: string) => void\r\n    ) {\r\n    }\r\n\r\n    private onEvent(name: string, jsonArgs: string) {\r\n        if (this.onEventAction !== undefined) {\r\n            this.onEventAction(name, jsonArgs);\r\n        } else {\r\n            (this.logger ?? console).log(`${this.prefix} TracingEnforcer: ${name}(${jsonArgs})`);    \r\n        }\r\n    }\r\n\r\n    onDownstreamRequest(connection: TrouterConnection, request: ITrouterRequest, response: ITrouterResponse): void {\r\n        this.onEvent('onDownstreamRequest', JSON.stringify({ request, response }));\r\n        this.wrapped.onDownstreamRequest(connection, request, response);\r\n    }\r\n\r\n    onConnected(connection: TrouterConnection): void {\r\n        this.onEvent('onConnected', connection.getState().toString());\r\n        this.wrapped.onConnected(connection);\r\n    }\r\n\r\n    onRegistered(connection: TrouterConnection): void {\r\n        this.onEvent('onRegistered', connection.getState().toString());\r\n        this.wrapped.onRegistered(connection);\r\n    }\r\n\r\n    onUnregistered(connection: TrouterConnection): void {\r\n        this.onEvent('onUnregistered', connection.getState().toString());\r\n        this.wrapped.onUnregistered(connection);\r\n    }\r\n\r\n    onReconnecting(connection: TrouterConnection): void {\r\n        this.onEvent('onReconnecting', connection.getState().toString());\r\n        this.wrapped.onReconnecting(connection);\r\n    }\r\n\r\n    onReconnectIsRequired(connection: TrouterConnection, useConnectParamsFromCache: boolean, reason: ReconnectReason): void {\r\n        this.onEvent('onReconnectIsRequired', JSON.stringify({ connection: connection.getState().toString(), useConnectParamsFromCache, reason }));\r\n        this.wrapped.onReconnectIsRequired(connection, useConnectParamsFromCache, reason);\r\n    }\r\n\r\n    onDisconnected(connection: TrouterConnection): void {\r\n        this.onEvent('onDisconnected', connection.getState().toString());\r\n        this.wrapped.onDisconnected(connection);\r\n    }\r\n\r\n    onTerminalError(connection: TrouterConnection): void {\r\n        this.onEvent('onTerminalError', JSON.stringify({ connection }));\r\n        this.wrapped.onTerminalError(connection);\r\n    }\r\n\r\n    onConnectionParametersUpdated(connectParams: Record<string, unknown>): void {\r\n        this.onEvent('onConnectionParametersUpdated', JSON.stringify({ connectParams }));\r\n        this.wrapped.onConnectionParametersUpdated(connectParams);\r\n    }\r\n\r\n    onTrouterMessageLost(flowTags: IMessageLossIndicator[]): void {\r\n        this.onEvent('onTrouterMessageLost', JSON.stringify({ flowTags }));\r\n        this.wrapped.onTrouterMessageLost(flowTags);\r\n    }\r\n\r\n    onUserActivityStateAccepted(cv: string): void {\r\n        this.onEvent('onUserActivityStateAccepted', JSON.stringify({ cv }));\r\n        this.wrapped.onUserActivityStateAccepted(cv);\r\n    }\r\n\r\n    onAudiencesSetResolved(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void {\r\n        this.onEvent('onAudiencesSetResolved', JSON.stringify({ audienceSubscriptionsResponse, cv }));\r\n        this.wrapped.onAudiencesSetResolved(audienceSubscriptionsResponse, cv);\r\n    }\r\n\r\n    getState(): TrouterState {\r\n        return this.wrapped.getState();\r\n    }\r\n}\r\n\r\n// Enforces compile-time type safety of function arguments\r\ntype HeldBackEventKind =\r\n    'onConnected' |\r\n    'onDownstreamRequest' |\r\n    'onTrouterMessageLost' |\r\n    'onUserActivityStateAccepted' |\r\n    'onAudiencesSetResolved';\r\n\r\ntype HeldBackEvent = {\r\n    kind: HeldBackEventKind;\r\n    args: Parameters<IManagerConsumer[HeldBackEventKind]>;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/RegistrationEnforcer.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { LogProvider, TrouterState } from './Interfaces';\r\nimport { TrouterManagerState }  from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\nimport { ReconnectReason } from './TrouterConnection';\r\n\r\nexport interface IManagerWorker {\r\n    startFirstConnection(): void;\r\n    stopFirstConnection(dontUnregister: boolean): void;\r\n\r\n    startSecondConnection(useConnectParamsFromCache: boolean): void;\r\n    stopSecondConnection(dontUnregister: boolean): void;\r\n    stopSecondConnectionDelayed(): void;\r\n\r\n    forceStopLingeringConnection(): void;\r\n\r\n    switchConnections(): void;\r\n    doesSecondConnectionExist(): boolean;\r\n\r\n    dispatchConnected(): void;\r\n    dispatchDisconnected(): void;\r\n    dispatchTerminalError(): void;\r\n    dispatchRegistrationState(isRegistered: boolean): void;\r\n\r\n    expediteBackoffOnConnections(): void\r\n}\r\n\r\n/**\r\n * State machine for manager\r\n */\r\nexport class TrouterManagerFsm {\r\n    private logger: Logger;\r\n    private state: TrouterManagerState = TrouterManagerState.Unknown;\r\n\r\n    constructor(logFunc: LogProvider, private worker: IManagerWorker) {\r\n        this.logger = new Logger('ManagerFsm', logFunc);\r\n    }\r\n\r\n    public start() {\r\n        if (this.state === TrouterManagerState.Unknown) {\r\n            this.setState(TrouterManagerState.Disconnected);\r\n            this.worker.forceStopLingeringConnection();\r\n            this.worker.startFirstConnection();\r\n        } else {\r\n            // Trouter is already running, but external code calling start()\r\n            // is often triggered by some relevant external event (e.g. computer waking up),\r\n            // so we want to retry immediately to not create unnecessary delays.\r\n            this.logger.info(`start called in state '${TrouterManagerState[this.state]}', expediting pending backoffs, if any`);\r\n            this.worker.expediteBackoffOnConnections();\r\n        }\r\n    }\r\n\r\n    public stop(dontUnregister?: boolean) {\r\n        if (this.state !== TrouterManagerState.Unknown) {\r\n            this.setState(TrouterManagerState.Unknown);\r\n            this.worker.stopFirstConnection(dontUnregister === true);\r\n            this.worker.stopSecondConnection(dontUnregister === true);\r\n        } else {\r\n            this.showIgnored('stop');\r\n        }\r\n    }\r\n\r\n    /** Returns current state */\r\n    public getState(): TrouterState {\r\n        switch (this.state) {\r\n        case TrouterManagerState.Unknown:\r\n        case TrouterManagerState.Connected:\r\n        case TrouterManagerState.Disconnected:\r\n        case TrouterManagerState.Switching:\r\n            return this.state as number as TrouterState;\r\n        case TrouterManagerState.TerminalError:\r\n            return TrouterState.Disconnected;\r\n        }\r\n    }\r\n\r\n    public getInternalState(): TrouterManagerState {\r\n        return this.state;\r\n    }\r\n\r\n    public onConnected(first: boolean) {\r\n        if (this.state === TrouterManagerState.Disconnected && first) {\r\n            if (this.worker.doesSecondConnectionExist()) {\r\n                this.setState(TrouterManagerState.Switching);\r\n            } else {\r\n                this.setState(TrouterManagerState.Connected);\r\n                this.worker.dispatchConnected();\r\n            }\r\n        } else {\r\n            this.showIgnored(`onConnected(${first})`);\r\n        }\r\n    }\r\n\r\n    public onRegistered(first: boolean) {\r\n        if (this.state === TrouterManagerState.Disconnected && !first) {\r\n            this.setState(TrouterManagerState.Connected);\r\n            this.worker.switchConnections();\r\n            this.worker.stopSecondConnection(true);\r\n            this.worker.dispatchConnected();\r\n        } else if (this.state === TrouterManagerState.Switching && !first) {\r\n            this.setState(TrouterManagerState.Connected);\r\n            this.worker.switchConnections();\r\n            this.worker.stopSecondConnectionDelayed();\r\n            this.worker.dispatchConnected();\r\n        } else if(this.state === TrouterManagerState.Disconnected && first) { \r\n            // happens when reconnect prompts connection to the same instance which dispatches disconnect as duplicate (both on old connection)\r\n            // at this point `first` is the new connection\r\n\r\n            this.setState(TrouterManagerState.Connected);\r\n            this.worker.dispatchConnected();\r\n        }\r\n        \r\n        this.worker.dispatchRegistrationState(true);\r\n    }\r\n\r\n    public onUnregistered(first: boolean) {\r\n        if (first) {\r\n            this.worker.dispatchRegistrationState(false);\r\n        }\r\n    }\r\n\r\n    public onReconnecting(first: boolean) {\r\n        if ((this.state === TrouterManagerState.Connected || this.state === TrouterManagerState.Switching) && first) {\r\n            this.setState(TrouterManagerState.Disconnected);\r\n            this.worker.dispatchDisconnected();\r\n        } else {\r\n            this.showIgnored(`onReconnecting(${first})`);\r\n        }\r\n    }\r\n\r\n    public onReconnectionRequired(first: boolean, useConnectParamsFromCache: boolean, reason: ReconnectReason) {\r\n        if (this.state === TrouterManagerState.Connected && first) {\r\n            this.setState(TrouterManagerState.Switching);\r\n            this.worker.startSecondConnection(useConnectParamsFromCache);\r\n        } else if (this.state === TrouterManagerState.Disconnected && first) {\r\n            this.worker.startSecondConnection(useConnectParamsFromCache);\r\n        } else if (this.state === TrouterManagerState.Switching && first && reason === ReconnectReason.Configuration) {\r\n            // Intentionally ignoring `trouter.reconnect` events arriving during an in-progress switch (on either connection),\r\n            // only configuration change is handled. This matches the current behavior of the C++ client.\r\n            // Even in the ignored cases, the client should still end up being connected to the right environment eventually.\r\n            this.logger.debug('onReconnectionRequired: switch requested while already in Switching state');\r\n            this.worker.stopSecondConnection(true);\r\n            this.worker.startSecondConnection(useConnectParamsFromCache);\r\n        } else {\r\n            this.showIgnored(`onReconnectionRequired(${first})`);\r\n        }\r\n    }\r\n\r\n    public onDisconnected(first: boolean) {\r\n        if (this.state == TrouterManagerState.Unknown && first) {\r\n            // This is executed after an explicit stop()\r\n            this.worker.dispatchDisconnected();\r\n        } else if (this.state == TrouterManagerState.Switching && first) {\r\n            // The current/old connection got disconnected during a connection switch\r\n            // (the disconnect would result only in onReconnecting() at other times,\r\n            // when automatic reconnects are still enabled)\r\n            this.worker.switchConnections();\r\n            this.worker.stopSecondConnection(false);\r\n            this.setState(TrouterManagerState.Disconnected);\r\n            this.worker.dispatchDisconnected();\r\n        } else {\r\n            this.showIgnored(`onDisconnected(${first})`);\r\n        }\r\n    }\r\n\r\n    public onTerminalError() {\r\n        this.setState(TrouterManagerState.TerminalError);\r\n        this.worker.dispatchTerminalError();\r\n    }\r\n\r\n    private showIgnored(event: string) {\r\n        this.logger.info(`Ignoring event '${event}' in state '${TrouterManagerState[this.state]}'`);\r\n    }\r\n\r\n    private setState(state: TrouterManagerState) {\r\n        this.logger.info(`Switching from state '${TrouterManagerState[this.state]}' to state '${TrouterManagerState[state]}'`);\r\n        if (this.state === state) {\r\n            this.logger.error(`Attempt to switch to the current state '${TrouterManagerState[state]}'`);\r\n\r\n            return;\r\n        }\r\n        this.state = state;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TrouterManagerFsm.ts","/**\r\n * Copyright (c) Microsoft. All rights reserved.\r\n */\r\n\r\nimport { CLIENT_VERSION } from './Constants';\r\nimport {\r\n    AuthTokenProvider,\r\n    Client, ConnectionInfo, IConnectionInfo,\r\n    ITrouterServiceBase, ITrouterServiceConfig, Listener, LogProvider, MessageHandler,\r\n    Request, Response, SkypeTokenProvider, StateChangedListener,\r\n    TokenRequest,\r\n    TrouterConnectionListener, TrouterRequestBody, TrouterState, TrouterTelemetrySettings,\r\n    UserActivityState,\r\n    IAudienceSubscription, IAudienceSubscriptionModel, IAudienceSubscriptionsResponse\r\n} from './Interfaces';\r\nimport { ITrouterOptions, ServerState } from './InternalInterfaces';\r\nimport { Logger } from './Logger';\r\nimport { MessageHandlerRegistry } from './MessageHandler';\r\nimport { addCacheAsBackupTo } from './SkypeTokenProviderWithCache';\r\nimport { TrouterManager } from './TrouterManager';\r\nimport { TrouterUrlPromise } from './TrouterUrlPromise';\r\n\r\nexport { MessageHandler, TrouterState, UserActivityState, IAudienceSubscription, IAudienceSubscriptionModel };\r\n\r\ninterface IEcsConfig {\r\n    TrouterConnectionUrl?: string;\r\n    TelemetryEnabled?: boolean;\r\n    ClientTelemetryEventEnabled: {\r\n        trouter_js_client_connected?: boolean;\r\n        trouter_js_client_disconnected?: boolean;\r\n        trouter_js_client_error?: boolean;\r\n        trouter_js_client_progress?: boolean;\r\n        trouter_js_client_response?: boolean;\r\n        logHealthCheckError?: boolean;\r\n        logSendPingError?: boolean;\r\n        numberOfStepsToMaintain?: number;\r\n        sendProgressTimeoutSecs?: number;\r\n    };\r\n}\r\n\r\nfunction populateTelemetryOptions(startingCfg: TrouterTelemetrySettings, ecsCfg?: IEcsConfig): TrouterTelemetrySettings {\r\n    if (!ecsCfg) {\r\n        return startingCfg;\r\n    }\r\n\r\n    let res = {\r\n        ...startingCfg,\r\n        ...{\r\n            enabled: ecsCfg.TelemetryEnabled\r\n        }\r\n    };\r\n\r\n    if (ecsCfg.ClientTelemetryEventEnabled !== undefined) {\r\n        res = {\r\n            ...res,\r\n            ...ecsCfg.ClientTelemetryEventEnabled\r\n        };\r\n    }\r\n\r\n    return <TrouterTelemetrySettings>res;\r\n}\r\n\r\nfunction populateTrouterOptions(cfg: ITrouterServiceConfig, logger: Logger, ecsCfg?: IEcsConfig): ITrouterOptions {\r\n    const rewriteUrlForProxyCallback = (url: string) => {\r\n        if (cfg.proxyUrlRewrite) {\r\n            logger.info('Using rewritten URL for proxy');\r\n\r\n            return cfg.proxyUrlRewrite(url);\r\n        } else {\r\n            return url;\r\n        }\r\n    };\r\n\r\n    return {\r\n        clientInfo: {\r\n            ua: cfg.trouterSettings.productName,\r\n            v: cfg.trouterSettings.version\r\n        },\r\n        ioOptions: {\r\n            // uncomment for manual testing\r\n            // transports: ['xhr-polling'],\r\n            // 'connect timeout': XXX, 10000 by default in socket.io code\r\n            ackTimeoutMs: 5000,\r\n            rewriteUrlForProxy: rewriteUrlForProxyCallback\r\n        },\r\n        clientCorrelationID: cfg.trouterSettings.sessionId,\r\n        environment: cfg.trouterSettings.environment,\r\n        telemetrySettings: populateTelemetryOptions(cfg.telemetryConfig.settings, ecsCfg),\r\n        eventLogger: cfg.telemetryConfig.eventLogger,\r\n        endpointId: cfg.trouterSettings.registrationId,\r\n        // keeping existing behavior of || - using default value when there's empty string\r\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\r\n        trouterUrl: (ecsCfg?.TrouterConnectionUrl) || cfg.trouterSettings.trouterServiceUrl,\r\n        registration: cfg.trouterSettings.registrarServiceUrl\r\n            ? {\r\n                registrarUrl: cfg.trouterSettings.registrarServiceUrl,\r\n                registrationId: cfg.trouterSettings.registrationId ?? '',\r\n                pnhAppId: cfg.trouterSettings.pnhAppId ?? '',\r\n                platform: cfg.trouterSettings.platform ?? '',\r\n                pnhTemplateKey: cfg.trouterSettings.pnhTemplate ?? '',\r\n                platformUIVersion: cfg.trouterSettings.platformUIVersion ?? '',\r\n                // keeping existing behavior of || - using default value when there's empty string\r\n                // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\r\n                productContext: cfg.trouterSettings.pnhProductContext || undefined,\r\n                context: cfg.trouterSettings.pnhContext ?? '',\r\n                registrarTtlSec: (cfg.trouterSettings.maxRegistrationTimeInMs ?? 0) / 1000\r\n            }\r\n            : undefined,\r\n        connectionDependsOnRegistration:\r\n            cfg.trouterSettings.registrarServiceUrl === undefined ?\r\n                (() => false) :\r\n                (cfg.trouterSettings.connectionDependsOnRegistration ?? (() => false)),\r\n        delayEventsUntilRegistered: cfg.trouterSettings.delayEventsUntilRegistered ?? (() => false),\r\n\r\n        timeoutOptions: {\r\n            // keeping existing behavior of || - using default value when there's 0\r\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\r\n            connectionTimeoutMs: cfg.trouterSettings.trouterConnectTimeoutInMs || 30000,\r\n            fetchTimeoutMs: 10000,\r\n            pingTimeoutMs: 40000,\r\n            pongTimeoutMs: 5000,\r\n            /** Followup WI to remove hardcoded value: https://domoreexp.visualstudio.com/MSTeams/_workitems/edit/2307271 */\r\n            maxBackoffMs: cfg.trouterSettings.productName === 'TeamsCDL' ? 300000 : 30000,\r\n            requestTimeoutMs: 5000,\r\n            userActivityResponseTimeoutMs: 10000,\r\n            ...cfg.trouterSettings.timeoutOptions\r\n        },\r\n        incallTimeoutOptions: {\r\n            connectionTimeoutMs: 10000,\r\n            fetchTimeoutMs: 5000,\r\n            pingTimeoutMs: 5000,\r\n            pongTimeoutMs: 2000,\r\n            maxBackoffMs: cfg.trouterSettings.productName === 'TeamsCDL' ? 300000 : 10000,\r\n            requestTimeoutMs: 5000,\r\n            userActivityResponseTimeoutMs: 10000,\r\n            ...cfg.trouterSettings.incallTimeoutOptions\r\n        },\r\n        incallModeTimeoutMs: cfg.trouterSettings.incallModeTimeoutMs ?? 0,\r\n        lingeringConnectionDelayMs: 60000,\r\n        // keeping existing behavior of || - using default value when there's 0\r\n        // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\r\n        userActivitySecondResendDelayMs: cfg.trouterSettings.userActivitySecondResendDelayMs || 10000,\r\n        duplicateDisconnectThresholdMs: 10000,\r\n        connectionCache: cfg.connectionCache,\r\n        // eslint-disable-next-line @typescript-eslint/unbound-method\r\n        registrationStateCallback: cfg.registrationStateCallbackForAcsDoNotUse,\r\n        rewriteUrlForProxy: rewriteUrlForProxyCallback,\r\n        retryLimitOnTokenFetch: cfg.trouterSettings.retryLimitOnTokenFetch,\r\n        extraConnectionHeaders: cfg.trouterSettings.extraConnectionHeaders,\r\n        expediteBackoffOnStartMinimumDelayMs: 10000,\r\n\r\n        // JSON.stringify() override for dumping options to log as JSON in TrouterManager\r\n        toJSON: function (this: ITrouterOptions) {\r\n            return {\r\n                ...this,\r\n\r\n                // If cache is set to some object of the host app, do not try to serialize it.\r\n                // It could contain circular references and JSON.stringify() would fully fail.\r\n                connectionCache: this.connectionCache ? {} : this.connectionCache\r\n            };\r\n        }\r\n    };\r\n}\r\n\r\nexport type TelemetryEvent = {\r\n    type: string;\r\n    registrationId: string;\r\n    connectionId?: string;\r\n    connectedClientId?: string;\r\n};\r\n\r\ninterface IWrappedStateChangedListener extends TrouterConnectionListener {\r\n    (state: TrouterState, info?: IConnectionInfo): void;\r\n    wrappedCallback: StateChangedListener;\r\n}\r\n\r\n/**\r\n * TrouterService implementation class\r\n */\r\nexport class TrouterService implements ITrouterServiceBase, Client, Listener {\r\n    private logger: Logger;\r\n    private trouterServer?: TrouterManager;\r\n    private listeners: { [path: string]: Listener };\r\n    private connectionInfo: ConnectionInfo | null;\r\n    private trouterCfg?: ITrouterServiceConfig;\r\n    private ecsCfg?: IEcsConfig;\r\n    private pendingActivityState?: [UserActivityState, string | undefined];\r\n\r\n\r\n    // Legacy fields\r\n    private trouterUrlPromise: TrouterUrlPromise;\r\n    private stateChangedListeners: (TrouterConnectionListener | IWrappedStateChangedListener)[] = [];\r\n    private messageHandlers: MessageHandlerRegistry;\r\n\r\n    public constructor(private logProvider: LogProvider) {\r\n        this.logger = new Logger('Trouter', logProvider);\r\n        this.trouterUrlPromise = new TrouterUrlPromise(logProvider);\r\n        this.messageHandlers = new MessageHandlerRegistry(logProvider);\r\n        this.listeners = {};\r\n        this.connectionInfo = null;\r\n        this.logger.info(`Created TrouterService version ${CLIENT_VERSION}`);\r\n    }\r\n\r\n    public start(cfg: ITrouterServiceConfig): void {\r\n        this.logger.info('Start');\r\n        if (!cfg.skypeTokenProvider && !cfg.authTokenProvider) {\r\n            throw new Error('no token provider has been configured, either skypeTokenProvider or authTokenProvider must be populated');\r\n        }\r\n\r\n        if (cfg.skypeTokenProvider && !cfg.trouterSettings.disableInternalSkypeTokenCache) {\r\n            cfg.skypeTokenProvider = addCacheAsBackupTo(cfg.skypeTokenProvider);\r\n        }\r\n\r\n        this.trouterCfg = cfg;\r\n        const options = populateTrouterOptions(cfg, this.logger, this.ecsCfg);\r\n\r\n        if ((<ITrouterServiceConfig & UndocumentedSettings>cfg).internalEnableV4cProtocol === false) {\r\n            options.forceV4aProtocol = true;\r\n        }\r\n\r\n        const authTokenProvider = authTokenProviderProtector(this.logger, cfg.authTokenProvider ?? skypeTokenAdapter(cfg.skypeTokenProvider));\r\n\r\n        if (this.trouterServer === undefined) {\r\n            this.trouterServer = new TrouterManager(\r\n                this.logProvider,\r\n                options,\r\n                authTokenProvider,\r\n                cfg.authTokenProvider === undefined,\r\n                this);\r\n        }\r\n\r\n        if (this.pendingActivityState !== undefined) {\r\n            this.trouterServer.setUserActivityState(this.pendingActivityState[0], this.pendingActivityState[1]);\r\n            this.pendingActivityState = undefined;\r\n        }\r\n\r\n        this.trouterServer.start();\r\n    }\r\n\r\n    public stop(dontUnregister?: boolean): void {\r\n        this.logger.info('close connection');\r\n        this.trouterUrlPromise.rejectUrl(new Error('TrouterService is stopped'));\r\n\r\n        if (this.trouterServer !== undefined) {\r\n            this.trouterServer.stop(dontUnregister);\r\n        }\r\n    }\r\n\r\n    public async setEcsConfig(fullEcsData: { [section: string]: unknown }): Promise<void> {\r\n        return new Promise<void>((resolve) => {\r\n            const ecsSection = 'TrouterJScriptClient';\r\n            this.ecsCfg = <IEcsConfig>(fullEcsData[ecsSection]);\r\n            this.logger.info(`Setting ECS configuration to ${JSON.stringify(this.ecsCfg)}`);\r\n            if (this.trouterServer !== undefined && this.trouterCfg !== undefined) {\r\n                const options = populateTrouterOptions(this.trouterCfg, this.logger, this.ecsCfg);\r\n                this.trouterServer.configure(options);\r\n            }\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Notifies trouter that network is restored - trouter will try to restore connection immediately\r\n     */\r\n    public checkConnection(disconnectDetected?: boolean): void {\r\n        if (this.trouterServer !== undefined) {\r\n            this.trouterServer.checkConnection(disconnectDetected ?? false);\r\n        }\r\n    }\r\n\r\n    public async resendRegistration(): Promise<void> {\r\n        if (!this.trouterServer) {\r\n            throw new Error('resendRegistration called too early');\r\n        }\r\n\r\n        return this.trouterServer.resendRegistration();\r\n    }\r\n\r\n\r\n    // Listeners\r\n\r\n    public registerListener(listener: Listener, path: string): boolean {\r\n        if (path === '' || !path.startsWith('/') || path.includes('?') || path.includes('#')) {\r\n            this.logger.error(`Listener path '${path}' is not valid`);\r\n\r\n            return false;\r\n        }\r\n        if (this.listeners[path]) {\r\n            this.logger.error(`Another listener is already registered for path '${path}'`);\r\n\r\n            return false;\r\n        }\r\n        this.listeners[path] = listener;\r\n        this.logger.debug(`Listener for path '${path}' registered`);\r\n        if (this.connectionInfo) {\r\n            listener.onTrouterConnected(this.connectionInfo.baseEndpointUrl + path, this.connectionInfo);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public unregisterListener(listener: Listener): boolean {\r\n        const paths: string[] = [];\r\n        for (const path of Object.keys(this.listeners)) {\r\n            if (this.listeners[path] === listener) {\r\n                paths.push(path);\r\n            }\r\n        }\r\n        if (paths.length === 0) {\r\n            return false;\r\n        }\r\n        for (const path of paths) {\r\n            delete this.listeners[path];\r\n        }\r\n        this.logger.debug(`Listener for path(s) '${paths.join('\\', \\'')}' unregistered`);\r\n\r\n        return true;\r\n    }\r\n\r\n    public onTrouterConnected(endpointUrl: string, connectionInfo: ConnectionInfo): void {\r\n        this.logger.debug('Trouter is now connected');\r\n        for (const path of Object.keys(this.listeners)) {\r\n            try {\r\n                this.listeners[path].onTrouterConnected(connectionInfo.baseEndpointUrl + path, connectionInfo);\r\n            } catch (e) {\r\n                this.logger.error(`Listener '${path}' threw an exception from onTrouterConnected(): ${e}`);\r\n            }\r\n        }\r\n        this.connectionInfo = connectionInfo;\r\n\r\n        this.trouterUrlPromise.resolveUrl(endpointUrl);\r\n        this.notifyStateChanged(TrouterState.Connected, {\r\n            url: endpointUrl,\r\n            getRemainingTtlInSec: () => connectionInfo.connectionTtlSec\r\n        });\r\n    }\r\n\r\n    public onTrouterDisconnected(): void {\r\n        this.logger.debug('Trouter is now disconnected');\r\n        this.connectionInfo = null;\r\n        for (const path of Object.keys(this.listeners)) {\r\n            const listener = this.listeners[path];\r\n            if (listener.onTrouterDisconnected) {\r\n                try {\r\n                    listener.onTrouterDisconnected();\r\n                } catch (e) {\r\n                    this.logger.error(`Listener '${path}' threw an exception from onTrouterDisconnected(): ${e}`);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.notifyStateChanged(TrouterState.Disconnected);\r\n    }\r\n\r\n    public onTrouterRequest(request: Request, response: Response): void {\r\n        let bestPath = '';\r\n        for (const path of Object.keys(this.listeners)) {\r\n            if (request.path.startsWith(path) && path.length > bestPath.length) {\r\n                bestPath = path;\r\n            }\r\n        }\r\n        if (bestPath !== '') {\r\n            try {\r\n                this.listeners[bestPath].onTrouterRequest(request, response);\r\n            } catch (e) {\r\n                this.logger.error(`Listener '${bestPath}' threw an exception from onTrouterRequest(): ${e}`);\r\n                response.status = 500;\r\n                response.headers = { 'Trouter-Responder': 'ClientLib' };\r\n                response.send();\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (this.tryMessageHandlers(request, response)) {\r\n            return;\r\n        }\r\n\r\n        response.status = 404;\r\n        response.headers = { 'Trouter-Responder': 'ClientLib' };\r\n        response.send();\r\n    }\r\n\r\n    public onTrouterMessageLoss(flowTags: string[]): boolean {\r\n        this.logger.info(`onTrouterMessageLoss called with tags [${flowTags}]`);\r\n\r\n        let messageLossProcessed = true;\r\n        for (const path of Object.keys(this.listeners)) {\r\n            const listener = this.listeners[path];\r\n            if (listener.onTrouterMessageLoss) {\r\n                try {\r\n                    messageLossProcessed = listener.onTrouterMessageLoss(flowTags) && messageLossProcessed;\r\n\r\n                    if (messageLossProcessed === undefined) {\r\n                        this.logger.error(`Listener '${path}' did not return a boolean value from onTrouterMessageLoss()`);\r\n                        messageLossProcessed = false;\r\n                    }\r\n                } catch (e) {\r\n                    this.logger.error(`Listener '${path}' threw an exception from onTrouterMessageLoss(): ${e}`);\r\n                    messageLossProcessed = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        return messageLossProcessed;\r\n    }\r\n\r\n    public onTrouterUserActivityStateAccepted(cv: string): void {\r\n        this.logger.debug(`onTrouterUserActivityStateAccepted cv: ${cv}`);\r\n        for (const path of Object.keys(this.listeners)) {\r\n            const listener = this.listeners[path];\r\n            if (listener.onTrouterUserActivityStateAccepted) {\r\n                try {\r\n                    listener.onTrouterUserActivityStateAccepted(cv);\r\n                } catch (e) {\r\n                    this.logger.error(`Listener '${path}' threw an exception from onTrouterUserActivityStateAccepted(): ${e}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onAudiencesSetResolved(audienceSubscriptionsResponse: IAudienceSubscriptionsResponse, cv: string): void {\r\n        this.logger.debug(`onAudiencesSetResolved cv: ${cv}`);\r\n        for (const path of Object.keys(this.listeners)) {\r\n            const listener = this.listeners[path];\r\n            if (listener.onAudiencesSetResolved) {\r\n                try {\r\n                    listener.onAudiencesSetResolved(audienceSubscriptionsResponse, cv);\r\n                } catch (e) {\r\n                    this.logger.error(`Listener '${path}' threw an exception from onAudienceSubscribed(): ${e}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public setUserActivityState(state: UserActivityState, correlationVector?: string): void {\r\n        if (state !== UserActivityState.Active && state !== UserActivityState.Inactive) {\r\n            throw new Error(`setUserActivityState called with unsupported value ${state}`);\r\n        }\r\n        this.logger.info(`setUserActivityState called with value ${UserActivityState[state]}`);\r\n\r\n        if (this.trouterServer && this.state() !== TrouterState.Unknown) {\r\n            this.trouterServer.setUserActivityState(state, correlationVector);\r\n        } else {\r\n            this.pendingActivityState = [state, correlationVector];\r\n            this.logger.warn('setUserActivityState called before start() or after stop()');\r\n        }\r\n    }\r\n\r\n    public setAudienceSubscriptions(audienceSubscriptionModel: IAudienceSubscriptionModel, correlationVector?: string): Promise<IAudienceSubscriptionsResponse> {\r\n        if (audienceSubscriptionModel.audienceSubscriptions.length > 1) {\r\n            throw new Error(\"Only singular audience subscription is supported\");\r\n        }\r\n\r\n        if (this.trouterServer && this.state() !== TrouterState.Unknown) {\r\n            return this.trouterServer.setAudienceSubscriptionsAsync(audienceSubscriptionModel, 15000, correlationVector);\r\n        }\r\n\r\n        throw new Error('audience subscribe called before start() or after stop()');\r\n    }\r\n\r\n    // Legacy API\r\n\r\n    public state(): TrouterState {\r\n        if (this.trouterServer !== undefined) {\r\n            return this.trouterServer.getState();\r\n        }\r\n\r\n        return TrouterState.Unknown;\r\n    }\r\n\r\n    public isInTerminalState(): boolean {\r\n        if (this.trouterServer !== undefined) {\r\n            return this.trouterServer.isInTerminalState();\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public reportStateInfo(): string {\r\n        if (this.trouterServer === undefined) {\r\n            return \"\";\r\n        }\r\n        return this.trouterServer.reportStateInfo();\r\n    }\r\n\r\n    public getServerState(): ServerState | undefined {\r\n        if (this.trouterServer !== undefined) {\r\n            return this.trouterServer.getServerState();\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    public getTrouterUrlAsync(): Promise<string> {\r\n        if (this.trouterServer !== undefined) {\r\n            return this.trouterUrlPromise.getPromise();\r\n        } else {\r\n            return Promise.reject(new Error('TrouterService has not been started'));\r\n        }\r\n    }\r\n\r\n    public onStateChanged(callback: StateChangedListener | undefined): void {\r\n        this.logger.info('onStateChanged called');\r\n        if (callback === undefined) {\r\n            this.stateChangedListeners = this.stateChangedListeners.filter(\r\n                (listener) => ((<IWrappedStateChangedListener>listener).wrappedCallback === undefined));\r\n        } else {\r\n            this.offStateChanged(callback);\r\n            const wrapper = (state: TrouterState, info?: IConnectionInfo) => {\r\n                callback(state, info ? info.url : '');\r\n            };\r\n            (<IWrappedStateChangedListener>wrapper).wrappedCallback = callback;\r\n            this.stateChangedListeners.push(wrapper);\r\n        }\r\n    }\r\n\r\n    public offStateChanged(callback: StateChangedListener): boolean {\r\n        this.logger.info('offStateChanged called');\r\n        const sizeBeforeRemoval = this.stateChangedListeners.length;\r\n        this.stateChangedListeners = this.stateChangedListeners.filter(\r\n            (listener) => ((<IWrappedStateChangedListener>listener).wrappedCallback !== callback));\r\n\r\n        return (sizeBeforeRemoval > this.stateChangedListeners.length);\r\n    }\r\n\r\n    public addCallback(callback: TrouterConnectionListener): void {\r\n        this.logger.info('addListener called');\r\n        const index = this.stateChangedListeners.indexOf(callback, 0);\r\n        if (index === -1 && callback !== undefined) {\r\n            this.stateChangedListeners.push(callback);\r\n        }\r\n    }\r\n\r\n    public removeCallback(callback: TrouterConnectionListener): boolean {\r\n        this.logger.info('removeListener called');\r\n        const index = this.stateChangedListeners.indexOf(callback, 0);\r\n        if (index > -1) {\r\n            this.stateChangedListeners.splice(index, 1);\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public registerMessageHandler(handler: MessageHandler) {\r\n        this.logger.info('registerMessageHandler is called');\r\n        this.messageHandlers.register(handler);\r\n    }\r\n\r\n    public clearMessageHandlers(): void {\r\n        this.logger.info('clearMessageHandlers is called');\r\n        this.messageHandlers.clear();\r\n    }\r\n\r\n    private notifyStateChanged(state: TrouterState, info?: IConnectionInfo): void {\r\n        this.logger.info(`notifyStateChanged called, will forward to ${this.stateChangedListeners.length} listeners`);\r\n        this.stateChangedListeners.forEach(callback => {\r\n            try {\r\n                callback(state, info);\r\n            } catch (error) {\r\n                this.logger.error(`Error in callback ${error}`);\r\n            }\r\n        });\r\n    }\r\n\r\n    private tryMessageHandlers(request: Request, response: Response): boolean {\r\n        if (!this.messageHandlers.active()) {\r\n\r\n            return false;\r\n        }\r\n\r\n        let body: TrouterRequestBody | undefined;\r\n        let eventId: number | null = null;\r\n\r\n        try {\r\n            body = <TrouterRequestBody>JSON.parse(request.body);\r\n            eventId = (body && (body.evt || body.eventId)) || null;\r\n            // eslint-disable-next-line no-empty\r\n        } catch (e) { }\r\n\r\n        const message = {\r\n            eventId: eventId,\r\n            url: (this.connectionInfo ? this.connectionInfo.baseEndpointUrl : '') + request.path,\r\n            body: body,\r\n            rawBody: request.body,\r\n            headers: request.headers\r\n        };\r\n\r\n        const result = this.messageHandlers.handleMessage(message);\r\n        if (!result.isHandled) {\r\n\r\n            return false;\r\n        }\r\n\r\n        response.status = result.resultCode;\r\n        if (result.responseHeaders) {\r\n            response.headers = result.responseHeaders;\r\n        }\r\n        if (result.responseBody) {\r\n            response.body = result.responseBody;\r\n        }\r\n        response.send();\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nexport function createTrouterService(logger: LogProvider): ITrouterServiceBase {\r\n    return new TrouterService(logger);\r\n}\r\n\r\nexport function getTrouterServiceVersion(): string {\r\n    return CLIENT_VERSION;\r\n}\r\n\r\nexport function replaceTrouterUrlBase(existingUrl: string, newBase: string): string {\r\n    const schemaSepPos = existingUrl.indexOf('://');\r\n    if (schemaSepPos >= 0) {\r\n        const pathSepPos = existingUrl.indexOf('/', schemaSepPos + 3);\r\n        if (pathSepPos >= 0) {\r\n            return newBase + existingUrl.substr(pathSepPos);\r\n        }\r\n    }\r\n\r\n    return '';\r\n}\r\n\r\nfunction skypeTokenAdapter(provider: SkypeTokenProvider): AuthTokenProvider {\r\n    return async (req: TokenRequest) => ({ token: await provider(req.needFresh), tokenType: 'skype' });\r\n}\r\n\r\nfunction authTokenProviderProtector(logger: Logger, provider: AuthTokenProvider): AuthTokenProvider {\r\n    let previousToken: string | undefined;\r\n\r\n    return async (req: TokenRequest) => {\r\n        const requestTime = new Date();\r\n        const timerId = setInterval(() => {\r\n            const delay = Math.round((Date.now() - requestTime.getTime()) / 60000);\r\n            logger.warn(`Note: Trouter auth token request promise from ${requestTime.toISOString()} has not been resolved for ${delay} minutes. The client is blocked from operating properly`);\r\n        }, 5 * 60000);\r\n\r\n        try {\r\n            const rsp = await provider(req);\r\n\r\n            if (req.needFresh && rsp.token === previousToken) {\r\n                logger.error('API violation: Trouter auth token provider got a request with needRefresh=true, but returned the same token as last time anyway. Please fix the host app');\r\n            }\r\n\r\n            previousToken = rsp.token;\r\n            return rsp;\r\n        }\r\n        finally {\r\n            clearInterval(timerId);\r\n        }\r\n    };\r\n}\r\n\r\ntype UndocumentedSettings = {\r\n    internalEnableV4cProtocol?: boolean\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib_temp/TsTrouter.ts","module.exports = __WEBPACK_EXTERNAL_MODULE_21__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@skype/tsregistrar\"\n// module id = 21\n// module chunks = 0","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js'; // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || new Array(16);\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || rng)();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || stringify(b);\n}\n\nexport default v1;","import validate from './validate.js';\n\nfunction parse(uuid) {\n  if (!validate(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  var v;\n  var arr = new Uint8Array(16); // Parse ########-....-....-....-............\n\n  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;\n  arr[1] = v >>> 16 & 0xff;\n  arr[2] = v >>> 8 & 0xff;\n  arr[3] = v & 0xff; // Parse ........-####-....-....-............\n\n  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff; // Parse ........-....-####-....-............\n\n  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff; // Parse ........-....-....-####-............\n\n  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff; // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n\n  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;\n  arr[11] = v / 0x100000000 & 0xff;\n  arr[12] = v >>> 24 & 0xff;\n  arr[13] = v >>> 16 & 0xff;\n  arr[14] = v >>> 8 & 0xff;\n  arr[15] = v & 0xff;\n  return arr;\n}\n\nexport default parse;","import stringify from './stringify.js';\nimport parse from './parse.js';\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  var bytes = [];\n\n  for (var i = 0; i < str.length; ++i) {\n    bytes.push(str.charCodeAt(i));\n  }\n\n  return bytes;\n}\n\nexport var DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport var URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function (name, version, hashfunc) {\n  function generateUUID(value, namespace, buf, offset) {\n    if (typeof value === 'string') {\n      value = stringToBytes(value);\n    }\n\n    if (typeof namespace === 'string') {\n      namespace = parse(namespace);\n    }\n\n    if (namespace.length !== 16) {\n      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    } // Compute hash of namespace and value, Per 4.3\n    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =\n    // hashfunc([...namespace, ... value])`\n\n\n    var bytes = new Uint8Array(16 + value.length);\n    bytes.set(namespace);\n    bytes.set(value, namespace.length);\n    bytes = hashfunc(bytes);\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      offset = offset || 0;\n\n      for (var i = 0; i < 16; ++i) {\n        buf[offset + i] = bytes[i];\n      }\n\n      return buf;\n    }\n\n    return stringify(bytes);\n  } // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name; // eslint-disable-next-line no-empty\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n}","/*\n * Browser-compatible JavaScript MD5\n *\n * Modification of JavaScript MD5\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\nfunction md5(bytes) {\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = new Uint8Array(msg.length);\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes[i] = msg.charCodeAt(i);\n    }\n  }\n\n  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));\n}\n/*\n * Convert an array of little-endian words to an array of bytes\n */\n\n\nfunction md5ToHexEncodedArray(input) {\n  var output = [];\n  var length32 = input.length * 32;\n  var hexTab = '0123456789abcdef';\n\n  for (var i = 0; i < length32; i += 8) {\n    var x = input[i >> 5] >>> i % 32 & 0xff;\n    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);\n    output.push(hex);\n  }\n\n  return output;\n}\n/**\n * Calculate output length with padding and bit length\n */\n\n\nfunction getOutputLength(inputLength8) {\n  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;\n}\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length.\n */\n\n\nfunction wordsToMd5(x, len) {\n  /* append padding */\n  x[len >> 5] |= 0x80 << len % 32;\n  x[getOutputLength(len) - 1] = len;\n  var a = 1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d = 271733878;\n\n  for (var i = 0; i < x.length; i += 16) {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n    a = md5ff(a, b, c, d, x[i], 7, -680876936);\n    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);\n    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);\n    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);\n    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);\n    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);\n    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);\n    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);\n    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);\n    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);\n    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);\n    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);\n    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);\n    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);\n    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);\n    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);\n    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);\n    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);\n    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);\n    b = md5gg(b, c, d, a, x[i], 20, -373897302);\n    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);\n    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);\n    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);\n    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);\n    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);\n    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);\n    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);\n    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);\n    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);\n    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);\n    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);\n    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);\n    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);\n    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);\n    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);\n    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);\n    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);\n    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);\n    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);\n    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);\n    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);\n    d = md5hh(d, a, b, c, x[i], 11, -358537222);\n    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);\n    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);\n    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);\n    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);\n    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);\n    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);\n    a = md5ii(a, b, c, d, x[i], 6, -198630844);\n    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);\n    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);\n    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);\n    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);\n    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);\n    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);\n    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);\n    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);\n    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);\n    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);\n    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);\n    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);\n    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);\n    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);\n    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);\n    a = safeAdd(a, olda);\n    b = safeAdd(b, oldb);\n    c = safeAdd(c, oldc);\n    d = safeAdd(d, oldd);\n  }\n\n  return [a, b, c, d];\n}\n/*\n * Convert an array bytes to an array of little-endian words\n * Characters >255 have their high-byte silently ignored.\n */\n\n\nfunction bytesToWords(input) {\n  if (input.length === 0) {\n    return [];\n  }\n\n  var length8 = input.length * 8;\n  var output = new Uint32Array(getOutputLength(length8));\n\n  for (var i = 0; i < length8; i += 8) {\n    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;\n  }\n\n  return output;\n}\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\n\n\nfunction safeAdd(x, y) {\n  var lsw = (x & 0xffff) + (y & 0xffff);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return msw << 16 | lsw & 0xffff;\n}\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\n\n\nfunction bitRotateLeft(num, cnt) {\n  return num << cnt | num >>> 32 - cnt;\n}\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\n\n\nfunction md5cmn(q, a, b, x, s, t) {\n  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);\n}\n\nfunction md5ff(a, b, c, d, x, s, t) {\n  return md5cmn(b & c | ~b & d, a, b, x, s, t);\n}\n\nfunction md5gg(a, b, c, d, x, s, t) {\n  return md5cmn(b & d | c & ~d, a, b, x, s, t);\n}\n\nfunction md5hh(a, b, c, d, x, s, t) {\n  return md5cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction md5ii(a, b, c, d, x, s, t) {\n  return md5cmn(c ^ (b | ~d), a, b, x, s, t);\n}\n\nexport default md5;","import v35 from './v35.js';\nimport md5 from './md5.js';\nvar v3 = v35('v3', 0x30, md5);\nexport default v3;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","// Adapted from Chris Veness' SHA1 code at\n// http://www.movable-type.co.uk/scripts/sha1.html\nfunction f(s, x, y, z) {\n  switch (s) {\n    case 0:\n      return x & y ^ ~x & z;\n\n    case 1:\n      return x ^ y ^ z;\n\n    case 2:\n      return x & y ^ x & z ^ y & z;\n\n    case 3:\n      return x ^ y ^ z;\n  }\n}\n\nfunction ROTL(x, n) {\n  return x << n | x >>> 32 - n;\n}\n\nfunction sha1(bytes) {\n  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = [];\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes.push(msg.charCodeAt(i));\n    }\n  } else if (!Array.isArray(bytes)) {\n    // Convert Array-like to Array\n    bytes = Array.prototype.slice.call(bytes);\n  }\n\n  bytes.push(0x80);\n  var l = bytes.length / 4 + 2;\n  var N = Math.ceil(l / 16);\n  var M = new Array(N);\n\n  for (var _i = 0; _i < N; ++_i) {\n    var arr = new Uint32Array(16);\n\n    for (var j = 0; j < 16; ++j) {\n      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];\n    }\n\n    M[_i] = arr;\n  }\n\n  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);\n  M[N - 1][14] = Math.floor(M[N - 1][14]);\n  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;\n\n  for (var _i2 = 0; _i2 < N; ++_i2) {\n    var W = new Uint32Array(80);\n\n    for (var t = 0; t < 16; ++t) {\n      W[t] = M[_i2][t];\n    }\n\n    for (var _t = 16; _t < 80; ++_t) {\n      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);\n    }\n\n    var a = H[0];\n    var b = H[1];\n    var c = H[2];\n    var d = H[3];\n    var e = H[4];\n\n    for (var _t2 = 0; _t2 < 80; ++_t2) {\n      var s = Math.floor(_t2 / 20);\n      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[_t2] >>> 0;\n      e = d;\n      d = c;\n      c = ROTL(b, 30) >>> 0;\n      b = a;\n      a = T;\n    }\n\n    H[0] = H[0] + a >>> 0;\n    H[1] = H[1] + b >>> 0;\n    H[2] = H[2] + c >>> 0;\n    H[3] = H[3] + d >>> 0;\n    H[4] = H[4] + e >>> 0;\n  }\n\n  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];\n}\n\nexport default sha1;","import v35 from './v35.js';\nimport sha1 from './sha1.js';\nvar v5 = v35('v5', 0x50, sha1);\nexport default v5;","export default '00000000-0000-0000-0000-000000000000';","import validate from './validate.js';\n\nfunction version(uuid) {\n  if (!validate(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  return parseInt(uuid.substr(14, 1), 16);\n}\n\nexport default version;","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * This error is thrown when an asynchronous operation has been aborted.\n * Check for this error by testing the `name` that the name property of the\n * error matches `\"AbortError\"`.\n *\n * @example\n * ```ts\n * const controller = new AbortController();\n * controller.abort();\n * try {\n *   doAsyncWork(controller.signal)\n * } catch (e) {\n *   if (e.name === 'AbortError') {\n *     // handle abort error here.\n *   }\n * }\n * ```\n */\nexport class AbortError extends Error {\n  constructor(message?: string) {\n    super(message);\n    this.name = \"AbortError\";\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { AbortError } from \"@azure/abort-controller\";\nimport type { AbortOptions } from \"./aborterUtils.js\";\n\n/**\n * Options for the createAbortablePromise function.\n */\nexport interface CreateAbortablePromiseOptions extends AbortOptions {\n  /** A function to be called if the promise was aborted */\n  cleanupBeforeAbort?: () => void;\n}\n\n/**\n * Creates an abortable promise.\n * @param buildPromise - A function that takes the resolve and reject functions as parameters.\n * @param options - The options for the abortable promise.\n * @returns A promise that can be aborted.\n */\nexport function createAbortablePromise<T>(\n  buildPromise: (\n    resolve: (value: T | PromiseLike<T>) => void,\n    reject: (reason?: any) => void,\n  ) => void,\n  options?: CreateAbortablePromiseOptions,\n): Promise<T> {\n  const { cleanupBeforeAbort, abortSignal, abortErrorMsg } = options ?? {};\n  return new Promise((resolve, reject) => {\n    function rejectOnAbort(): void {\n      reject(new AbortError(abortErrorMsg ?? \"The operation was aborted.\"));\n    }\n    function removeListeners(): void {\n      abortSignal?.removeEventListener(\"abort\", onAbort);\n    }\n    function onAbort(): void {\n      cleanupBeforeAbort?.();\n      removeListeners();\n      rejectOnAbort();\n    }\n    if (abortSignal?.aborted) {\n      return rejectOnAbort();\n    }\n    try {\n      buildPromise(\n        (x) => {\n          removeListeners();\n          resolve(x);\n        },\n        (x) => {\n          removeListeners();\n          reject(x);\n        },\n      );\n    } catch (err) {\n      reject(err);\n    }\n    abortSignal?.addEventListener(\"abort\", onAbort);\n  });\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport type { AbortOptions } from \"./aborterUtils.js\";\nimport { createAbortablePromise } from \"./createAbortablePromise.js\";\n\nconst StandardAbortMessage = \"The delay was aborted.\";\n\n/**\n * Options for support abort functionality for the delay method\n */\nexport interface DelayOptions extends AbortOptions {}\n\n/**\n * A wrapper for setTimeout that resolves a promise after timeInMs milliseconds.\n * @param timeInMs - The number of milliseconds to be delayed.\n * @param options - The options for delay - currently abort options\n * @returns Promise that is resolved after timeInMs\n */\nexport function delay(timeInMs: number, options?: DelayOptions): Promise<void> {\n  let token: ReturnType<typeof setTimeout>;\n  const { abortSignal, abortErrorMsg } = options ?? {};\n  return createAbortablePromise(\n    (resolve) => {\n      token = setTimeout(resolve, timeInMs);\n    },\n    {\n      cleanupBeforeAbort: () => clearTimeout(token),\n      abortSignal,\n      abortErrorMsg: abortErrorMsg ?? StandardAbortMessage,\n    },\n  );\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport type { AbortSignalLike } from \"@azure/abort-controller\";\n\n/**\n * Options related to abort controller.\n */\nexport interface AbortOptions {\n  /**\n   * The abortSignal associated with containing operation.\n   */\n  abortSignal?: AbortSignalLike;\n  /**\n   * The abort error message associated with containing operation.\n   */\n  abortErrorMsg?: string;\n}\n\n/**\n * Represents a function that returns a promise that can be aborted.\n */\nexport type AbortablePromiseBuilder<T> = (abortOptions: {\n  abortSignal?: AbortSignalLike;\n}) => Promise<T>;\n\n/**\n * promise.race() wrapper that aborts rest of promises as soon as the first promise settles.\n */\nexport async function cancelablePromiseRace<T extends unknown[]>(\n  abortablePromiseBuilders: AbortablePromiseBuilder<T[number]>[],\n  options?: { abortSignal?: AbortSignalLike },\n): Promise<T[number]> {\n  const aborter = new AbortController();\n  function abortHandler(): void {\n    aborter.abort();\n  }\n  options?.abortSignal?.addEventListener(\"abort\", abortHandler);\n  try {\n    return await Promise.race(\n      abortablePromiseBuilders.map((p) => p({ abortSignal: aborter.signal })),\n    );\n  } finally {\n    aborter.abort();\n    options?.abortSignal?.removeEventListener(\"abort\", abortHandler);\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * Returns a random integer value between a lower and upper bound,\n * inclusive of both bounds.\n * Note that this uses Math.random and isn't secure. If you need to use\n * this for any kind of security purpose, find a better source of random.\n * @param min - The smallest integer value allowed.\n * @param max - The largest integer value allowed.\n */\nexport function getRandomIntegerInclusive(min: number, max: number): number {\n  // Make sure inputs are integers.\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  // Pick a random offset from zero to the size of the range.\n  // Since Math.random() can never return 1, we have to make the range one larger\n  // in order to be inclusive of the maximum value after we take the floor.\n  const offset = Math.floor(Math.random() * (max - min + 1));\n  return offset + min;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * A generic shape for a plain JS object.\n */\nexport type UnknownObject = { [s: string]: unknown };\n\n/**\n * Helper to determine when an input is a generic JS object.\n * @returns true when input is an object type that is not null, Array, RegExp, or Date.\n */\nexport function isObject(input: unknown): input is UnknownObject {\n  return (\n    typeof input === \"object\" &&\n    input !== null &&\n    !Array.isArray(input) &&\n    !(input instanceof RegExp) &&\n    !(input instanceof Date)\n  );\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { isObject } from \"./object.js\";\n\n/**\n * Typeguard for an error object shape (has name and message)\n * @param e - Something caught by a catch clause.\n */\nexport function isError(e: unknown): e is Error {\n  if (isObject(e)) {\n    const hasName = typeof e.name === \"string\";\n    const hasMessage = typeof e.message === \"string\";\n    return hasName && hasMessage;\n  }\n  return false;\n}\n\n/**\n * Given what is thought to be an error object, return the message if possible.\n * If the message is missing, returns a stringified version of the input.\n * @param e - Something thrown from a try block\n * @returns The error message or a string of the input\n */\nexport function getErrorMessage(e: unknown): string {\n  if (isError(e)) {\n    return e.message;\n  } else {\n    let stringified: string;\n    try {\n      if (typeof e === \"object\" && e) {\n        stringified = JSON.stringify(e);\n      } else {\n        stringified = String(e);\n      }\n    } catch (err: any) {\n      stringified = \"[unable to stringify input]\";\n    }\n    return `Unknown error ${stringified}`;\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { createHash, createHmac } from \"crypto\";\n\n/**\n * Generates a SHA-256 HMAC signature.\n * @param key - The HMAC key represented as a base64 string, used to generate the cryptographic HMAC hash.\n * @param stringToSign - The data to be signed.\n * @param encoding - The textual encoding to use for the returned HMAC digest.\n */\nexport async function computeSha256Hmac(\n  key: string,\n  stringToSign: string,\n  encoding: \"base64\" | \"hex\",\n): Promise<string> {\n  const decodedKey = Buffer.from(key, \"base64\");\n\n  return createHmac(\"sha256\", decodedKey).update(stringToSign).digest(encoding);\n}\n\n/**\n * Generates a SHA-256 hash.\n * @param content - The data to be included in the hash.\n * @param encoding - The textual encoding to use for the returned hash.\n */\nexport async function computeSha256Hash(\n  content: string,\n  encoding: \"base64\" | \"hex\",\n): Promise<string> {\n  return createHash(\"sha256\").update(content).digest(encoding);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * Helper TypeGuard that checks if something is defined or not.\n * @param thing - Anything\n */\nexport function isDefined<T>(thing: T | undefined | null): thing is T {\n  return typeof thing !== \"undefined\" && thing !== null;\n}\n\n/**\n * Helper TypeGuard that checks if the input is an object with the specified properties.\n * @param thing - Anything.\n * @param properties - The name of the properties that should appear in the object.\n */\nexport function isObjectWithProperties<Thing, PropertyName extends string>(\n  thing: Thing,\n  properties: PropertyName[],\n): thing is Thing & Record<PropertyName, unknown> {\n  if (!isDefined(thing) || typeof thing !== \"object\") {\n    return false;\n  }\n\n  for (const property of properties) {\n    if (!objectHasProperty(thing, property)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Helper TypeGuard that checks if the input is an object with the specified property.\n * @param thing - Any object.\n * @param property - The name of the property that should appear in the object.\n */\nexport function objectHasProperty<Thing, PropertyName extends string>(\n  thing: Thing,\n  property: PropertyName,\n): thing is Thing & Record<PropertyName, unknown> {\n  return (\n    isDefined(thing) && typeof thing === \"object\" && property in (thing as Record<string, unknown>)\n  );\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { randomUUID as v4RandomUUID } from \"crypto\";\n\ninterface Crypto {\n  randomUUID(): string;\n}\n\ndeclare const globalThis: {\n  crypto: Crypto;\n};\n\n// NOTE: This is a workaround until we can use `globalThis.crypto.randomUUID` in Node.js 19+.\nconst uuidFunction =\n  typeof globalThis?.crypto?.randomUUID === \"function\"\n    ? globalThis.crypto.randomUUID.bind(globalThis.crypto)\n    : v4RandomUUID;\n\n/**\n * Generated Universally Unique Identifier\n *\n * @returns RFC4122 v4 UUID.\n */\nexport function randomUUID(): string {\n  return uuidFunction();\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\ninterface Window {\n  document: unknown;\n}\n\ninterface DedicatedWorkerGlobalScope {\n  constructor: {\n    name: string;\n  };\n\n  importScripts: (...paths: string[]) => void;\n}\n\ninterface Navigator {\n  product: string;\n}\n\ninterface DenoGlobal {\n  version: {\n    deno: string;\n  };\n}\n\ninterface BunGlobal {\n  version: string;\n}\n\n// eslint-disable-next-line @azure/azure-sdk/ts-no-window\ndeclare const window: Window;\ndeclare const self: DedicatedWorkerGlobalScope;\ndeclare const Deno: DenoGlobal;\ndeclare const Bun: BunGlobal;\ndeclare const navigator: Navigator;\n\n/**\n * A constant that indicates whether the environment the code is running is a Web Browser.\n */\n// eslint-disable-next-line @azure/azure-sdk/ts-no-window\nexport const isBrowser = typeof window !== \"undefined\" && typeof window.document !== \"undefined\";\n\n/**\n * A constant that indicates whether the environment the code is running is a Web Worker.\n */\nexport const isWebWorker =\n  typeof self === \"object\" &&\n  typeof self?.importScripts === \"function\" &&\n  (self.constructor?.name === \"DedicatedWorkerGlobalScope\" ||\n    self.constructor?.name === \"ServiceWorkerGlobalScope\" ||\n    self.constructor?.name === \"SharedWorkerGlobalScope\");\n\n/**\n * A constant that indicates whether the environment the code is running is Deno.\n */\nexport const isDeno =\n  typeof Deno !== \"undefined\" &&\n  typeof Deno.version !== \"undefined\" &&\n  typeof Deno.version.deno !== \"undefined\";\n\n/**\n * A constant that indicates whether the environment the code is running is Bun.sh.\n */\nexport const isBun = typeof Bun !== \"undefined\" && typeof Bun.version !== \"undefined\";\n\n/**\n * A constant that indicates whether the environment the code is running is a Node.js compatible environment.\n */\nexport const isNodeLike =\n  typeof globalThis.process !== \"undefined\" &&\n  Boolean(globalThis.process.version) &&\n  Boolean(globalThis.process.versions?.node);\n\n/**\n * A constant that indicates whether the environment the code is running is a Node.js compatible environment.\n * @deprecated Use `isNodeLike` instead.\n */\nexport const isNode = isNodeLike;\n\n/**\n * A constant that indicates whether the environment the code is running is Node.JS.\n */\nexport const isNodeRuntime = isNodeLike && !isBun && !isDeno;\n\n/**\n * A constant that indicates whether the environment the code is running is in React-Native.\n */\n// https://github.com/facebook/react-native/blob/main/packages/react-native/Libraries/Core/setUpNavigator.js\nexport const isReactNative =\n  typeof navigator !== \"undefined\" && navigator?.product === \"ReactNative\";\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/** The supported character encoding type */\nexport type EncodingType = \"utf-8\" | \"base64\" | \"base64url\" | \"hex\";\n\n/**\n * The helper that transforms bytes with specific character encoding into string\n * @param bytes - the uint8array bytes\n * @param format - the format we use to encode the byte\n * @returns a string of the encoded string\n */\nexport function uint8ArrayToString(bytes: Uint8Array, format: EncodingType): string {\n  return Buffer.from(bytes).toString(format);\n}\n\n/**\n * The helper that transforms string to specific character encoded bytes array.\n * @param value - the string to be converted\n * @param format - the format we use to decode the value\n * @returns a uint8array\n */\nexport function stringToUint8Array(value: string, format: EncodingType): Uint8Array {\n  return Buffer.from(value, format);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nexport { delay, type DelayOptions } from \"./delay.js\";\nexport {\n  type AbortOptions,\n  cancelablePromiseRace,\n  type AbortablePromiseBuilder,\n} from \"./aborterUtils.js\";\nexport {\n  createAbortablePromise,\n  type CreateAbortablePromiseOptions,\n} from \"./createAbortablePromise.js\";\nexport { getRandomIntegerInclusive } from \"./random.js\";\nexport { isObject, type UnknownObject } from \"./object.js\";\nexport { isError, getErrorMessage } from \"./error.js\";\nexport { computeSha256Hash, computeSha256Hmac } from \"./sha256.js\";\nexport { isDefined, isObjectWithProperties, objectHasProperty } from \"./typeGuards.js\";\nexport { randomUUID } from \"./uuidUtils.js\";\nexport {\n  isBrowser,\n  isBun,\n  isNode,\n  isNodeLike,\n  isNodeRuntime,\n  isDeno,\n  isReactNative,\n  isWebWorker,\n} from \"./checkEnvironment.js\";\nexport { uint8ArrayToString, stringToUint8Array, type EncodingType } from \"./bytesEncoding.js\";\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PACKAGE_VERSION = exports.CONFIG_API_VERSION = exports.EudbCountries = exports.CloudPrefix = exports.CloudType = exports.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES = void 0;\nexports.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES = 3;\n// Gov cloud types\nvar CloudType;\n(function (CloudType) {\n    CloudType[\"Public\"] = \"Public\";\n    CloudType[\"GccHigh\"] = \"GCC High\";\n    CloudType[\"Dod\"] = \"DoD\";\n})(CloudType || (exports.CloudType = CloudType = {}));\nvar CloudPrefix;\n(function (CloudPrefix) {\n    CloudPrefix[\"OrgId\"] = \"orgid\";\n    CloudPrefix[\"Acs\"] = \"acs\";\n    CloudPrefix[\"Spool\"] = \"spool\";\n    CloudPrefix[\"GccHigh\"] = \"gcch\";\n    CloudPrefix[\"GccHighAcs\"] = \"gcch-acs\";\n    CloudPrefix[\"Dod\"] = \"dod\";\n    CloudPrefix[\"DodAcs\"] = \"dod-acs\";\n})(CloudPrefix || (exports.CloudPrefix = CloudPrefix = {}));\nexports.EudbCountries = [\"europe\", \"france\", \"germany\", \"norway\", \"switzerland\", \"sweden\"];\nexports.CONFIG_API_VERSION = \"2024-09-01\";\nexports.PACKAGE_VERSION = \"1.0.0-beta.29\";\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isEudbLocation = exports.parseTokenCredential = exports.base64decode = exports.toTelemetrySender = exports.toLogProvider = exports.toMessageHandler = void 0;\nexports.generateUuid = generateUuid;\nconst uuid_1 = require(\"uuid\");\nconst core_util_1 = require(\"@azure/core-util\");\nconst constants_1 = require(\"./constants\");\nconst eventIds = new Map([\n    [\"chatMessageReceived\", 200],\n    [\"typingIndicatorReceived\", 245],\n    [\"readReceiptReceived\", 246],\n    [\"chatMessageEdited\", 247],\n    [\"chatMessageDeleted\", 248],\n    [\"chatThreadCreated\", 257],\n    [\"chatThreadPropertiesUpdated\", 258],\n    [\"chatThreadDeleted\", 259],\n    [\"participantsAdded\", 260],\n    [\"participantsRemoved\", 261],\n]);\nconst publicTeamsUserPrefix = \"8:orgid:\";\nconst dodTeamsUserPrefix = \"8:dod:\";\nconst gcchTeamsUserPrefix = \"8:gcch:\";\nconst teamsVisitorUserPrefix = \"8:teamsvisitor:\";\nconst phoneNumberPrefix = \"4:\";\nconst acsUserPrefix = \"8:acs:\";\nconst acsGcchUserPrefix = \"8:gcch-acs:\";\nconst acsDodUserPrefix = \"8:dod-acs:\";\nconst spoolUserPrefix = \"8:spool:\";\nconst toMessageHandler = (event, listener, resourceEndpoint, gatewayApiVersion) => {\n    const eventId = eventIds.get(event);\n    return {\n        handleMessage(message) {\n            let genericPayload = null;\n            if (message === null || message === void 0 ? void 0 : message.rawBody) {\n                genericPayload = JSON.parse(message.rawBody);\n            }\n            if (genericPayload === null || genericPayload.eventId !== eventId) {\n                return undefined;\n            }\n            const eventPayload = toEventPayload(event, genericPayload, resourceEndpoint, gatewayApiVersion);\n            if (eventPayload === null) {\n                return undefined;\n            }\n            listener(eventPayload);\n            return { isHandled: true, resultCode: 200 };\n        },\n    };\n};\nexports.toMessageHandler = toMessageHandler;\nconst toEventPayload = (event, genericPayload, resourceEndpoint, gatewayApiVersion) => {\n    if (event === \"chatMessageReceived\") {\n        const payload = genericPayload;\n        const eventPayload = {\n            threadId: payload.groupId,\n            sender: constructIdentifierKindFromMri(payload.senderId),\n            senderDisplayName: payload.senderDisplayName,\n            recipient: constructIdentifierKindFromMri(payload.recipientMri),\n            id: payload.messageId,\n            createdOn: new Date(payload.originalArrivalTime),\n            version: payload.version,\n            type: payload.messageType,\n            message: payload.messageBody,\n            metadata: parseJsonString(payload.acsChatMessageMetadata) || {},\n            attachments: transformEndpoint(parseJsonString(payload.attachments) || [], resourceEndpoint, gatewayApiVersion),\n        };\n        return eventPayload;\n    }\n    if (event === \"chatMessageEdited\") {\n        const payload = genericPayload;\n        const eventPayload = {\n            threadId: payload.groupId,\n            sender: constructIdentifierKindFromMri(payload.senderId),\n            senderDisplayName: payload.senderDisplayName,\n            recipient: constructIdentifierKindFromMri(payload.recipientMri),\n            id: payload.messageId,\n            createdOn: new Date(payload.originalArrivalTime),\n            version: payload.version,\n            message: payload.messageBody,\n            editedOn: new Date(payload.edittime),\n            type: payload.messageType,\n            metadata: parseJsonString(payload.acsChatMessageMetadata) || {},\n            attachments: transformEndpoint(parseJsonString(payload.attachments) || [], resourceEndpoint, gatewayApiVersion),\n        };\n        return eventPayload;\n    }\n    if (event === \"chatMessageDeleted\") {\n        const payload = genericPayload;\n        const eventPayload = {\n            threadId: payload.groupId,\n            sender: constructIdentifierKindFromMri(payload.senderId),\n            senderDisplayName: payload.senderDisplayName,\n            recipient: constructIdentifierKindFromMri(payload.recipientMri),\n            id: payload.messageId,\n            createdOn: new Date(payload.originalArrivalTime),\n            version: payload.version,\n            deletedOn: new Date(payload.deletetime),\n            type: payload.messageType,\n        };\n        return eventPayload;\n    }\n    if (event === \"typingIndicatorReceived\") {\n        const payload = genericPayload;\n        const eventPayload = {\n            threadId: payload.groupId,\n            sender: constructIdentifierKindFromMri(payload.senderId),\n            senderDisplayName: payload.senderDisplayName,\n            recipient: constructIdentifierKindFromMri(payload.recipientMri),\n            version: payload.version,\n            receivedOn: new Date(payload.originalArrivalTime),\n        };\n        return eventPayload;\n    }\n    if (event === \"readReceiptReceived\") {\n        const payload = genericPayload;\n        const readReceiptMessageBody = JSON.parse(payload.messageBody);\n        const consumptionHorizon = readReceiptMessageBody.consumptionhorizon.split(\";\");\n        const eventPayload = {\n            threadId: payload.groupId,\n            sender: constructIdentifierKindFromMri(payload.senderId),\n            senderDisplayName: \"\",\n            recipient: constructIdentifierKindFromMri(payload.recipientMri),\n            chatMessageId: payload.messageId,\n            readOn: new Date(+consumptionHorizon[1]),\n        };\n        return eventPayload;\n    }\n    if (event === \"chatThreadCreated\") {\n        const payload = genericPayload;\n        const createdByPayload = JSON.parse(unescape(payload.createdBy));\n        const membersPayload = JSON.parse(unescape(payload.members));\n        const propertiesPayload = JSON.parse(unescape(payload.properties));\n        const createdBy = {\n            id: constructIdentifierKindFromMri(createdByPayload.participantId),\n            displayName: createdByPayload.displayName,\n        };\n        const chatParticipants = membersPayload.map((m) => {\n            return {\n                id: constructIdentifierKindFromMri(m.participantId),\n                displayName: m.displayName,\n            };\n        });\n        const eventPayload = {\n            threadId: payload.threadId,\n            createdOn: new Date(payload.createTime),\n            createdBy: createdBy,\n            version: payload.version,\n            participants: chatParticipants,\n            properties: propertiesPayload,\n        };\n        return eventPayload;\n    }\n    if (event === \"chatThreadPropertiesUpdated\") {\n        const payload = genericPayload;\n        const updatedByPayload = JSON.parse(unescape(payload.editedBy));\n        const propertiesPayload = JSON.parse(unescape(payload.properties));\n        const updatedBy = {\n            id: constructIdentifierKindFromMri(updatedByPayload.participantId),\n            displayName: updatedByPayload.displayName,\n        };\n        const eventPayload = {\n            threadId: payload.threadId,\n            updatedOn: new Date(payload.editTime),\n            updatedBy: updatedBy,\n            version: payload.version,\n            properties: propertiesPayload,\n        };\n        return eventPayload;\n    }\n    if (event === \"chatThreadDeleted\") {\n        const payload = genericPayload;\n        const deletedByPayload = JSON.parse(unescape(payload.deletedBy));\n        const deletedBy = {\n            id: constructIdentifierKindFromMri(deletedByPayload.participantId),\n            displayName: deletedByPayload.displayName,\n        };\n        const eventPayload = {\n            threadId: payload.threadId,\n            deletedOn: new Date(payload.deleteTime),\n            deletedBy: deletedBy,\n            version: payload.version,\n        };\n        return eventPayload;\n    }\n    if (event === \"participantsAdded\") {\n        const payload = genericPayload;\n        const addedByPayload = JSON.parse(unescape(payload.addedBy));\n        const participantsAddedPayload = JSON.parse(unescape(payload.participantsAdded));\n        const addedBy = {\n            id: constructIdentifierKindFromMri(addedByPayload.participantId),\n            displayName: addedByPayload.displayName,\n        };\n        const chatParticipants = participantsAddedPayload.map((m) => {\n            return {\n                id: constructIdentifierKindFromMri(m.participantId),\n                displayName: m.displayName,\n                shareHistoryTime: new Date(m.shareHistoryTime),\n            };\n        });\n        const eventPayload = {\n            threadId: payload.threadId,\n            addedOn: new Date(payload.time),\n            addedBy: addedBy,\n            version: payload.version,\n            participantsAdded: chatParticipants,\n        };\n        return eventPayload;\n    }\n    if (event === \"participantsRemoved\") {\n        const payload = genericPayload;\n        const removedByPayload = JSON.parse(unescape(payload.removedBy));\n        const participantsRemovedPayload = JSON.parse(unescape(payload.participantsRemoved));\n        const removedBy = {\n            id: constructIdentifierKindFromMri(removedByPayload.participantId),\n            displayName: removedByPayload.displayName,\n        };\n        const chatParticipants = participantsRemovedPayload.map((m) => {\n            return {\n                id: constructIdentifierKindFromMri(m.participantId),\n                displayName: m.displayName,\n                shareHistoryTime: new Date(m.shareHistoryTime),\n            };\n        });\n        const eventPayload = {\n            threadId: payload.threadId,\n            removedOn: new Date(payload.time),\n            removedBy: removedBy,\n            version: payload.version,\n            participantsRemoved: chatParticipants,\n        };\n        return eventPayload;\n    }\n    return null;\n};\nconst toLogProvider = (logger) => {\n    return {\n        log: (...message) => logger.info(message),\n        warn: (...message) => logger.warning(message),\n        error: (...message) => logger.error(message),\n        debug: (...message) => logger.verbose(message),\n        info: (...message) => logger.verbose(message),\n    };\n};\nexports.toLogProvider = toLogProvider;\nconst toTelemetrySender = (logger) => {\n    return {\n        logEvent: (clientEvent) => logger.info(clientEvent),\n    };\n};\nexports.toTelemetrySender = toTelemetrySender;\nconst constructIdentifierKindFromMri = (mri) => {\n    if (mri.startsWith(publicTeamsUserPrefix)) {\n        return {\n            kind: \"microsoftTeamsUser\",\n            rawId: mri,\n            microsoftTeamsUserId: mri.substring(publicTeamsUserPrefix.length),\n            isAnonymous: false,\n            cloud: \"public\",\n        };\n    }\n    else if (mri.startsWith(dodTeamsUserPrefix)) {\n        return {\n            kind: \"microsoftTeamsUser\",\n            rawId: mri,\n            microsoftTeamsUserId: mri.substring(dodTeamsUserPrefix.length),\n            isAnonymous: false,\n            cloud: \"dod\",\n        };\n    }\n    else if (mri.startsWith(gcchTeamsUserPrefix)) {\n        return {\n            kind: \"microsoftTeamsUser\",\n            rawId: mri,\n            microsoftTeamsUserId: mri.substring(gcchTeamsUserPrefix.length),\n            isAnonymous: false,\n            cloud: \"gcch\",\n        };\n    }\n    else if (mri.startsWith(teamsVisitorUserPrefix)) {\n        return {\n            kind: \"microsoftTeamsUser\",\n            rawId: mri,\n            microsoftTeamsUserId: mri.substring(teamsVisitorUserPrefix.length),\n            isAnonymous: true,\n        };\n    }\n    else if (mri.startsWith(phoneNumberPrefix)) {\n        return {\n            kind: \"phoneNumber\",\n            rawId: mri,\n            phoneNumber: mri.substring(phoneNumberPrefix.length),\n        };\n    }\n    else if (mri.startsWith(acsUserPrefix) ||\n        mri.startsWith(acsGcchUserPrefix) ||\n        mri.startsWith(acsDodUserPrefix) ||\n        mri.startsWith(spoolUserPrefix)) {\n        return { kind: \"communicationUser\", communicationUserId: mri };\n    }\n    else {\n        return { kind: \"unknown\", id: mri };\n    }\n};\nconst parseJsonString = (str) => {\n    if (str === undefined ||\n        str === null ||\n        str === \"\" ||\n        str === \"null\" ||\n        str === \"{}\" ||\n        str === \"[]\") {\n        return undefined;\n    }\n    return JSON.parse(str);\n};\nconst createMediaUrlString = (urlString, resourceEndpoint, gatewayApiVersion) => {\n    let url;\n    try {\n        url = new URL(urlString);\n        if (url.protocol === \"http:\" || url.protocol === \"https:\") {\n            // If its already a full url, substitute the origin\n            url = new URL(url.pathname, resourceEndpoint);\n        }\n    }\n    catch (_) {\n        // urlString is a likely a relative URL, so create a new one with the resourceEndpoint as base\n        try {\n            url = new URL(urlString, resourceEndpoint);\n        }\n        catch (_) {\n            // If we get here, then the urlString passed in is likely incorrect, so just pass it along\n            // As there's nothing we can do at this point.\n            return urlString;\n        }\n    }\n    // Append api-version query and return string\n    url.searchParams.set(\"api-version\", gatewayApiVersion);\n    return url.toString();\n};\nconst isValidURL = (str) => {\n    let url;\n    try {\n        url = new URL(str);\n    }\n    catch (_) {\n        return false;\n    }\n    return url.protocol === \"http:\" || url.protocol === \"https:\";\n};\nconst transformEndpoint = (attachments, resourceEndpoint, gatewayApiVersion) => {\n    if (resourceEndpoint === undefined ||\n        resourceEndpoint === null ||\n        resourceEndpoint === \"\" ||\n        !isValidURL(resourceEndpoint)) {\n        return attachments;\n    }\n    attachments\n        .filter((e) => e.attachmentType.toLowerCase() === \"image\".toLowerCase())\n        .map((attachment) => {\n        if (attachment.previewUrl) {\n            attachment.previewUrl = createMediaUrlString(attachment.previewUrl, resourceEndpoint, gatewayApiVersion);\n        }\n        if (attachment.url) {\n            attachment.url = createMediaUrlString(attachment.url, resourceEndpoint, gatewayApiVersion);\n        }\n    });\n    return attachments;\n};\nconst base64decode = (encodedString) => !core_util_1.isNodeLike ? atob(encodedString) : Buffer.from(encodedString, \"base64\").toString();\nexports.base64decode = base64decode;\nconst parseJWT = (token) => {\n    let [, payload] = token === null || token === void 0 ? void 0 : token.split(\".\");\n    if (payload === undefined) {\n        throw new Error(\"Invalid token\");\n    }\n    payload = payload.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    return JSON.parse(decodeURIComponent(escape((0, exports.base64decode)(payload))));\n};\nconst parseTokenCredential = (credential) => __awaiter(void 0, void 0, void 0, function* () {\n    const accessToken = yield credential.getToken();\n    const jwtToken = accessToken === null || accessToken === void 0 ? void 0 : accessToken.token;\n    const parsedJwtToken = parseJWT(jwtToken);\n    const identityMri = parsedJwtToken.skypeid;\n    const acsResourceId = parsedJwtToken.resourceId;\n    const cloudType = getCloudTypeFromSkypeId(identityMri);\n    const resourceLocation = parsedJwtToken.resourceLocation || \"\";\n    return { jwtToken, acsResourceId, identityMri, cloudType, resourceLocation };\n});\nexports.parseTokenCredential = parseTokenCredential;\n/**\n * Generated Universally Unique Identifier\n *\n * @returns RFC4122 v4 UUID.\n * @internal\n */\nfunction generateUuid() {\n    return (0, uuid_1.v4)();\n}\nconst isEudbLocation = (location) => !!location && !!constants_1.EudbCountries.find((euLocation) => euLocation === location);\nexports.isEudbLocation = isEudbLocation;\nfunction getCloudTypeFromSkypeId(skypeId) {\n    const cloudPrefix = skypeId.substring(0, skypeId.indexOf(\":\"));\n    switch (cloudPrefix) {\n        case constants_1.CloudPrefix.OrgId:\n        case constants_1.CloudPrefix.Acs:\n        case constants_1.CloudPrefix.Spool: {\n            return constants_1.CloudType.Public;\n        }\n        case constants_1.CloudPrefix.GccHigh:\n        case constants_1.CloudPrefix.GccHighAcs: {\n            return constants_1.CloudType.GccHigh;\n        }\n        case constants_1.CloudPrefix.Dod:\n        case constants_1.CloudPrefix.DodAcs: {\n            return constants_1.CloudType.Dod;\n        }\n        default: {\n            return constants_1.CloudType.Public;\n        }\n    }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\ndeclare global {\n  // stub these out for the browser\n  function btoa(input: string): string;\n  function atob(input: string): string;\n}\n\n/**\n * Encodes a string in base64 format.\n * @param value - the string to encode\n * @internal\n */\nexport function encodeString(value: string): string {\n  return btoa(value);\n}\n\n/**\n * Encodes a byte array in base64 format.\n * @param value - the Uint8Aray to encode\n * @internal\n */\nexport function encodeByteArray(value: Uint8Array): string {\n  let str = \"\";\n  for (let i = 0; i < value.length; i++) {\n    str += String.fromCharCode(value[i]);\n  }\n  return btoa(str);\n}\n\n/**\n * Decodes a base64 string into a byte array.\n * @param value - the base64 string to decode\n * @internal\n */\nexport function decodeString(value: string): Uint8Array {\n  const byteString = atob(value);\n  const arr = new Uint8Array(byteString.length);\n  for (let i = 0; i < byteString.length; i++) {\n    arr[i] = byteString.charCodeAt(i);\n  }\n  return arr;\n}\n\n/**\n * Decodes a base64 string into a string.\n * @param value - the base64 string to decode\n * @internal\n */\nexport function decodeStringToString(value: string): string {\n  return atob(value);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  HttpClient,\n  HttpMethods,\n  PipelineOptions,\n  PipelinePolicy,\n  PipelineRequest,\n  PipelineResponse,\n  TransferProgressEvent,\n} from \"@azure/core-rest-pipeline\";\nimport { AbortSignalLike } from \"@azure/abort-controller\";\nimport { OperationTracingOptions } from \"@azure/core-tracing\";\n\n/**\n * Default key used to access the XML attributes.\n */\nexport const XML_ATTRKEY = \"$\";\n/**\n * Default key used to access the XML value content.\n */\nexport const XML_CHARKEY = \"_\";\n/**\n * Options to govern behavior of xml parser and builder.\n */\nexport interface XmlOptions {\n  /**\n   * indicates the name of the root element in the resulting XML when building XML.\n   */\n  rootName?: string;\n  /**\n   * indicates whether the root element is to be included or not in the output when parsing XML.\n   */\n  includeRoot?: boolean;\n  /**\n   * key used to access the XML value content when parsing XML.\n   */\n  xmlCharKey?: string;\n}\n/**\n * Options to configure serialization/de-serialization behavior.\n */\nexport interface SerializerOptions {\n  /**\n   * Options to configure xml parser/builder behavior.\n   */\n  xml: XmlOptions;\n  /**\n   * Normally additional properties are included in the result object, even if there is no mapper for them.\n   * This flag disables this behavior when true. It is used when parsing headers to avoid polluting the result object.\n   */\n  ignoreUnknownProperties?: boolean;\n}\n\nexport type RequiredSerializerOptions = {\n  [K in keyof SerializerOptions]: Required<SerializerOptions[K]>;\n};\n\n/**\n * A type alias for future proofing.\n */\nexport type OperationRequest = PipelineRequest;\n\n/**\n * Metadata that is used to properly parse a response.\n */\nexport interface OperationRequestInfo {\n  /**\n   * Used to parse the response.\n   */\n  operationSpec?: OperationSpec;\n\n  /**\n   * Used to encode the request.\n   */\n  operationArguments?: OperationArguments;\n\n  /**\n   * A function that returns the proper OperationResponseMap for the given OperationSpec and\n   * PipelineResponse combination. If this is undefined, then a simple status code lookup will\n   * be used.\n   */\n  operationResponseGetter?: (\n    operationSpec: OperationSpec,\n    response: PipelineResponse,\n  ) => undefined | OperationResponseMap;\n\n  /**\n   * Whether or not the PipelineResponse should be deserialized. Defaults to true.\n   */\n  shouldDeserialize?: boolean | ((response: PipelineResponse) => boolean);\n}\n\n/**\n * The base options type for all operations.\n */\nexport interface OperationOptions {\n  /**\n   * The signal which can be used to abort requests.\n   */\n  abortSignal?: AbortSignalLike;\n  /**\n   * Options used when creating and sending HTTP requests for this operation.\n   */\n  requestOptions?: OperationRequestOptions;\n  /**\n   * Options used when tracing is enabled.\n   */\n  tracingOptions?: OperationTracingOptions;\n  /**\n   * Options to override serialization/de-serialization behavior.\n   */\n  serializerOptions?: SerializerOptions;\n\n  /**\n   * A function to be called each time a response is received from the server\n   * while performing the requested operation.\n   * May be called multiple times.\n   */\n  onResponse?: RawResponseCallback;\n}\n\n/**\n * Options used when creating and sending HTTP requests for this operation.\n */\nexport interface OperationRequestOptions {\n  /**\n   * User defined custom request headers that\n   * will be applied before the request is sent.\n   */\n  customHeaders?: { [key: string]: string };\n\n  /**\n   * The number of milliseconds a request can take before automatically being terminated.\n   */\n  timeout?: number;\n\n  /**\n   * Callback which fires upon upload progress.\n   */\n  onUploadProgress?: (progress: TransferProgressEvent) => void;\n\n  /**\n   * Callback which fires upon download progress.\n   */\n  onDownloadProgress?: (progress: TransferProgressEvent) => void;\n\n  /**\n   * Whether or not the HttpOperationResponse should be deserialized. If this is undefined, then the\n   * HttpOperationResponse should be deserialized.\n   */\n  shouldDeserialize?: boolean | ((response: PipelineResponse) => boolean);\n\n  /**\n   * Set to true if the request is sent over HTTP instead of HTTPS\n   */\n  allowInsecureConnection?: boolean;\n}\n\n/**\n * A collection of properties that apply to a single invocation of an operation.\n */\nexport interface OperationArguments {\n  /**\n   * The parameters that were passed to the operation method.\n   */\n  [parameterName: string]: unknown;\n\n  /**\n   * The optional arguments that are provided to an operation.\n   */\n  options?: OperationOptions;\n}\n\n/**\n * The format that will be used to join an array of values together for a query parameter value.\n */\nexport type QueryCollectionFormat = \"CSV\" | \"SSV\" | \"TSV\" | \"Pipes\" | \"Multi\";\n\n/**\n * Encodes how to reach a particular property on an object.\n */\nexport type ParameterPath = string | string[] | { [propertyName: string]: ParameterPath };\n\n/**\n * A common interface that all Operation parameter's extend.\n */\nexport interface OperationParameter {\n  /**\n   * The path to this parameter's value in OperationArguments or the object that contains paths for\n   * each property's value in OperationArguments.\n   */\n  parameterPath: ParameterPath;\n\n  /**\n   * The mapper that defines how to validate and serialize this parameter's value.\n   */\n  mapper: Mapper;\n}\n\n/**\n * A parameter for an operation that will be substituted into the operation's request URL.\n */\nexport interface OperationURLParameter extends OperationParameter {\n  /**\n   * Whether or not to skip encoding the URL parameter's value before adding it to the URL.\n   */\n  skipEncoding?: boolean;\n}\n\n/**\n * A parameter for an operation that will be added as a query parameter to the operation's HTTP\n * request.\n */\nexport interface OperationQueryParameter extends OperationParameter {\n  /**\n   * Whether or not to skip encoding the query parameter's value before adding it to the URL.\n   */\n  skipEncoding?: boolean;\n\n  /**\n   * If this query parameter's value is a collection, what type of format should the value be\n   * converted to.\n   */\n  collectionFormat?: QueryCollectionFormat;\n}\n\n/**\n * An OperationResponse that can be returned from an operation request for a single status code.\n */\nexport interface OperationResponseMap {\n  /**\n   * The mapper that will be used to deserialize the response headers.\n   */\n  headersMapper?: Mapper;\n\n  /**\n   * The mapper that will be used to deserialize the response body.\n   */\n  bodyMapper?: Mapper;\n\n  /**\n   * Indicates if this is an error response\n   */\n  isError?: boolean;\n}\n\n/**\n * A specification that defines an operation.\n */\nexport interface OperationSpec {\n  /**\n   * The serializer to use in this operation.\n   */\n  readonly serializer: Serializer;\n\n  /**\n   * The HTTP method that should be used by requests for this operation.\n   */\n  readonly httpMethod: HttpMethods;\n\n  /**\n   * The URL that was provided in the service's specification. This will still have all of the URL\n   * template variables in it. If this is not provided when the OperationSpec is created, then it\n   * will be populated by a \"baseUri\" property on the ServiceClient.\n   */\n  readonly baseUrl?: string;\n\n  /**\n   * The fixed path for this operation's URL. This will still have all of the URL template variables\n   * in it.\n   */\n  readonly path?: string;\n\n  /**\n   * The content type of the request body. This value will be used as the \"Content-Type\" header if\n   * it is provided.\n   */\n  readonly contentType?: string;\n\n  /**\n   * The media type of the request body.\n   * This value can be used to aide in serialization if it is provided.\n   */\n  readonly mediaType?:\n    | \"json\"\n    | \"xml\"\n    | \"form\"\n    | \"binary\"\n    | \"multipart\"\n    | \"text\"\n    | \"unknown\"\n    | string;\n  /**\n   * The parameter that will be used to construct the HTTP request's body.\n   */\n  readonly requestBody?: OperationParameter;\n\n  /**\n   * Whether or not this operation uses XML request and response bodies.\n   */\n  readonly isXML?: boolean;\n\n  /**\n   * The parameters to the operation method that will be substituted into the constructed URL.\n   */\n  readonly urlParameters?: ReadonlyArray<OperationURLParameter>;\n\n  /**\n   * The parameters to the operation method that will be added to the constructed URL's query.\n   */\n  readonly queryParameters?: ReadonlyArray<OperationQueryParameter>;\n\n  /**\n   * The parameters to the operation method that will be converted to headers on the operation's\n   * HTTP request.\n   */\n  readonly headerParameters?: ReadonlyArray<OperationParameter>;\n\n  /**\n   * The parameters to the operation method that will be used to create a formdata body for the\n   * operation's HTTP request.\n   */\n  readonly formDataParameters?: ReadonlyArray<OperationParameter>;\n\n  /**\n   * The different types of responses that this operation can return based on what status code is\n   * returned.\n   */\n  readonly responses: { [responseCode: string]: OperationResponseMap };\n}\n\n/**\n * Wrapper object for http request and response. Deserialized object is stored in\n * the `parsedBody` property when the response body is received in JSON or XML.\n */\nexport interface FullOperationResponse extends PipelineResponse {\n  /**\n   * The parsed HTTP response headers.\n   */\n  parsedHeaders?: { [key: string]: unknown };\n\n  /**\n   * The response body as parsed JSON or XML.\n   */\n  parsedBody?: any;\n\n  /**\n   * The request that generated the response.\n   */\n  request: OperationRequest;\n}\n\n/**\n * A function to be called each time a response is received from the server\n * while performing the requested operation.\n * May be called multiple times.\n */\nexport type RawResponseCallback = (\n  rawResponse: FullOperationResponse,\n  flatResponse: unknown,\n  error?: unknown,\n) => void;\n\n/**\n * Used to map raw response objects to final shapes.\n * Helps packing and unpacking Dates and other encoded types that are not intrinsic to JSON.\n * Also allows pulling values from headers, as well as inserting default values and constants.\n */\nexport interface Serializer {\n  /**\n   * The provided model mapper.\n   */\n  readonly modelMappers: { [key: string]: any };\n  /**\n   * Whether the contents are XML or not.\n   */\n  readonly isXML: boolean;\n\n  /**\n   * Validates constraints, if any. This function will throw if the provided value does not respect those constraints.\n   * @param mapper - The definition of data models.\n   * @param value - The value.\n   * @param objectName - Name of the object. Used in the error messages.\n   * @deprecated Removing the constraints validation on client side.\n   */\n  validateConstraints(mapper: Mapper, value: any, objectName: string): void;\n\n  /**\n   * Serialize the given object based on its metadata defined in the mapper.\n   *\n   * @param mapper - The mapper which defines the metadata of the serializable object.\n   * @param object - A valid Javascript object to be serialized.\n   * @param objectName - Name of the serialized object.\n   * @param options - additional options to deserialization.\n   * @returns A valid serialized Javascript object.\n   */\n  serialize(mapper: Mapper, object: any, objectName?: string, options?: SerializerOptions): any;\n\n  /**\n   * Deserialize the given object based on its metadata defined in the mapper.\n   *\n   * @param mapper - The mapper which defines the metadata of the serializable object.\n   * @param responseBody - A valid Javascript entity to be deserialized.\n   * @param objectName - Name of the deserialized object.\n   * @param options - Controls behavior of XML parser and builder.\n   * @returns A valid deserialized Javascript object.\n   */\n  deserialize(\n    mapper: Mapper,\n    responseBody: any,\n    objectName: string,\n    options?: SerializerOptions,\n  ): any;\n}\n\n/**\n * Description of various value constraints such as integer ranges and string regex.\n */\nexport interface MapperConstraints {\n  /**\n   * The value should be less than or equal to the `InclusiveMaximum` value.\n   */\n  InclusiveMaximum?: number;\n  /**\n   * The value should be less than the `ExclusiveMaximum` value.\n   */\n  ExclusiveMaximum?: number;\n  /**\n   * The value should be greater than or equal to the `InclusiveMinimum` value.\n   */\n  InclusiveMinimum?: number;\n  /**\n   * The value should be greater than the `InclusiveMinimum` value.\n   */\n  ExclusiveMinimum?: number;\n  /**\n   * The length should be smaller than the `MaxLength`.\n   */\n  MaxLength?: number;\n  /**\n   * The length should be bigger than the `MinLength`.\n   */\n  MinLength?: number;\n  /**\n   * The value must match the pattern.\n   */\n  Pattern?: RegExp;\n  /**\n   * The value must contain fewer items than the MaxItems value.\n   */\n  MaxItems?: number;\n  /**\n   * The value must contain more items than the `MinItems` value.\n   */\n  MinItems?: number;\n  /**\n   * The value must contain only unique items.\n   */\n  UniqueItems?: true;\n  /**\n   * The value should be exactly divisible by the `MultipleOf` value.\n   */\n  MultipleOf?: number;\n}\n\n/**\n * Type of the mapper. Includes known mappers.\n */\nexport type MapperType =\n  | SimpleMapperType\n  | CompositeMapperType\n  | SequenceMapperType\n  | DictionaryMapperType\n  | EnumMapperType;\n\n/**\n * The type of a simple mapper.\n */\nexport interface SimpleMapperType {\n  /**\n   * Name of the type of the property.\n   */\n  name:\n    | \"Base64Url\"\n    | \"Boolean\"\n    | \"ByteArray\"\n    | \"Date\"\n    | \"DateTime\"\n    | \"DateTimeRfc1123\"\n    | \"Object\"\n    | \"Stream\"\n    | \"String\"\n    | \"TimeSpan\"\n    | \"UnixTime\"\n    | \"Uuid\"\n    | \"Number\"\n    | \"any\";\n}\n\n/**\n * Helps build a mapper that describes how to map a set of properties of an object based on other mappers.\n *\n * Only one of the following properties should be present: `className`, `modelProperties` and `additionalProperties`.\n */\nexport interface CompositeMapperType {\n  /**\n   * Name of the composite mapper type.\n   */\n  name: \"Composite\";\n\n  /**\n   * Use `className` to reference another type definition.\n   */\n  className?: string;\n\n  /**\n   * Use `modelProperties` when the reference to the other type has been resolved.\n   */\n  modelProperties?: { [propertyName: string]: Mapper };\n\n  /**\n   * Used when a model has `additionalProperties: true`. Allows the generic processing of unnamed model properties on the response object.\n   */\n  additionalProperties?: Mapper;\n\n  /**\n   * The name of the top-most parent scheme, the one that has no parents.\n   */\n  uberParent?: string;\n\n  /**\n   * A polymorphic discriminator.\n   */\n  polymorphicDiscriminator?: PolymorphicDiscriminator;\n}\n\n/**\n * Helps build a mapper that describes how to parse a sequence of mapped values.\n */\nexport interface SequenceMapperType {\n  /**\n   * Name of the sequence type mapper.\n   */\n  name: \"Sequence\";\n  /**\n   * The mapper to use to map each one of the properties of the sequence.\n   */\n  element: Mapper;\n}\n\n/**\n * Helps build a mapper that describes how to parse a dictionary of mapped values.\n */\nexport interface DictionaryMapperType {\n  /**\n   * Name of the sequence type mapper.\n   */\n  name: \"Dictionary\";\n  /**\n   * The mapper to use to map the value of each property in the dictionary.\n   */\n  value: Mapper;\n}\n\n/**\n * Helps build a mapper that describes how to parse an enum value.\n */\nexport interface EnumMapperType {\n  /**\n   * Name of the enum type mapper.\n   */\n  name: \"Enum\";\n  /**\n   * Values allowed by this mapper.\n   */\n  allowedValues: any[];\n}\n\n/**\n * The base definition of a mapper. Can be used for XML and plain JavaScript objects.\n */\nexport interface BaseMapper {\n  /**\n   * Name for the xml element\n   */\n  xmlName?: string;\n  /**\n   * Xml element namespace\n   */\n  xmlNamespace?: string;\n  /**\n   * Xml element namespace prefix\n   */\n  xmlNamespacePrefix?: string;\n  /**\n   * Determines if the current property should be serialized as an attribute of the parent xml element\n   */\n  xmlIsAttribute?: boolean;\n  /**\n   * Determines if the current property should be serialized as the inner content of the xml element\n   */\n  xmlIsMsText?: boolean;\n  /**\n   * Name for the xml elements when serializing an array\n   */\n  xmlElementName?: string;\n  /**\n   * Whether or not the current property should have a wrapping XML element\n   */\n  xmlIsWrapped?: boolean;\n  /**\n   * Whether or not the current property is readonly\n   */\n  readOnly?: boolean;\n  /**\n   * Whether or not the current property is a constant\n   */\n  isConstant?: boolean;\n  /**\n   * Whether or not the current property is required\n   */\n  required?: boolean;\n  /**\n   * Whether or not the current property allows mull as a value\n   */\n  nullable?: boolean;\n  /**\n   * The name to use when serializing\n   */\n  serializedName?: string;\n  /**\n   * Type of the mapper\n   */\n  type: MapperType;\n  /**\n   * Default value when one is not explicitly provided\n   */\n  defaultValue?: any;\n  /**\n   * Constraints to test the current value against\n   */\n  constraints?: MapperConstraints;\n}\n\n/**\n * Mappers are definitions of the data models used in the library.\n * These data models are part of the Operation or Client definitions in the responses or parameters.\n */\nexport type Mapper = BaseMapper | CompositeMapper | SequenceMapper | DictionaryMapper | EnumMapper;\n\n/**\n * Used to disambiguate discriminated type unions.\n * For example, if response can have many shapes but also includes a 'kind' field (or similar),\n * that field can be used to determine how to deserialize the response to the correct type.\n */\nexport interface PolymorphicDiscriminator {\n  /**\n   * Name of the discriminant property in the original JSON payload, e.g. `@odata.kind`.\n   */\n  serializedName: string;\n  /**\n   * Name to use on the resulting object instead of the original property name.\n   * Useful since the JSON property could be difficult to work with.\n   * For example: For a field received as `@odata.kind`, the final object could instead include a property simply named `kind`.\n   */\n  clientName: string;\n  /**\n   * It may contain any other property.\n   */\n  [key: string]: string;\n}\n\n/**\n * A mapper composed of other mappers.\n */\nexport interface CompositeMapper extends BaseMapper {\n  /**\n   * The type descriptor of the `CompositeMapper`.\n   */\n  type: CompositeMapperType;\n}\n\n/**\n * A mapper describing arrays.\n */\nexport interface SequenceMapper extends BaseMapper {\n  /**\n   * The type descriptor of the `SequenceMapper`.\n   */\n  type: SequenceMapperType;\n}\n\n/**\n * A mapper describing plain JavaScript objects used as key/value pairs.\n */\nexport interface DictionaryMapper extends BaseMapper {\n  /**\n   * The type descriptor of the `DictionaryMapper`.\n   */\n  type: DictionaryMapperType;\n  /**\n   * Optionally, a prefix to add to the header collection.\n   */\n  headerCollectionPrefix?: string;\n}\n\n/**\n * A mapper describing an enum value.\n */\nexport interface EnumMapper extends BaseMapper {\n  /**\n   * The type descriptor of the `EnumMapper`.\n   */\n  type: EnumMapperType;\n}\n\nexport interface UrlParameterValue {\n  value: string;\n  skipUrlEncoding: boolean;\n}\n\n/**\n * Configuration for creating a new Tracing Span\n */\nexport interface SpanConfig {\n  /**\n   * Package name prefix\n   */\n  packagePrefix: string;\n  /**\n   * Service namespace\n   */\n  namespace: string;\n}\n\n/**\n * Used to configure additional policies added to the pipeline at construction.\n */\nexport interface AdditionalPolicyConfig {\n  /**\n   * A policy to be added.\n   */\n  policy: PipelinePolicy;\n  /**\n   * Determines if this policy be applied before or after retry logic.\n   * Only use `perRetry` if you need to modify the request again\n   * each time the operation is retried due to retryable service\n   * issues.\n   */\n  position: \"perCall\" | \"perRetry\";\n}\n\n/**\n * The common set of options that high level clients are expected to expose.\n */\nexport interface CommonClientOptions extends PipelineOptions {\n  /**\n   * The HttpClient that will be used to send HTTP requests.\n   */\n  httpClient?: HttpClient;\n  /**\n   * Set to true if the request is sent over HTTP instead of HTTPS\n   */\n  allowInsecureConnection?: boolean;\n  /**\n   * Additional policies to include in the HTTP pipeline.\n   */\n  additionalPolicies?: AdditionalPolicyConfig[];\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { CompositeMapper, FullOperationResponse, OperationResponseMap } from \"./interfaces.js\";\n\n/**\n * The union of all possible types for a primitive response body.\n * @internal\n */\nexport type BodyPrimitive = number | string | boolean | Date | Uint8Array | undefined | null;\n\n/**\n * A type guard for a primitive response body.\n * @param value - Value to test\n *\n * @internal\n */\nexport function isPrimitiveBody(value: unknown, mapperTypeName?: string): value is BodyPrimitive {\n  return (\n    mapperTypeName !== \"Composite\" &&\n    mapperTypeName !== \"Dictionary\" &&\n    (typeof value === \"string\" ||\n      typeof value === \"number\" ||\n      typeof value === \"boolean\" ||\n      mapperTypeName?.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i) !==\n        null ||\n      value === undefined ||\n      value === null)\n  );\n}\n\nconst validateISODuration =\n  /^(-|\\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;\n\n/**\n * Returns true if the given string is in ISO 8601 format.\n * @param value - The value to be validated for ISO 8601 duration format.\n * @internal\n */\nexport function isDuration(value: string): boolean {\n  return validateISODuration.test(value);\n}\n\nconst validUuidRegex =\n  /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;\n\n/**\n * Returns true if the provided uuid is valid.\n *\n * @param uuid - The uuid that needs to be validated.\n *\n * @internal\n */\nexport function isValidUuid(uuid: string): boolean {\n  return validUuidRegex.test(uuid);\n}\n\n/**\n * Representation of parsed response headers and body coupled with information\n * about how to map them:\n * - whether the response body should be wrapped (typically if its type is primitive).\n * - whether the response is nullable so it can be null if the combination of\n *   the headers and the body is empty.\n */\ninterface ResponseObjectWithMetadata {\n  /** whether the mapper allows nullable body */\n  hasNullableType: boolean;\n  /** whether the response's body should be wrapped */\n  shouldWrapBody: boolean;\n  /** parsed headers of the response */\n  headers:\n    | {\n        [key: string]: unknown;\n      }\n    | undefined;\n  /** parsed body of the response */\n  body: any;\n}\n\n/**\n * Maps the response as follows:\n * - wraps the response body if needed (typically if its type is primitive).\n * - returns null if the combination of the headers and the body is empty.\n * - otherwise, returns the combination of the headers and the body.\n *\n * @param responseObject - a representation of the parsed response\n * @returns the response that will be returned to the user which can be null and/or wrapped\n *\n * @internal\n */\nfunction handleNullableResponseAndWrappableBody(\n  responseObject: ResponseObjectWithMetadata,\n): unknown | null {\n  const combinedHeadersAndBody = {\n    ...responseObject.headers,\n    ...responseObject.body,\n  };\n  if (\n    responseObject.hasNullableType &&\n    Object.getOwnPropertyNames(combinedHeadersAndBody).length === 0\n  ) {\n    return responseObject.shouldWrapBody ? { body: null } : null;\n  } else {\n    return responseObject.shouldWrapBody\n      ? {\n          ...responseObject.headers,\n          body: responseObject.body,\n        }\n      : combinedHeadersAndBody;\n  }\n}\n\n/**\n * Take a `FullOperationResponse` and turn it into a flat\n * response object to hand back to the consumer.\n * @param fullResponse - The processed response from the operation request\n * @param responseSpec - The response map from the OperationSpec\n *\n * @internal\n */\nexport function flattenResponse(\n  fullResponse: FullOperationResponse,\n  responseSpec: OperationResponseMap | undefined,\n): unknown {\n  const parsedHeaders = fullResponse.parsedHeaders;\n\n  // head methods never have a body, but we return a boolean set to body property\n  // to indicate presence/absence of the resource\n  if (fullResponse.request.method === \"HEAD\") {\n    return {\n      ...parsedHeaders,\n      body: fullResponse.parsedBody,\n    };\n  }\n  const bodyMapper = responseSpec && responseSpec.bodyMapper;\n  const isNullable = Boolean(bodyMapper?.nullable);\n  const expectedBodyTypeName = bodyMapper?.type.name;\n\n  /** If the body is asked for, we look at the expected body type to handle it */\n  if (expectedBodyTypeName === \"Stream\") {\n    return {\n      ...parsedHeaders,\n      blobBody: fullResponse.blobBody,\n      readableStreamBody: fullResponse.readableStreamBody,\n    };\n  }\n\n  const modelProperties =\n    (expectedBodyTypeName === \"Composite\" &&\n      (bodyMapper as CompositeMapper).type.modelProperties) ||\n    {};\n  const isPageableResponse = Object.keys(modelProperties).some(\n    (k) => modelProperties[k].serializedName === \"\",\n  );\n  if (expectedBodyTypeName === \"Sequence\" || isPageableResponse) {\n    const arrayResponse: { [key: string]: unknown } =\n      fullResponse.parsedBody ?? ([] as unknown as { [key: string]: unknown });\n\n    for (const key of Object.keys(modelProperties)) {\n      if (modelProperties[key].serializedName) {\n        arrayResponse[key] = fullResponse.parsedBody?.[key];\n      }\n    }\n\n    if (parsedHeaders) {\n      for (const key of Object.keys(parsedHeaders)) {\n        arrayResponse[key] = parsedHeaders[key];\n      }\n    }\n    return isNullable &&\n      !fullResponse.parsedBody &&\n      !parsedHeaders &&\n      Object.getOwnPropertyNames(modelProperties).length === 0\n      ? null\n      : arrayResponse;\n  }\n\n  return handleNullableResponseAndWrappableBody({\n    body: fullResponse.parsedBody,\n    headers: parsedHeaders,\n    hasNullableType: isNullable,\n    shouldWrapBody: isPrimitiveBody(fullResponse.parsedBody, expectedBodyTypeName),\n  });\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport * as base64 from \"./base64.js\";\nimport {\n  BaseMapper,\n  CompositeMapper,\n  DictionaryMapper,\n  EnumMapper,\n  Mapper,\n  MapperConstraints,\n  PolymorphicDiscriminator,\n  RequiredSerializerOptions,\n  SequenceMapper,\n  Serializer,\n  SerializerOptions,\n  XML_ATTRKEY,\n  XML_CHARKEY,\n} from \"./interfaces.js\";\nimport { isDuration, isValidUuid } from \"./utils.js\";\n\nclass SerializerImpl implements Serializer {\n  constructor(\n    public readonly modelMappers: { [key: string]: any } = {},\n    public readonly isXML: boolean = false,\n  ) {}\n\n  /**\n   * @deprecated Removing the constraints validation on client side.\n   */\n  validateConstraints(mapper: Mapper, value: any, objectName: string): void {\n    const failValidation = (\n      constraintName: keyof MapperConstraints,\n      constraintValue: any,\n    ): never => {\n      throw new Error(\n        `\"${objectName}\" with value \"${value}\" should satisfy the constraint \"${constraintName}\": ${constraintValue}.`,\n      );\n    };\n    if (mapper.constraints && value !== undefined && value !== null) {\n      const {\n        ExclusiveMaximum,\n        ExclusiveMinimum,\n        InclusiveMaximum,\n        InclusiveMinimum,\n        MaxItems,\n        MaxLength,\n        MinItems,\n        MinLength,\n        MultipleOf,\n        Pattern,\n        UniqueItems,\n      } = mapper.constraints;\n      if (ExclusiveMaximum !== undefined && value >= ExclusiveMaximum) {\n        failValidation(\"ExclusiveMaximum\", ExclusiveMaximum);\n      }\n      if (ExclusiveMinimum !== undefined && value <= ExclusiveMinimum) {\n        failValidation(\"ExclusiveMinimum\", ExclusiveMinimum);\n      }\n      if (InclusiveMaximum !== undefined && value > InclusiveMaximum) {\n        failValidation(\"InclusiveMaximum\", InclusiveMaximum);\n      }\n      if (InclusiveMinimum !== undefined && value < InclusiveMinimum) {\n        failValidation(\"InclusiveMinimum\", InclusiveMinimum);\n      }\n      if (MaxItems !== undefined && value.length > MaxItems) {\n        failValidation(\"MaxItems\", MaxItems);\n      }\n      if (MaxLength !== undefined && value.length > MaxLength) {\n        failValidation(\"MaxLength\", MaxLength);\n      }\n      if (MinItems !== undefined && value.length < MinItems) {\n        failValidation(\"MinItems\", MinItems);\n      }\n      if (MinLength !== undefined && value.length < MinLength) {\n        failValidation(\"MinLength\", MinLength);\n      }\n      if (MultipleOf !== undefined && value % MultipleOf !== 0) {\n        failValidation(\"MultipleOf\", MultipleOf);\n      }\n      if (Pattern) {\n        const pattern: RegExp = typeof Pattern === \"string\" ? new RegExp(Pattern) : Pattern;\n        if (typeof value !== \"string\" || value.match(pattern) === null) {\n          failValidation(\"Pattern\", Pattern);\n        }\n      }\n      if (\n        UniqueItems &&\n        value.some((item: any, i: number, ar: Array<any>) => ar.indexOf(item) !== i)\n      ) {\n        failValidation(\"UniqueItems\", UniqueItems);\n      }\n    }\n  }\n\n  /**\n   * Serialize the given object based on its metadata defined in the mapper\n   *\n   * @param mapper - The mapper which defines the metadata of the serializable object\n   *\n   * @param object - A valid Javascript object to be serialized\n   *\n   * @param objectName - Name of the serialized object\n   *\n   * @param options - additional options to serialization\n   *\n   * @returns A valid serialized Javascript object\n   */\n  serialize(\n    mapper: Mapper,\n    object: any,\n    objectName?: string,\n    options: SerializerOptions = { xml: {} },\n  ): any {\n    const updatedOptions: RequiredSerializerOptions = {\n      xml: {\n        rootName: options.xml.rootName ?? \"\",\n        includeRoot: options.xml.includeRoot ?? false,\n        xmlCharKey: options.xml.xmlCharKey ?? XML_CHARKEY,\n      },\n    };\n    let payload: any = {};\n    const mapperType = mapper.type.name as string;\n    if (!objectName) {\n      objectName = mapper.serializedName!;\n    }\n    if (mapperType.match(/^Sequence$/i) !== null) {\n      payload = [];\n    }\n\n    if (mapper.isConstant) {\n      object = mapper.defaultValue;\n    }\n\n    // This table of allowed values should help explain\n    // the mapper.required and mapper.nullable properties.\n    // X means \"neither undefined or null are allowed\".\n    //           || required\n    //           || true      | false\n    //  nullable || ==========================\n    //      true || null      | undefined/null\n    //     false || X         | undefined\n    // undefined || X         | undefined/null\n\n    const { required, nullable } = mapper;\n\n    if (required && nullable && object === undefined) {\n      throw new Error(`${objectName} cannot be undefined.`);\n    }\n    if (required && !nullable && (object === undefined || object === null)) {\n      throw new Error(`${objectName} cannot be null or undefined.`);\n    }\n    if (!required && nullable === false && object === null) {\n      throw new Error(`${objectName} cannot be null.`);\n    }\n\n    if (object === undefined || object === null) {\n      payload = object;\n    } else {\n      if (mapperType.match(/^any$/i) !== null) {\n        payload = object;\n      } else if (mapperType.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i) !== null) {\n        payload = serializeBasicTypes(mapperType, objectName, object);\n      } else if (mapperType.match(/^Enum$/i) !== null) {\n        const enumMapper = mapper as EnumMapper;\n        payload = serializeEnumType(objectName, enumMapper.type.allowedValues, object);\n      } else if (\n        mapperType.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i) !== null\n      ) {\n        payload = serializeDateTypes(mapperType, object, objectName);\n      } else if (mapperType.match(/^ByteArray$/i) !== null) {\n        payload = serializeByteArrayType(objectName, object);\n      } else if (mapperType.match(/^Base64Url$/i) !== null) {\n        payload = serializeBase64UrlType(objectName, object);\n      } else if (mapperType.match(/^Sequence$/i) !== null) {\n        payload = serializeSequenceType(\n          this,\n          mapper as SequenceMapper,\n          object,\n          objectName,\n          Boolean(this.isXML),\n          updatedOptions,\n        );\n      } else if (mapperType.match(/^Dictionary$/i) !== null) {\n        payload = serializeDictionaryType(\n          this,\n          mapper as DictionaryMapper,\n          object,\n          objectName,\n          Boolean(this.isXML),\n          updatedOptions,\n        );\n      } else if (mapperType.match(/^Composite$/i) !== null) {\n        payload = serializeCompositeType(\n          this,\n          mapper as CompositeMapper,\n          object,\n          objectName,\n          Boolean(this.isXML),\n          updatedOptions,\n        );\n      }\n    }\n    return payload;\n  }\n\n  /**\n   * Deserialize the given object based on its metadata defined in the mapper\n   *\n   * @param mapper - The mapper which defines the metadata of the serializable object\n   *\n   * @param responseBody - A valid Javascript entity to be deserialized\n   *\n   * @param objectName - Name of the deserialized object\n   *\n   * @param options - Controls behavior of XML parser and builder.\n   *\n   * @returns A valid deserialized Javascript object\n   */\n  deserialize(\n    mapper: Mapper,\n    responseBody: any,\n    objectName: string,\n    options: SerializerOptions = { xml: {} },\n  ): any {\n    const updatedOptions: RequiredSerializerOptions = {\n      xml: {\n        rootName: options.xml.rootName ?? \"\",\n        includeRoot: options.xml.includeRoot ?? false,\n        xmlCharKey: options.xml.xmlCharKey ?? XML_CHARKEY,\n      },\n      ignoreUnknownProperties: options.ignoreUnknownProperties ?? false,\n    };\n    if (responseBody === undefined || responseBody === null) {\n      if (this.isXML && mapper.type.name === \"Sequence\" && !mapper.xmlIsWrapped) {\n        // Edge case for empty XML non-wrapped lists. xml2js can't distinguish\n        // between the list being empty versus being missing,\n        // so let's do the more user-friendly thing and return an empty list.\n        responseBody = [];\n      }\n      // specifically check for undefined as default value can be a falsey value `0, \"\", false, null`\n      if (mapper.defaultValue !== undefined) {\n        responseBody = mapper.defaultValue;\n      }\n      return responseBody;\n    }\n\n    let payload: any;\n    const mapperType = mapper.type.name;\n    if (!objectName) {\n      objectName = mapper.serializedName!;\n    }\n\n    if (mapperType.match(/^Composite$/i) !== null) {\n      payload = deserializeCompositeType(\n        this,\n        mapper as CompositeMapper,\n        responseBody,\n        objectName,\n        updatedOptions,\n      );\n    } else {\n      if (this.isXML) {\n        const xmlCharKey = updatedOptions.xml.xmlCharKey;\n        /**\n         * If the mapper specifies this as a non-composite type value but the responseBody contains\n         * both header (\"$\" i.e., XML_ATTRKEY) and body (\"#\" i.e., XML_CHARKEY) properties,\n         * then just reduce the responseBody value to the body (\"#\" i.e., XML_CHARKEY) property.\n         */\n        if (responseBody[XML_ATTRKEY] !== undefined && responseBody[xmlCharKey] !== undefined) {\n          responseBody = responseBody[xmlCharKey];\n        }\n      }\n\n      if (mapperType.match(/^Number$/i) !== null) {\n        payload = parseFloat(responseBody);\n        if (isNaN(payload)) {\n          payload = responseBody;\n        }\n      } else if (mapperType.match(/^Boolean$/i) !== null) {\n        if (responseBody === \"true\") {\n          payload = true;\n        } else if (responseBody === \"false\") {\n          payload = false;\n        } else {\n          payload = responseBody;\n        }\n      } else if (mapperType.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i) !== null) {\n        payload = responseBody;\n      } else if (mapperType.match(/^(Date|DateTime|DateTimeRfc1123)$/i) !== null) {\n        payload = new Date(responseBody);\n      } else if (mapperType.match(/^UnixTime$/i) !== null) {\n        payload = unixTimeToDate(responseBody);\n      } else if (mapperType.match(/^ByteArray$/i) !== null) {\n        payload = base64.decodeString(responseBody);\n      } else if (mapperType.match(/^Base64Url$/i) !== null) {\n        payload = base64UrlToByteArray(responseBody);\n      } else if (mapperType.match(/^Sequence$/i) !== null) {\n        payload = deserializeSequenceType(\n          this,\n          mapper as SequenceMapper,\n          responseBody,\n          objectName,\n          updatedOptions,\n        );\n      } else if (mapperType.match(/^Dictionary$/i) !== null) {\n        payload = deserializeDictionaryType(\n          this,\n          mapper as DictionaryMapper,\n          responseBody,\n          objectName,\n          updatedOptions,\n        );\n      }\n    }\n\n    if (mapper.isConstant) {\n      payload = mapper.defaultValue;\n    }\n\n    return payload;\n  }\n}\n\n/**\n * Method that creates and returns a Serializer.\n * @param modelMappers - Known models to map\n * @param isXML - If XML should be supported\n */\nexport function createSerializer(\n  modelMappers: { [key: string]: any } = {},\n  isXML: boolean = false,\n): Serializer {\n  return new SerializerImpl(modelMappers, isXML);\n}\n\nfunction trimEnd(str: string, ch: string): string {\n  let len = str.length;\n  while (len - 1 >= 0 && str[len - 1] === ch) {\n    --len;\n  }\n  return str.substr(0, len);\n}\n\nfunction bufferToBase64Url(buffer: Uint8Array): string | undefined {\n  if (!buffer) {\n    return undefined;\n  }\n  if (!(buffer instanceof Uint8Array)) {\n    throw new Error(`Please provide an input of type Uint8Array for converting to Base64Url.`);\n  }\n  // Uint8Array to Base64.\n  const str = base64.encodeByteArray(buffer);\n  // Base64 to Base64Url.\n  return trimEnd(str, \"=\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\n\nfunction base64UrlToByteArray(str: string): Uint8Array | undefined {\n  if (!str) {\n    return undefined;\n  }\n  if (str && typeof str.valueOf() !== \"string\") {\n    throw new Error(\"Please provide an input of type string for converting to Uint8Array\");\n  }\n  // Base64Url to Base64.\n  str = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  // Base64 to Uint8Array.\n  return base64.decodeString(str);\n}\n\nfunction splitSerializeName(prop: string | undefined): string[] {\n  const classes: string[] = [];\n  let partialclass = \"\";\n  if (prop) {\n    const subwords = prop.split(\".\");\n\n    for (const item of subwords) {\n      if (item.charAt(item.length - 1) === \"\\\\\") {\n        partialclass += item.substr(0, item.length - 1) + \".\";\n      } else {\n        partialclass += item;\n        classes.push(partialclass);\n        partialclass = \"\";\n      }\n    }\n  }\n\n  return classes;\n}\n\nfunction dateToUnixTime(d: string | Date): number | undefined {\n  if (!d) {\n    return undefined;\n  }\n\n  if (typeof d.valueOf() === \"string\") {\n    d = new Date(d as string);\n  }\n  return Math.floor((d as Date).getTime() / 1000);\n}\n\nfunction unixTimeToDate(n: number): Date | undefined {\n  if (!n) {\n    return undefined;\n  }\n  return new Date(n * 1000);\n}\n\nfunction serializeBasicTypes(typeName: string, objectName: string, value: any): any {\n  if (value !== null && value !== undefined) {\n    if (typeName.match(/^Number$/i) !== null) {\n      if (typeof value !== \"number\") {\n        throw new Error(`${objectName} with value ${value} must be of type number.`);\n      }\n    } else if (typeName.match(/^String$/i) !== null) {\n      if (typeof value.valueOf() !== \"string\") {\n        throw new Error(`${objectName} with value \"${value}\" must be of type string.`);\n      }\n    } else if (typeName.match(/^Uuid$/i) !== null) {\n      if (!(typeof value.valueOf() === \"string\" && isValidUuid(value))) {\n        throw new Error(\n          `${objectName} with value \"${value}\" must be of type string and a valid uuid.`,\n        );\n      }\n    } else if (typeName.match(/^Boolean$/i) !== null) {\n      if (typeof value !== \"boolean\") {\n        throw new Error(`${objectName} with value ${value} must be of type boolean.`);\n      }\n    } else if (typeName.match(/^Stream$/i) !== null) {\n      const objectType = typeof value;\n      if (\n        objectType !== \"string\" &&\n        typeof value.pipe !== \"function\" && // NodeJS.ReadableStream\n        typeof value.tee !== \"function\" && // browser ReadableStream\n        !(value instanceof ArrayBuffer) &&\n        !ArrayBuffer.isView(value) &&\n        // File objects count as a type of Blob, so we want to use instanceof explicitly\n        !((typeof Blob === \"function\" || typeof Blob === \"object\") && value instanceof Blob) &&\n        objectType !== \"function\"\n      ) {\n        throw new Error(\n          `${objectName} must be a string, Blob, ArrayBuffer, ArrayBufferView, ReadableStream, or () => ReadableStream.`,\n        );\n      }\n    }\n  }\n  return value;\n}\n\nfunction serializeEnumType(objectName: string, allowedValues: Array<any>, value: any): any {\n  if (!allowedValues) {\n    throw new Error(\n      `Please provide a set of allowedValues to validate ${objectName} as an Enum Type.`,\n    );\n  }\n  const isPresent = allowedValues.some((item) => {\n    if (typeof item.valueOf() === \"string\") {\n      return item.toLowerCase() === value.toLowerCase();\n    }\n    return item === value;\n  });\n  if (!isPresent) {\n    throw new Error(\n      `${value} is not a valid value for ${objectName}. The valid values are: ${JSON.stringify(\n        allowedValues,\n      )}.`,\n    );\n  }\n  return value;\n}\n\nfunction serializeByteArrayType(objectName: string, value: any): any {\n  if (value !== undefined && value !== null) {\n    if (!(value instanceof Uint8Array)) {\n      throw new Error(`${objectName} must be of type Uint8Array.`);\n    }\n    value = base64.encodeByteArray(value);\n  }\n  return value;\n}\n\nfunction serializeBase64UrlType(objectName: string, value: any): any {\n  if (value !== undefined && value !== null) {\n    if (!(value instanceof Uint8Array)) {\n      throw new Error(`${objectName} must be of type Uint8Array.`);\n    }\n    value = bufferToBase64Url(value);\n  }\n  return value;\n}\n\nfunction serializeDateTypes(typeName: string, value: any, objectName: string): any {\n  if (value !== undefined && value !== null) {\n    if (typeName.match(/^Date$/i) !== null) {\n      if (\n        !(\n          value instanceof Date ||\n          (typeof value.valueOf() === \"string\" && !isNaN(Date.parse(value)))\n        )\n      ) {\n        throw new Error(`${objectName} must be an instanceof Date or a string in ISO8601 format.`);\n      }\n      value =\n        value instanceof Date\n          ? value.toISOString().substring(0, 10)\n          : new Date(value).toISOString().substring(0, 10);\n    } else if (typeName.match(/^DateTime$/i) !== null) {\n      if (\n        !(\n          value instanceof Date ||\n          (typeof value.valueOf() === \"string\" && !isNaN(Date.parse(value)))\n        )\n      ) {\n        throw new Error(`${objectName} must be an instanceof Date or a string in ISO8601 format.`);\n      }\n      value = value instanceof Date ? value.toISOString() : new Date(value).toISOString();\n    } else if (typeName.match(/^DateTimeRfc1123$/i) !== null) {\n      if (\n        !(\n          value instanceof Date ||\n          (typeof value.valueOf() === \"string\" && !isNaN(Date.parse(value)))\n        )\n      ) {\n        throw new Error(`${objectName} must be an instanceof Date or a string in RFC-1123 format.`);\n      }\n      value = value instanceof Date ? value.toUTCString() : new Date(value).toUTCString();\n    } else if (typeName.match(/^UnixTime$/i) !== null) {\n      if (\n        !(\n          value instanceof Date ||\n          (typeof value.valueOf() === \"string\" && !isNaN(Date.parse(value)))\n        )\n      ) {\n        throw new Error(\n          `${objectName} must be an instanceof Date or a string in RFC-1123/ISO8601 format ` +\n            `for it to be serialized in UnixTime/Epoch format.`,\n        );\n      }\n      value = dateToUnixTime(value);\n    } else if (typeName.match(/^TimeSpan$/i) !== null) {\n      if (!isDuration(value)) {\n        throw new Error(\n          `${objectName} must be a string in ISO 8601 format. Instead was \"${value}\".`,\n        );\n      }\n    }\n  }\n  return value;\n}\n\nfunction serializeSequenceType(\n  serializer: Serializer,\n  mapper: SequenceMapper,\n  object: any,\n  objectName: string,\n  isXml: boolean,\n  options: RequiredSerializerOptions,\n): any {\n  if (!Array.isArray(object)) {\n    throw new Error(`${objectName} must be of type Array.`);\n  }\n  let elementType = mapper.type.element;\n  if (!elementType || typeof elementType !== \"object\") {\n    throw new Error(\n      `element\" metadata for an Array must be defined in the ` +\n        `mapper and it must of type \"object\" in ${objectName}.`,\n    );\n  }\n  // Quirk: Composite mappers referenced by `element` might\n  // not have *all* properties declared (like uberParent),\n  // so let's try to look up the full definition by name.\n  if (elementType.type.name === \"Composite\" && elementType.type.className) {\n    elementType = serializer.modelMappers[elementType.type.className] ?? elementType;\n  }\n  const tempArray = [];\n  for (let i = 0; i < object.length; i++) {\n    const serializedValue = serializer.serialize(elementType, object[i], objectName, options);\n    if (isXml && elementType.xmlNamespace) {\n      const xmlnsKey = elementType.xmlNamespacePrefix\n        ? `xmlns:${elementType.xmlNamespacePrefix}`\n        : \"xmlns\";\n      if (elementType.type.name === \"Composite\") {\n        tempArray[i] = { ...serializedValue };\n        tempArray[i][XML_ATTRKEY] = { [xmlnsKey]: elementType.xmlNamespace };\n      } else {\n        tempArray[i] = {};\n        tempArray[i][options.xml.xmlCharKey] = serializedValue;\n        tempArray[i][XML_ATTRKEY] = { [xmlnsKey]: elementType.xmlNamespace };\n      }\n    } else {\n      tempArray[i] = serializedValue;\n    }\n  }\n  return tempArray;\n}\n\nfunction serializeDictionaryType(\n  serializer: Serializer,\n  mapper: DictionaryMapper,\n  object: any,\n  objectName: string,\n  isXml: boolean,\n  options: RequiredSerializerOptions,\n): any {\n  if (typeof object !== \"object\") {\n    throw new Error(`${objectName} must be of type object.`);\n  }\n  const valueType = mapper.type.value;\n  if (!valueType || typeof valueType !== \"object\") {\n    throw new Error(\n      `\"value\" metadata for a Dictionary must be defined in the ` +\n        `mapper and it must of type \"object\" in ${objectName}.`,\n    );\n  }\n  const tempDictionary: { [key: string]: any } = {};\n  for (const key of Object.keys(object)) {\n    const serializedValue = serializer.serialize(valueType, object[key], objectName, options);\n    // If the element needs an XML namespace we need to add it within the $ property\n    tempDictionary[key] = getXmlObjectValue(valueType, serializedValue, isXml, options);\n  }\n\n  // Add the namespace to the root element if needed\n  if (isXml && mapper.xmlNamespace) {\n    const xmlnsKey = mapper.xmlNamespacePrefix ? `xmlns:${mapper.xmlNamespacePrefix}` : \"xmlns\";\n    const result = tempDictionary;\n    result[XML_ATTRKEY] = { [xmlnsKey]: mapper.xmlNamespace };\n    return result;\n  }\n\n  return tempDictionary;\n}\n\n/**\n * Resolves the additionalProperties property from a referenced mapper\n * @param serializer - the serializer containing the entire set of mappers\n * @param mapper - the composite mapper to resolve\n * @param objectName - name of the object being serialized\n */\nfunction resolveAdditionalProperties(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  objectName: string,\n): SequenceMapper | BaseMapper | CompositeMapper | DictionaryMapper | EnumMapper | undefined {\n  const additionalProperties = mapper.type.additionalProperties;\n\n  if (!additionalProperties && mapper.type.className) {\n    const modelMapper = resolveReferencedMapper(serializer, mapper, objectName);\n    return modelMapper?.type.additionalProperties;\n  }\n\n  return additionalProperties;\n}\n\n/**\n * Finds the mapper referenced by className\n * @param serializer - the serializer containing the entire set of mappers\n * @param mapper - the composite mapper to resolve\n * @param objectName - name of the object being serialized\n */\nfunction resolveReferencedMapper(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  objectName: string,\n): CompositeMapper | undefined {\n  const className = mapper.type.className;\n  if (!className) {\n    throw new Error(\n      `Class name for model \"${objectName}\" is not provided in the mapper \"${JSON.stringify(\n        mapper,\n        undefined,\n        2,\n      )}\".`,\n    );\n  }\n\n  return serializer.modelMappers[className];\n}\n\n/**\n * Resolves a composite mapper's modelProperties.\n * @param serializer - the serializer containing the entire set of mappers\n * @param mapper - the composite mapper to resolve\n */\nfunction resolveModelProperties(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  objectName: string,\n): { [propertyName: string]: Mapper } {\n  let modelProps = mapper.type.modelProperties;\n  if (!modelProps) {\n    const modelMapper = resolveReferencedMapper(serializer, mapper, objectName);\n    if (!modelMapper) {\n      throw new Error(`mapper() cannot be null or undefined for model \"${mapper.type.className}\".`);\n    }\n    modelProps = modelMapper?.type.modelProperties;\n    if (!modelProps) {\n      throw new Error(\n        `modelProperties cannot be null or undefined in the ` +\n          `mapper \"${JSON.stringify(modelMapper)}\" of type \"${\n            mapper.type.className\n          }\" for object \"${objectName}\".`,\n      );\n    }\n  }\n\n  return modelProps;\n}\n\nfunction serializeCompositeType(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  object: any,\n  objectName: string,\n  isXml: boolean,\n  options: RequiredSerializerOptions,\n): any {\n  if (getPolymorphicDiscriminatorRecursively(serializer, mapper)) {\n    mapper = getPolymorphicMapper(serializer, mapper, object, \"clientName\");\n  }\n\n  if (object !== undefined && object !== null) {\n    const payload: any = {};\n    const modelProps = resolveModelProperties(serializer, mapper, objectName);\n    for (const key of Object.keys(modelProps)) {\n      const propertyMapper = modelProps[key];\n      if (propertyMapper.readOnly) {\n        continue;\n      }\n\n      let propName: string | undefined;\n      let parentObject: any = payload;\n      if (serializer.isXML) {\n        if (propertyMapper.xmlIsWrapped) {\n          propName = propertyMapper.xmlName;\n        } else {\n          propName = propertyMapper.xmlElementName || propertyMapper.xmlName;\n        }\n      } else {\n        const paths = splitSerializeName(propertyMapper.serializedName!);\n        propName = paths.pop();\n\n        for (const pathName of paths) {\n          const childObject = parentObject[pathName];\n          if (\n            (childObject === undefined || childObject === null) &&\n            ((object[key] !== undefined && object[key] !== null) ||\n              propertyMapper.defaultValue !== undefined)\n          ) {\n            parentObject[pathName] = {};\n          }\n          parentObject = parentObject[pathName];\n        }\n      }\n\n      if (parentObject !== undefined && parentObject !== null) {\n        if (isXml && mapper.xmlNamespace) {\n          const xmlnsKey = mapper.xmlNamespacePrefix\n            ? `xmlns:${mapper.xmlNamespacePrefix}`\n            : \"xmlns\";\n          parentObject[XML_ATTRKEY] = {\n            ...parentObject[XML_ATTRKEY],\n            [xmlnsKey]: mapper.xmlNamespace,\n          };\n        }\n        const propertyObjectName =\n          propertyMapper.serializedName !== \"\"\n            ? objectName + \".\" + propertyMapper.serializedName\n            : objectName;\n\n        let toSerialize = object[key];\n        const polymorphicDiscriminator = getPolymorphicDiscriminatorRecursively(serializer, mapper);\n        if (\n          polymorphicDiscriminator &&\n          polymorphicDiscriminator.clientName === key &&\n          (toSerialize === undefined || toSerialize === null)\n        ) {\n          toSerialize = mapper.serializedName;\n        }\n\n        const serializedValue = serializer.serialize(\n          propertyMapper,\n          toSerialize,\n          propertyObjectName,\n          options,\n        );\n        if (serializedValue !== undefined && propName !== undefined && propName !== null) {\n          const value = getXmlObjectValue(propertyMapper, serializedValue, isXml, options);\n          if (isXml && propertyMapper.xmlIsAttribute) {\n            // XML_ATTRKEY, i.e., $ is the key attributes are kept under in xml2js.\n            // This keeps things simple while preventing name collision\n            // with names in user documents.\n            parentObject[XML_ATTRKEY] = parentObject[XML_ATTRKEY] || {};\n            parentObject[XML_ATTRKEY][propName] = serializedValue;\n          } else if (isXml && propertyMapper.xmlIsWrapped) {\n            parentObject[propName] = { [propertyMapper.xmlElementName!]: value };\n          } else {\n            parentObject[propName] = value;\n          }\n        }\n      }\n    }\n\n    const additionalPropertiesMapper = resolveAdditionalProperties(serializer, mapper, objectName);\n    if (additionalPropertiesMapper) {\n      const propNames = Object.keys(modelProps);\n      for (const clientPropName in object) {\n        const isAdditionalProperty = propNames.every((pn) => pn !== clientPropName);\n        if (isAdditionalProperty) {\n          payload[clientPropName] = serializer.serialize(\n            additionalPropertiesMapper,\n            object[clientPropName],\n            objectName + '[\"' + clientPropName + '\"]',\n            options,\n          );\n        }\n      }\n    }\n\n    return payload;\n  }\n  return object;\n}\n\nfunction getXmlObjectValue(\n  propertyMapper: Mapper,\n  serializedValue: any,\n  isXml: boolean,\n  options: RequiredSerializerOptions,\n): any {\n  if (!isXml || !propertyMapper.xmlNamespace) {\n    return serializedValue;\n  }\n\n  const xmlnsKey = propertyMapper.xmlNamespacePrefix\n    ? `xmlns:${propertyMapper.xmlNamespacePrefix}`\n    : \"xmlns\";\n  const xmlNamespace = { [xmlnsKey]: propertyMapper.xmlNamespace };\n\n  if ([\"Composite\"].includes(propertyMapper.type.name)) {\n    if (serializedValue[XML_ATTRKEY]) {\n      return serializedValue;\n    } else {\n      const result: any = { ...serializedValue };\n      result[XML_ATTRKEY] = xmlNamespace;\n      return result;\n    }\n  }\n  const result: any = {};\n  result[options.xml.xmlCharKey] = serializedValue;\n  result[XML_ATTRKEY] = xmlNamespace;\n  return result;\n}\n\nfunction isSpecialXmlProperty(propertyName: string, options: RequiredSerializerOptions): boolean {\n  return [XML_ATTRKEY, options.xml.xmlCharKey].includes(propertyName);\n}\n\nfunction deserializeCompositeType(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  responseBody: any,\n  objectName: string,\n  options: RequiredSerializerOptions,\n): any {\n  const xmlCharKey = options.xml.xmlCharKey ?? XML_CHARKEY;\n  if (getPolymorphicDiscriminatorRecursively(serializer, mapper)) {\n    mapper = getPolymorphicMapper(serializer, mapper, responseBody, \"serializedName\");\n  }\n\n  const modelProps = resolveModelProperties(serializer, mapper, objectName);\n  let instance: { [key: string]: any } = {};\n  const handledPropertyNames: string[] = [];\n\n  for (const key of Object.keys(modelProps)) {\n    const propertyMapper = modelProps[key];\n    const paths = splitSerializeName(modelProps[key].serializedName!);\n    handledPropertyNames.push(paths[0]);\n    const { serializedName, xmlName, xmlElementName } = propertyMapper;\n    let propertyObjectName = objectName;\n    if (serializedName !== \"\" && serializedName !== undefined) {\n      propertyObjectName = objectName + \".\" + serializedName;\n    }\n\n    const headerCollectionPrefix = (propertyMapper as DictionaryMapper).headerCollectionPrefix;\n    if (headerCollectionPrefix) {\n      const dictionary: any = {};\n      for (const headerKey of Object.keys(responseBody)) {\n        if (headerKey.startsWith(headerCollectionPrefix)) {\n          dictionary[headerKey.substring(headerCollectionPrefix.length)] = serializer.deserialize(\n            (propertyMapper as DictionaryMapper).type.value,\n            responseBody[headerKey],\n            propertyObjectName,\n            options,\n          );\n        }\n\n        handledPropertyNames.push(headerKey);\n      }\n      instance[key] = dictionary;\n    } else if (serializer.isXML) {\n      if (propertyMapper.xmlIsAttribute && responseBody[XML_ATTRKEY]) {\n        instance[key] = serializer.deserialize(\n          propertyMapper,\n          responseBody[XML_ATTRKEY][xmlName!],\n          propertyObjectName,\n          options,\n        );\n      } else if (propertyMapper.xmlIsMsText) {\n        if (responseBody[xmlCharKey] !== undefined) {\n          instance[key] = responseBody[xmlCharKey];\n        } else if (typeof responseBody === \"string\") {\n          // The special case where xml parser parses \"<Name>content</Name>\" into JSON of\n          //   `{ name: \"content\"}` instead of `{ name: { \"_\": \"content\" }}`\n          instance[key] = responseBody;\n        }\n      } else {\n        const propertyName = xmlElementName || xmlName || serializedName;\n        if (propertyMapper.xmlIsWrapped) {\n          /* a list of <xmlElementName> wrapped by <xmlName>\n            For the xml example below\n              <Cors>\n                <CorsRule>...</CorsRule>\n                <CorsRule>...</CorsRule>\n              </Cors>\n            the responseBody has\n              {\n                Cors: {\n                  CorsRule: [{...}, {...}]\n                }\n              }\n            xmlName is \"Cors\" and xmlElementName is\"CorsRule\".\n          */\n          const wrapped = responseBody[xmlName!];\n          const elementList = wrapped?.[xmlElementName!] ?? [];\n          instance[key] = serializer.deserialize(\n            propertyMapper,\n            elementList,\n            propertyObjectName,\n            options,\n          );\n          handledPropertyNames.push(xmlName!);\n        } else {\n          const property = responseBody[propertyName!];\n          instance[key] = serializer.deserialize(\n            propertyMapper,\n            property,\n            propertyObjectName,\n            options,\n          );\n          handledPropertyNames.push(propertyName!);\n        }\n      }\n    } else {\n      // deserialize the property if it is present in the provided responseBody instance\n      let propertyInstance;\n      let res = responseBody;\n      // traversing the object step by step.\n      let steps = 0;\n      for (const item of paths) {\n        if (!res) break;\n        steps++;\n        res = res[item];\n      }\n      // only accept null when reaching the last position of object otherwise it would be undefined\n      if (res === null && steps < paths.length) {\n        res = undefined;\n      }\n      propertyInstance = res;\n      const polymorphicDiscriminator = mapper.type.polymorphicDiscriminator;\n      // checking that the model property name (key)(ex: \"fishtype\") and the\n      // clientName of the polymorphicDiscriminator {metadata} (ex: \"fishtype\")\n      // instead of the serializedName of the polymorphicDiscriminator (ex: \"fish.type\")\n      // is a better approach. The generator is not consistent with escaping '\\.' in the\n      // serializedName of the property (ex: \"fish\\.type\") that is marked as polymorphic discriminator\n      // and the serializedName of the metadata polymorphicDiscriminator (ex: \"fish.type\"). However,\n      // the clientName transformation of the polymorphicDiscriminator (ex: \"fishtype\") and\n      // the transformation of model property name (ex: \"fishtype\") is done consistently.\n      // Hence, it is a safer bet to rely on the clientName of the polymorphicDiscriminator.\n      if (\n        polymorphicDiscriminator &&\n        key === polymorphicDiscriminator.clientName &&\n        (propertyInstance === undefined || propertyInstance === null)\n      ) {\n        propertyInstance = mapper.serializedName;\n      }\n\n      let serializedValue;\n      // paging\n      if (Array.isArray(responseBody[key]) && modelProps[key].serializedName === \"\") {\n        propertyInstance = responseBody[key];\n        const arrayInstance = serializer.deserialize(\n          propertyMapper,\n          propertyInstance,\n          propertyObjectName,\n          options,\n        );\n        // Copy over any properties that have already been added into the instance, where they do\n        // not exist on the newly de-serialized array\n        for (const [k, v] of Object.entries(instance)) {\n          if (!Object.prototype.hasOwnProperty.call(arrayInstance, k)) {\n            arrayInstance[k] = v;\n          }\n        }\n        instance = arrayInstance;\n      } else if (propertyInstance !== undefined || propertyMapper.defaultValue !== undefined) {\n        serializedValue = serializer.deserialize(\n          propertyMapper,\n          propertyInstance,\n          propertyObjectName,\n          options,\n        );\n        instance[key] = serializedValue;\n      }\n    }\n  }\n\n  const additionalPropertiesMapper = mapper.type.additionalProperties;\n  if (additionalPropertiesMapper) {\n    const isAdditionalProperty = (responsePropName: string): boolean => {\n      for (const clientPropName in modelProps) {\n        const paths = splitSerializeName(modelProps[clientPropName].serializedName);\n        if (paths[0] === responsePropName) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    for (const responsePropName in responseBody) {\n      if (isAdditionalProperty(responsePropName)) {\n        instance[responsePropName] = serializer.deserialize(\n          additionalPropertiesMapper,\n          responseBody[responsePropName],\n          objectName + '[\"' + responsePropName + '\"]',\n          options,\n        );\n      }\n    }\n  } else if (responseBody && !options.ignoreUnknownProperties) {\n    for (const key of Object.keys(responseBody)) {\n      if (\n        instance[key] === undefined &&\n        !handledPropertyNames.includes(key) &&\n        !isSpecialXmlProperty(key, options)\n      ) {\n        instance[key] = responseBody[key];\n      }\n    }\n  }\n\n  return instance;\n}\n\nfunction deserializeDictionaryType(\n  serializer: Serializer,\n  mapper: DictionaryMapper,\n  responseBody: any,\n  objectName: string,\n  options: RequiredSerializerOptions,\n): any {\n  /* jshint validthis: true */\n  const value = mapper.type.value;\n  if (!value || typeof value !== \"object\") {\n    throw new Error(\n      `\"value\" metadata for a Dictionary must be defined in the ` +\n        `mapper and it must of type \"object\" in ${objectName}`,\n    );\n  }\n  if (responseBody) {\n    const tempDictionary: { [key: string]: any } = {};\n    for (const key of Object.keys(responseBody)) {\n      tempDictionary[key] = serializer.deserialize(value, responseBody[key], objectName, options);\n    }\n    return tempDictionary;\n  }\n  return responseBody;\n}\n\nfunction deserializeSequenceType(\n  serializer: Serializer,\n  mapper: SequenceMapper,\n  responseBody: any,\n  objectName: string,\n  options: RequiredSerializerOptions,\n): any {\n  let element = mapper.type.element;\n  if (!element || typeof element !== \"object\") {\n    throw new Error(\n      `element\" metadata for an Array must be defined in the ` +\n        `mapper and it must of type \"object\" in ${objectName}`,\n    );\n  }\n  if (responseBody) {\n    if (!Array.isArray(responseBody)) {\n      // xml2js will interpret a single element array as just the element, so force it to be an array\n      responseBody = [responseBody];\n    }\n\n    // Quirk: Composite mappers referenced by `element` might\n    // not have *all* properties declared (like uberParent),\n    // so let's try to look up the full definition by name.\n    if (element.type.name === \"Composite\" && element.type.className) {\n      element = serializer.modelMappers[element.type.className] ?? element;\n    }\n\n    const tempArray = [];\n    for (let i = 0; i < responseBody.length; i++) {\n      tempArray[i] = serializer.deserialize(\n        element,\n        responseBody[i],\n        `${objectName}[${i}]`,\n        options,\n      );\n    }\n    return tempArray;\n  }\n  return responseBody;\n}\n\nfunction getIndexDiscriminator(\n  discriminators: Record<string, CompositeMapper>,\n  discriminatorValue: string,\n  typeName: string,\n): CompositeMapper | undefined {\n  const typeNamesToCheck = [typeName];\n  while (typeNamesToCheck.length) {\n    const currentName = typeNamesToCheck.shift();\n    const indexDiscriminator =\n      discriminatorValue === currentName\n        ? discriminatorValue\n        : currentName + \".\" + discriminatorValue;\n    if (Object.prototype.hasOwnProperty.call(discriminators, indexDiscriminator)) {\n      return discriminators[indexDiscriminator];\n    } else {\n      for (const [name, mapper] of Object.entries(discriminators)) {\n        if (\n          name.startsWith(currentName + \".\") &&\n          mapper.type.uberParent === currentName &&\n          mapper.type.className\n        ) {\n          typeNamesToCheck.push(mapper.type.className);\n        }\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction getPolymorphicMapper(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n  object: any,\n  polymorphicPropertyName: \"clientName\" | \"serializedName\",\n): CompositeMapper {\n  const polymorphicDiscriminator = getPolymorphicDiscriminatorRecursively(serializer, mapper);\n\n  if (polymorphicDiscriminator) {\n    let discriminatorName = polymorphicDiscriminator[polymorphicPropertyName];\n    if (discriminatorName) {\n      // The serializedName might have \\\\, which we just want to ignore\n      if (polymorphicPropertyName === \"serializedName\") {\n        discriminatorName = discriminatorName.replace(/\\\\/gi, \"\");\n      }\n      const discriminatorValue = object[discriminatorName];\n      const typeName = mapper.type.uberParent ?? mapper.type.className;\n\n      if (typeof discriminatorValue === \"string\" && typeName) {\n        const polymorphicMapper = getIndexDiscriminator(\n          serializer.modelMappers.discriminators,\n          discriminatorValue,\n          typeName,\n        );\n        if (polymorphicMapper) {\n          mapper = polymorphicMapper;\n        }\n      }\n    }\n  }\n  return mapper;\n}\n\nfunction getPolymorphicDiscriminatorRecursively(\n  serializer: Serializer,\n  mapper: CompositeMapper,\n): PolymorphicDiscriminator | undefined {\n  return (\n    mapper.type.polymorphicDiscriminator ||\n    getPolymorphicDiscriminatorSafely(serializer, mapper.type.uberParent) ||\n    getPolymorphicDiscriminatorSafely(serializer, mapper.type.className)\n  );\n}\n\nfunction getPolymorphicDiscriminatorSafely(\n  serializer: Serializer,\n  typeName?: string,\n): PolymorphicDiscriminator | undefined {\n  return (\n    typeName &&\n    serializer.modelMappers[typeName] &&\n    serializer.modelMappers[typeName].type.polymorphicDiscriminator\n  );\n}\n\n/**\n * Known types of Mappers\n */\nexport const MapperTypeNames = {\n  Base64Url: \"Base64Url\",\n  Boolean: \"Boolean\",\n  ByteArray: \"ByteArray\",\n  Composite: \"Composite\",\n  Date: \"Date\",\n  DateTime: \"DateTime\",\n  DateTimeRfc1123: \"DateTimeRfc1123\",\n  Dictionary: \"Dictionary\",\n  Enum: \"Enum\",\n  Number: \"Number\",\n  Object: \"Object\",\n  Sequence: \"Sequence\",\n  String: \"String\",\n  Stream: \"Stream\",\n  TimeSpan: \"TimeSpan\",\n  UnixTime: \"UnixTime\",\n} as const;\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { HttpClient, PipelineRequest, PipelineResponse, SendRequest } from \"./interfaces.js\";\n\n/**\n * Policies are executed in phases.\n * The execution order is:\n * 1. Serialize Phase\n * 2. Policies not in a phase\n * 3. Deserialize Phase\n * 4. Retry Phase\n * 5. Sign Phase\n */\nexport type PipelinePhase = \"Deserialize\" | \"Serialize\" | \"Retry\" | \"Sign\";\n\nconst ValidPhaseNames = new Set<PipelinePhase>([\"Deserialize\", \"Serialize\", \"Retry\", \"Sign\"]);\n\n/**\n * Options when adding a policy to the pipeline.\n * Used to express dependencies on other policies.\n */\nexport interface AddPolicyOptions {\n  /**\n   * Policies that this policy must come before.\n   */\n  beforePolicies?: string[];\n  /**\n   * Policies that this policy must come after.\n   */\n  afterPolicies?: string[];\n  /**\n   * The phase that this policy must come after.\n   */\n  afterPhase?: PipelinePhase;\n  /**\n   * The phase this policy belongs to.\n   */\n  phase?: PipelinePhase;\n}\n\n/**\n * A pipeline policy manipulates a request as it travels through the pipeline.\n * It is conceptually a middleware that is allowed to modify the request before\n * it is made as well as the response when it is received.\n */\nexport interface PipelinePolicy {\n  /**\n   * The policy name. Must be a unique string in the pipeline.\n   */\n  name: string;\n  /**\n   * The main method to implement that manipulates a request/response.\n   * @param request - The request being performed.\n   * @param next - The next policy in the pipeline. Must be called to continue the pipeline.\n   */\n  sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse>;\n}\n\n/**\n * Represents a pipeline for making a HTTP request to a URL.\n * Pipelines can have multiple policies to manage manipulating each request\n * before and after it is made to the server.\n */\nexport interface Pipeline {\n  /**\n   * Add a new policy to the pipeline.\n   * @param policy - A policy that manipulates a request.\n   * @param options - A set of options for when the policy should run.\n   */\n  addPolicy(policy: PipelinePolicy, options?: AddPolicyOptions): void;\n  /**\n   * Remove a policy from the pipeline.\n   * @param options - Options that let you specify which policies to remove.\n   */\n  removePolicy(options: { name?: string; phase?: PipelinePhase }): PipelinePolicy[];\n  /**\n   * Uses the pipeline to make a HTTP request.\n   * @param httpClient - The HttpClient that actually performs the request.\n   * @param request - The request to be made.\n   */\n  sendRequest(httpClient: HttpClient, request: PipelineRequest): Promise<PipelineResponse>;\n  /**\n   * Returns the current set of policies in the pipeline in the order in which\n   * they will be applied to the request. Later in the list is closer to when\n   * the request is performed.\n   */\n  getOrderedPolicies(): PipelinePolicy[];\n  /**\n   * Duplicates this pipeline to allow for modifying an existing one without mutating it.\n   */\n  clone(): Pipeline;\n}\n\ninterface PipelineDescriptor {\n  policy: PipelinePolicy;\n  options: AddPolicyOptions;\n}\n\ninterface PolicyGraphNode {\n  policy: PipelinePolicy;\n  dependsOn: Set<PolicyGraphNode>;\n  dependants: Set<PolicyGraphNode>;\n  afterPhase?: Phase;\n}\n\ninterface Phase {\n  name: PipelinePhase | \"None\";\n  policies: Set<PolicyGraphNode>;\n  hasRun: boolean;\n  hasAfterPolicies: boolean;\n}\n\n/**\n * A private implementation of Pipeline.\n * Do not export this class from the package.\n * @internal\n */\nclass HttpPipeline implements Pipeline {\n  private _policies: PipelineDescriptor[] = [];\n  private _orderedPolicies?: PipelinePolicy[];\n\n  private constructor(policies?: PipelineDescriptor[]) {\n    this._policies = policies?.slice(0) ?? [];\n    this._orderedPolicies = undefined;\n  }\n\n  public addPolicy(policy: PipelinePolicy, options: AddPolicyOptions = {}): void {\n    if (options.phase && options.afterPhase) {\n      throw new Error(\"Policies inside a phase cannot specify afterPhase.\");\n    }\n    if (options.phase && !ValidPhaseNames.has(options.phase)) {\n      throw new Error(`Invalid phase name: ${options.phase}`);\n    }\n    if (options.afterPhase && !ValidPhaseNames.has(options.afterPhase)) {\n      throw new Error(`Invalid afterPhase name: ${options.afterPhase}`);\n    }\n    this._policies.push({\n      policy,\n      options,\n    });\n    this._orderedPolicies = undefined;\n  }\n\n  public removePolicy(options: { name?: string; phase?: string }): PipelinePolicy[] {\n    const removedPolicies: PipelinePolicy[] = [];\n\n    this._policies = this._policies.filter((policyDescriptor) => {\n      if (\n        (options.name && policyDescriptor.policy.name === options.name) ||\n        (options.phase && policyDescriptor.options.phase === options.phase)\n      ) {\n        removedPolicies.push(policyDescriptor.policy);\n        return false;\n      } else {\n        return true;\n      }\n    });\n    this._orderedPolicies = undefined;\n\n    return removedPolicies;\n  }\n\n  public sendRequest(httpClient: HttpClient, request: PipelineRequest): Promise<PipelineResponse> {\n    const policies = this.getOrderedPolicies();\n\n    const pipeline = policies.reduceRight<SendRequest>(\n      (next, policy) => {\n        return (req: PipelineRequest) => {\n          return policy.sendRequest(req, next);\n        };\n      },\n      (req: PipelineRequest) => httpClient.sendRequest(req),\n    );\n\n    return pipeline(request);\n  }\n\n  public getOrderedPolicies(): PipelinePolicy[] {\n    if (!this._orderedPolicies) {\n      this._orderedPolicies = this.orderPolicies();\n    }\n    return this._orderedPolicies;\n  }\n\n  public clone(): Pipeline {\n    return new HttpPipeline(this._policies);\n  }\n\n  public static create(): Pipeline {\n    return new HttpPipeline();\n  }\n\n  private orderPolicies(): PipelinePolicy[] {\n    /**\n     * The goal of this method is to reliably order pipeline policies\n     * based on their declared requirements when they were added.\n     *\n     * Order is first determined by phase:\n     *\n     * 1. Serialize Phase\n     * 2. Policies not in a phase\n     * 3. Deserialize Phase\n     * 4. Retry Phase\n     * 5. Sign Phase\n     *\n     * Within each phase, policies are executed in the order\n     * they were added unless they were specified to execute\n     * before/after other policies or after a particular phase.\n     *\n     * To determine the final order, we will walk the policy list\n     * in phase order multiple times until all dependencies are\n     * satisfied.\n     *\n     * `afterPolicies` are the set of policies that must be\n     * executed before a given policy. This requirement is\n     * considered satisfied when each of the listed policies\n     * have been scheduled.\n     *\n     * `beforePolicies` are the set of policies that must be\n     * executed after a given policy. Since this dependency\n     * can be expressed by converting it into a equivalent\n     * `afterPolicies` declarations, they are normalized\n     * into that form for simplicity.\n     *\n     * An `afterPhase` dependency is considered satisfied when all\n     * policies in that phase have scheduled.\n     *\n     */\n    const result: PipelinePolicy[] = [];\n\n    // Track all policies we know about.\n    const policyMap: Map<string, PolicyGraphNode> = new Map<string, PolicyGraphNode>();\n\n    function createPhase(name: PipelinePhase | \"None\"): Phase {\n      return {\n        name,\n        policies: new Set<PolicyGraphNode>(),\n        hasRun: false,\n        hasAfterPolicies: false,\n      };\n    }\n\n    // Track policies for each phase.\n    const serializePhase = createPhase(\"Serialize\");\n    const noPhase = createPhase(\"None\");\n    const deserializePhase = createPhase(\"Deserialize\");\n    const retryPhase = createPhase(\"Retry\");\n    const signPhase = createPhase(\"Sign\");\n\n    // a list of phases in order\n    const orderedPhases = [serializePhase, noPhase, deserializePhase, retryPhase, signPhase];\n\n    // Small helper function to map phase name to each Phase\n    function getPhase(phase: PipelinePhase | undefined): Phase {\n      if (phase === \"Retry\") {\n        return retryPhase;\n      } else if (phase === \"Serialize\") {\n        return serializePhase;\n      } else if (phase === \"Deserialize\") {\n        return deserializePhase;\n      } else if (phase === \"Sign\") {\n        return signPhase;\n      } else {\n        return noPhase;\n      }\n    }\n\n    // First walk each policy and create a node to track metadata.\n    for (const descriptor of this._policies) {\n      const policy = descriptor.policy;\n      const options = descriptor.options;\n      const policyName = policy.name;\n      if (policyMap.has(policyName)) {\n        throw new Error(\"Duplicate policy names not allowed in pipeline\");\n      }\n      const node: PolicyGraphNode = {\n        policy,\n        dependsOn: new Set<PolicyGraphNode>(),\n        dependants: new Set<PolicyGraphNode>(),\n      };\n      if (options.afterPhase) {\n        node.afterPhase = getPhase(options.afterPhase);\n        node.afterPhase.hasAfterPolicies = true;\n      }\n      policyMap.set(policyName, node);\n      const phase = getPhase(options.phase);\n      phase.policies.add(node);\n    }\n\n    // Now that each policy has a node, connect dependency references.\n    for (const descriptor of this._policies) {\n      const { policy, options } = descriptor;\n      const policyName = policy.name;\n      const node = policyMap.get(policyName);\n      if (!node) {\n        throw new Error(`Missing node for policy ${policyName}`);\n      }\n\n      if (options.afterPolicies) {\n        for (const afterPolicyName of options.afterPolicies) {\n          const afterNode = policyMap.get(afterPolicyName);\n          if (afterNode) {\n            // Linking in both directions helps later\n            // when we want to notify dependants.\n            node.dependsOn.add(afterNode);\n            afterNode.dependants.add(node);\n          }\n        }\n      }\n      if (options.beforePolicies) {\n        for (const beforePolicyName of options.beforePolicies) {\n          const beforeNode = policyMap.get(beforePolicyName);\n          if (beforeNode) {\n            // To execute before another node, make it\n            // depend on the current node.\n            beforeNode.dependsOn.add(node);\n            node.dependants.add(beforeNode);\n          }\n        }\n      }\n    }\n\n    function walkPhase(phase: Phase): void {\n      phase.hasRun = true;\n      // Sets iterate in insertion order\n      for (const node of phase.policies) {\n        if (node.afterPhase && (!node.afterPhase.hasRun || node.afterPhase.policies.size)) {\n          // If this node is waiting on a phase to complete,\n          // we need to skip it for now.\n          // Even if the phase is empty, we should wait for it\n          // to be walked to avoid re-ordering policies.\n          continue;\n        }\n        if (node.dependsOn.size === 0) {\n          // If there's nothing else we're waiting for, we can\n          // add this policy to the result list.\n          result.push(node.policy);\n          // Notify anything that depends on this policy that\n          // the policy has been scheduled.\n          for (const dependant of node.dependants) {\n            dependant.dependsOn.delete(node);\n          }\n          policyMap.delete(node.policy.name);\n          phase.policies.delete(node);\n        }\n      }\n    }\n\n    function walkPhases(): void {\n      for (const phase of orderedPhases) {\n        walkPhase(phase);\n        // if the phase isn't complete\n        if (phase.policies.size > 0 && phase !== noPhase) {\n          if (!noPhase.hasRun) {\n            // Try running noPhase to see if that unblocks this phase next tick.\n            // This can happen if a phase that happens before noPhase\n            // is waiting on a noPhase policy to complete.\n            walkPhase(noPhase);\n          }\n          // Don't proceed to the next phase until this phase finishes.\n          return;\n        }\n\n        if (phase.hasAfterPolicies) {\n          // Run any policies unblocked by this phase\n          walkPhase(noPhase);\n        }\n      }\n    }\n\n    // Iterate until we've put every node in the result list.\n    let iteration = 0;\n    while (policyMap.size > 0) {\n      iteration++;\n      const initialResultLength = result.length;\n      // Keep walking each phase in order until we can order every node.\n      walkPhases();\n      // The result list *should* get at least one larger each time\n      // after the first full pass.\n      // Otherwise, we're going to loop forever.\n      if (result.length <= initialResultLength && iteration > 1) {\n        throw new Error(\"Cannot satisfy policy dependencies due to requirements cycle.\");\n      }\n    }\n\n    return result;\n  }\n}\n\n/**\n * Creates a totally empty pipeline.\n * Useful for testing or creating a custom one.\n */\nexport function createEmptyPipeline(): Pipeline {\n  return HttpPipeline.create();\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { EOL } from \"node:os\";\nimport util from \"node:util\";\nimport * as process from \"node:process\";\n\nexport function log(message: unknown, ...args: any[]): void {\n  process.stderr.write(`${util.format(message, ...args)}${EOL}`);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { log } from \"./log.js\";\n\n/**\n * A simple mechanism for enabling logging.\n * Intended to mimic the publicly available `debug` package.\n */\nexport interface Debug {\n  /**\n   * Creates a new logger with the given namespace.\n   */\n  (namespace: string): Debugger;\n  /**\n   * The default log method (defaults to console)\n   */\n  log: (...args: any[]) => void;\n  /**\n   * Enables a particular set of namespaces.\n   * To enable multiple separate them with commas, e.g. \"info,debug\".\n   * Supports wildcards, e.g. \"azure:*\"\n   * Supports skip syntax, e.g. \"azure:*,-azure:storage:*\" will enable\n   * everything under azure except for things under azure:storage.\n   */\n  enable: (namespaces: string) => void;\n  /**\n   * Checks if a particular namespace is enabled.\n   */\n  enabled: (namespace: string) => boolean;\n  /**\n   * Disables all logging, returns what was previously enabled.\n   */\n  disable: () => string;\n}\n\n/**\n * A log function that can be dynamically enabled and redirected.\n */\nexport interface Debugger {\n  /**\n   * Logs the given arguments to the `log` method.\n   */\n  (...args: any[]): void;\n  /**\n   * True if this logger is active and logging.\n   */\n  enabled: boolean;\n  /**\n   * Used to cleanup/remove this logger.\n   */\n  destroy: () => boolean;\n  /**\n   * The current log method. Can be overridden to redirect output.\n   */\n  log: (...args: any[]) => void;\n  /**\n   * The namespace of this logger.\n   */\n  namespace: string;\n  /**\n   * Extends this logger with a child namespace.\n   * Namespaces are separated with a ':' character.\n   */\n  extend: (namespace: string) => Debugger;\n}\n\nconst debugEnvVariable =\n  (typeof process !== \"undefined\" && process.env && process.env.DEBUG) || undefined;\n\nlet enabledString: string | undefined;\nlet enabledNamespaces: RegExp[] = [];\nlet skippedNamespaces: RegExp[] = [];\nconst debuggers: Debugger[] = [];\n\nif (debugEnvVariable) {\n  enable(debugEnvVariable);\n}\n\nconst debugObj: Debug = Object.assign(\n  (namespace: string): Debugger => {\n    return createDebugger(namespace);\n  },\n  {\n    enable,\n    enabled,\n    disable,\n    log,\n  },\n);\n\nfunction enable(namespaces: string): void {\n  enabledString = namespaces;\n  enabledNamespaces = [];\n  skippedNamespaces = [];\n  const wildcard = /\\*/g;\n  const namespaceList = namespaces.split(\",\").map((ns) => ns.trim().replace(wildcard, \".*?\"));\n  for (const ns of namespaceList) {\n    if (ns.startsWith(\"-\")) {\n      skippedNamespaces.push(new RegExp(`^${ns.substr(1)}$`));\n    } else {\n      enabledNamespaces.push(new RegExp(`^${ns}$`));\n    }\n  }\n  for (const instance of debuggers) {\n    instance.enabled = enabled(instance.namespace);\n  }\n}\n\nfunction enabled(namespace: string): boolean {\n  if (namespace.endsWith(\"*\")) {\n    return true;\n  }\n\n  for (const skipped of skippedNamespaces) {\n    if (skipped.test(namespace)) {\n      return false;\n    }\n  }\n  for (const enabledNamespace of enabledNamespaces) {\n    if (enabledNamespace.test(namespace)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction disable(): string {\n  const result = enabledString || \"\";\n  enable(\"\");\n  return result;\n}\n\nfunction createDebugger(namespace: string): Debugger {\n  const newDebugger: Debugger = Object.assign(debug, {\n    enabled: enabled(namespace),\n    destroy,\n    log: debugObj.log,\n    namespace,\n    extend,\n  });\n\n  function debug(...args: any[]): void {\n    if (!newDebugger.enabled) {\n      return;\n    }\n    if (args.length > 0) {\n      args[0] = `${namespace} ${args[0]}`;\n    }\n    newDebugger.log(...args);\n  }\n\n  debuggers.push(newDebugger);\n\n  return newDebugger;\n}\n\nfunction destroy(this: Debugger): boolean {\n  const index = debuggers.indexOf(this);\n  if (index >= 0) {\n    debuggers.splice(index, 1);\n    return true;\n  }\n  return false;\n}\n\nfunction extend(this: Debugger, namespace: string): Debugger {\n  const newDebugger = createDebugger(`${this.namespace}:${namespace}`);\n  newDebugger.log = this.log;\n  return newDebugger;\n}\n\nexport default debugObj;\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport debug, { type Debugger } from \"./debug.js\";\nexport type { Debugger } from \"./debug.js\";\n\nconst registeredLoggers = new Set<AzureDebugger>();\nconst logLevelFromEnv =\n  (typeof process !== \"undefined\" && process.env && process.env.AZURE_LOG_LEVEL) || undefined;\n\nlet azureLogLevel: AzureLogLevel | undefined;\n\n/**\n * The AzureLogger provides a mechanism for overriding where logs are output to.\n * By default, logs are sent to stderr.\n * Override the `log` method to redirect logs to another location.\n */\nexport const AzureLogger: AzureClientLogger = debug(\"azure\");\nAzureLogger.log = (...args) => {\n  debug.log(...args);\n};\n\n/**\n * The log levels supported by the logger.\n * The log levels in order of most verbose to least verbose are:\n * - verbose\n * - info\n * - warning\n * - error\n */\nexport type AzureLogLevel = \"verbose\" | \"info\" | \"warning\" | \"error\";\nconst AZURE_LOG_LEVELS = [\"verbose\", \"info\", \"warning\", \"error\"];\n\ntype AzureDebugger = Debugger & { level: AzureLogLevel };\n\n/**\n * An AzureClientLogger is a function that can log to an appropriate severity level.\n */\nexport type AzureClientLogger = Debugger;\n\nif (logLevelFromEnv) {\n  // avoid calling setLogLevel because we don't want a mis-set environment variable to crash\n  if (isAzureLogLevel(logLevelFromEnv)) {\n    setLogLevel(logLevelFromEnv);\n  } else {\n    console.error(\n      `AZURE_LOG_LEVEL set to unknown log level '${logLevelFromEnv}'; logging is not enabled. Acceptable values: ${AZURE_LOG_LEVELS.join(\n        \", \",\n      )}.`,\n    );\n  }\n}\n\n/**\n * Immediately enables logging at the specified log level. If no level is specified, logging is disabled.\n * @param level - The log level to enable for logging.\n * Options from most verbose to least verbose are:\n * - verbose\n * - info\n * - warning\n * - error\n */\nexport function setLogLevel(level?: AzureLogLevel): void {\n  if (level && !isAzureLogLevel(level)) {\n    throw new Error(\n      `Unknown log level '${level}'. Acceptable values: ${AZURE_LOG_LEVELS.join(\",\")}`,\n    );\n  }\n  azureLogLevel = level;\n\n  const enabledNamespaces = [];\n  for (const logger of registeredLoggers) {\n    if (shouldEnable(logger)) {\n      enabledNamespaces.push(logger.namespace);\n    }\n  }\n\n  debug.enable(enabledNamespaces.join(\",\"));\n}\n\n/**\n * Retrieves the currently specified log level.\n */\nexport function getLogLevel(): AzureLogLevel | undefined {\n  return azureLogLevel;\n}\n\nconst levelMap = {\n  verbose: 400,\n  info: 300,\n  warning: 200,\n  error: 100,\n};\n\n/**\n * Defines the methods available on the SDK-facing logger.\n */\n// eslint-disable-next-line @typescript-eslint/no-redeclare\nexport interface AzureLogger {\n  /**\n   * Used for failures the program is unlikely to recover from,\n   * such as Out of Memory.\n   */\n  error: Debugger;\n  /**\n   * Used when a function fails to perform its intended task.\n   * Usually this means the function will throw an exception.\n   * Not used for self-healing events (e.g. automatic retry)\n   */\n  warning: Debugger;\n  /**\n   * Used when a function operates normally.\n   */\n  info: Debugger;\n  /**\n   * Used for detailed troubleshooting scenarios. This is\n   * intended for use by developers / system administrators\n   * for diagnosing specific failures.\n   */\n  verbose: Debugger;\n}\n\n/**\n * Creates a logger for use by the Azure SDKs that inherits from `AzureLogger`.\n * @param namespace - The name of the SDK package.\n * @hidden\n */\nexport function createClientLogger(namespace: string): AzureLogger {\n  const clientRootLogger: AzureClientLogger = AzureLogger.extend(namespace);\n  patchLogMethod(AzureLogger, clientRootLogger);\n  return {\n    error: createLogger(clientRootLogger, \"error\"),\n    warning: createLogger(clientRootLogger, \"warning\"),\n    info: createLogger(clientRootLogger, \"info\"),\n    verbose: createLogger(clientRootLogger, \"verbose\"),\n  };\n}\n\nfunction patchLogMethod(parent: AzureClientLogger, child: AzureClientLogger | AzureDebugger): void {\n  child.log = (...args) => {\n    parent.log(...args);\n  };\n}\n\nfunction createLogger(parent: AzureClientLogger, level: AzureLogLevel): AzureDebugger {\n  const logger: AzureDebugger = Object.assign(parent.extend(level), {\n    level,\n  });\n\n  patchLogMethod(parent, logger);\n\n  if (shouldEnable(logger)) {\n    const enabledNamespaces = debug.disable();\n    debug.enable(enabledNamespaces + \",\" + logger.namespace);\n  }\n\n  registeredLoggers.add(logger);\n\n  return logger;\n}\n\nfunction shouldEnable(logger: AzureDebugger): boolean {\n  return Boolean(azureLogLevel && levelMap[logger.level] <= levelMap[azureLogLevel]);\n}\n\nfunction isAzureLogLevel(logLevel: string): logLevel is AzureLogLevel {\n  return AZURE_LOG_LEVELS.includes(logLevel as any);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { createClientLogger } from \"@azure/logger\";\nexport const logger = createClientLogger(\"core-rest-pipeline\");\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { type UnknownObject, isObject } from \"@azure/core-util\";\n\n/**\n * @internal\n */\nexport interface SanitizerOptions {\n  /**\n   * Header names whose values will be logged when logging is enabled.\n   * Defaults include a list of well-known safe headers. Any headers\n   * specified in this field will be added to that list.  Any other values will\n   * be written to logs as \"REDACTED\".\n   */\n  additionalAllowedHeaderNames?: string[];\n\n  /**\n   * Query string names whose values will be logged when logging is enabled. By default no\n   * query string values are logged.\n   */\n  additionalAllowedQueryParameters?: string[];\n}\n\nconst RedactedString = \"REDACTED\";\n\n// Make sure this list is up-to-date with the one under core/logger/Readme#Keyconcepts\nconst defaultAllowedHeaderNames = [\n  \"x-ms-client-request-id\",\n  \"x-ms-return-client-request-id\",\n  \"x-ms-useragent\",\n  \"x-ms-correlation-request-id\",\n  \"x-ms-request-id\",\n  \"client-request-id\",\n  \"ms-cv\",\n  \"return-client-request-id\",\n  \"traceparent\",\n\n  \"Access-Control-Allow-Credentials\",\n  \"Access-Control-Allow-Headers\",\n  \"Access-Control-Allow-Methods\",\n  \"Access-Control-Allow-Origin\",\n  \"Access-Control-Expose-Headers\",\n  \"Access-Control-Max-Age\",\n  \"Access-Control-Request-Headers\",\n  \"Access-Control-Request-Method\",\n  \"Origin\",\n\n  \"Accept\",\n  \"Accept-Encoding\",\n  \"Cache-Control\",\n  \"Connection\",\n  \"Content-Length\",\n  \"Content-Type\",\n  \"Date\",\n  \"ETag\",\n  \"Expires\",\n  \"If-Match\",\n  \"If-Modified-Since\",\n  \"If-None-Match\",\n  \"If-Unmodified-Since\",\n  \"Last-Modified\",\n  \"Pragma\",\n  \"Request-Id\",\n  \"Retry-After\",\n  \"Server\",\n  \"Transfer-Encoding\",\n  \"User-Agent\",\n  \"WWW-Authenticate\",\n];\n\nconst defaultAllowedQueryParameters: string[] = [\"api-version\"];\n\n/**\n * @internal\n */\nexport class Sanitizer {\n  private allowedHeaderNames: Set<string>;\n  private allowedQueryParameters: Set<string>;\n\n  constructor({\n    additionalAllowedHeaderNames: allowedHeaderNames = [],\n    additionalAllowedQueryParameters: allowedQueryParameters = [],\n  }: SanitizerOptions = {}) {\n    allowedHeaderNames = defaultAllowedHeaderNames.concat(allowedHeaderNames);\n    allowedQueryParameters = defaultAllowedQueryParameters.concat(allowedQueryParameters);\n\n    this.allowedHeaderNames = new Set(allowedHeaderNames.map((n) => n.toLowerCase()));\n    this.allowedQueryParameters = new Set(allowedQueryParameters.map((p) => p.toLowerCase()));\n  }\n\n  public sanitize(obj: unknown): string {\n    const seen = new Set<unknown>();\n    return JSON.stringify(\n      obj,\n      (key: string, value: unknown) => {\n        // Ensure Errors include their interesting non-enumerable members\n        if (value instanceof Error) {\n          return {\n            ...value,\n            name: value.name,\n            message: value.message,\n          };\n        }\n\n        if (key === \"headers\") {\n          return this.sanitizeHeaders(value as UnknownObject);\n        } else if (key === \"url\") {\n          return this.sanitizeUrl(value as string);\n        } else if (key === \"query\") {\n          return this.sanitizeQuery(value as UnknownObject);\n        } else if (key === \"body\") {\n          // Don't log the request body\n          return undefined;\n        } else if (key === \"response\") {\n          // Don't log response again\n          return undefined;\n        } else if (key === \"operationSpec\") {\n          // When using sendOperationRequest, the request carries a massive\n          // field with the autorest spec. No need to log it.\n          return undefined;\n        } else if (Array.isArray(value) || isObject(value)) {\n          if (seen.has(value)) {\n            return \"[Circular]\";\n          }\n          seen.add(value);\n        }\n\n        return value;\n      },\n      2,\n    );\n  }\n\n  public sanitizeUrl(value: string): string {\n    if (typeof value !== \"string\" || value === null || value === \"\") {\n      return value;\n    }\n\n    const url = new URL(value);\n\n    if (!url.search) {\n      return value;\n    }\n\n    for (const [key] of url.searchParams) {\n      if (!this.allowedQueryParameters.has(key.toLowerCase())) {\n        url.searchParams.set(key, RedactedString);\n      }\n    }\n\n    return url.toString();\n  }\n\n  private sanitizeHeaders(obj: UnknownObject): UnknownObject {\n    const sanitized: UnknownObject = {};\n    for (const key of Object.keys(obj)) {\n      if (this.allowedHeaderNames.has(key.toLowerCase())) {\n        sanitized[key] = obj[key];\n      } else {\n        sanitized[key] = RedactedString;\n      }\n    }\n    return sanitized;\n  }\n\n  private sanitizeQuery(value: UnknownObject): UnknownObject {\n    if (typeof value !== \"object\" || value === null) {\n      return value;\n    }\n\n    const sanitized: UnknownObject = {};\n\n    for (const k of Object.keys(value)) {\n      if (this.allowedQueryParameters.has(k.toLowerCase())) {\n        sanitized[k] = value[k];\n      } else {\n        sanitized[k] = RedactedString;\n      }\n    }\n\n    return sanitized;\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { Debugger } from \"@azure/logger\";\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { logger as coreLogger } from \"../log.js\";\nimport { Sanitizer } from \"../util/sanitizer.js\";\n\n/**\n * The programmatic identifier of the logPolicy.\n */\nexport const logPolicyName = \"logPolicy\";\n\n/**\n * Options to configure the logPolicy.\n */\nexport interface LogPolicyOptions {\n  /**\n   * Header names whose values will be logged when logging is enabled.\n   * Defaults include a list of well-known safe headers. Any headers\n   * specified in this field will be added to that list.  Any other values will\n   * be written to logs as \"REDACTED\".\n   */\n  additionalAllowedHeaderNames?: string[];\n\n  /**\n   * Query string names whose values will be logged when logging is enabled. By default no\n   * query string values are logged.\n   */\n  additionalAllowedQueryParameters?: string[];\n\n  /**\n   * The log function to use for writing pipeline logs.\n   * Defaults to core-http's built-in logger.\n   * Compatible with the `debug` library.\n   */\n  logger?: Debugger;\n}\n\n/**\n * A policy that logs all requests and responses.\n * @param options - Options to configure logPolicy.\n */\nexport function logPolicy(options: LogPolicyOptions = {}): PipelinePolicy {\n  const logger = options.logger ?? coreLogger.info;\n  const sanitizer = new Sanitizer({\n    additionalAllowedHeaderNames: options.additionalAllowedHeaderNames,\n    additionalAllowedQueryParameters: options.additionalAllowedQueryParameters,\n  });\n  return {\n    name: logPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!logger.enabled) {\n        return next(request);\n      }\n\n      logger(`Request: ${sanitizer.sanitize(request)}`);\n\n      const response = await next(request);\n\n      logger(`Response status code: ${response.status}`);\n      logger(`Headers: ${sanitizer.sanitize(response.headers)}`);\n\n      return response;\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\n\n/**\n * The programmatic identifier of the redirectPolicy.\n */\nexport const redirectPolicyName = \"redirectPolicy\";\n\n/**\n * Methods that are allowed to follow redirects 301 and 302\n */\nconst allowedRedirect = [\"GET\", \"HEAD\"];\n\n/**\n * Options for how redirect responses are handled.\n */\nexport interface RedirectPolicyOptions {\n  /**\n   * The maximum number of times the redirect URL will be tried before\n   * failing.  Defaults to 20.\n   */\n  maxRetries?: number;\n}\n\n/**\n * A policy to follow Location headers from the server in order\n * to support server-side redirection.\n * In the browser, this policy is not used.\n * @param options - Options to control policy behavior.\n */\nexport function redirectPolicy(options: RedirectPolicyOptions = {}): PipelinePolicy {\n  const { maxRetries = 20 } = options;\n  return {\n    name: redirectPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      const response = await next(request);\n      return handleRedirect(next, response, maxRetries);\n    },\n  };\n}\n\nasync function handleRedirect(\n  next: SendRequest,\n  response: PipelineResponse,\n  maxRetries: number,\n  currentRetries: number = 0,\n): Promise<PipelineResponse> {\n  const { request, status, headers } = response;\n  const locationHeader = headers.get(\"location\");\n  if (\n    locationHeader &&\n    (status === 300 ||\n      (status === 301 && allowedRedirect.includes(request.method)) ||\n      (status === 302 && allowedRedirect.includes(request.method)) ||\n      (status === 303 && request.method === \"POST\") ||\n      status === 307) &&\n    currentRetries < maxRetries\n  ) {\n    const url = new URL(locationHeader, request.url);\n    request.url = url.toString();\n\n    // POST request with Status code 303 should be converted into a\n    // redirected GET request if the redirect url is present in the location header\n    if (status === 303) {\n      request.method = \"GET\";\n      request.headers.delete(\"Content-Length\");\n      delete request.body;\n    }\n\n    request.headers.delete(\"Authorization\");\n\n    const res = await next(request);\n    return handleRedirect(next, res, maxRetries, currentRetries + 1);\n  }\n\n  return response;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport * as os from \"node:os\";\nimport * as process from \"node:process\";\n\n/**\n * @internal\n */\ninterface ExtendedPlatformVersions extends NodeJS.ProcessVersions {\n  bun?: string;\n  deno?: string;\n}\n\n/**\n * @internal\n */\nexport function getHeaderName(): string {\n  return \"User-Agent\";\n}\n\n/**\n * @internal\n */\nexport async function setPlatformSpecificData(map: Map<string, string>): Promise<void> {\n  if (process && process.versions) {\n    const versions = process.versions as ExtendedPlatformVersions;\n    if (versions.bun) {\n      map.set(\"Bun\", versions.bun);\n    } else if (versions.deno) {\n      map.set(\"Deno\", versions.deno);\n    } else if (versions.node) {\n      map.set(\"Node\", versions.node);\n    }\n  }\n\n  map.set(\"OS\", `(${os.arch()}-${os.type()}-${os.release()})`);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nexport const SDK_VERSION: string = \"1.17.0\";\n\nexport const DEFAULT_RETRY_POLICY_COUNT = 3;\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { getHeaderName, setPlatformSpecificData } from \"./userAgentPlatform.js\";\nimport { SDK_VERSION } from \"../constants.js\";\n\nfunction getUserAgentString(telemetryInfo: Map<string, string>): string {\n  const parts: string[] = [];\n  for (const [key, value] of telemetryInfo) {\n    const token = value ? `${key}/${value}` : key;\n    parts.push(token);\n  }\n  return parts.join(\" \");\n}\n\n/**\n * @internal\n */\nexport function getUserAgentHeaderName(): string {\n  return getHeaderName();\n}\n\n/**\n * @internal\n */\nexport async function getUserAgentValue(prefix?: string): Promise<string> {\n  const runtimeInfo = new Map<string, string>();\n  runtimeInfo.set(\"core-rest-pipeline\", SDK_VERSION);\n  await setPlatformSpecificData(runtimeInfo);\n  const defaultAgent = getUserAgentString(runtimeInfo);\n  const userAgentValue = prefix ? `${prefix} ${defaultAgent}` : defaultAgent;\n  return userAgentValue;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { getUserAgentHeaderName, getUserAgentValue } from \"../util/userAgent.js\";\n\nconst UserAgentHeaderName = getUserAgentHeaderName();\n\n/**\n * The programmatic identifier of the userAgentPolicy.\n */\nexport const userAgentPolicyName = \"userAgentPolicy\";\n\n/**\n * Options for adding user agent details to outgoing requests.\n */\nexport interface UserAgentPolicyOptions {\n  /**\n   * String prefix to add to the user agent for outgoing requests.\n   * Defaults to an empty string.\n   */\n  userAgentPrefix?: string;\n}\n\n/**\n * A policy that sets the User-Agent header (or equivalent) to reflect\n * the library version.\n * @param options - Options to customize the user agent value.\n */\nexport function userAgentPolicy(options: UserAgentPolicyOptions = {}): PipelinePolicy {\n  const userAgentValue = getUserAgentValue(options.userAgentPrefix);\n  return {\n    name: userAgentPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!request.headers.has(UserAgentHeaderName)) {\n        request.headers.set(UserAgentHeaderName, await userAgentValue);\n      }\n      return next(request);\n    },\n  };\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nexport function isNodeReadableStream(x: unknown): x is NodeJS.ReadableStream {\n  return Boolean(x && typeof (x as NodeJS.ReadableStream)[\"pipe\"] === \"function\");\n}\n\nexport function isWebReadableStream(x: unknown): x is ReadableStream {\n  return Boolean(\n    x &&\n      typeof (x as ReadableStream).getReader === \"function\" &&\n      typeof (x as ReadableStream).tee === \"function\",\n  );\n}\n\nexport function isReadableStream(x: unknown): x is ReadableStream | NodeJS.ReadableStream {\n  return isNodeReadableStream(x) || isWebReadableStream(x);\n}\n\nexport function isBlob(x: unknown): x is Blob {\n  return typeof (x as Blob).stream === \"function\";\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { isNodeLike } from \"@azure/core-util\";\nimport { isNodeReadableStream } from \"./typeGuards.js\";\n\n/**\n * Options passed into createFile specifying metadata about the file.\n */\nexport interface CreateFileOptions {\n  /**\n   * The MIME type of the file.\n   */\n  type?: string;\n\n  /**\n   * Last modified time of the file as a UNIX timestamp.\n   * This will default to the current date.\n   */\n  lastModified?: number;\n\n  /**\n   * relative path of this file when uploading a directory.\n   */\n  webkitRelativePath?: string;\n}\n\n/**\n * Extra options for createFile when a stream is being passed in.\n */\nexport interface CreateFileFromStreamOptions extends CreateFileOptions {\n  /**\n   * Size of the file represented by the stream in bytes.\n   *\n   * This will be used by the pipeline when calculating the Content-Length header\n   * for the overall request.\n   */\n  size?: number;\n}\n\nconst unimplementedMethods = {\n  arrayBuffer: () => {\n    throw new Error(\"Not implemented\");\n  },\n  slice: () => {\n    throw new Error(\"Not implemented\");\n  },\n  text: () => {\n    throw new Error(\"Not implemented\");\n  },\n};\n\n/**\n * Private symbol used as key on objects created using createFile containing the\n * original source of the file object.\n *\n * This is used in Node to access the original Node stream without using Blob#stream, which\n * returns a web stream. This is done to avoid a couple of bugs to do with Blob#stream and\n * Readable#to/fromWeb in Node versions we support:\n * - https://github.com/nodejs/node/issues/42694 (fixed in Node 18.14)\n * - https://github.com/nodejs/node/issues/48916 (fixed in Node 20.6)\n *\n * Once these versions are no longer supported, we may be able to stop doing this.\n *\n * @internal\n */\nconst rawContent: unique symbol = Symbol(\"rawContent\");\n\n/**\n * Type signature of a blob-like object with a raw content property.\n */\ninterface RawContent {\n  [rawContent](): Uint8Array | NodeJS.ReadableStream | ReadableStream<Uint8Array>;\n}\n\nfunction hasRawContent(x: unknown): x is RawContent {\n  return typeof (x as RawContent)[rawContent] === \"function\";\n}\n\n/**\n * Extract the raw content from a given blob-like object. If the input was created using createFile\n * or createFileFromStream, the exact content passed into createFile/createFileFromStream will be used.\n * For true instances of Blob and File, returns the blob's content as a Web ReadableStream<Uint8Array>.\n *\n * @internal\n */\nexport function getRawContent(\n  blob: Blob,\n): NodeJS.ReadableStream | ReadableStream<Uint8Array> | Uint8Array {\n  if (hasRawContent(blob)) {\n    return blob[rawContent]();\n  } else {\n    return blob.stream();\n  }\n}\n\n/**\n * Create an object that implements the File interface. This object is intended to be\n * passed into RequestBodyType.formData, and is not guaranteed to work as expected in\n * other situations.\n *\n * Use this function to:\n * - Create a File object for use in RequestBodyType.formData in environments where the\n *   global File object is unavailable.\n * - Create a File-like object from a readable stream without reading the stream into memory.\n *\n * @param stream - the content of the file as a callback returning a stream. When a File object made using createFile is\n *                  passed in a request's form data map, the stream will not be read into memory\n *                  and instead will be streamed when the request is made. In the event of a retry, the\n *                  stream needs to be read again, so this callback SHOULD return a fresh stream if possible.\n * @param name - the name of the file.\n * @param options - optional metadata about the file, e.g. file name, file size, MIME type.\n */\nexport function createFileFromStream(\n  stream: () => ReadableStream<Uint8Array> | NodeJS.ReadableStream,\n  name: string,\n  options: CreateFileFromStreamOptions = {},\n): File {\n  return {\n    ...unimplementedMethods,\n    type: options.type ?? \"\",\n    lastModified: options.lastModified ?? new Date().getTime(),\n    webkitRelativePath: options.webkitRelativePath ?? \"\",\n    size: options.size ?? -1,\n    name,\n    stream: () => {\n      const s = stream();\n      if (isNodeReadableStream(s)) {\n        throw new Error(\n          \"Not supported: a Node stream was provided as input to createFileFromStream.\",\n        );\n      }\n\n      return s;\n    },\n    [rawContent]: stream,\n  } as File & RawContent;\n}\n\n/**\n * Create an object that implements the File interface. This object is intended to be\n * passed into RequestBodyType.formData, and is not guaranteed to work as expected in\n * other situations.\n *\n * Use this function create a File object for use in RequestBodyType.formData in environments where the global File object is unavailable.\n *\n * @param content - the content of the file as a Uint8Array in memory.\n * @param name - the name of the file.\n * @param options - optional metadata about the file, e.g. file name, file size, MIME type.\n */\nexport function createFile(\n  content: Uint8Array,\n  name: string,\n  options: CreateFileOptions = {},\n): File {\n  if (isNodeLike) {\n    return {\n      ...unimplementedMethods,\n      type: options.type ?? \"\",\n      lastModified: options.lastModified ?? new Date().getTime(),\n      webkitRelativePath: options.webkitRelativePath ?? \"\",\n      size: content.byteLength,\n      name,\n      arrayBuffer: async () => content.buffer,\n      stream: () => new Blob([content]).stream(),\n      [rawContent]: () => content,\n    } as File & RawContent;\n  } else {\n    return new File([content], name, options);\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { Readable } from \"node:stream\";\nimport type { ReadableStream as AsyncIterableReadableStream } from \"node:stream/web\";\nimport { isBlob } from \"./typeGuards.js\";\nimport { getRawContent } from \"./file.js\";\n\nasync function* streamAsyncIterator(\n  this: ReadableStream<Uint8Array>,\n): AsyncIterableIterator<Uint8Array> {\n  const reader = this.getReader();\n  try {\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) {\n        return;\n      }\n\n      yield value;\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\nfunction makeAsyncIterable<T>(webStream: any): asserts webStream is AsyncIterableReadableStream<T> {\n  if (!webStream[Symbol.asyncIterator]) {\n    webStream[Symbol.asyncIterator] = streamAsyncIterator.bind(webStream);\n  }\n\n  if (!webStream.values) {\n    webStream.values = streamAsyncIterator.bind(webStream);\n  }\n}\n\nfunction ensureNodeStream(\n  stream: ReadableStream<Uint8Array> | NodeJS.ReadableStream,\n): NodeJS.ReadableStream {\n  if (stream instanceof ReadableStream) {\n    makeAsyncIterable<Uint8Array>(stream);\n    return Readable.fromWeb(stream);\n  } else {\n    return stream;\n  }\n}\n\nfunction toStream(\n  source: ReadableStream<Uint8Array> | NodeJS.ReadableStream | Uint8Array | Blob,\n): NodeJS.ReadableStream {\n  if (source instanceof Uint8Array) {\n    return Readable.from(Buffer.from(source));\n  } else if (isBlob(source)) {\n    return toStream(getRawContent(source));\n  } else {\n    return ensureNodeStream(source);\n  }\n}\n\n/**\n * Accepted binary data types for concat\n *\n * @internal\n */\nexport type ConcatSource = ReadableStream<Uint8Array> | NodeJS.ReadableStream | Uint8Array | Blob;\n\n/**\n * Utility function that concatenates a set of binary inputs into one combined output.\n *\n * @param sources - array of sources for the concatenation\n * @returns - in Node, a (() =\\> NodeJS.ReadableStream) which, when read, produces a concatenation of all the inputs.\n *           In browser, returns a `Blob` representing all the concatenated inputs.\n *\n * @internal\n */\nexport async function concat(\n  sources: (ConcatSource | (() => ConcatSource))[],\n): Promise<(() => NodeJS.ReadableStream) | Blob> {\n  return function () {\n    const streams = sources.map((x) => (typeof x === \"function\" ? x() : x)).map(toStream);\n\n    return Readable.from(\n      (async function* () {\n        for (const stream of streams as NodeJS.ReadableStream[]) {\n          for await (const chunk of stream) {\n            yield chunk;\n          }\n        }\n      })(),\n    );\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { randomUUID, stringToUint8Array } from \"@azure/core-util\";\nimport type { BodyPart, HttpHeaders, PipelineRequest, PipelineResponse } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { concat } from \"../util/concat.js\";\nimport { isBlob } from \"../util/typeGuards.js\";\n\nfunction generateBoundary(): string {\n  return `----AzSDKFormBoundary${randomUUID()}`;\n}\n\nfunction encodeHeaders(headers: HttpHeaders): string {\n  let result = \"\";\n  for (const [key, value] of headers) {\n    result += `${key}: ${value}\\r\\n`;\n  }\n  return result;\n}\n\nfunction getLength(\n  source:\n    | (() => ReadableStream<Uint8Array>)\n    | (() => NodeJS.ReadableStream)\n    | Uint8Array\n    | Blob\n    | ReadableStream\n    | NodeJS.ReadableStream,\n): number | undefined {\n  if (source instanceof Uint8Array) {\n    return source.byteLength;\n  } else if (isBlob(source)) {\n    // if was created using createFile then -1 means we have an unknown size\n    return source.size === -1 ? undefined : source.size;\n  } else {\n    return undefined;\n  }\n}\n\nfunction getTotalLength(\n  sources: (\n    | (() => ReadableStream<Uint8Array>)\n    | (() => NodeJS.ReadableStream)\n    | Uint8Array\n    | Blob\n    | ReadableStream\n    | NodeJS.ReadableStream\n  )[],\n): number | undefined {\n  let total = 0;\n  for (const source of sources) {\n    const partLength = getLength(source);\n    if (partLength === undefined) {\n      return undefined;\n    } else {\n      total += partLength;\n    }\n  }\n  return total;\n}\n\nasync function buildRequestBody(\n  request: PipelineRequest,\n  parts: BodyPart[],\n  boundary: string,\n): Promise<void> {\n  const sources = [\n    stringToUint8Array(`--${boundary}`, \"utf-8\"),\n    ...parts.flatMap((part) => [\n      stringToUint8Array(\"\\r\\n\", \"utf-8\"),\n      stringToUint8Array(encodeHeaders(part.headers), \"utf-8\"),\n      stringToUint8Array(\"\\r\\n\", \"utf-8\"),\n      part.body,\n      stringToUint8Array(`\\r\\n--${boundary}`, \"utf-8\"),\n    ]),\n    stringToUint8Array(\"--\\r\\n\\r\\n\", \"utf-8\"),\n  ];\n\n  const contentLength = getTotalLength(sources);\n  if (contentLength) {\n    request.headers.set(\"Content-Length\", contentLength);\n  }\n\n  request.body = await concat(sources);\n}\n\n/**\n * Name of multipart policy\n */\nexport const multipartPolicyName = \"multipartPolicy\";\n\nconst maxBoundaryLength = 70;\nconst validBoundaryCharacters = new Set(\n  `abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?`,\n);\n\nfunction assertValidBoundary(boundary: string): void {\n  if (boundary.length > maxBoundaryLength) {\n    throw new Error(`Multipart boundary \"${boundary}\" exceeds maximum length of 70 characters`);\n  }\n\n  if (Array.from(boundary).some((x) => !validBoundaryCharacters.has(x))) {\n    throw new Error(`Multipart boundary \"${boundary}\" contains invalid characters`);\n  }\n}\n\n/**\n * Pipeline policy for multipart requests\n */\nexport function multipartPolicy(): PipelinePolicy {\n  return {\n    name: multipartPolicyName,\n    async sendRequest(request, next): Promise<PipelineResponse> {\n      if (!request.multipartBody) {\n        return next(request);\n      }\n\n      if (request.body) {\n        throw new Error(\"multipartBody and regular body cannot be set at the same time\");\n      }\n\n      let boundary = request.multipartBody.boundary;\n\n      const contentTypeHeader = request.headers.get(\"Content-Type\") ?? \"multipart/mixed\";\n      const parsedHeader = contentTypeHeader.match(/^(multipart\\/[^ ;]+)(?:; *boundary=(.+))?$/);\n      if (!parsedHeader) {\n        throw new Error(\n          `Got multipart request body, but content-type header was not multipart: ${contentTypeHeader}`,\n        );\n      }\n\n      const [, contentType, parsedBoundary] = parsedHeader;\n      if (parsedBoundary && boundary && parsedBoundary !== boundary) {\n        throw new Error(\n          `Multipart boundary was specified as ${parsedBoundary} in the header, but got ${boundary} in the request body`,\n        );\n      }\n\n      boundary ??= parsedBoundary;\n      if (boundary) {\n        assertValidBoundary(boundary);\n      } else {\n        boundary = generateBoundary();\n      }\n      request.headers.set(\"Content-Type\", `${contentType}; boundary=${boundary}`);\n      await buildRequestBody(request, request.multipartBody.parts, boundary);\n\n      request.multipartBody = undefined;\n\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\n\n/**\n * The programmatic identifier of the decompressResponsePolicy.\n */\nexport const decompressResponsePolicyName = \"decompressResponsePolicy\";\n\n/**\n * A policy to enable response decompression according to Accept-Encoding header\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Encoding\n */\nexport function decompressResponsePolicy(): PipelinePolicy {\n  return {\n    name: decompressResponsePolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      // HEAD requests have no body\n      if (request.method !== \"HEAD\") {\n        request.headers.set(\"Accept-Encoding\", \"gzip,deflate\");\n      }\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { AbortError, type AbortSignalLike } from \"@azure/abort-controller\";\nimport type { PipelineResponse } from \"../interfaces.js\";\n\nconst StandardAbortMessage = \"The operation was aborted.\";\n\n/**\n * A wrapper for setTimeout that resolves a promise after delayInMs milliseconds.\n * @param delayInMs - The number of milliseconds to be delayed.\n * @param value - The value to be resolved with after a timeout of t milliseconds.\n * @param options - The options for delay - currently abort options\n *                  - abortSignal - The abortSignal associated with containing operation.\n *                  - abortErrorMsg - The abort error message associated with containing operation.\n * @returns Resolved promise\n */\nexport function delay<T>(\n  delayInMs: number,\n  value?: T,\n  options?: {\n    abortSignal?: AbortSignalLike;\n    abortErrorMsg?: string;\n  },\n): Promise<T | void> {\n  return new Promise((resolve, reject) => {\n    let timer: ReturnType<typeof setTimeout> | undefined = undefined;\n    let onAborted: (() => void) | undefined = undefined;\n\n    const rejectOnAbort = (): void => {\n      return reject(\n        new AbortError(options?.abortErrorMsg ? options?.abortErrorMsg : StandardAbortMessage),\n      );\n    };\n\n    const removeListeners = (): void => {\n      if (options?.abortSignal && onAborted) {\n        options.abortSignal.removeEventListener(\"abort\", onAborted);\n      }\n    };\n\n    onAborted = (): void => {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      removeListeners();\n      return rejectOnAbort();\n    };\n\n    if (options?.abortSignal && options.abortSignal.aborted) {\n      return rejectOnAbort();\n    }\n\n    timer = setTimeout(() => {\n      removeListeners();\n      resolve(value);\n    }, delayInMs);\n\n    if (options?.abortSignal) {\n      options.abortSignal.addEventListener(\"abort\", onAborted);\n    }\n  });\n}\n\n/**\n * @internal\n * @returns the parsed value or undefined if the parsed value is invalid.\n */\nexport function parseHeaderValueAsNumber(\n  response: PipelineResponse,\n  headerName: string,\n): number | undefined {\n  const value = response.headers.get(headerName);\n  if (!value) return;\n  const valueAsNum = Number(value);\n  if (Number.isNaN(valueAsNum)) return;\n  return valueAsNum;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineResponse } from \"../index.js\";\nimport { parseHeaderValueAsNumber } from \"../util/helpers.js\";\nimport type { RetryStrategy } from \"./retryStrategy.js\";\n\n/**\n * The header that comes back from Azure services representing\n * the amount of time (minimum) to wait to retry (in seconds or timestamp after which we can retry).\n */\nconst RetryAfterHeader = \"Retry-After\";\n/**\n * The headers that come back from Azure services representing\n * the amount of time (minimum) to wait to retry.\n *\n * \"retry-after-ms\", \"x-ms-retry-after-ms\" : milliseconds\n * \"Retry-After\" : seconds or timestamp\n */\nconst AllRetryAfterHeaders: string[] = [\"retry-after-ms\", \"x-ms-retry-after-ms\", RetryAfterHeader];\n\n/**\n * A response is a throttling retry response if it has a throttling status code (429 or 503),\n * as long as one of the [ \"Retry-After\" or \"retry-after-ms\" or \"x-ms-retry-after-ms\" ] headers has a valid value.\n *\n * Returns the `retryAfterInMs` value if the response is a throttling retry response.\n * If not throttling retry response, returns `undefined`.\n *\n * @internal\n */\nfunction getRetryAfterInMs(response?: PipelineResponse): number | undefined {\n  if (!(response && [429, 503].includes(response.status))) return undefined;\n  try {\n    // Headers: \"retry-after-ms\", \"x-ms-retry-after-ms\", \"Retry-After\"\n    for (const header of AllRetryAfterHeaders) {\n      const retryAfterValue = parseHeaderValueAsNumber(response, header);\n      if (retryAfterValue === 0 || retryAfterValue) {\n        // \"Retry-After\" header ==> seconds\n        // \"retry-after-ms\", \"x-ms-retry-after-ms\" headers ==> milli-seconds\n        const multiplyingFactor = header === RetryAfterHeader ? 1000 : 1;\n        return retryAfterValue * multiplyingFactor; // in milli-seconds\n      }\n    }\n\n    // RetryAfterHeader (\"Retry-After\") has a special case where it might be formatted as a date instead of a number of seconds\n    const retryAfterHeader = response.headers.get(RetryAfterHeader);\n    if (!retryAfterHeader) return;\n\n    const date = Date.parse(retryAfterHeader);\n    const diff = date - Date.now();\n    // negative diff would mean a date in the past, so retry asap with 0 milliseconds\n    return Number.isFinite(diff) ? Math.max(0, diff) : undefined;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * A response is a retry response if it has a throttling status code (429 or 503),\n * as long as one of the [ \"Retry-After\" or \"retry-after-ms\" or \"x-ms-retry-after-ms\" ] headers has a valid value.\n */\nexport function isThrottlingRetryResponse(response?: PipelineResponse): boolean {\n  return Number.isFinite(getRetryAfterInMs(response));\n}\n\nexport function throttlingRetryStrategy(): RetryStrategy {\n  return {\n    name: \"throttlingRetryStrategy\",\n    retry({ response }) {\n      const retryAfterInMs = getRetryAfterInMs(response);\n      if (!Number.isFinite(retryAfterInMs)) {\n        return { skipStrategy: true };\n      }\n      return {\n        retryAfterInMs,\n      };\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineResponse } from \"../interfaces.js\";\nimport type { RestError } from \"../restError.js\";\nimport { getRandomIntegerInclusive } from \"@azure/core-util\";\nimport type { RetryStrategy } from \"./retryStrategy.js\";\nimport { isThrottlingRetryResponse } from \"./throttlingRetryStrategy.js\";\n\n// intervals are in milliseconds\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\nexport function exponentialRetryStrategy(\n  options: {\n    /**\n     * The amount of delay in milliseconds between retry attempts. Defaults to 1000\n     * (1 second.) The delay increases exponentially with each retry up to a maximum\n     * specified by maxRetryDelayInMs.\n     */\n    retryDelayInMs?: number;\n\n    /**\n     * The maximum delay in milliseconds allowed before retrying an operation. Defaults\n     * to 64000 (64 seconds).\n     */\n    maxRetryDelayInMs?: number;\n\n    /**\n     * If true it won't retry if it received a system error.\n     */\n    ignoreSystemErrors?: boolean;\n\n    /**\n     * If true it won't retry if it received a non-fatal HTTP status code.\n     */\n    ignoreHttpStatusCodes?: boolean;\n  } = {},\n): RetryStrategy {\n  const retryInterval = options.retryDelayInMs ?? DEFAULT_CLIENT_RETRY_INTERVAL;\n  const maxRetryInterval = options.maxRetryDelayInMs ?? DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n\n  let retryAfterInMs = retryInterval;\n\n  return {\n    name: \"exponentialRetryStrategy\",\n    retry({ retryCount, response, responseError }) {\n      const matchedSystemError = isSystemError(responseError);\n      const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n\n      const isExponential = isExponentialRetryResponse(response);\n      const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n      const unknownResponse = response && (isThrottlingRetryResponse(response) || !isExponential);\n\n      if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n        return { skipStrategy: true };\n      }\n\n      if (responseError && !matchedSystemError && !isExponential) {\n        return { errorToThrow: responseError };\n      }\n\n      // Exponentially increase the delay each time\n      const exponentialDelay = retryAfterInMs * Math.pow(2, retryCount);\n      // Don't let the delay exceed the maximum\n      const clampedExponentialDelay = Math.min(maxRetryInterval, exponentialDelay);\n      // Allow the final value to have some \"jitter\" (within 50% of the delay size) so\n      // that retries across multiple clients don't occur simultaneously.\n      retryAfterInMs =\n        clampedExponentialDelay / 2 + getRandomIntegerInclusive(0, clampedExponentialDelay / 2);\n      return { retryAfterInMs };\n    },\n  };\n}\n\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\nexport function isExponentialRetryResponse(response?: PipelineResponse): boolean {\n  return Boolean(\n    response &&\n      response.status !== undefined &&\n      (response.status >= 500 || response.status === 408) &&\n      response.status !== 501 &&\n      response.status !== 505,\n  );\n}\n\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\nexport function isSystemError(err?: RestError): boolean {\n  if (!err) {\n    return false;\n  }\n  return (\n    err.code === \"ETIMEDOUT\" ||\n    err.code === \"ESOCKETTIMEDOUT\" ||\n    err.code === \"ECONNREFUSED\" ||\n    err.code === \"ECONNRESET\" ||\n    err.code === \"ENOENT\" ||\n    err.code === \"ENOTFOUND\"\n  );\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { delay } from \"../util/helpers.js\";\nimport { type AzureLogger, createClientLogger } from \"@azure/logger\";\nimport type { RetryStrategy } from \"../retryStrategies/retryStrategy.js\";\nimport type { RestError } from \"../restError.js\";\nimport { AbortError } from \"@azure/abort-controller\";\nimport { DEFAULT_RETRY_POLICY_COUNT } from \"../constants.js\";\n\nconst retryPolicyLogger = createClientLogger(\"core-rest-pipeline retryPolicy\");\n\n/**\n * The programmatic identifier of the retryPolicy.\n */\nconst retryPolicyName = \"retryPolicy\";\n\n/**\n * Options to the {@link retryPolicy}\n */\nexport interface RetryPolicyOptions {\n  /**\n   * Maximum number of retries. If not specified, it will limit to 3 retries.\n   */\n  maxRetries?: number;\n  /**\n   * Logger. If it's not provided, a default logger is used.\n   */\n  logger?: AzureLogger;\n}\n\n/**\n * retryPolicy is a generic policy to enable retrying requests when certain conditions are met\n */\nexport function retryPolicy(\n  strategies: RetryStrategy[],\n  options: RetryPolicyOptions = { maxRetries: DEFAULT_RETRY_POLICY_COUNT },\n): PipelinePolicy {\n  const logger = options.logger || retryPolicyLogger;\n  return {\n    name: retryPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      let response: PipelineResponse | undefined;\n      let responseError: RestError | undefined;\n      let retryCount = -1;\n\n      // eslint-disable-next-line no-constant-condition\n      retryRequest: while (true) {\n        retryCount += 1;\n        response = undefined;\n        responseError = undefined;\n\n        try {\n          logger.info(`Retry ${retryCount}: Attempting to send request`, request.requestId);\n          response = await next(request);\n          logger.info(`Retry ${retryCount}: Received a response from request`, request.requestId);\n        } catch (e: any) {\n          logger.error(`Retry ${retryCount}: Received an error from request`, request.requestId);\n\n          // RestErrors are valid targets for the retry strategies.\n          // If none of the retry strategies can work with them, they will be thrown later in this policy.\n          // If the received error is not a RestError, it is immediately thrown.\n          responseError = e as RestError;\n          if (!e || responseError.name !== \"RestError\") {\n            throw e;\n          }\n\n          response = responseError.response;\n        }\n\n        if (request.abortSignal?.aborted) {\n          logger.error(`Retry ${retryCount}: Request aborted.`);\n          const abortError = new AbortError();\n          throw abortError;\n        }\n\n        if (retryCount >= (options.maxRetries ?? DEFAULT_RETRY_POLICY_COUNT)) {\n          logger.info(\n            `Retry ${retryCount}: Maximum retries reached. Returning the last received response, or throwing the last received error.`,\n          );\n          if (responseError) {\n            throw responseError;\n          } else if (response) {\n            return response;\n          } else {\n            throw new Error(\"Maximum retries reached with no response or error to throw\");\n          }\n        }\n\n        logger.info(`Retry ${retryCount}: Processing ${strategies.length} retry strategies.`);\n\n        strategiesLoop: for (const strategy of strategies) {\n          const strategyLogger = strategy.logger || retryPolicyLogger;\n          strategyLogger.info(`Retry ${retryCount}: Processing retry strategy ${strategy.name}.`);\n\n          const modifiers = strategy.retry({\n            retryCount,\n            response,\n            responseError,\n          });\n\n          if (modifiers.skipStrategy) {\n            strategyLogger.info(`Retry ${retryCount}: Skipped.`);\n            continue strategiesLoop;\n          }\n\n          const { errorToThrow, retryAfterInMs, redirectTo } = modifiers;\n\n          if (errorToThrow) {\n            strategyLogger.error(\n              `Retry ${retryCount}: Retry strategy ${strategy.name} throws error:`,\n              errorToThrow,\n            );\n            throw errorToThrow;\n          }\n\n          if (retryAfterInMs || retryAfterInMs === 0) {\n            strategyLogger.info(\n              `Retry ${retryCount}: Retry strategy ${strategy.name} retries after ${retryAfterInMs}`,\n            );\n            await delay(retryAfterInMs, undefined, { abortSignal: request.abortSignal });\n            continue retryRequest;\n          }\n\n          if (redirectTo) {\n            strategyLogger.info(\n              `Retry ${retryCount}: Retry strategy ${strategy.name} redirects to ${redirectTo}`,\n            );\n            request.url = redirectTo;\n            continue retryRequest;\n          }\n        }\n\n        if (responseError) {\n          logger.info(\n            `None of the retry strategies could work with the received error. Throwing it.`,\n          );\n          throw responseError;\n        }\n        if (response) {\n          logger.info(\n            `None of the retry strategies could work with the received response. Returning it.`,\n          );\n          return response;\n        }\n\n        // If all the retries skip and there's no response,\n        // we're still in the retry loop, so a new request will be sent\n        // until `maxRetries` is reached.\n      }\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRetryOptions } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { exponentialRetryStrategy } from \"../retryStrategies/exponentialRetryStrategy.js\";\nimport { throttlingRetryStrategy } from \"../retryStrategies/throttlingRetryStrategy.js\";\nimport { retryPolicy } from \"./retryPolicy.js\";\nimport { DEFAULT_RETRY_POLICY_COUNT } from \"../constants.js\";\n\n/**\n * Name of the {@link defaultRetryPolicy}\n */\nexport const defaultRetryPolicyName = \"defaultRetryPolicy\";\n\n/**\n * Options that control how to retry failed requests.\n */\nexport interface DefaultRetryPolicyOptions extends PipelineRetryOptions {}\n\n/**\n * A policy that retries according to three strategies:\n * - When the server sends a 429 response with a Retry-After header.\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails, it will retry with an exponentially increasing delay.\n */\nexport function defaultRetryPolicy(options: DefaultRetryPolicyOptions = {}): PipelinePolicy {\n  return {\n    name: defaultRetryPolicyName,\n    sendRequest: retryPolicy([throttlingRetryStrategy(), exponentialRetryStrategy(options)], {\n      maxRetries: options.maxRetries ?? DEFAULT_RETRY_POLICY_COUNT,\n    }).sendRequest,\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { HttpHeaders, RawHttpHeaders, RawHttpHeadersInput } from \"./interfaces.js\";\n\ninterface HeaderEntry {\n  name: string;\n  value: string;\n}\n\nfunction normalizeName(name: string): string {\n  return name.toLowerCase();\n}\n\nfunction* headerIterator(map: Map<string, HeaderEntry>): IterableIterator<[string, string]> {\n  for (const entry of map.values()) {\n    yield [entry.name, entry.value];\n  }\n}\n\nclass HttpHeadersImpl implements HttpHeaders {\n  private readonly _headersMap: Map<string, HeaderEntry>;\n\n  constructor(rawHeaders?: RawHttpHeaders | RawHttpHeadersInput) {\n    this._headersMap = new Map<string, HeaderEntry>();\n    if (rawHeaders) {\n      for (const headerName of Object.keys(rawHeaders)) {\n        this.set(headerName, rawHeaders[headerName]);\n      }\n    }\n  }\n\n  /**\n   * Set a header in this collection with the provided name and value. The name is\n   * case-insensitive.\n   * @param name - The name of the header to set. This value is case-insensitive.\n   * @param value - The value of the header to set.\n   */\n  public set(name: string, value: string | number | boolean): void {\n    this._headersMap.set(normalizeName(name), { name, value: String(value).trim() });\n  }\n\n  /**\n   * Get the header value for the provided header name, or undefined if no header exists in this\n   * collection with the provided name.\n   * @param name - The name of the header. This value is case-insensitive.\n   */\n  public get(name: string): string | undefined {\n    return this._headersMap.get(normalizeName(name))?.value;\n  }\n\n  /**\n   * Get whether or not this header collection contains a header entry for the provided header name.\n   * @param name - The name of the header to set. This value is case-insensitive.\n   */\n  public has(name: string): boolean {\n    return this._headersMap.has(normalizeName(name));\n  }\n\n  /**\n   * Remove the header with the provided headerName.\n   * @param name - The name of the header to remove.\n   */\n  public delete(name: string): void {\n    this._headersMap.delete(normalizeName(name));\n  }\n\n  /**\n   * Get the JSON object representation of this HTTP header collection.\n   */\n  public toJSON(options: { preserveCase?: boolean } = {}): RawHttpHeaders {\n    const result: RawHttpHeaders = {};\n    if (options.preserveCase) {\n      for (const entry of this._headersMap.values()) {\n        result[entry.name] = entry.value;\n      }\n    } else {\n      for (const [normalizedName, entry] of this._headersMap) {\n        result[normalizedName] = entry.value;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get the string representation of this HTTP header collection.\n   */\n  public toString(): string {\n    return JSON.stringify(this.toJSON({ preserveCase: true }));\n  }\n\n  /**\n   * Iterate over tuples of header [name, value] pairs.\n   */\n  [Symbol.iterator](): Iterator<[string, string]> {\n    return headerIterator(this._headersMap);\n  }\n}\n\n/**\n * Creates an object that satisfies the `HttpHeaders` interface.\n * @param rawHeaders - A simple object representing initial headers\n */\nexport function createHttpHeaders(rawHeaders?: RawHttpHeadersInput): HttpHeaders {\n  return new HttpHeadersImpl(rawHeaders);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { isNodeLike, stringToUint8Array } from \"@azure/core-util\";\nimport { createHttpHeaders } from \"../httpHeaders.js\";\nimport type {\n  BodyPart,\n  FormDataMap,\n  FormDataValue,\n  PipelineRequest,\n  PipelineResponse,\n  SendRequest,\n} from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\n\n/**\n * The programmatic identifier of the formDataPolicy.\n */\nexport const formDataPolicyName = \"formDataPolicy\";\n\nfunction formDataToFormDataMap(formData: FormData): FormDataMap {\n  const formDataMap: FormDataMap = {};\n  for (const [key, value] of formData.entries()) {\n    formDataMap[key] ??= [];\n    (formDataMap[key] as FormDataValue[]).push(value);\n  }\n  return formDataMap;\n}\n\n/**\n * A policy that encodes FormData on the request into the body.\n */\nexport function formDataPolicy(): PipelinePolicy {\n  return {\n    name: formDataPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (isNodeLike && typeof FormData !== \"undefined\" && request.body instanceof FormData) {\n        request.formData = formDataToFormDataMap(request.body);\n        request.body = undefined;\n      }\n\n      if (request.formData) {\n        const contentType = request.headers.get(\"Content-Type\");\n        if (contentType && contentType.indexOf(\"application/x-www-form-urlencoded\") !== -1) {\n          request.body = wwwFormUrlEncode(request.formData);\n        } else {\n          await prepareFormData(request.formData, request);\n        }\n\n        request.formData = undefined;\n      }\n      return next(request);\n    },\n  };\n}\n\nfunction wwwFormUrlEncode(formData: FormDataMap): string {\n  const urlSearchParams = new URLSearchParams();\n  for (const [key, value] of Object.entries(formData)) {\n    if (Array.isArray(value)) {\n      for (const subValue of value) {\n        urlSearchParams.append(key, subValue.toString());\n      }\n    } else {\n      urlSearchParams.append(key, value.toString());\n    }\n  }\n  return urlSearchParams.toString();\n}\n\nasync function prepareFormData(formData: FormDataMap, request: PipelineRequest): Promise<void> {\n  // validate content type (multipart/form-data)\n  const contentType = request.headers.get(\"Content-Type\");\n  if (contentType && !contentType.startsWith(\"multipart/form-data\")) {\n    // content type is specified and is not multipart/form-data. Exit.\n    return;\n  }\n\n  request.headers.set(\"Content-Type\", contentType ?? \"multipart/form-data\");\n\n  // set body to MultipartRequestBody using content from FormDataMap\n  const parts: BodyPart[] = [];\n\n  for (const [fieldName, values] of Object.entries(formData)) {\n    for (const value of Array.isArray(values) ? values : [values]) {\n      if (typeof value === \"string\") {\n        parts.push({\n          headers: createHttpHeaders({\n            \"Content-Disposition\": `form-data; name=\"${fieldName}\"`,\n          }),\n          body: stringToUint8Array(value, \"utf-8\"),\n        });\n      } else if (value === undefined || value === null || typeof value !== \"object\") {\n        throw new Error(\n          `Unexpected value for key ${fieldName}: ${value}. Value should be serialized to string first.`,\n        );\n      } else {\n        // using || instead of ?? here since if value.name is empty we should create a file name\n        const fileName = (value as File).name || \"blob\";\n        const headers = createHttpHeaders();\n        headers.set(\n          \"Content-Disposition\",\n          `form-data; name=\"${fieldName}\"; filename=\"${fileName}\"`,\n        );\n\n        // again, || is used since an empty value.type means the content type is unset\n        headers.set(\"Content-Type\", value.type || \"application/octet-stream\");\n\n        parts.push({\n          headers,\n          body: value,\n        });\n      }\n    }\n  }\n  request.multipartBody = { parts };\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\tlet m;\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && (m = navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)) && parseInt(m[1], 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n",{"errno":-4058,"code":"ENOENT","syscall":"open","path":"C:\\Users\\angellan\\OCDI\\Release\\async_spool_core\\SDK\\js\\common\\temp\\node_modules\\.pnpm\\agent-base@7.1.1\\node_modules\\agent-base\\src\\helpers.ts"},{"errno":-4058,"code":"ENOENT","syscall":"open","path":"C:\\Users\\angellan\\OCDI\\Release\\async_spool_core\\SDK\\js\\common\\temp\\node_modules\\.pnpm\\agent-base@7.1.1\\node_modules\\agent-base\\src\\index.ts"},{"errno":-4058,"code":"ENOENT","syscall":"open","path":"C:\\Users\\angellan\\OCDI\\Release\\async_spool_core\\SDK\\js\\common\\temp\\node_modules\\.pnpm\\https-proxy-agent@7.0.5\\node_modules\\https-proxy-agent\\src\\parse-proxy-response.ts"},{"errno":-4058,"code":"ENOENT","syscall":"open","path":"C:\\Users\\angellan\\OCDI\\Release\\async_spool_core\\SDK\\js\\common\\temp\\node_modules\\.pnpm\\https-proxy-agent@7.0.5\\node_modules\\https-proxy-agent\\src\\index.ts"},"// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n",{"errno":-4058,"code":"ENOENT","syscall":"open","path":"C:\\Users\\angellan\\OCDI\\Release\\async_spool_core\\SDK\\js\\common\\temp\\node_modules\\.pnpm\\http-proxy-agent@7.0.2\\node_modules\\http-proxy-agent\\src\\index.ts"},"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type * as http from \"http\";\nimport type * as https from \"https\";\nimport { HttpsProxyAgent } from \"https-proxy-agent\";\nimport { HttpProxyAgent } from \"http-proxy-agent\";\nimport type {\n  PipelineRequest,\n  PipelineResponse,\n  ProxySettings,\n  SendRequest,\n} from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { logger } from \"../log.js\";\n\nconst HTTPS_PROXY = \"HTTPS_PROXY\";\nconst HTTP_PROXY = \"HTTP_PROXY\";\nconst ALL_PROXY = \"ALL_PROXY\";\nconst NO_PROXY = \"NO_PROXY\";\n\n/**\n * The programmatic identifier of the proxyPolicy.\n */\nexport const proxyPolicyName = \"proxyPolicy\";\n\n/**\n * Stores the patterns specified in NO_PROXY environment variable.\n * @internal\n */\nexport const globalNoProxyList: string[] = [];\nlet noProxyListLoaded: boolean = false;\n\n/** A cache of whether a host should bypass the proxy. */\nconst globalBypassedMap: Map<string, boolean> = new Map();\n\nfunction getEnvironmentValue(name: string): string | undefined {\n  if (process.env[name]) {\n    return process.env[name];\n  } else if (process.env[name.toLowerCase()]) {\n    return process.env[name.toLowerCase()];\n  }\n  return undefined;\n}\n\nfunction loadEnvironmentProxyValue(): string | undefined {\n  if (!process) {\n    return undefined;\n  }\n\n  const httpsProxy = getEnvironmentValue(HTTPS_PROXY);\n  const allProxy = getEnvironmentValue(ALL_PROXY);\n  const httpProxy = getEnvironmentValue(HTTP_PROXY);\n\n  return httpsProxy || allProxy || httpProxy;\n}\n\n/**\n * Check whether the host of a given `uri` matches any pattern in the no proxy list.\n * If there's a match, any request sent to the same host shouldn't have the proxy settings set.\n * This implementation is a port of https://github.com/Azure/azure-sdk-for-net/blob/8cca811371159e527159c7eb65602477898683e2/sdk/core/Azure.Core/src/Pipeline/Internal/HttpEnvironmentProxy.cs#L210\n */\nfunction isBypassed(\n  uri: string,\n  noProxyList: string[],\n  bypassedMap?: Map<string, boolean>,\n): boolean | undefined {\n  if (noProxyList.length === 0) {\n    return false;\n  }\n  const host = new URL(uri).hostname;\n  if (bypassedMap?.has(host)) {\n    return bypassedMap.get(host);\n  }\n  let isBypassedFlag = false;\n  for (const pattern of noProxyList) {\n    if (pattern[0] === \".\") {\n      // This should match either domain it self or any subdomain or host\n      // .foo.com will match foo.com it self or *.foo.com\n      if (host.endsWith(pattern)) {\n        isBypassedFlag = true;\n      } else {\n        if (host.length === pattern.length - 1 && host === pattern.slice(1)) {\n          isBypassedFlag = true;\n        }\n      }\n    } else {\n      if (host === pattern) {\n        isBypassedFlag = true;\n      }\n    }\n  }\n  bypassedMap?.set(host, isBypassedFlag);\n  return isBypassedFlag;\n}\n\nexport function loadNoProxy(): string[] {\n  const noProxy = getEnvironmentValue(NO_PROXY);\n  noProxyListLoaded = true;\n  if (noProxy) {\n    return noProxy\n      .split(\",\")\n      .map((item) => item.trim())\n      .filter((item) => item.length);\n  }\n\n  return [];\n}\n\n/**\n * This method converts a proxy url into `ProxySettings` for use with ProxyPolicy.\n * If no argument is given, it attempts to parse a proxy URL from the environment\n * variables `HTTPS_PROXY` or `HTTP_PROXY`.\n * @param proxyUrl - The url of the proxy to use. May contain authentication information.\n * @deprecated - Internally this method is no longer necessary when setting proxy information.\n */\nexport function getDefaultProxySettings(proxyUrl?: string): ProxySettings | undefined {\n  if (!proxyUrl) {\n    proxyUrl = loadEnvironmentProxyValue();\n    if (!proxyUrl) {\n      return undefined;\n    }\n  }\n\n  const parsedUrl = new URL(proxyUrl);\n  const schema = parsedUrl.protocol ? parsedUrl.protocol + \"//\" : \"\";\n  return {\n    host: schema + parsedUrl.hostname,\n    port: Number.parseInt(parsedUrl.port || \"80\"),\n    username: parsedUrl.username,\n    password: parsedUrl.password,\n  };\n}\n\n/**\n * This method attempts to parse a proxy URL from the environment\n * variables `HTTPS_PROXY` or `HTTP_PROXY`.\n */\nfunction getDefaultProxySettingsInternal(): URL | undefined {\n  const envProxy = loadEnvironmentProxyValue();\n  return envProxy ? new URL(envProxy) : undefined;\n}\n\nfunction getUrlFromProxySettings(settings: ProxySettings): URL {\n  let parsedProxyUrl: URL;\n  try {\n    parsedProxyUrl = new URL(settings.host);\n  } catch {\n    throw new Error(\n      `Expecting a valid host string in proxy settings, but found \"${settings.host}\".`,\n    );\n  }\n\n  parsedProxyUrl.port = String(settings.port);\n  if (settings.username) {\n    parsedProxyUrl.username = settings.username;\n  }\n  if (settings.password) {\n    parsedProxyUrl.password = settings.password;\n  }\n\n  return parsedProxyUrl;\n}\n\nfunction setProxyAgentOnRequest(\n  request: PipelineRequest,\n  cachedAgents: CachedAgents,\n  proxyUrl: URL,\n): void {\n  // Custom Agent should take precedence so if one is present\n  // we should skip to avoid overwriting it.\n  if (request.agent) {\n    return;\n  }\n\n  const url = new URL(request.url);\n\n  const isInsecure = url.protocol !== \"https:\";\n\n  if (request.tlsSettings) {\n    logger.warning(\n      \"TLS settings are not supported in combination with custom Proxy, certificates provided to the client will be ignored.\",\n    );\n  }\n\n  const headers = request.headers.toJSON();\n\n  if (isInsecure) {\n    if (!cachedAgents.httpProxyAgent) {\n      cachedAgents.httpProxyAgent = new HttpProxyAgent(proxyUrl, { headers });\n    }\n    request.agent = cachedAgents.httpProxyAgent;\n  } else {\n    if (!cachedAgents.httpsProxyAgent) {\n      cachedAgents.httpsProxyAgent = new HttpsProxyAgent(proxyUrl, { headers });\n    }\n    request.agent = cachedAgents.httpsProxyAgent;\n  }\n}\n\ninterface CachedAgents {\n  httpsProxyAgent?: https.Agent;\n  httpProxyAgent?: http.Agent;\n}\n\n/**\n * A policy that allows one to apply proxy settings to all requests.\n * If not passed static settings, they will be retrieved from the HTTPS_PROXY\n * or HTTP_PROXY environment variables.\n * @param proxySettings - ProxySettings to use on each request.\n * @param options - additional settings, for example, custom NO_PROXY patterns\n */\nexport function proxyPolicy(\n  proxySettings?: ProxySettings,\n  options?: {\n    /** a list of patterns to override those loaded from NO_PROXY environment variable. */\n    customNoProxyList?: string[];\n  },\n): PipelinePolicy {\n  if (!noProxyListLoaded) {\n    globalNoProxyList.push(...loadNoProxy());\n  }\n\n  const defaultProxy = proxySettings\n    ? getUrlFromProxySettings(proxySettings)\n    : getDefaultProxySettingsInternal();\n\n  const cachedAgents: CachedAgents = {};\n\n  return {\n    name: proxyPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (\n        !request.proxySettings &&\n        defaultProxy &&\n        !isBypassed(\n          request.url,\n          options?.customNoProxyList ?? globalNoProxyList,\n          options?.customNoProxyList ? undefined : globalBypassedMap,\n        )\n      ) {\n        setProxyAgentOnRequest(request, cachedAgents, defaultProxy);\n      } else if (request.proxySettings) {\n        setProxyAgentOnRequest(\n          request,\n          cachedAgents,\n          getUrlFromProxySettings(request.proxySettings),\n        );\n      }\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\n\n/**\n * The programmatic identifier of the setClientRequestIdPolicy.\n */\nexport const setClientRequestIdPolicyName = \"setClientRequestIdPolicy\";\n\n/**\n * Each PipelineRequest gets a unique id upon creation.\n * This policy passes that unique id along via an HTTP header to enable better\n * telemetry and tracing.\n * @param requestIdHeaderName - The name of the header to pass the request ID to.\n */\nexport function setClientRequestIdPolicy(\n  requestIdHeaderName = \"x-ms-client-request-id\",\n): PipelinePolicy {\n  return {\n    name: setClientRequestIdPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!request.headers.has(requestIdHeaderName)) {\n        request.headers.set(requestIdHeaderName, request.requestId);\n      }\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport type { TlsSettings } from \"../interfaces.js\";\n\n/**\n * Name of the TLS Policy\n */\nexport const tlsPolicyName = \"tlsPolicy\";\n\n/**\n * Gets a pipeline policy that adds the client certificate to the HttpClient agent for authentication.\n */\nexport function tlsPolicy(tlsSettings?: TlsSettings): PipelinePolicy {\n  return {\n    name: tlsPolicyName,\n    sendRequest: async (req, next) => {\n      // Users may define a request tlsSettings, honor those over the client level one\n      if (!req.tlsSettings) {\n        req.tlsSettings = tlsSettings;\n      }\n      return next(req);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { TracingContext, TracingSpan } from \"./interfaces.js\";\n\n/** @internal */\nexport const knownContextKeys = {\n  span: Symbol.for(\"@azure/core-tracing span\"),\n  namespace: Symbol.for(\"@azure/core-tracing namespace\"),\n};\n\n/**\n * Creates a new {@link TracingContext} with the given options.\n * @param options - A set of known keys that may be set on the context.\n * @returns A new {@link TracingContext} with the given options.\n *\n * @internal\n */\nexport function createTracingContext(options: CreateTracingContextOptions = {}): TracingContext {\n  let context: TracingContext = new TracingContextImpl(options.parentContext);\n  if (options.span) {\n    context = context.setValue(knownContextKeys.span, options.span);\n  }\n  if (options.namespace) {\n    context = context.setValue(knownContextKeys.namespace, options.namespace);\n  }\n  return context;\n}\n\n/** @internal */\nexport class TracingContextImpl implements TracingContext {\n  private _contextMap: Map<symbol, unknown>;\n  constructor(initialContext?: TracingContext) {\n    this._contextMap =\n      initialContext instanceof TracingContextImpl\n        ? new Map<symbol, unknown>(initialContext._contextMap)\n        : new Map();\n  }\n\n  setValue(key: symbol, value: unknown): TracingContext {\n    const newContext = new TracingContextImpl(this);\n    newContext._contextMap.set(key, value);\n    return newContext;\n  }\n\n  getValue(key: symbol): unknown {\n    return this._contextMap.get(key);\n  }\n\n  deleteValue(key: symbol): TracingContext {\n    const newContext = new TracingContextImpl(this);\n    newContext._contextMap.delete(key);\n    return newContext;\n  }\n}\n\n/**\n * Represents a set of items that can be set when creating a new {@link TracingContext}.\n */\nexport interface CreateTracingContextOptions {\n  /** The {@link parentContext} - the newly created context will contain all the values of the parent context unless overridden. */\n  parentContext?: TracingContext;\n  /** An initial span to set on the context. */\n  span?: TracingSpan;\n  /** The namespace to set on any child spans. */\n  namespace?: string;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { Instrumenter } from \"./interfaces.js\";\n\n/**\n * Browser-only implementation of the module's state. The browser esm variant will not load the commonjs state, so we do not need to share state between the two.\n */\nexport const state = {\n  instrumenterImplementation: undefined as Instrumenter | undefined,\n};\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  Instrumenter,\n  InstrumenterSpanOptions,\n  TracingContext,\n  TracingSpan,\n} from \"./interfaces.js\";\n\nimport { createTracingContext } from \"./tracingContext.js\";\nimport { state } from \"./state.js\";\n\nexport function createDefaultTracingSpan(): TracingSpan {\n  return {\n    end: () => {\n      // noop\n    },\n    isRecording: () => false,\n    recordException: () => {\n      // noop\n    },\n    setAttribute: () => {\n      // noop\n    },\n    setStatus: () => {\n      // noop\n    },\n  };\n}\n\nexport function createDefaultInstrumenter(): Instrumenter {\n  return {\n    createRequestHeaders: (): Record<string, string> => {\n      return {};\n    },\n    parseTraceparentHeader: (): TracingContext | undefined => {\n      return undefined;\n    },\n    startSpan: (\n      _name: string,\n      spanOptions: InstrumenterSpanOptions,\n    ): { span: TracingSpan; tracingContext: TracingContext } => {\n      return {\n        span: createDefaultTracingSpan(),\n        tracingContext: createTracingContext({ parentContext: spanOptions.tracingContext }),\n      };\n    },\n    withContext<\n      CallbackArgs extends unknown[],\n      Callback extends (...args: CallbackArgs) => ReturnType<Callback>,\n    >(\n      _context: TracingContext,\n      callback: Callback,\n      ...callbackArgs: CallbackArgs\n    ): ReturnType<Callback> {\n      return callback(...callbackArgs);\n    },\n  };\n}\n\n/**\n * Extends the Azure SDK with support for a given instrumenter implementation.\n *\n * @param instrumenter - The instrumenter implementation to use.\n */\nexport function useInstrumenter(instrumenter: Instrumenter): void {\n  state.instrumenterImplementation = instrumenter;\n}\n\n/**\n * Gets the currently set instrumenter, a No-Op instrumenter by default.\n *\n * @returns The currently set instrumenter\n */\nexport function getInstrumenter(): Instrumenter {\n  if (!state.instrumenterImplementation) {\n    state.instrumenterImplementation = createDefaultInstrumenter();\n  }\n  return state.instrumenterImplementation;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  OperationTracingOptions,\n  OptionsWithTracingContext,\n  Resolved,\n  TracingClient,\n  TracingClientOptions,\n  TracingContext,\n  TracingSpan,\n  TracingSpanOptions,\n} from \"./interfaces.js\";\nimport { getInstrumenter } from \"./instrumenter.js\";\nimport { knownContextKeys } from \"./tracingContext.js\";\n\n/**\n * Creates a new tracing client.\n *\n * @param options - Options used to configure the tracing client.\n * @returns - An instance of {@link TracingClient}.\n */\nexport function createTracingClient(options: TracingClientOptions): TracingClient {\n  const { namespace, packageName, packageVersion } = options;\n\n  function startSpan<Options extends { tracingOptions?: OperationTracingOptions }>(\n    name: string,\n    operationOptions?: Options,\n    spanOptions?: TracingSpanOptions,\n  ): {\n    span: TracingSpan;\n    updatedOptions: OptionsWithTracingContext<Options>;\n  } {\n    const startSpanResult = getInstrumenter().startSpan(name, {\n      ...spanOptions,\n      packageName: packageName,\n      packageVersion: packageVersion,\n      tracingContext: operationOptions?.tracingOptions?.tracingContext,\n    });\n    let tracingContext = startSpanResult.tracingContext;\n    const span = startSpanResult.span;\n    if (!tracingContext.getValue(knownContextKeys.namespace)) {\n      tracingContext = tracingContext.setValue(knownContextKeys.namespace, namespace);\n    }\n    span.setAttribute(\"az.namespace\", tracingContext.getValue(knownContextKeys.namespace));\n    const updatedOptions: OptionsWithTracingContext<Options> = Object.assign({}, operationOptions, {\n      tracingOptions: { ...operationOptions?.tracingOptions, tracingContext },\n    });\n\n    return {\n      span,\n      updatedOptions,\n    };\n  }\n\n  async function withSpan<\n    Options extends { tracingOptions?: OperationTracingOptions },\n    Callback extends (\n      updatedOptions: Options,\n      span: Omit<TracingSpan, \"end\">,\n    ) => ReturnType<Callback>,\n  >(\n    name: string,\n    operationOptions: Options,\n    callback: Callback,\n    spanOptions?: TracingSpanOptions,\n  ): Promise<Resolved<ReturnType<Callback>>> {\n    const { span, updatedOptions } = startSpan(name, operationOptions, spanOptions);\n    try {\n      const result = await withContext(updatedOptions.tracingOptions.tracingContext, () =>\n        Promise.resolve(callback(updatedOptions, span)),\n      );\n      span.setStatus({ status: \"success\" });\n      return result as ReturnType<typeof withSpan>;\n    } catch (err: any) {\n      span.setStatus({ status: \"error\", error: err });\n      throw err;\n    } finally {\n      span.end();\n    }\n  }\n\n  function withContext<\n    CallbackArgs extends unknown[],\n    Callback extends (...args: CallbackArgs) => ReturnType<Callback>,\n  >(\n    context: TracingContext,\n    callback: Callback,\n    ...callbackArgs: CallbackArgs\n  ): ReturnType<Callback> {\n    return getInstrumenter().withContext(context, callback, ...callbackArgs);\n  }\n\n  /**\n   * Parses a traceparent header value into a span identifier.\n   *\n   * @param traceparentHeader - The traceparent header to parse.\n   * @returns An implementation-specific identifier for the span.\n   */\n  function parseTraceparentHeader(traceparentHeader: string): TracingContext | undefined {\n    return getInstrumenter().parseTraceparentHeader(traceparentHeader);\n  }\n\n  /**\n   * Creates a set of request headers to propagate tracing information to a backend.\n   *\n   * @param tracingContext - The context containing the span to serialize.\n   * @returns The set of headers to add to a request.\n   */\n  function createRequestHeaders(tracingContext?: TracingContext): Record<string, string> {\n    return getInstrumenter().createRequestHeaders(tracingContext);\n  }\n\n  return {\n    startSpan,\n    withSpan,\n    withContext,\n    parseTraceparentHeader,\n    createRequestHeaders,\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { inspect } from \"node:util\";\n\nexport const custom = inspect.custom;\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { isError } from \"@azure/core-util\";\nimport type { PipelineRequest, PipelineResponse } from \"./interfaces.js\";\nimport { custom } from \"./util/inspect.js\";\nimport { Sanitizer } from \"./util/sanitizer.js\";\n\nconst errorSanitizer = new Sanitizer();\n\n/**\n * The options supported by RestError.\n */\nexport interface RestErrorOptions {\n  /**\n   * The code of the error itself (use statics on RestError if possible.)\n   */\n  code?: string;\n  /**\n   * The HTTP status code of the request (if applicable.)\n   */\n  statusCode?: number;\n  /**\n   * The request that was made.\n   */\n  request?: PipelineRequest;\n  /**\n   * The response received (if any.)\n   */\n  response?: PipelineResponse;\n}\n\n/**\n * A custom error type for failed pipeline requests.\n */\nexport class RestError extends Error {\n  /**\n   * Something went wrong when making the request.\n   * This means the actual request failed for some reason,\n   * such as a DNS issue or the connection being lost.\n   */\n  static readonly REQUEST_SEND_ERROR: string = \"REQUEST_SEND_ERROR\";\n  /**\n   * This means that parsing the response from the server failed.\n   * It may have been malformed.\n   */\n  static readonly PARSE_ERROR: string = \"PARSE_ERROR\";\n\n  /**\n   * The code of the error itself (use statics on RestError if possible.)\n   */\n  public code?: string;\n  /**\n   * The HTTP status code of the request (if applicable.)\n   */\n  public statusCode?: number;\n  /**\n   * The request that was made.\n   * This property is non-enumerable.\n   */\n  public request?: PipelineRequest;\n  /**\n   * The response received (if any.)\n   * This property is non-enumerable.\n   */\n  public response?: PipelineResponse;\n  /**\n   * Bonus property set by the throw site.\n   */\n  public details?: unknown;\n\n  constructor(message: string, options: RestErrorOptions = {}) {\n    super(message);\n    this.name = \"RestError\";\n    this.code = options.code;\n    this.statusCode = options.statusCode;\n\n    // The request and response may contain sensitive information in the headers or body.\n    // To help prevent this sensitive information being accidentally logged, the request and response\n    // properties are marked as non-enumerable here. This prevents them showing up in the output of\n    // JSON.stringify and console.log.\n    Object.defineProperty(this, \"request\", { value: options.request, enumerable: false });\n    Object.defineProperty(this, \"response\", { value: options.response, enumerable: false });\n\n    Object.setPrototypeOf(this, RestError.prototype);\n  }\n\n  /**\n   * Logging method for util.inspect in Node\n   */\n  [custom](): string {\n    // Extract non-enumerable properties and add them back. This is OK since in this output the request and\n    // response get sanitized.\n    return `RestError: ${this.message} \\n ${errorSanitizer.sanitize({\n      ...this,\n      request: this.request,\n      response: this.response,\n    })}`;\n  }\n}\n\n/**\n * Typeguard for RestError\n * @param e - Something caught by a catch clause.\n */\nexport function isRestError(e: unknown): e is RestError {\n  if (e instanceof RestError) {\n    return true;\n  }\n  return isError(e) && e.name === \"RestError\";\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport {\n  type TracingClient,\n  type TracingContext,\n  type TracingSpan,\n  createTracingClient,\n} from \"@azure/core-tracing\";\nimport { SDK_VERSION } from \"../constants.js\";\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { getUserAgentValue } from \"../util/userAgent.js\";\nimport { logger } from \"../log.js\";\nimport { getErrorMessage, isError } from \"@azure/core-util\";\nimport { isRestError } from \"../restError.js\";\nimport { Sanitizer } from \"../util/sanitizer.js\";\n\n/**\n * The programmatic identifier of the tracingPolicy.\n */\nexport const tracingPolicyName = \"tracingPolicy\";\n\n/**\n * Options to configure the tracing policy.\n */\nexport interface TracingPolicyOptions {\n  /**\n   * String prefix to add to the user agent logged as metadata\n   * on the generated Span.\n   * Defaults to an empty string.\n   */\n  userAgentPrefix?: string;\n  /**\n   * Query string names whose values will be logged when logging is enabled. By default no\n   * query string values are logged.\n   */\n  additionalAllowedQueryParameters?: string[];\n}\n\n/**\n * A simple policy to create OpenTelemetry Spans for each request made by the pipeline\n * that has SpanOptions with a parent.\n * Requests made without a parent Span will not be recorded.\n * @param options - Options to configure the telemetry logged by the tracing policy.\n */\nexport function tracingPolicy(options: TracingPolicyOptions = {}): PipelinePolicy {\n  const userAgentPromise = getUserAgentValue(options.userAgentPrefix);\n  const sanitizer = new Sanitizer({\n    additionalAllowedQueryParameters: options.additionalAllowedQueryParameters,\n  });\n  const tracingClient = tryCreateTracingClient();\n\n  return {\n    name: tracingPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!tracingClient) {\n        return next(request);\n      }\n\n      const userAgent = await userAgentPromise;\n\n      const spanAttributes = {\n        \"http.url\": sanitizer.sanitizeUrl(request.url),\n        \"http.method\": request.method,\n        \"http.user_agent\": userAgent,\n        requestId: request.requestId,\n      };\n      if (userAgent) {\n        spanAttributes[\"http.user_agent\"] = userAgent;\n      }\n\n      const { span, tracingContext } = tryCreateSpan(tracingClient, request, spanAttributes) ?? {};\n\n      if (!span || !tracingContext) {\n        return next(request);\n      }\n\n      try {\n        const response = await tracingClient.withContext(tracingContext, next, request);\n        tryProcessResponse(span, response);\n        return response;\n      } catch (err: any) {\n        tryProcessError(span, err);\n        throw err;\n      }\n    },\n  };\n}\n\nfunction tryCreateTracingClient(): TracingClient | undefined {\n  try {\n    return createTracingClient({\n      namespace: \"\",\n      packageName: \"@azure/core-rest-pipeline\",\n      packageVersion: SDK_VERSION,\n    });\n  } catch (e: unknown) {\n    logger.warning(`Error when creating the TracingClient: ${getErrorMessage(e)}`);\n    return undefined;\n  }\n}\n\nfunction tryCreateSpan(\n  tracingClient: TracingClient,\n  request: PipelineRequest,\n  spanAttributes: Record<string, unknown>,\n): { span: TracingSpan; tracingContext: TracingContext } | undefined {\n  try {\n    // As per spec, we do not need to differentiate between HTTP and HTTPS in span name.\n    const { span, updatedOptions } = tracingClient.startSpan(\n      `HTTP ${request.method}`,\n      { tracingOptions: request.tracingOptions },\n      {\n        spanKind: \"client\",\n        spanAttributes,\n      },\n    );\n\n    // If the span is not recording, don't do any more work.\n    if (!span.isRecording()) {\n      span.end();\n      return undefined;\n    }\n\n    // set headers\n    const headers = tracingClient.createRequestHeaders(\n      updatedOptions.tracingOptions.tracingContext,\n    );\n    for (const [key, value] of Object.entries(headers)) {\n      request.headers.set(key, value);\n    }\n    return { span, tracingContext: updatedOptions.tracingOptions.tracingContext };\n  } catch (e: any) {\n    logger.warning(`Skipping creating a tracing span due to an error: ${getErrorMessage(e)}`);\n    return undefined;\n  }\n}\n\nfunction tryProcessError(span: TracingSpan, error: unknown): void {\n  try {\n    span.setStatus({\n      status: \"error\",\n      error: isError(error) ? error : undefined,\n    });\n    if (isRestError(error) && error.statusCode) {\n      span.setAttribute(\"http.status_code\", error.statusCode);\n    }\n    span.end();\n  } catch (e: any) {\n    logger.warning(`Skipping tracing span processing due to an error: ${getErrorMessage(e)}`);\n  }\n}\n\nfunction tryProcessResponse(span: TracingSpan, response: PipelineResponse): void {\n  try {\n    span.setAttribute(\"http.status_code\", response.status);\n    const serviceRequestId = response.headers.get(\"x-ms-request-id\");\n    if (serviceRequestId) {\n      span.setAttribute(\"serviceRequestId\", serviceRequestId);\n    }\n    span.setStatus({\n      status: \"success\",\n    });\n    span.end();\n  } catch (e: any) {\n    logger.warning(`Skipping tracing span processing due to an error: ${getErrorMessage(e)}`);\n  }\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { type LogPolicyOptions, logPolicy } from \"./policies/logPolicy.js\";\nimport { type Pipeline, createEmptyPipeline } from \"./pipeline.js\";\nimport type { PipelineRetryOptions, TlsSettings, ProxySettings } from \"./interfaces.js\";\nimport { type RedirectPolicyOptions, redirectPolicy } from \"./policies/redirectPolicy.js\";\nimport { type UserAgentPolicyOptions, userAgentPolicy } from \"./policies/userAgentPolicy.js\";\nimport { multipartPolicy, multipartPolicyName } from \"./policies/multipartPolicy.js\";\nimport { decompressResponsePolicy } from \"./policies/decompressResponsePolicy.js\";\nimport { defaultRetryPolicy } from \"./policies/defaultRetryPolicy.js\";\nimport { formDataPolicy } from \"./policies/formDataPolicy.js\";\nimport { isNodeLike } from \"@azure/core-util\";\nimport { proxyPolicy } from \"./policies/proxyPolicy.js\";\nimport { setClientRequestIdPolicy } from \"./policies/setClientRequestIdPolicy.js\";\nimport { tlsPolicy } from \"./policies/tlsPolicy.js\";\nimport { tracingPolicy } from \"./policies/tracingPolicy.js\";\n\n/**\n * Defines options that are used to configure the HTTP pipeline for\n * an SDK client.\n */\nexport interface PipelineOptions {\n  /**\n   * Options that control how to retry failed requests.\n   */\n  retryOptions?: PipelineRetryOptions;\n\n  /**\n   * Options to configure a proxy for outgoing requests.\n   */\n  proxyOptions?: ProxySettings;\n\n  /** Options for configuring TLS authentication */\n  tlsOptions?: TlsSettings;\n\n  /**\n   * Options for how redirect responses are handled.\n   */\n  redirectOptions?: RedirectPolicyOptions;\n\n  /**\n   * Options for adding user agent details to outgoing requests.\n   */\n  userAgentOptions?: UserAgentPolicyOptions;\n\n  /**\n   * Options for setting common telemetry and tracing info to outgoing requests.\n   */\n  telemetryOptions?: TelemetryOptions;\n}\n\n/**\n * Defines options that are used to configure common telemetry and tracing info\n */\nexport interface TelemetryOptions {\n  /**\n   * The name of the header to pass the request ID to.\n   */\n  clientRequestIdHeaderName?: string;\n}\n\n/**\n * Defines options that are used to configure internal options of\n * the HTTP pipeline for an SDK client.\n */\nexport interface InternalPipelineOptions extends PipelineOptions {\n  /**\n   * Options to configure request/response logging.\n   */\n  loggingOptions?: LogPolicyOptions;\n}\n\n/**\n * Create a new pipeline with a default set of customizable policies.\n * @param options - Options to configure a custom pipeline.\n */\nexport function createPipelineFromOptions(options: InternalPipelineOptions): Pipeline {\n  const pipeline = createEmptyPipeline();\n\n  if (isNodeLike) {\n    if (options.tlsOptions) {\n      pipeline.addPolicy(tlsPolicy(options.tlsOptions));\n    }\n    pipeline.addPolicy(proxyPolicy(options.proxyOptions));\n    pipeline.addPolicy(decompressResponsePolicy());\n  }\n\n  pipeline.addPolicy(formDataPolicy(), { beforePolicies: [multipartPolicyName] });\n  pipeline.addPolicy(userAgentPolicy(options.userAgentOptions));\n  pipeline.addPolicy(setClientRequestIdPolicy(options.telemetryOptions?.clientRequestIdHeaderName));\n  // The multipart policy is added after policies with no phase, so that\n  // policies can be added between it and formDataPolicy to modify\n  // properties (e.g., making the boundary constant in recorded tests).\n  pipeline.addPolicy(multipartPolicy(), { afterPhase: \"Deserialize\" });\n  pipeline.addPolicy(defaultRetryPolicy(options.retryOptions), { phase: \"Retry\" });\n  pipeline.addPolicy(tracingPolicy({ ...options.userAgentOptions, ...options.loggingOptions }), {\n    afterPhase: \"Retry\",\n  });\n  if (isNodeLike) {\n    // Both XHR and Fetch expect to handle redirects automatically,\n    // so only include this policy when we're in Node.\n    pipeline.addPolicy(redirectPolicy(options.redirectOptions), { afterPhase: \"Retry\" });\n  }\n  pipeline.addPolicy(logPolicy(options.loggingOptions), { afterPhase: \"Sign\" });\n\n  return pipeline;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport * as http from \"node:http\";\nimport * as https from \"node:https\";\nimport * as zlib from \"node:zlib\";\nimport { Transform } from \"node:stream\";\nimport { AbortError } from \"@azure/abort-controller\";\nimport type {\n  HttpClient,\n  HttpHeaders,\n  PipelineRequest,\n  PipelineResponse,\n  RequestBodyType,\n  TlsSettings,\n  TransferProgressEvent,\n} from \"./interfaces.js\";\nimport { createHttpHeaders } from \"./httpHeaders.js\";\nimport { RestError } from \"./restError.js\";\nimport type { IncomingMessage } from \"node:http\";\nimport { logger } from \"./log.js\";\n\nconst DEFAULT_TLS_SETTINGS = {};\n\nfunction isReadableStream(body: any): body is NodeJS.ReadableStream {\n  return body && typeof body.pipe === \"function\";\n}\n\nfunction isStreamComplete(stream: NodeJS.ReadableStream): Promise<void> {\n  return new Promise((resolve) => {\n    const handler = (): void => {\n      resolve();\n      stream.removeListener(\"close\", handler);\n      stream.removeListener(\"end\", handler);\n      stream.removeListener(\"error\", handler);\n    };\n\n    stream.on(\"close\", handler);\n    stream.on(\"end\", handler);\n    stream.on(\"error\", handler);\n  });\n}\n\nfunction isArrayBuffer(body: any): body is ArrayBuffer | ArrayBufferView {\n  return body && typeof body.byteLength === \"number\";\n}\n\nclass ReportTransform extends Transform {\n  private loadedBytes = 0;\n  private progressCallback: (progress: TransferProgressEvent) => void;\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  _transform(chunk: string | Buffer, _encoding: string, callback: Function): void {\n    this.push(chunk);\n    this.loadedBytes += chunk.length;\n    try {\n      this.progressCallback({ loadedBytes: this.loadedBytes });\n      callback();\n    } catch (e: any) {\n      callback(e);\n    }\n  }\n\n  constructor(progressCallback: (progress: TransferProgressEvent) => void) {\n    super();\n    this.progressCallback = progressCallback;\n  }\n}\n\n/**\n * A HttpClient implementation that uses Node's \"https\" module to send HTTPS requests.\n * @internal\n */\nclass NodeHttpClient implements HttpClient {\n  private cachedHttpAgent?: http.Agent;\n  private cachedHttpsAgents: WeakMap<TlsSettings, https.Agent> = new WeakMap();\n\n  /**\n   * Makes a request over an underlying transport layer and returns the response.\n   * @param request - The request to be made.\n   */\n  public async sendRequest(request: PipelineRequest): Promise<PipelineResponse> {\n    const abortController = new AbortController();\n    let abortListener: ((event: any) => void) | undefined;\n    if (request.abortSignal) {\n      if (request.abortSignal.aborted) {\n        throw new AbortError(\"The operation was aborted.\");\n      }\n\n      abortListener = (event: Event) => {\n        if (event.type === \"abort\") {\n          abortController.abort();\n        }\n      };\n      request.abortSignal.addEventListener(\"abort\", abortListener);\n    }\n\n    if (request.timeout > 0) {\n      setTimeout(() => {\n        abortController.abort();\n      }, request.timeout);\n    }\n\n    const acceptEncoding = request.headers.get(\"Accept-Encoding\");\n    const shouldDecompress =\n      acceptEncoding?.includes(\"gzip\") || acceptEncoding?.includes(\"deflate\");\n\n    let body = typeof request.body === \"function\" ? request.body() : request.body;\n    if (body && !request.headers.has(\"Content-Length\")) {\n      const bodyLength = getBodyLength(body);\n      if (bodyLength !== null) {\n        request.headers.set(\"Content-Length\", bodyLength);\n      }\n    }\n\n    let responseStream: NodeJS.ReadableStream | undefined;\n    try {\n      if (body && request.onUploadProgress) {\n        const onUploadProgress = request.onUploadProgress;\n        const uploadReportStream = new ReportTransform(onUploadProgress);\n        uploadReportStream.on(\"error\", (e) => {\n          logger.error(\"Error in upload progress\", e);\n        });\n        if (isReadableStream(body)) {\n          body.pipe(uploadReportStream);\n        } else {\n          uploadReportStream.end(body);\n        }\n\n        body = uploadReportStream;\n      }\n\n      const res = await this.makeRequest(request, abortController, body);\n\n      const headers = getResponseHeaders(res);\n\n      const status = res.statusCode ?? 0;\n      const response: PipelineResponse = {\n        status,\n        headers,\n        request,\n      };\n\n      // Responses to HEAD must not have a body.\n      // If they do return a body, that body must be ignored.\n      if (request.method === \"HEAD\") {\n        // call resume() and not destroy() to avoid closing the socket\n        // and losing keep alive\n        res.resume();\n        return response;\n      }\n\n      responseStream = shouldDecompress ? getDecodedResponseStream(res, headers) : res;\n\n      const onDownloadProgress = request.onDownloadProgress;\n      if (onDownloadProgress) {\n        const downloadReportStream = new ReportTransform(onDownloadProgress);\n        downloadReportStream.on(\"error\", (e) => {\n          logger.error(\"Error in download progress\", e);\n        });\n        responseStream.pipe(downloadReportStream);\n        responseStream = downloadReportStream;\n      }\n\n      if (\n        // Value of POSITIVE_INFINITY in streamResponseStatusCodes is considered as any status code\n        request.streamResponseStatusCodes?.has(Number.POSITIVE_INFINITY) ||\n        request.streamResponseStatusCodes?.has(response.status)\n      ) {\n        response.readableStreamBody = responseStream;\n      } else {\n        response.bodyAsText = await streamToText(responseStream);\n      }\n\n      return response;\n    } finally {\n      // clean up event listener\n      if (request.abortSignal && abortListener) {\n        let uploadStreamDone = Promise.resolve();\n        if (isReadableStream(body)) {\n          uploadStreamDone = isStreamComplete(body);\n        }\n        let downloadStreamDone = Promise.resolve();\n        if (isReadableStream(responseStream)) {\n          downloadStreamDone = isStreamComplete(responseStream);\n        }\n\n        Promise.all([uploadStreamDone, downloadStreamDone])\n          .then(() => {\n            // eslint-disable-next-line promise/always-return\n            if (abortListener) {\n              request.abortSignal?.removeEventListener(\"abort\", abortListener);\n            }\n          })\n          .catch((e) => {\n            logger.warning(\"Error when cleaning up abortListener on httpRequest\", e);\n          });\n      }\n    }\n  }\n\n  private makeRequest(\n    request: PipelineRequest,\n    abortController: AbortController,\n    body?: RequestBodyType,\n  ): Promise<http.IncomingMessage> {\n    const url = new URL(request.url);\n\n    const isInsecure = url.protocol !== \"https:\";\n\n    if (isInsecure && !request.allowInsecureConnection) {\n      throw new Error(`Cannot connect to ${request.url} while allowInsecureConnection is false.`);\n    }\n\n    const agent = (request.agent as http.Agent) ?? this.getOrCreateAgent(request, isInsecure);\n    const options: http.RequestOptions = {\n      agent,\n      hostname: url.hostname,\n      path: `${url.pathname}${url.search}`,\n      port: url.port,\n      method: request.method,\n      headers: request.headers.toJSON({ preserveCase: true }),\n    };\n\n    return new Promise<http.IncomingMessage>((resolve, reject) => {\n      const req = isInsecure ? http.request(options, resolve) : https.request(options, resolve);\n\n      req.once(\"error\", (err: Error & { code?: string }) => {\n        reject(\n          new RestError(err.message, { code: err.code ?? RestError.REQUEST_SEND_ERROR, request }),\n        );\n      });\n\n      abortController.signal.addEventListener(\"abort\", () => {\n        const abortError = new AbortError(\"The operation was aborted.\");\n        req.destroy(abortError);\n        reject(abortError);\n      });\n      if (body && isReadableStream(body)) {\n        body.pipe(req);\n      } else if (body) {\n        if (typeof body === \"string\" || Buffer.isBuffer(body)) {\n          req.end(body);\n        } else if (isArrayBuffer(body)) {\n          req.end(ArrayBuffer.isView(body) ? Buffer.from(body.buffer) : Buffer.from(body));\n        } else {\n          logger.error(\"Unrecognized body type\", body);\n          reject(new RestError(\"Unrecognized body type\"));\n        }\n      } else {\n        // streams don't like \"undefined\" being passed as data\n        req.end();\n      }\n    });\n  }\n\n  private getOrCreateAgent(request: PipelineRequest, isInsecure: boolean): http.Agent {\n    const disableKeepAlive = request.disableKeepAlive;\n\n    // Handle Insecure requests first\n    if (isInsecure) {\n      if (disableKeepAlive) {\n        // keepAlive:false is the default so we don't need a custom Agent\n        return http.globalAgent;\n      }\n\n      if (!this.cachedHttpAgent) {\n        // If there is no cached agent create a new one and cache it.\n        this.cachedHttpAgent = new http.Agent({ keepAlive: true });\n      }\n      return this.cachedHttpAgent;\n    } else {\n      if (disableKeepAlive && !request.tlsSettings) {\n        // When there are no tlsSettings and keepAlive is false\n        // we don't need a custom agent\n        return https.globalAgent;\n      }\n\n      // We use the tlsSettings to index cached clients\n      const tlsSettings = request.tlsSettings ?? DEFAULT_TLS_SETTINGS;\n\n      // Get the cached agent or create a new one with the\n      // provided values for keepAlive and tlsSettings\n      let agent = this.cachedHttpsAgents.get(tlsSettings);\n\n      if (agent && agent.options.keepAlive === !disableKeepAlive) {\n        return agent;\n      }\n\n      logger.info(\"No cached TLS Agent exist, creating a new Agent\");\n      agent = new https.Agent({\n        // keepAlive is true if disableKeepAlive is false.\n        keepAlive: !disableKeepAlive,\n        // Since we are spreading, if no tslSettings were provided, nothing is added to the agent options.\n        ...tlsSettings,\n      });\n\n      this.cachedHttpsAgents.set(tlsSettings, agent);\n      return agent;\n    }\n  }\n}\n\nfunction getResponseHeaders(res: IncomingMessage): HttpHeaders {\n  const headers = createHttpHeaders();\n  for (const header of Object.keys(res.headers)) {\n    const value = res.headers[header];\n    if (Array.isArray(value)) {\n      if (value.length > 0) {\n        headers.set(header, value[0]);\n      }\n    } else if (value) {\n      headers.set(header, value);\n    }\n  }\n  return headers;\n}\n\nfunction getDecodedResponseStream(\n  stream: IncomingMessage,\n  headers: HttpHeaders,\n): NodeJS.ReadableStream {\n  const contentEncoding = headers.get(\"Content-Encoding\");\n  if (contentEncoding === \"gzip\") {\n    const unzip = zlib.createGunzip();\n    stream.pipe(unzip);\n    return unzip;\n  } else if (contentEncoding === \"deflate\") {\n    const inflate = zlib.createInflate();\n    stream.pipe(inflate);\n    return inflate;\n  }\n\n  return stream;\n}\n\nfunction streamToText(stream: NodeJS.ReadableStream): Promise<string> {\n  return new Promise<string>((resolve, reject) => {\n    const buffer: Buffer[] = [];\n\n    stream.on(\"data\", (chunk) => {\n      if (Buffer.isBuffer(chunk)) {\n        buffer.push(chunk);\n      } else {\n        buffer.push(Buffer.from(chunk));\n      }\n    });\n    stream.on(\"end\", () => {\n      resolve(Buffer.concat(buffer).toString(\"utf8\"));\n    });\n    stream.on(\"error\", (e) => {\n      if (e && e?.name === \"AbortError\") {\n        reject(e);\n      } else {\n        reject(\n          new RestError(`Error reading response as text: ${e.message}`, {\n            code: RestError.PARSE_ERROR,\n          }),\n        );\n      }\n    });\n  });\n}\n\n/** @internal */\nexport function getBodyLength(body: RequestBodyType): number | null {\n  if (!body) {\n    return 0;\n  } else if (Buffer.isBuffer(body)) {\n    return body.length;\n  } else if (isReadableStream(body)) {\n    return null;\n  } else if (isArrayBuffer(body)) {\n    return body.byteLength;\n  } else if (typeof body === \"string\") {\n    return Buffer.from(body).length;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Create a new HttpClient instance for the NodeJS environment.\n * @internal\n */\nexport function createNodeHttpClient(): HttpClient {\n  return new NodeHttpClient();\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { HttpClient } from \"./interfaces.js\";\nimport { createNodeHttpClient } from \"./nodeHttpClient.js\";\n\n/**\n * Create the correct HttpClient for the current environment.\n */\nexport function createDefaultHttpClient(): HttpClient {\n  return createNodeHttpClient();\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type {\n  FormDataMap,\n  HttpHeaders,\n  HttpMethods,\n  MultipartRequestBody,\n  PipelineRequest,\n  ProxySettings,\n  RequestBodyType,\n  TransferProgressEvent,\n} from \"./interfaces.js\";\nimport { createHttpHeaders } from \"./httpHeaders.js\";\nimport type { AbortSignalLike } from \"@azure/abort-controller\";\nimport { randomUUID } from \"@azure/core-util\";\nimport type { OperationTracingOptions } from \"@azure/core-tracing\";\n\n/**\n * Settings to initialize a request.\n * Almost equivalent to Partial<PipelineRequest>, but url is mandatory.\n */\nexport interface PipelineRequestOptions {\n  /**\n   * The URL to make the request to.\n   */\n  url: string;\n\n  /**\n   * The HTTP method to use when making the request.\n   */\n  method?: HttpMethods;\n\n  /**\n   * The HTTP headers to use when making the request.\n   */\n  headers?: HttpHeaders;\n\n  /**\n   * The number of milliseconds a request can take before automatically being terminated.\n   * If the request is terminated, an `AbortError` is thrown.\n   * Defaults to 0, which disables the timeout.\n   */\n  timeout?: number;\n\n  /**\n   * If credentials (cookies) should be sent along during an XHR.\n   * Defaults to false.\n   */\n  withCredentials?: boolean;\n\n  /**\n   * A unique identifier for the request. Used for logging and tracing.\n   */\n  requestId?: string;\n\n  /**\n   * The HTTP body content (if any)\n   */\n  body?: RequestBodyType;\n\n  /**\n   * Body for a multipart request.\n   */\n  multipartBody?: MultipartRequestBody;\n\n  /**\n   * To simulate a browser form post\n   */\n  formData?: FormDataMap;\n\n  /**\n   * A list of response status codes whose corresponding PipelineResponse body should be treated as a stream.\n   */\n  streamResponseStatusCodes?: Set<number>;\n\n  /**\n   * BROWSER ONLY\n   *\n   * A browser only option to enable use of the Streams API. If this option is set and streaming is used\n   * (see `streamResponseStatusCodes`), the response will have a property `browserStream` instead of\n   * `blobBody` which will be undefined.\n   *\n   * Default value is false\n   */\n  enableBrowserStreams?: boolean;\n\n  /**\n   * Proxy configuration.\n   */\n  proxySettings?: ProxySettings;\n\n  /**\n   * If the connection should not be reused.\n   */\n  disableKeepAlive?: boolean;\n\n  /**\n   * Used to abort the request later.\n   */\n  abortSignal?: AbortSignalLike;\n\n  /**\n   * Options used to create a span when tracing is enabled.\n   */\n  tracingOptions?: OperationTracingOptions;\n\n  /**\n   * Callback which fires upon upload progress.\n   */\n  onUploadProgress?: (progress: TransferProgressEvent) => void;\n\n  /** Callback which fires upon download progress. */\n  onDownloadProgress?: (progress: TransferProgressEvent) => void;\n\n  /** Set to true if the request is sent over HTTP instead of HTTPS */\n  allowInsecureConnection?: boolean;\n}\n\nclass PipelineRequestImpl implements PipelineRequest {\n  public url: string;\n  public method: HttpMethods;\n  public headers: HttpHeaders;\n  public timeout: number;\n  public withCredentials: boolean;\n  public body?: RequestBodyType;\n  public multipartBody?: MultipartRequestBody;\n  public formData?: FormDataMap;\n  public streamResponseStatusCodes?: Set<number>;\n  public enableBrowserStreams: boolean;\n\n  public proxySettings?: ProxySettings;\n  public disableKeepAlive: boolean;\n  public abortSignal?: AbortSignalLike;\n  public requestId: string;\n  public tracingOptions?: OperationTracingOptions;\n  public allowInsecureConnection?: boolean;\n  public onUploadProgress?: (progress: TransferProgressEvent) => void;\n  public onDownloadProgress?: (progress: TransferProgressEvent) => void;\n\n  constructor(options: PipelineRequestOptions) {\n    this.url = options.url;\n    this.body = options.body;\n    this.headers = options.headers ?? createHttpHeaders();\n    this.method = options.method ?? \"GET\";\n    this.timeout = options.timeout ?? 0;\n    this.multipartBody = options.multipartBody;\n    this.formData = options.formData;\n    this.disableKeepAlive = options.disableKeepAlive ?? false;\n    this.proxySettings = options.proxySettings;\n    this.streamResponseStatusCodes = options.streamResponseStatusCodes;\n    this.withCredentials = options.withCredentials ?? false;\n    this.abortSignal = options.abortSignal;\n    this.tracingOptions = options.tracingOptions;\n    this.onUploadProgress = options.onUploadProgress;\n    this.onDownloadProgress = options.onDownloadProgress;\n    this.requestId = options.requestId || randomUUID();\n    this.allowInsecureConnection = options.allowInsecureConnection ?? false;\n    this.enableBrowserStreams = options.enableBrowserStreams ?? false;\n  }\n}\n\n/**\n * Creates a new pipeline request with the given options.\n * This method is to allow for the easy setting of default values and not required.\n * @param options - The options to create the request with.\n */\nexport function createPipelineRequest(options: PipelineRequestOptions): PipelineRequest {\n  return new PipelineRequestImpl(options);\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { exponentialRetryStrategy } from \"../retryStrategies/exponentialRetryStrategy.js\";\nimport { retryPolicy } from \"./retryPolicy.js\";\nimport { DEFAULT_RETRY_POLICY_COUNT } from \"../constants.js\";\n\n/**\n * The programmatic identifier of the exponentialRetryPolicy.\n */\nexport const exponentialRetryPolicyName = \"exponentialRetryPolicy\";\n\n/**\n * Options that control how to retry failed requests.\n */\nexport interface ExponentialRetryPolicyOptions {\n  /**\n   * The maximum number of retry attempts. Defaults to 3.\n   */\n  maxRetries?: number;\n\n  /**\n   * The amount of delay in milliseconds between retry attempts. Defaults to 1000\n   * (1 second.) The delay increases exponentially with each retry up to a maximum\n   * specified by maxRetryDelayInMs.\n   */\n  retryDelayInMs?: number;\n\n  /**\n   * The maximum delay in milliseconds allowed before retrying an operation. Defaults\n   * to 64000 (64 seconds).\n   */\n  maxRetryDelayInMs?: number;\n}\n\n/**\n * A policy that attempts to retry requests while introducing an exponentially increasing delay.\n * @param options - Options that configure retry logic.\n */\nexport function exponentialRetryPolicy(\n  options: ExponentialRetryPolicyOptions = {},\n): PipelinePolicy {\n  return retryPolicy(\n    [\n      exponentialRetryStrategy({\n        ...options,\n        ignoreSystemErrors: true,\n      }),\n    ],\n    {\n      maxRetries: options.maxRetries ?? DEFAULT_RETRY_POLICY_COUNT,\n    },\n  );\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { exponentialRetryStrategy } from \"../retryStrategies/exponentialRetryStrategy.js\";\nimport { retryPolicy } from \"./retryPolicy.js\";\nimport { DEFAULT_RETRY_POLICY_COUNT } from \"../constants.js\";\n\n/**\n * Name of the {@link systemErrorRetryPolicy}\n */\nexport const systemErrorRetryPolicyName = \"systemErrorRetryPolicy\";\n\n/**\n * Options that control how to retry failed requests.\n */\nexport interface SystemErrorRetryPolicyOptions {\n  /**\n   * The maximum number of retry attempts. Defaults to 3.\n   */\n  maxRetries?: number;\n\n  /**\n   * The amount of delay in milliseconds between retry attempts. Defaults to 1000\n   * (1 second.) The delay increases exponentially with each retry up to a maximum\n   * specified by maxRetryDelayInMs.\n   */\n  retryDelayInMs?: number;\n\n  /**\n   * The maximum delay in milliseconds allowed before retrying an operation. Defaults\n   * to 64000 (64 seconds).\n   */\n  maxRetryDelayInMs?: number;\n}\n\n/**\n * A retry policy that specifically seeks to handle errors in the\n * underlying transport layer (e.g. DNS lookup failures) rather than\n * retryable error codes from the server itself.\n * @param options - Options that customize the policy.\n */\nexport function systemErrorRetryPolicy(\n  options: SystemErrorRetryPolicyOptions = {},\n): PipelinePolicy {\n  return {\n    name: systemErrorRetryPolicyName,\n    sendRequest: retryPolicy(\n      [\n        exponentialRetryStrategy({\n          ...options,\n          ignoreHttpStatusCodes: true,\n        }),\n      ],\n      {\n        maxRetries: options.maxRetries ?? DEFAULT_RETRY_POLICY_COUNT,\n      },\n    ).sendRequest,\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { throttlingRetryStrategy } from \"../retryStrategies/throttlingRetryStrategy.js\";\nimport { retryPolicy } from \"./retryPolicy.js\";\nimport { DEFAULT_RETRY_POLICY_COUNT } from \"../constants.js\";\n\n/**\n * Name of the {@link throttlingRetryPolicy}\n */\nexport const throttlingRetryPolicyName = \"throttlingRetryPolicy\";\n\n/**\n * Options that control how to retry failed requests.\n */\nexport interface ThrottlingRetryPolicyOptions {\n  /**\n   * The maximum number of retry attempts. Defaults to 3.\n   */\n  maxRetries?: number;\n}\n\n/**\n * A policy that retries when the server sends a 429 response with a Retry-After header.\n *\n * To learn more, please refer to\n * https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-request-limits,\n * https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits and\n * https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/troubleshooting-throttling-errors\n *\n * @param options - Options that configure retry logic.\n */\nexport function throttlingRetryPolicy(options: ThrottlingRetryPolicyOptions = {}): PipelinePolicy {\n  return {\n    name: throttlingRetryPolicyName,\n    sendRequest: retryPolicy([throttlingRetryStrategy()], {\n      maxRetries: options.maxRetries ?? DEFAULT_RETRY_POLICY_COUNT,\n    }).sendRequest,\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { AccessToken, GetTokenOptions, TokenCredential } from \"@azure/core-auth\";\nimport { delay } from \"./helpers.js\";\n\n/**\n * A function that gets a promise of an access token and allows providing\n * options.\n *\n * @param options - the options to pass to the underlying token provider\n */\nexport type AccessTokenGetter = (\n  scopes: string | string[],\n  options: GetTokenOptions,\n) => Promise<AccessToken>;\n\nexport interface TokenCyclerOptions {\n  /**\n   * The window of time before token expiration during which the token will be\n   * considered unusable due to risk of the token expiring before sending the\n   * request.\n   *\n   * This will only become meaningful if the refresh fails for over\n   * (refreshWindow - forcedRefreshWindow) milliseconds.\n   */\n  forcedRefreshWindowInMs: number;\n  /**\n   * Interval in milliseconds to retry failed token refreshes.\n   */\n  retryIntervalInMs: number;\n  /**\n   * The window of time before token expiration during which\n   * we will attempt to refresh the token.\n   */\n  refreshWindowInMs: number;\n}\n\n// Default options for the cycler if none are provided\nexport const DEFAULT_CYCLER_OPTIONS: TokenCyclerOptions = {\n  forcedRefreshWindowInMs: 1000, // Force waiting for a refresh 1s before the token expires\n  retryIntervalInMs: 3000, // Allow refresh attempts every 3s\n  refreshWindowInMs: 1000 * 60 * 2, // Start refreshing 2m before expiry\n};\n\n/**\n * Converts an an unreliable access token getter (which may resolve with null)\n * into an AccessTokenGetter by retrying the unreliable getter in a regular\n * interval.\n *\n * @param getAccessToken - A function that produces a promise of an access token that may fail by returning null.\n * @param retryIntervalInMs - The time (in milliseconds) to wait between retry attempts.\n * @param refreshTimeout - The timestamp after which the refresh attempt will fail, throwing an exception.\n * @returns - A promise that, if it resolves, will resolve with an access token.\n */\nasync function beginRefresh(\n  getAccessToken: () => Promise<AccessToken | null>,\n  retryIntervalInMs: number,\n  refreshTimeout: number,\n): Promise<AccessToken> {\n  // This wrapper handles exceptions gracefully as long as we haven't exceeded\n  // the timeout.\n  async function tryGetAccessToken(): Promise<AccessToken | null> {\n    if (Date.now() < refreshTimeout) {\n      try {\n        return await getAccessToken();\n      } catch {\n        return null;\n      }\n    } else {\n      const finalToken = await getAccessToken();\n\n      // Timeout is up, so throw if it's still null\n      if (finalToken === null) {\n        throw new Error(\"Failed to refresh access token.\");\n      }\n\n      return finalToken;\n    }\n  }\n\n  let token: AccessToken | null = await tryGetAccessToken();\n\n  while (token === null) {\n    await delay(retryIntervalInMs);\n\n    token = await tryGetAccessToken();\n  }\n\n  return token;\n}\n\n/**\n * Creates a token cycler from a credential, scopes, and optional settings.\n *\n * A token cycler represents a way to reliably retrieve a valid access token\n * from a TokenCredential. It will handle initializing the token, refreshing it\n * when it nears expiration, and synchronizes refresh attempts to avoid\n * concurrency hazards.\n *\n * @param credential - the underlying TokenCredential that provides the access\n * token\n * @param tokenCyclerOptions - optionally override default settings for the cycler\n *\n * @returns - a function that reliably produces a valid access token\n */\nexport function createTokenCycler(\n  credential: TokenCredential,\n  tokenCyclerOptions?: Partial<TokenCyclerOptions>,\n): AccessTokenGetter {\n  let refreshWorker: Promise<AccessToken> | null = null;\n  let token: AccessToken | null = null;\n  let tenantId: string | undefined;\n\n  const options = {\n    ...DEFAULT_CYCLER_OPTIONS,\n    ...tokenCyclerOptions,\n  };\n\n  /**\n   * This little holder defines several predicates that we use to construct\n   * the rules of refreshing the token.\n   */\n  const cycler = {\n    /**\n     * Produces true if a refresh job is currently in progress.\n     */\n    get isRefreshing(): boolean {\n      return refreshWorker !== null;\n    },\n    /**\n     * Produces true if the cycler SHOULD refresh (we are within the refresh\n     * window and not already refreshing)\n     */\n    get shouldRefresh(): boolean {\n      if (cycler.isRefreshing) {\n        return false;\n      }\n      if (token?.refreshAfterTimestamp && token.refreshAfterTimestamp < Date.now()) {\n        return true;\n      }\n\n      return (token?.expiresOnTimestamp ?? 0) - options.refreshWindowInMs < Date.now();\n    },\n    /**\n     * Produces true if the cycler MUST refresh (null or nearly-expired\n     * token).\n     */\n    get mustRefresh(): boolean {\n      return (\n        token === null || token.expiresOnTimestamp - options.forcedRefreshWindowInMs < Date.now()\n      );\n    },\n  };\n\n  /**\n   * Starts a refresh job or returns the existing job if one is already\n   * running.\n   */\n  function refresh(\n    scopes: string | string[],\n    getTokenOptions: GetTokenOptions,\n  ): Promise<AccessToken> {\n    if (!cycler.isRefreshing) {\n      // We bind `scopes` here to avoid passing it around a lot\n      const tryGetAccessToken = (): Promise<AccessToken | null> =>\n        credential.getToken(scopes, getTokenOptions);\n\n      // Take advantage of promise chaining to insert an assignment to `token`\n      // before the refresh can be considered done.\n      refreshWorker = beginRefresh(\n        tryGetAccessToken,\n        options.retryIntervalInMs,\n        // If we don't have a token, then we should timeout immediately\n        token?.expiresOnTimestamp ?? Date.now(),\n      )\n        .then((_token) => {\n          refreshWorker = null;\n          token = _token;\n          tenantId = getTokenOptions.tenantId;\n          return token;\n        })\n        .catch((reason) => {\n          // We also should reset the refresher if we enter a failed state.  All\n          // existing awaiters will throw, but subsequent requests will start a\n          // new retry chain.\n          refreshWorker = null;\n          token = null;\n          tenantId = undefined;\n          throw reason;\n        });\n    }\n\n    return refreshWorker as Promise<AccessToken>;\n  }\n\n  return async (scopes: string | string[], tokenOptions: GetTokenOptions): Promise<AccessToken> => {\n    //\n    // Simple rules:\n    // - If we MUST refresh, then return the refresh task, blocking\n    //   the pipeline until a token is available.\n    // - If we SHOULD refresh, then run refresh but don't return it\n    //   (we can still use the cached token).\n    // - Return the token, since it's fine if we didn't return in\n    //   step 1.\n    //\n\n    const hasClaimChallenge = Boolean(tokenOptions.claims);\n    const tenantIdChanged = tenantId !== tokenOptions.tenantId;\n\n    if (hasClaimChallenge) {\n      // If we've received a claim, we know the existing token isn't valid\n      // We want to clear it so that that refresh worker won't use the old expiration time as a timeout\n      token = null;\n    }\n\n    // If the tenantId passed in token options is different to the one we have\n    // Or if we are in claim challenge and the token was rejected and a new access token need to be issued, we need to\n    // refresh the token with the new tenantId or token.\n    const mustRefresh = tenantIdChanged || hasClaimChallenge || cycler.mustRefresh;\n\n    if (mustRefresh) {\n      return refresh(scopes, tokenOptions);\n    }\n\n    if (cycler.shouldRefresh) {\n      refresh(scopes, tokenOptions);\n    }\n\n    return token as AccessToken;\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { AccessToken, GetTokenOptions, TokenCredential } from \"@azure/core-auth\";\nimport type { AzureLogger } from \"@azure/logger\";\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { createTokenCycler } from \"../util/tokenCycler.js\";\nimport { logger as coreLogger } from \"../log.js\";\n\n/**\n * The programmatic identifier of the bearerTokenAuthenticationPolicy.\n */\nexport const bearerTokenAuthenticationPolicyName = \"bearerTokenAuthenticationPolicy\";\n\n/**\n * Options sent to the authorizeRequest callback\n */\nexport interface AuthorizeRequestOptions {\n  /**\n   * The scopes for which the bearer token applies.\n   */\n  scopes: string[];\n  /**\n   * Function that retrieves either a cached access token or a new access token.\n   */\n  getAccessToken: (scopes: string[], options: GetTokenOptions) => Promise<AccessToken | null>;\n  /**\n   * Request that the policy is trying to fulfill.\n   */\n  request: PipelineRequest;\n  /**\n   * A logger, if one was sent through the HTTP pipeline.\n   */\n  logger?: AzureLogger;\n}\n\n/**\n * Options sent to the authorizeRequestOnChallenge callback\n */\nexport interface AuthorizeRequestOnChallengeOptions {\n  /**\n   * The scopes for which the bearer token applies.\n   */\n  scopes: string[];\n  /**\n   * Function that retrieves either a cached access token or a new access token.\n   */\n  getAccessToken: (scopes: string[], options: GetTokenOptions) => Promise<AccessToken | null>;\n  /**\n   * Request that the policy is trying to fulfill.\n   */\n  request: PipelineRequest;\n  /**\n   * Response containing the challenge.\n   */\n  response: PipelineResponse;\n  /**\n   * A logger, if one was sent through the HTTP pipeline.\n   */\n  logger?: AzureLogger;\n}\n\n/**\n * Options to override the processing of [Continuous Access Evaluation](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-continuous-access-evaluation) challenges.\n */\nexport interface ChallengeCallbacks {\n  /**\n   * Allows for the authorization of the main request of this policy before it's sent.\n   */\n  authorizeRequest?(options: AuthorizeRequestOptions): Promise<void>;\n  /**\n   * Allows to handle authentication challenges and to re-authorize the request.\n   * The response containing the challenge is `options.response`.\n   * If this method returns true, the underlying request will be sent once again.\n   * The request may be modified before being sent.\n   */\n  authorizeRequestOnChallenge?(options: AuthorizeRequestOnChallengeOptions): Promise<boolean>;\n}\n\n/**\n * Options to configure the bearerTokenAuthenticationPolicy\n */\nexport interface BearerTokenAuthenticationPolicyOptions {\n  /**\n   * The TokenCredential implementation that can supply the bearer token.\n   */\n  credential?: TokenCredential;\n  /**\n   * The scopes for which the bearer token applies.\n   */\n  scopes: string | string[];\n  /**\n   * Allows for the processing of [Continuous Access Evaluation](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-continuous-access-evaluation) challenges.\n   * If provided, it must contain at least the `authorizeRequestOnChallenge` method.\n   * If provided, after a request is sent, if it has a challenge, it can be processed to re-send the original request with the relevant challenge information.\n   */\n  challengeCallbacks?: ChallengeCallbacks;\n  /**\n   * A logger can be sent for debugging purposes.\n   */\n  logger?: AzureLogger;\n}\n\n/**\n * Default authorize request handler\n */\nasync function defaultAuthorizeRequest(options: AuthorizeRequestOptions): Promise<void> {\n  const { scopes, getAccessToken, request } = options;\n  const getTokenOptions: GetTokenOptions = {\n    abortSignal: request.abortSignal,\n    tracingOptions: request.tracingOptions,\n  };\n  const accessToken = await getAccessToken(scopes, getTokenOptions);\n\n  if (accessToken) {\n    options.request.headers.set(\"Authorization\", `Bearer ${accessToken.token}`);\n  }\n}\n\n/**\n * We will retrieve the challenge only if the response status code was 401,\n * and if the response contained the header \"WWW-Authenticate\" with a non-empty value.\n */\nfunction getChallenge(response: PipelineResponse): string | undefined {\n  const challenge = response.headers.get(\"WWW-Authenticate\");\n  if (response.status === 401 && challenge) {\n    return challenge;\n  }\n  return;\n}\n\n/**\n * A policy that can request a token from a TokenCredential implementation and\n * then apply it to the Authorization header of a request as a Bearer token.\n */\nexport function bearerTokenAuthenticationPolicy(\n  options: BearerTokenAuthenticationPolicyOptions,\n): PipelinePolicy {\n  const { credential, scopes, challengeCallbacks } = options;\n  const logger = options.logger || coreLogger;\n  const callbacks = {\n    authorizeRequest: challengeCallbacks?.authorizeRequest ?? defaultAuthorizeRequest,\n    authorizeRequestOnChallenge: challengeCallbacks?.authorizeRequestOnChallenge,\n    // keep all other properties\n    ...challengeCallbacks,\n  };\n\n  // This function encapsulates the entire process of reliably retrieving the token\n  // The options are left out of the public API until there's demand to configure this.\n  // Remember to extend `BearerTokenAuthenticationPolicyOptions` with `TokenCyclerOptions`\n  // in order to pass through the `options` object.\n  const getAccessToken = credential\n    ? createTokenCycler(credential /* , options */)\n    : () => Promise.resolve(null);\n\n  return {\n    name: bearerTokenAuthenticationPolicyName,\n    /**\n     * If there's no challenge parameter:\n     * - It will try to retrieve the token using the cache, or the credential's getToken.\n     * - Then it will try the next policy with or without the retrieved token.\n     *\n     * It uses the challenge parameters to:\n     * - Skip a first attempt to get the token from the credential if there's no cached token,\n     *   since it expects the token to be retrievable only after the challenge.\n     * - Prepare the outgoing request if the `prepareRequest` method has been provided.\n     * - Send an initial request to receive the challenge if it fails.\n     * - Process a challenge if the response contains it.\n     * - Retrieve a token with the challenge information, then re-send the request.\n     */\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!request.url.toLowerCase().startsWith(\"https://\")) {\n        throw new Error(\n          \"Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.\",\n        );\n      }\n\n      await callbacks.authorizeRequest({\n        scopes: Array.isArray(scopes) ? scopes : [scopes],\n        request,\n        getAccessToken,\n        logger,\n      });\n\n      let response: PipelineResponse;\n      let error: Error | undefined;\n      try {\n        response = await next(request);\n      } catch (err: any) {\n        error = err;\n        response = err.response;\n      }\n\n      if (\n        callbacks.authorizeRequestOnChallenge &&\n        response?.status === 401 &&\n        getChallenge(response)\n      ) {\n        // processes challenge\n        const shouldSendRequest = await callbacks.authorizeRequestOnChallenge({\n          scopes: Array.isArray(scopes) ? scopes : [scopes],\n          request,\n          response,\n          getAccessToken,\n          logger,\n        });\n\n        if (shouldSendRequest) {\n          return next(request);\n        }\n      }\n\n      if (error) {\n        throw error;\n      } else {\n        return response;\n      }\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\n\n/**\n * The programmatic identifier of the ndJsonPolicy.\n */\nexport const ndJsonPolicyName = \"ndJsonPolicy\";\n\n/**\n * ndJsonPolicy is a policy used to control keep alive settings for every request.\n */\nexport function ndJsonPolicy(): PipelinePolicy {\n  return {\n    name: ndJsonPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      // There currently isn't a good way to bypass the serializer\n      if (typeof request.body === \"string\" && request.body.startsWith(\"[\")) {\n        const body = JSON.parse(request.body);\n        if (Array.isArray(body)) {\n          request.body = body.map((item) => JSON.stringify(item) + \"\\n\").join(\"\");\n        }\n      }\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { GetTokenOptions, TokenCredential } from \"@azure/core-auth\";\nimport type { AzureLogger } from \"@azure/logger\";\nimport type { PipelineRequest, PipelineResponse, SendRequest } from \"../interfaces.js\";\nimport type { PipelinePolicy } from \"../pipeline.js\";\nimport { type AccessTokenGetter, createTokenCycler } from \"../util/tokenCycler.js\";\nimport { logger as coreLogger } from \"../log.js\";\nimport type { AuthorizeRequestOptions } from \"./bearerTokenAuthenticationPolicy.js\";\n\n/**\n * The programmatic identifier of the auxiliaryAuthenticationHeaderPolicy.\n */\nexport const auxiliaryAuthenticationHeaderPolicyName = \"auxiliaryAuthenticationHeaderPolicy\";\nconst AUTHORIZATION_AUXILIARY_HEADER = \"x-ms-authorization-auxiliary\";\n\n/**\n * Options to configure the auxiliaryAuthenticationHeaderPolicy\n */\nexport interface AuxiliaryAuthenticationHeaderPolicyOptions {\n  /**\n   * TokenCredential list used to get token from auxiliary tenants and\n   * one credential for each tenant the client may need to access\n   */\n  credentials?: TokenCredential[];\n  /**\n   * Scopes depend on the cloud your application runs in\n   */\n  scopes: string | string[];\n  /**\n   * A logger can be sent for debugging purposes.\n   */\n  logger?: AzureLogger;\n}\n\nasync function sendAuthorizeRequest(options: AuthorizeRequestOptions): Promise<string> {\n  const { scopes, getAccessToken, request } = options;\n  const getTokenOptions: GetTokenOptions = {\n    abortSignal: request.abortSignal,\n    tracingOptions: request.tracingOptions,\n  };\n\n  return (await getAccessToken(scopes, getTokenOptions))?.token ?? \"\";\n}\n\n/**\n * A policy for external tokens to `x-ms-authorization-auxiliary` header.\n * This header will be used when creating a cross-tenant application we may need to handle authentication requests\n * for resources that are in different tenants.\n * You could see [ARM docs](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/authenticate-multi-tenant) for a rundown of how this feature works\n */\nexport function auxiliaryAuthenticationHeaderPolicy(\n  options: AuxiliaryAuthenticationHeaderPolicyOptions,\n): PipelinePolicy {\n  const { credentials, scopes } = options;\n  const logger = options.logger || coreLogger;\n  const tokenCyclerMap = new WeakMap<TokenCredential, AccessTokenGetter>();\n\n  return {\n    name: auxiliaryAuthenticationHeaderPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      if (!request.url.toLowerCase().startsWith(\"https://\")) {\n        throw new Error(\n          \"Bearer token authentication for auxiliary header is not permitted for non-TLS protected (non-https) URLs.\",\n        );\n      }\n      if (!credentials || credentials.length === 0) {\n        logger.info(\n          `${auxiliaryAuthenticationHeaderPolicyName} header will not be set due to empty credentials.`,\n        );\n        return next(request);\n      }\n\n      const tokenPromises: Promise<string>[] = [];\n      for (const credential of credentials) {\n        let getAccessToken = tokenCyclerMap.get(credential);\n        if (!getAccessToken) {\n          getAccessToken = createTokenCycler(credential);\n          tokenCyclerMap.set(credential, getAccessToken);\n        }\n        tokenPromises.push(\n          sendAuthorizeRequest({\n            scopes: Array.isArray(scopes) ? scopes : [scopes],\n            request,\n            getAccessToken,\n            logger,\n          }),\n        );\n      }\n      const auxiliaryTokens = (await Promise.all(tokenPromises)).filter((token) => Boolean(token));\n      if (auxiliaryTokens.length === 0) {\n        logger.warning(\n          `None of the auxiliary tokens are valid. ${AUTHORIZATION_AUXILIARY_HEADER} header will not be set.`,\n        );\n        return next(request);\n      }\n      request.headers.set(\n        AUTHORIZATION_AUXILIARY_HEADER,\n        auxiliaryTokens.map((token) => `Bearer ${token}`).join(\", \"),\n      );\n\n      return next(request);\n    },\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\ndeclare global {\n  interface FormData {}\n  interface Blob {}\n  interface File {}\n  interface ReadableStream<R = any> {}\n  interface TransformStream<I = any, O = any> {}\n}\n/* eslint-enable @typescript-eslint/no-unused-vars */\n\nexport type {\n  Agent,\n  BodyPart,\n  FormDataMap,\n  FormDataValue,\n  HttpClient,\n  HttpHeaders,\n  HttpMethods,\n  KeyObject,\n  MultipartRequestBody,\n  PipelineRequest,\n  PipelineResponse,\n  PipelineRetryOptions,\n  ProxySettings,\n  PxfObject,\n  RawHttpHeaders,\n  RawHttpHeadersInput,\n  RequestBodyType,\n  SendRequest,\n  TlsSettings,\n  TransferProgressEvent,\n} from \"./interfaces.js\";\nexport {\n  type AddPolicyOptions as AddPipelineOptions,\n  type PipelinePhase,\n  type PipelinePolicy,\n  type Pipeline,\n  createEmptyPipeline,\n} from \"./pipeline.js\";\nexport {\n  createPipelineFromOptions,\n  type TelemetryOptions,\n  type InternalPipelineOptions,\n  type PipelineOptions,\n} from \"./createPipelineFromOptions.js\";\nexport { createDefaultHttpClient } from \"./defaultHttpClient.js\";\nexport { createHttpHeaders } from \"./httpHeaders.js\";\nexport { createPipelineRequest, type PipelineRequestOptions } from \"./pipelineRequest.js\";\nexport { RestError, type RestErrorOptions, isRestError } from \"./restError.js\";\nexport {\n  decompressResponsePolicy,\n  decompressResponsePolicyName,\n} from \"./policies/decompressResponsePolicy.js\";\nexport {\n  exponentialRetryPolicy,\n  type ExponentialRetryPolicyOptions,\n  exponentialRetryPolicyName,\n} from \"./policies/exponentialRetryPolicy.js\";\nexport {\n  setClientRequestIdPolicy,\n  setClientRequestIdPolicyName,\n} from \"./policies/setClientRequestIdPolicy.js\";\nexport { logPolicy, logPolicyName, type LogPolicyOptions } from \"./policies/logPolicy.js\";\nexport { multipartPolicy, multipartPolicyName } from \"./policies/multipartPolicy.js\";\nexport { proxyPolicy, proxyPolicyName, getDefaultProxySettings } from \"./policies/proxyPolicy.js\";\nexport {\n  redirectPolicy,\n  redirectPolicyName,\n  type RedirectPolicyOptions,\n} from \"./policies/redirectPolicy.js\";\nexport {\n  systemErrorRetryPolicy,\n  type SystemErrorRetryPolicyOptions,\n  systemErrorRetryPolicyName,\n} from \"./policies/systemErrorRetryPolicy.js\";\nexport {\n  throttlingRetryPolicy,\n  throttlingRetryPolicyName,\n  type ThrottlingRetryPolicyOptions,\n} from \"./policies/throttlingRetryPolicy.js\";\nexport { retryPolicy, type RetryPolicyOptions } from \"./policies/retryPolicy.js\";\nexport type {\n  RetryStrategy,\n  RetryInformation,\n  RetryModifiers,\n} from \"./retryStrategies/retryStrategy.js\";\nexport {\n  tracingPolicy,\n  tracingPolicyName,\n  type TracingPolicyOptions,\n} from \"./policies/tracingPolicy.js\";\nexport {\n  defaultRetryPolicy,\n  type DefaultRetryPolicyOptions,\n} from \"./policies/defaultRetryPolicy.js\";\nexport {\n  userAgentPolicy,\n  userAgentPolicyName,\n  type UserAgentPolicyOptions,\n} from \"./policies/userAgentPolicy.js\";\nexport { tlsPolicy, tlsPolicyName } from \"./policies/tlsPolicy.js\";\nexport { formDataPolicy, formDataPolicyName } from \"./policies/formDataPolicy.js\";\nexport {\n  bearerTokenAuthenticationPolicy,\n  type BearerTokenAuthenticationPolicyOptions,\n  bearerTokenAuthenticationPolicyName,\n  type ChallengeCallbacks,\n  type AuthorizeRequestOptions,\n  type AuthorizeRequestOnChallengeOptions,\n} from \"./policies/bearerTokenAuthenticationPolicy.js\";\nexport { ndJsonPolicy, ndJsonPolicyName } from \"./policies/ndJsonPolicy.js\";\nexport {\n  auxiliaryAuthenticationHeaderPolicy,\n  type AuxiliaryAuthenticationHeaderPolicyOptions,\n  auxiliaryAuthenticationHeaderPolicyName,\n} from \"./policies/auxiliaryAuthenticationHeaderPolicy.js\";\nexport {\n  createFile,\n  createFileFromStream,\n  type CreateFileOptions,\n  type CreateFileFromStreamOptions,\n} from \"./util/file.js\";\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { OperationRequest, OperationRequestInfo } from \"./interfaces.js\";\n\n/**\n * Browser-only implementation of the module's state. The browser esm variant will not load the commonjs state, so we do not need to share state between the two.\n */\nexport const state = {\n  operationRequestMap: new WeakMap<OperationRequest, OperationRequestInfo>(),\n};\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  CompositeMapper,\n  Mapper,\n  OperationArguments,\n  OperationParameter,\n  OperationRequest,\n  OperationRequestInfo,\n  ParameterPath,\n} from \"./interfaces.js\";\n\nimport { state } from \"./state.js\";\n\n/**\n * @internal\n * Retrieves the value to use for a given operation argument\n * @param operationArguments - The arguments passed from the generated client\n * @param parameter - The parameter description\n * @param fallbackObject - If something isn't found in the arguments bag, look here.\n *  Generally used to look at the service client properties.\n */\nexport function getOperationArgumentValueFromParameter(\n  operationArguments: OperationArguments,\n  parameter: OperationParameter,\n  fallbackObject?: { [parameterName: string]: any },\n): any {\n  let parameterPath = parameter.parameterPath;\n  const parameterMapper = parameter.mapper;\n  let value: any;\n  if (typeof parameterPath === \"string\") {\n    parameterPath = [parameterPath];\n  }\n  if (Array.isArray(parameterPath)) {\n    if (parameterPath.length > 0) {\n      if (parameterMapper.isConstant) {\n        value = parameterMapper.defaultValue;\n      } else {\n        let propertySearchResult = getPropertyFromParameterPath(operationArguments, parameterPath);\n\n        if (!propertySearchResult.propertyFound && fallbackObject) {\n          propertySearchResult = getPropertyFromParameterPath(fallbackObject, parameterPath);\n        }\n\n        let useDefaultValue = false;\n        if (!propertySearchResult.propertyFound) {\n          useDefaultValue =\n            parameterMapper.required ||\n            (parameterPath[0] === \"options\" && parameterPath.length === 2);\n        }\n        value = useDefaultValue ? parameterMapper.defaultValue : propertySearchResult.propertyValue;\n      }\n    }\n  } else {\n    if (parameterMapper.required) {\n      value = {};\n    }\n\n    for (const propertyName in parameterPath) {\n      const propertyMapper: Mapper = (parameterMapper as CompositeMapper).type.modelProperties![\n        propertyName\n      ];\n      const propertyPath: ParameterPath = parameterPath[propertyName];\n      const propertyValue: any = getOperationArgumentValueFromParameter(\n        operationArguments,\n        {\n          parameterPath: propertyPath,\n          mapper: propertyMapper,\n        },\n        fallbackObject,\n      );\n      if (propertyValue !== undefined) {\n        if (!value) {\n          value = {};\n        }\n        value[propertyName] = propertyValue;\n      }\n    }\n  }\n  return value;\n}\n\ninterface PropertySearchResult {\n  propertyValue?: any;\n  propertyFound: boolean;\n}\n\nfunction getPropertyFromParameterPath(\n  parent: { [parameterName: string]: any },\n  parameterPath: string[],\n): PropertySearchResult {\n  const result: PropertySearchResult = { propertyFound: false };\n  let i = 0;\n  for (; i < parameterPath.length; ++i) {\n    const parameterPathPart: string = parameterPath[i];\n    // Make sure to check inherited properties too, so don't use hasOwnProperty().\n    if (parent && parameterPathPart in parent) {\n      parent = parent[parameterPathPart];\n    } else {\n      break;\n    }\n  }\n  if (i === parameterPath.length) {\n    result.propertyValue = parent;\n    result.propertyFound = true;\n  }\n  return result;\n}\n\nconst originalRequestSymbol = Symbol.for(\"@azure/core-client original request\");\n\nfunction hasOriginalRequest(\n  request: OperationRequest,\n): request is OperationRequest & { [originalRequestSymbol]: OperationRequest } {\n  return originalRequestSymbol in request;\n}\n\nexport function getOperationRequestInfo(request: OperationRequest): OperationRequestInfo {\n  if (hasOriginalRequest(request)) {\n    return getOperationRequestInfo(request[originalRequestSymbol]);\n  }\n  let info = state.operationRequestMap.get(request);\n\n  if (!info) {\n    info = {};\n    state.operationRequestMap.set(request, info);\n  }\n  return info;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  FullOperationResponse,\n  OperationRequest,\n  OperationResponseMap,\n  OperationSpec,\n  RequiredSerializerOptions,\n  SerializerOptions,\n  XML_CHARKEY,\n  XmlOptions,\n} from \"./interfaces.js\";\nimport {\n  PipelinePolicy,\n  PipelineRequest,\n  PipelineResponse,\n  RestError,\n  SendRequest,\n} from \"@azure/core-rest-pipeline\";\nimport { MapperTypeNames } from \"./serializer.js\";\nimport { getOperationRequestInfo } from \"./operationHelpers.js\";\n\nconst defaultJsonContentTypes = [\"application/json\", \"text/json\"];\nconst defaultXmlContentTypes = [\"application/xml\", \"application/atom+xml\"];\n\n/**\n * The programmatic identifier of the deserializationPolicy.\n */\nexport const deserializationPolicyName = \"deserializationPolicy\";\n\n/**\n * Options to configure API response deserialization.\n */\nexport interface DeserializationPolicyOptions {\n  /**\n   * Configures the expected content types for the deserialization of\n   * JSON and XML response bodies.\n   */\n  expectedContentTypes?: DeserializationContentTypes;\n\n  /**\n   * A function that is able to parse XML. Required for XML support.\n   */\n  parseXML?: (str: string, opts?: XmlOptions) => Promise<any>;\n\n  /**\n   * Configures behavior of xml parser and builder.\n   */\n  serializerOptions?: SerializerOptions;\n}\n\n/**\n * The content-types that will indicate that an operation response should be deserialized in a\n * particular way.\n */\nexport interface DeserializationContentTypes {\n  /**\n   * The content-types that indicate that an operation response should be deserialized as JSON.\n   * Defaults to [ \"application/json\", \"text/json\" ].\n   */\n  json?: string[];\n\n  /**\n   * The content-types that indicate that an operation response should be deserialized as XML.\n   * Defaults to [ \"application/xml\", \"application/atom+xml\" ].\n   */\n  xml?: string[];\n}\n\n/**\n * This policy handles parsing out responses according to OperationSpecs on the request.\n */\nexport function deserializationPolicy(options: DeserializationPolicyOptions = {}): PipelinePolicy {\n  const jsonContentTypes = options.expectedContentTypes?.json ?? defaultJsonContentTypes;\n  const xmlContentTypes = options.expectedContentTypes?.xml ?? defaultXmlContentTypes;\n  const parseXML = options.parseXML;\n  const serializerOptions = options.serializerOptions;\n  const updatedOptions: RequiredSerializerOptions = {\n    xml: {\n      rootName: serializerOptions?.xml.rootName ?? \"\",\n      includeRoot: serializerOptions?.xml.includeRoot ?? false,\n      xmlCharKey: serializerOptions?.xml.xmlCharKey ?? XML_CHARKEY,\n    },\n  };\n\n  return {\n    name: deserializationPolicyName,\n    async sendRequest(request: PipelineRequest, next: SendRequest): Promise<PipelineResponse> {\n      const response = await next(request);\n      return deserializeResponseBody(\n        jsonContentTypes,\n        xmlContentTypes,\n        response,\n        updatedOptions,\n        parseXML,\n      );\n    },\n  };\n}\n\nfunction getOperationResponseMap(\n  parsedResponse: PipelineResponse,\n): undefined | OperationResponseMap {\n  let result: OperationResponseMap | undefined;\n  const request: OperationRequest = parsedResponse.request;\n  const operationInfo = getOperationRequestInfo(request);\n  const operationSpec = operationInfo?.operationSpec;\n  if (operationSpec) {\n    if (!operationInfo?.operationResponseGetter) {\n      result = operationSpec.responses[parsedResponse.status];\n    } else {\n      result = operationInfo?.operationResponseGetter(operationSpec, parsedResponse);\n    }\n  }\n  return result;\n}\n\nfunction shouldDeserializeResponse(parsedResponse: PipelineResponse): boolean {\n  const request: OperationRequest = parsedResponse.request;\n  const operationInfo = getOperationRequestInfo(request);\n  const shouldDeserialize = operationInfo?.shouldDeserialize;\n  let result: boolean;\n  if (shouldDeserialize === undefined) {\n    result = true;\n  } else if (typeof shouldDeserialize === \"boolean\") {\n    result = shouldDeserialize;\n  } else {\n    result = shouldDeserialize(parsedResponse);\n  }\n  return result;\n}\n\nasync function deserializeResponseBody(\n  jsonContentTypes: string[],\n  xmlContentTypes: string[],\n  response: PipelineResponse,\n  options: RequiredSerializerOptions,\n  parseXML?: (str: string, opts?: XmlOptions) => Promise<any>,\n): Promise<PipelineResponse> {\n  const parsedResponse = await parse(\n    jsonContentTypes,\n    xmlContentTypes,\n    response,\n    options,\n    parseXML,\n  );\n  if (!shouldDeserializeResponse(parsedResponse)) {\n    return parsedResponse;\n  }\n\n  const operationInfo = getOperationRequestInfo(parsedResponse.request);\n  const operationSpec = operationInfo?.operationSpec;\n  if (!operationSpec || !operationSpec.responses) {\n    return parsedResponse;\n  }\n\n  const responseSpec = getOperationResponseMap(parsedResponse);\n  const { error, shouldReturnResponse } = handleErrorResponse(\n    parsedResponse,\n    operationSpec,\n    responseSpec,\n    options,\n  );\n  if (error) {\n    throw error;\n  } else if (shouldReturnResponse) {\n    return parsedResponse;\n  }\n\n  // An operation response spec does exist for current status code, so\n  // use it to deserialize the response.\n  if (responseSpec) {\n    if (responseSpec.bodyMapper) {\n      let valueToDeserialize: any = parsedResponse.parsedBody;\n      if (operationSpec.isXML && responseSpec.bodyMapper.type.name === MapperTypeNames.Sequence) {\n        valueToDeserialize =\n          typeof valueToDeserialize === \"object\"\n            ? valueToDeserialize[responseSpec.bodyMapper.xmlElementName!]\n            : [];\n      }\n      try {\n        parsedResponse.parsedBody = operationSpec.serializer.deserialize(\n          responseSpec.bodyMapper,\n          valueToDeserialize,\n          \"operationRes.parsedBody\",\n          options,\n        );\n      } catch (deserializeError: any) {\n        const restError = new RestError(\n          `Error ${deserializeError} occurred in deserializing the responseBody - ${parsedResponse.bodyAsText}`,\n          {\n            statusCode: parsedResponse.status,\n            request: parsedResponse.request,\n            response: parsedResponse,\n          },\n        );\n        throw restError;\n      }\n    } else if (operationSpec.httpMethod === \"HEAD\") {\n      // head methods never have a body, but we return a boolean to indicate presence/absence of the resource\n      parsedResponse.parsedBody = response.status >= 200 && response.status < 300;\n    }\n\n    if (responseSpec.headersMapper) {\n      parsedResponse.parsedHeaders = operationSpec.serializer.deserialize(\n        responseSpec.headersMapper,\n        parsedResponse.headers.toJSON(),\n        \"operationRes.parsedHeaders\",\n        { xml: {}, ignoreUnknownProperties: true },\n      );\n    }\n  }\n\n  return parsedResponse;\n}\n\nfunction isOperationSpecEmpty(operationSpec: OperationSpec): boolean {\n  const expectedStatusCodes = Object.keys(operationSpec.responses);\n  return (\n    expectedStatusCodes.length === 0 ||\n    (expectedStatusCodes.length === 1 && expectedStatusCodes[0] === \"default\")\n  );\n}\n\nfunction handleErrorResponse(\n  parsedResponse: FullOperationResponse,\n  operationSpec: OperationSpec,\n  responseSpec: OperationResponseMap | undefined,\n  options: RequiredSerializerOptions,\n): { error: RestError | null; shouldReturnResponse: boolean } {\n  const isSuccessByStatus = 200 <= parsedResponse.status && parsedResponse.status < 300;\n  const isExpectedStatusCode: boolean = isOperationSpecEmpty(operationSpec)\n    ? isSuccessByStatus\n    : !!responseSpec;\n\n  if (isExpectedStatusCode) {\n    if (responseSpec) {\n      if (!responseSpec.isError) {\n        return { error: null, shouldReturnResponse: false };\n      }\n    } else {\n      return { error: null, shouldReturnResponse: false };\n    }\n  }\n\n  const errorResponseSpec = responseSpec ?? operationSpec.responses.default;\n\n  const initialErrorMessage = parsedResponse.request.streamResponseStatusCodes?.has(\n    parsedResponse.status,\n  )\n    ? `Unexpected status code: ${parsedResponse.status}`\n    : (parsedResponse.bodyAsText as string);\n\n  const error = new RestError(initialErrorMessage, {\n    statusCode: parsedResponse.status,\n    request: parsedResponse.request,\n    response: parsedResponse,\n  });\n\n  // If the item failed but there's no error spec or default spec to deserialize the error,\n  // we should fail so we just throw the parsed response\n  if (!errorResponseSpec) {\n    throw error;\n  }\n\n  const defaultBodyMapper = errorResponseSpec.bodyMapper;\n  const defaultHeadersMapper = errorResponseSpec.headersMapper;\n\n  try {\n    // If error response has a body, try to deserialize it using default body mapper.\n    // Then try to extract error code & message from it\n    if (parsedResponse.parsedBody) {\n      const parsedBody = parsedResponse.parsedBody;\n      let deserializedError;\n\n      if (defaultBodyMapper) {\n        let valueToDeserialize: any = parsedBody;\n        if (operationSpec.isXML && defaultBodyMapper.type.name === MapperTypeNames.Sequence) {\n          valueToDeserialize = [];\n          const elementName = defaultBodyMapper.xmlElementName;\n          if (typeof parsedBody === \"object\" && elementName) {\n            valueToDeserialize = parsedBody[elementName];\n          }\n        }\n        deserializedError = operationSpec.serializer.deserialize(\n          defaultBodyMapper,\n          valueToDeserialize,\n          \"error.response.parsedBody\",\n          options,\n        );\n      }\n\n      const internalError: any = parsedBody.error || deserializedError || parsedBody;\n      error.code = internalError.code;\n      if (internalError.message) {\n        error.message = internalError.message;\n      }\n\n      if (defaultBodyMapper) {\n        (error.response! as FullOperationResponse).parsedBody = deserializedError;\n      }\n    }\n\n    // If error response has headers, try to deserialize it using default header mapper\n    if (parsedResponse.headers && defaultHeadersMapper) {\n      (error.response! as FullOperationResponse).parsedHeaders =\n        operationSpec.serializer.deserialize(\n          defaultHeadersMapper,\n          parsedResponse.headers.toJSON(),\n          \"operationRes.parsedHeaders\",\n        );\n    }\n  } catch (defaultError: any) {\n    error.message = `Error \"${defaultError.message}\" occurred in deserializing the responseBody - \"${parsedResponse.bodyAsText}\" for the default response.`;\n  }\n\n  return { error, shouldReturnResponse: false };\n}\n\nasync function parse(\n  jsonContentTypes: string[],\n  xmlContentTypes: string[],\n  operationResponse: FullOperationResponse,\n  opts: RequiredSerializerOptions,\n  parseXML?: (str: string, opts?: XmlOptions) => Promise<any>,\n): Promise<FullOperationResponse> {\n  if (\n    !operationResponse.request.streamResponseStatusCodes?.has(operationResponse.status) &&\n    operationResponse.bodyAsText\n  ) {\n    const text = operationResponse.bodyAsText;\n    const contentType: string = operationResponse.headers.get(\"Content-Type\") || \"\";\n    const contentComponents: string[] = !contentType\n      ? []\n      : contentType.split(\";\").map((component) => component.toLowerCase());\n\n    try {\n      if (\n        contentComponents.length === 0 ||\n        contentComponents.some((component) => jsonContentTypes.indexOf(component) !== -1)\n      ) {\n        operationResponse.parsedBody = JSON.parse(text);\n        return operationResponse;\n      } else if (contentComponents.some((component) => xmlContentTypes.indexOf(component) !== -1)) {\n        if (!parseXML) {\n          throw new Error(\"Parsing XML not supported.\");\n        }\n        const body = await parseXML(text, opts.xml);\n        operationResponse.parsedBody = body;\n        return operationResponse;\n      }\n    } catch (err: any) {\n      const msg = `Error \"${err}\" occurred while parsing the response body - ${operationResponse.bodyAsText}.`;\n      const errCode = err.code || RestError.PARSE_ERROR;\n      const e = new RestError(msg, {\n        code: errCode,\n        statusCode: operationResponse.status,\n        request: operationResponse.request,\n        response: operationResponse,\n      });\n      throw e;\n    }\n  }\n\n  return operationResponse;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { OperationParameter, OperationSpec } from \"./interfaces.js\";\nimport { MapperTypeNames } from \"./serializer.js\";\n\n/**\n * Gets the list of status codes for streaming responses.\n * @internal\n */\nexport function getStreamingResponseStatusCodes(operationSpec: OperationSpec): Set<number> {\n  const result = new Set<number>();\n  for (const statusCode in operationSpec.responses) {\n    const operationResponse = operationSpec.responses[statusCode];\n    if (\n      operationResponse.bodyMapper &&\n      operationResponse.bodyMapper.type.name === MapperTypeNames.Stream\n    ) {\n      result.add(Number(statusCode));\n    }\n  }\n  return result;\n}\n\n/**\n * Get the path to this parameter's value as a dotted string (a.b.c).\n * @param parameter - The parameter to get the path string for.\n * @returns The path to this parameter's value as a dotted string.\n * @internal\n */\nexport function getPathStringFromParameter(parameter: OperationParameter): string {\n  const { parameterPath, mapper } = parameter;\n  let result: string;\n  if (typeof parameterPath === \"string\") {\n    result = parameterPath;\n  } else if (Array.isArray(parameterPath)) {\n    result = parameterPath.join(\".\");\n  } else {\n    result = mapper.serializedName!;\n  }\n  return result;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  DictionaryMapper,\n  OperationArguments,\n  OperationRequest,\n  OperationSpec,\n  RequiredSerializerOptions,\n  SerializerOptions,\n  XML_ATTRKEY,\n  XML_CHARKEY,\n  XmlOptions,\n} from \"./interfaces.js\";\nimport { PipelinePolicy, PipelineResponse, SendRequest } from \"@azure/core-rest-pipeline\";\nimport {\n  getOperationArgumentValueFromParameter,\n  getOperationRequestInfo,\n} from \"./operationHelpers.js\";\nimport { MapperTypeNames } from \"./serializer.js\";\nimport { getPathStringFromParameter } from \"./interfaceHelpers.js\";\n\n/**\n * The programmatic identifier of the serializationPolicy.\n */\nexport const serializationPolicyName = \"serializationPolicy\";\n\n/**\n * Options to configure API request serialization.\n */\nexport interface SerializationPolicyOptions {\n  /**\n   * A function that is able to write XML. Required for XML support.\n   */\n  stringifyXML?: (obj: any, opts?: XmlOptions) => string;\n\n  /**\n   * Configures behavior of xml parser and builder.\n   */\n  serializerOptions?: SerializerOptions;\n}\n\n/**\n * This policy handles assembling the request body and headers using\n * an OperationSpec and OperationArguments on the request.\n */\nexport function serializationPolicy(options: SerializationPolicyOptions = {}): PipelinePolicy {\n  const stringifyXML = options.stringifyXML;\n\n  return {\n    name: serializationPolicyName,\n    async sendRequest(request: OperationRequest, next: SendRequest): Promise<PipelineResponse> {\n      const operationInfo = getOperationRequestInfo(request);\n      const operationSpec = operationInfo?.operationSpec;\n      const operationArguments = operationInfo?.operationArguments;\n      if (operationSpec && operationArguments) {\n        serializeHeaders(request, operationArguments, operationSpec);\n        serializeRequestBody(request, operationArguments, operationSpec, stringifyXML);\n      }\n      return next(request);\n    },\n  };\n}\n\n/**\n * @internal\n */\nexport function serializeHeaders(\n  request: OperationRequest,\n  operationArguments: OperationArguments,\n  operationSpec: OperationSpec,\n): void {\n  if (operationSpec.headerParameters) {\n    for (const headerParameter of operationSpec.headerParameters) {\n      let headerValue = getOperationArgumentValueFromParameter(operationArguments, headerParameter);\n      if ((headerValue !== null && headerValue !== undefined) || headerParameter.mapper.required) {\n        headerValue = operationSpec.serializer.serialize(\n          headerParameter.mapper,\n          headerValue,\n          getPathStringFromParameter(headerParameter),\n        );\n        const headerCollectionPrefix = (headerParameter.mapper as DictionaryMapper)\n          .headerCollectionPrefix;\n        if (headerCollectionPrefix) {\n          for (const key of Object.keys(headerValue)) {\n            request.headers.set(headerCollectionPrefix + key, headerValue[key]);\n          }\n        } else {\n          request.headers.set(\n            headerParameter.mapper.serializedName || getPathStringFromParameter(headerParameter),\n            headerValue,\n          );\n        }\n      }\n    }\n  }\n  const customHeaders = operationArguments.options?.requestOptions?.customHeaders;\n  if (customHeaders) {\n    for (const customHeaderName of Object.keys(customHeaders)) {\n      request.headers.set(customHeaderName, customHeaders[customHeaderName]);\n    }\n  }\n}\n\n/**\n * @internal\n */\nexport function serializeRequestBody(\n  request: OperationRequest,\n  operationArguments: OperationArguments,\n  operationSpec: OperationSpec,\n  stringifyXML: (obj: any, opts?: XmlOptions) => string = function () {\n    throw new Error(\"XML serialization unsupported!\");\n  },\n): void {\n  const serializerOptions = operationArguments.options?.serializerOptions;\n  const updatedOptions: RequiredSerializerOptions = {\n    xml: {\n      rootName: serializerOptions?.xml.rootName ?? \"\",\n      includeRoot: serializerOptions?.xml.includeRoot ?? false,\n      xmlCharKey: serializerOptions?.xml.xmlCharKey ?? XML_CHARKEY,\n    },\n  };\n\n  const xmlCharKey = updatedOptions.xml.xmlCharKey;\n  if (operationSpec.requestBody && operationSpec.requestBody.mapper) {\n    request.body = getOperationArgumentValueFromParameter(\n      operationArguments,\n      operationSpec.requestBody,\n    );\n\n    const bodyMapper = operationSpec.requestBody.mapper;\n    const {\n      required,\n      serializedName,\n      xmlName,\n      xmlElementName,\n      xmlNamespace,\n      xmlNamespacePrefix,\n      nullable,\n    } = bodyMapper;\n    const typeName = bodyMapper.type.name;\n\n    try {\n      if (\n        (request.body !== undefined && request.body !== null) ||\n        (nullable && request.body === null) ||\n        required\n      ) {\n        const requestBodyParameterPathString: string = getPathStringFromParameter(\n          operationSpec.requestBody,\n        );\n        request.body = operationSpec.serializer.serialize(\n          bodyMapper,\n          request.body,\n          requestBodyParameterPathString,\n          updatedOptions,\n        );\n\n        const isStream = typeName === MapperTypeNames.Stream;\n\n        if (operationSpec.isXML) {\n          const xmlnsKey = xmlNamespacePrefix ? `xmlns:${xmlNamespacePrefix}` : \"xmlns\";\n          const value = getXmlValueWithNamespace(\n            xmlNamespace,\n            xmlnsKey,\n            typeName,\n            request.body,\n            updatedOptions,\n          );\n\n          if (typeName === MapperTypeNames.Sequence) {\n            request.body = stringifyXML(\n              prepareXMLRootList(\n                value,\n                xmlElementName || xmlName || serializedName!,\n                xmlnsKey,\n                xmlNamespace,\n              ),\n              { rootName: xmlName || serializedName, xmlCharKey },\n            );\n          } else if (!isStream) {\n            request.body = stringifyXML(value, {\n              rootName: xmlName || serializedName,\n              xmlCharKey,\n            });\n          }\n        } else if (\n          typeName === MapperTypeNames.String &&\n          (operationSpec.contentType?.match(\"text/plain\") || operationSpec.mediaType === \"text\")\n        ) {\n          // the String serializer has validated that request body is a string\n          // so just send the string.\n          return;\n        } else if (!isStream) {\n          request.body = JSON.stringify(request.body);\n        }\n      }\n    } catch (error: any) {\n      throw new Error(\n        `Error \"${error.message}\" occurred in serializing the payload - ${JSON.stringify(\n          serializedName,\n          undefined,\n          \"  \",\n        )}.`,\n      );\n    }\n  } else if (operationSpec.formDataParameters && operationSpec.formDataParameters.length > 0) {\n    request.formData = {};\n    for (const formDataParameter of operationSpec.formDataParameters) {\n      const formDataParameterValue = getOperationArgumentValueFromParameter(\n        operationArguments,\n        formDataParameter,\n      );\n      if (formDataParameterValue !== undefined && formDataParameterValue !== null) {\n        const formDataParameterPropertyName: string =\n          formDataParameter.mapper.serializedName || getPathStringFromParameter(formDataParameter);\n        request.formData[formDataParameterPropertyName] = operationSpec.serializer.serialize(\n          formDataParameter.mapper,\n          formDataParameterValue,\n          getPathStringFromParameter(formDataParameter),\n          updatedOptions,\n        );\n      }\n    }\n  }\n}\n\n/**\n * Adds an xml namespace to the xml serialized object if needed, otherwise it just returns the value itself\n */\nfunction getXmlValueWithNamespace(\n  xmlNamespace: string | undefined,\n  xmlnsKey: string,\n  typeName: string,\n  serializedValue: any,\n  options: RequiredSerializerOptions,\n): any {\n  // Composite and Sequence schemas already got their root namespace set during serialization\n  // We just need to add xmlns to the other schema types\n  if (xmlNamespace && ![\"Composite\", \"Sequence\", \"Dictionary\"].includes(typeName)) {\n    const result: any = {};\n    result[options.xml.xmlCharKey] = serializedValue;\n    result[XML_ATTRKEY] = { [xmlnsKey]: xmlNamespace };\n    return result;\n  }\n\n  return serializedValue;\n}\n\nfunction prepareXMLRootList(\n  obj: any,\n  elementName: string,\n  xmlNamespaceKey?: string,\n  xmlNamespace?: string,\n): { [key: string]: any[] } {\n  if (!Array.isArray(obj)) {\n    obj = [obj];\n  }\n  if (!xmlNamespaceKey || !xmlNamespace) {\n    return { [elementName]: obj };\n  }\n\n  const result = { [elementName]: obj };\n  result[XML_ATTRKEY] = { [xmlNamespaceKey]: xmlNamespace };\n  return result;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { DeserializationPolicyOptions, deserializationPolicy } from \"./deserializationPolicy.js\";\nimport {\n  InternalPipelineOptions,\n  Pipeline,\n  bearerTokenAuthenticationPolicy,\n  createPipelineFromOptions,\n} from \"@azure/core-rest-pipeline\";\nimport { SerializationPolicyOptions, serializationPolicy } from \"./serializationPolicy.js\";\nimport { TokenCredential } from \"@azure/core-auth\";\n\n/**\n * Options for creating a Pipeline to use with ServiceClient.\n * Mostly for customizing the auth policy (if using token auth) or\n * the deserialization options when using XML.\n */\nexport interface InternalClientPipelineOptions extends InternalPipelineOptions {\n  /**\n   * Options to customize bearerTokenAuthenticationPolicy.\n   */\n  credentialOptions?: { credentialScopes: string | string[]; credential: TokenCredential };\n  /**\n   * Options to customize deserializationPolicy.\n   */\n  deserializationOptions?: DeserializationPolicyOptions;\n  /**\n   * Options to customize serializationPolicy.\n   */\n  serializationOptions?: SerializationPolicyOptions;\n}\n\n/**\n * Creates a new Pipeline for use with a Service Client.\n * Adds in deserializationPolicy by default.\n * Also adds in bearerTokenAuthenticationPolicy if passed a TokenCredential.\n * @param options - Options to customize the created pipeline.\n */\nexport function createClientPipeline(options: InternalClientPipelineOptions = {}): Pipeline {\n  const pipeline = createPipelineFromOptions(options ?? {});\n  if (options.credentialOptions) {\n    pipeline.addPolicy(\n      bearerTokenAuthenticationPolicy({\n        credential: options.credentialOptions.credential,\n        scopes: options.credentialOptions.credentialScopes,\n      }),\n    );\n  }\n\n  pipeline.addPolicy(serializationPolicy(options.serializationOptions), { phase: \"Serialize\" });\n  pipeline.addPolicy(deserializationPolicy(options.deserializationOptions), {\n    phase: \"Deserialize\",\n  });\n\n  return pipeline;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { HttpClient, createDefaultHttpClient } from \"@azure/core-rest-pipeline\";\n\nlet cachedHttpClient: HttpClient | undefined;\n\nexport function getCachedDefaultHttpClient(): HttpClient {\n  if (!cachedHttpClient) {\n    cachedHttpClient = createDefaultHttpClient();\n  }\n\n  return cachedHttpClient;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { OperationArguments, OperationSpec, QueryCollectionFormat } from \"./interfaces.js\";\nimport { getOperationArgumentValueFromParameter } from \"./operationHelpers.js\";\nimport { getPathStringFromParameter } from \"./interfaceHelpers.js\";\n\nconst CollectionFormatToDelimiterMap: { [key in QueryCollectionFormat]: string } = {\n  CSV: \",\",\n  SSV: \" \",\n  Multi: \"Multi\",\n  TSV: \"\\t\",\n  Pipes: \"|\",\n};\n\nexport function getRequestUrl(\n  baseUri: string,\n  operationSpec: OperationSpec,\n  operationArguments: OperationArguments,\n  fallbackObject: { [parameterName: string]: any },\n): string {\n  const urlReplacements = calculateUrlReplacements(\n    operationSpec,\n    operationArguments,\n    fallbackObject,\n  );\n\n  let isAbsolutePath = false;\n\n  let requestUrl = replaceAll(baseUri, urlReplacements);\n  if (operationSpec.path) {\n    let path = replaceAll(operationSpec.path, urlReplacements);\n    // QUIRK: sometimes we get a path component like /{nextLink}\n    // which may be a fully formed URL with a leading /. In that case, we should\n    // remove the leading /\n    if (operationSpec.path === \"/{nextLink}\" && path.startsWith(\"/\")) {\n      path = path.substring(1);\n    }\n    // QUIRK: sometimes we get a path component like {nextLink}\n    // which may be a fully formed URL. In that case, we should\n    // ignore the baseUri.\n    if (isAbsoluteUrl(path)) {\n      requestUrl = path;\n      isAbsolutePath = true;\n    } else {\n      requestUrl = appendPath(requestUrl, path);\n    }\n  }\n\n  const { queryParams, sequenceParams } = calculateQueryParameters(\n    operationSpec,\n    operationArguments,\n    fallbackObject,\n  );\n  /**\n   * Notice that this call sets the `noOverwrite` parameter to true if the `requestUrl`\n   * is an absolute path. This ensures that existing query parameter values in `requestUrl`\n   * do not get overwritten. On the other hand when `requestUrl` is not absolute path, it\n   * is still being built so there is nothing to overwrite.\n   */\n  requestUrl = appendQueryParams(requestUrl, queryParams, sequenceParams, isAbsolutePath);\n\n  return requestUrl;\n}\n\nfunction replaceAll(input: string, replacements: Map<string, string>): string {\n  let result = input;\n  for (const [searchValue, replaceValue] of replacements) {\n    result = result.split(searchValue).join(replaceValue);\n  }\n  return result;\n}\n\nfunction calculateUrlReplacements(\n  operationSpec: OperationSpec,\n  operationArguments: OperationArguments,\n  fallbackObject: { [parameterName: string]: any },\n): Map<string, string> {\n  const result = new Map<string, string>();\n  if (operationSpec.urlParameters?.length) {\n    for (const urlParameter of operationSpec.urlParameters) {\n      let urlParameterValue: string = getOperationArgumentValueFromParameter(\n        operationArguments,\n        urlParameter,\n        fallbackObject,\n      );\n      const parameterPathString = getPathStringFromParameter(urlParameter);\n      urlParameterValue = operationSpec.serializer.serialize(\n        urlParameter.mapper,\n        urlParameterValue,\n        parameterPathString,\n      );\n      if (!urlParameter.skipEncoding) {\n        urlParameterValue = encodeURIComponent(urlParameterValue);\n      }\n      result.set(\n        `{${urlParameter.mapper.serializedName || parameterPathString}}`,\n        urlParameterValue,\n      );\n    }\n  }\n  return result;\n}\n\nfunction isAbsoluteUrl(url: string): boolean {\n  return url.includes(\"://\");\n}\n\nfunction appendPath(url: string, pathToAppend?: string): string {\n  if (!pathToAppend) {\n    return url;\n  }\n\n  const parsedUrl = new URL(url);\n  let newPath = parsedUrl.pathname;\n\n  if (!newPath.endsWith(\"/\")) {\n    newPath = `${newPath}/`;\n  }\n\n  if (pathToAppend.startsWith(\"/\")) {\n    pathToAppend = pathToAppend.substring(1);\n  }\n\n  const searchStart = pathToAppend.indexOf(\"?\");\n  if (searchStart !== -1) {\n    const path = pathToAppend.substring(0, searchStart);\n    const search = pathToAppend.substring(searchStart + 1);\n    newPath = newPath + path;\n    if (search) {\n      parsedUrl.search = parsedUrl.search ? `${parsedUrl.search}&${search}` : search;\n    }\n  } else {\n    newPath = newPath + pathToAppend;\n  }\n\n  parsedUrl.pathname = newPath;\n\n  return parsedUrl.toString();\n}\n\nfunction calculateQueryParameters(\n  operationSpec: OperationSpec,\n  operationArguments: OperationArguments,\n  fallbackObject: { [parameterName: string]: any },\n): {\n  queryParams: Map<string, string | string[]>;\n  sequenceParams: Set<string>;\n} {\n  const result = new Map<string, string | string[]>();\n  const sequenceParams: Set<string> = new Set<string>();\n\n  if (operationSpec.queryParameters?.length) {\n    for (const queryParameter of operationSpec.queryParameters) {\n      if (queryParameter.mapper.type.name === \"Sequence\" && queryParameter.mapper.serializedName) {\n        sequenceParams.add(queryParameter.mapper.serializedName);\n      }\n      let queryParameterValue: string | string[] = getOperationArgumentValueFromParameter(\n        operationArguments,\n        queryParameter,\n        fallbackObject,\n      );\n      if (\n        (queryParameterValue !== undefined && queryParameterValue !== null) ||\n        queryParameter.mapper.required\n      ) {\n        queryParameterValue = operationSpec.serializer.serialize(\n          queryParameter.mapper,\n          queryParameterValue,\n          getPathStringFromParameter(queryParameter),\n        );\n\n        const delimiter = queryParameter.collectionFormat\n          ? CollectionFormatToDelimiterMap[queryParameter.collectionFormat]\n          : \"\";\n        if (Array.isArray(queryParameterValue)) {\n          // replace null and undefined\n          queryParameterValue = queryParameterValue.map((item) => {\n            if (item === null || item === undefined) {\n              return \"\";\n            }\n\n            return item;\n          });\n        }\n        if (queryParameter.collectionFormat === \"Multi\" && queryParameterValue.length === 0) {\n          continue;\n        } else if (\n          Array.isArray(queryParameterValue) &&\n          (queryParameter.collectionFormat === \"SSV\" || queryParameter.collectionFormat === \"TSV\")\n        ) {\n          queryParameterValue = queryParameterValue.join(delimiter);\n        }\n        if (!queryParameter.skipEncoding) {\n          if (Array.isArray(queryParameterValue)) {\n            queryParameterValue = queryParameterValue.map((item: string) => {\n              return encodeURIComponent(item);\n            });\n          } else {\n            queryParameterValue = encodeURIComponent(queryParameterValue);\n          }\n        }\n\n        // Join pipes and CSV *after* encoding, or the server will be upset.\n        if (\n          Array.isArray(queryParameterValue) &&\n          (queryParameter.collectionFormat === \"CSV\" || queryParameter.collectionFormat === \"Pipes\")\n        ) {\n          queryParameterValue = queryParameterValue.join(delimiter);\n        }\n\n        result.set(\n          queryParameter.mapper.serializedName || getPathStringFromParameter(queryParameter),\n          queryParameterValue,\n        );\n      }\n    }\n  }\n  return {\n    queryParams: result,\n    sequenceParams,\n  };\n}\n\nfunction simpleParseQueryParams(queryString: string): Map<string, string | string[] | undefined> {\n  const result: Map<string, string | string[] | undefined> = new Map<\n    string,\n    string | string[] | undefined\n  >();\n  if (!queryString || queryString[0] !== \"?\") {\n    return result;\n  }\n\n  // remove the leading ?\n  queryString = queryString.slice(1);\n  const pairs = queryString.split(\"&\");\n\n  for (const pair of pairs) {\n    const [name, value] = pair.split(\"=\", 2);\n    const existingValue = result.get(name);\n    if (existingValue) {\n      if (Array.isArray(existingValue)) {\n        existingValue.push(value);\n      } else {\n        result.set(name, [existingValue, value]);\n      }\n    } else {\n      result.set(name, value);\n    }\n  }\n\n  return result;\n}\n\n/** @internal */\nexport function appendQueryParams(\n  url: string,\n  queryParams: Map<string, string | string[]>,\n  sequenceParams: Set<string>,\n  noOverwrite: boolean = false,\n): string {\n  if (queryParams.size === 0) {\n    return url;\n  }\n\n  const parsedUrl = new URL(url);\n\n  // QUIRK: parsedUrl.searchParams will have their name/value pairs decoded, which\n  // can change their meaning to the server, such as in the case of a SAS signature.\n  // To avoid accidentally un-encoding a query param, we parse the key/values ourselves\n  const combinedParams = simpleParseQueryParams(parsedUrl.search);\n\n  for (const [name, value] of queryParams) {\n    const existingValue = combinedParams.get(name);\n    if (Array.isArray(existingValue)) {\n      if (Array.isArray(value)) {\n        existingValue.push(...value);\n        const valueSet = new Set(existingValue);\n        combinedParams.set(name, Array.from(valueSet));\n      } else {\n        existingValue.push(value);\n      }\n    } else if (existingValue) {\n      if (Array.isArray(value)) {\n        value.unshift(existingValue);\n      } else if (sequenceParams.has(name)) {\n        combinedParams.set(name, [existingValue, value]);\n      }\n      if (!noOverwrite) {\n        combinedParams.set(name, value);\n      }\n    } else {\n      combinedParams.set(name, value);\n    }\n  }\n\n  const searchPieces: string[] = [];\n  for (const [name, value] of combinedParams) {\n    if (typeof value === \"string\") {\n      searchPieces.push(`${name}=${value}`);\n    } else if (Array.isArray(value)) {\n      // QUIRK: If we get an array of values, include multiple key/value pairs\n      for (const subValue of value) {\n        searchPieces.push(`${name}=${subValue}`);\n      }\n    } else {\n      searchPieces.push(`${name}=${value}`);\n    }\n  }\n\n  // QUIRK: we have to set search manually as searchParams will encode comma when it shouldn't.\n  parsedUrl.search = searchPieces.length ? `?${searchPieces.join(\"&\")}` : \"\";\n  return parsedUrl.toString();\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { createClientLogger } from \"@azure/logger\";\nexport const logger = createClientLogger(\"core-client\");\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  CommonClientOptions,\n  OperationArguments,\n  OperationRequest,\n  OperationSpec,\n} from \"./interfaces.js\";\nimport {\n  HttpClient,\n  Pipeline,\n  PipelineRequest,\n  PipelineResponse,\n  createPipelineRequest,\n} from \"@azure/core-rest-pipeline\";\nimport { TokenCredential } from \"@azure/core-auth\";\nimport { createClientPipeline } from \"./pipeline.js\";\nimport { flattenResponse } from \"./utils.js\";\nimport { getCachedDefaultHttpClient } from \"./httpClientCache.js\";\nimport { getOperationRequestInfo } from \"./operationHelpers.js\";\nimport { getRequestUrl } from \"./urlHelpers.js\";\nimport { getStreamingResponseStatusCodes } from \"./interfaceHelpers.js\";\nimport { logger } from \"./log.js\";\n\n/**\n * Options to be provided while creating the client.\n */\nexport interface ServiceClientOptions extends CommonClientOptions {\n  /**\n   * If specified, this is the base URI that requests will be made against for this ServiceClient.\n   * If it is not specified, then all OperationSpecs must contain a baseUrl property.\n   * @deprecated This property is deprecated and will be removed soon, please use endpoint instead\n   */\n  baseUri?: string;\n  /**\n   * If specified, this is the endpoint that requests will be made against for this ServiceClient.\n   * If it is not specified, then all OperationSpecs must contain a baseUrl property.\n   * to encourage customer to use endpoint, we mark the baseUri as deprecated.\n   */\n  endpoint?: string;\n  /**\n   * If specified, will be used to build the BearerTokenAuthenticationPolicy.\n   */\n  credentialScopes?: string | string[];\n  /**\n   * The default request content type for the service.\n   * Used if no requestContentType is present on an OperationSpec.\n   */\n  requestContentType?: string;\n  /**\n   * Credential used to authenticate the request.\n   */\n  credential?: TokenCredential;\n  /**\n   * A customized pipeline to use, otherwise a default one will be created.\n   */\n  pipeline?: Pipeline;\n}\n\n/**\n * Initializes a new instance of the ServiceClient.\n */\nexport class ServiceClient {\n  /**\n   * If specified, this is the base URI that requests will be made against for this ServiceClient.\n   * If it is not specified, then all OperationSpecs must contain a baseUrl property.\n   */\n  private readonly _endpoint?: string;\n\n  /**\n   * The default request content type for the service.\n   * Used if no requestContentType is present on an OperationSpec.\n   */\n  private readonly _requestContentType?: string;\n\n  /**\n   * Set to true if the request is sent over HTTP instead of HTTPS\n   */\n  private readonly _allowInsecureConnection?: boolean;\n\n  /**\n   * The HTTP client that will be used to send requests.\n   */\n  private readonly _httpClient: HttpClient;\n\n  /**\n   * The pipeline used by this client to make requests\n   */\n  public readonly pipeline: Pipeline;\n\n  /**\n   * The ServiceClient constructor\n   * @param credential - The credentials used for authentication with the service.\n   * @param options - The service client options that govern the behavior of the client.\n   */\n  constructor(options: ServiceClientOptions = {}) {\n    this._requestContentType = options.requestContentType;\n    this._endpoint = options.endpoint ?? options.baseUri;\n    if (options.baseUri) {\n      logger.warning(\n        \"The baseUri option for SDK Clients has been deprecated, please use endpoint instead.\",\n      );\n    }\n    this._allowInsecureConnection = options.allowInsecureConnection;\n    this._httpClient = options.httpClient || getCachedDefaultHttpClient();\n\n    this.pipeline = options.pipeline || createDefaultPipeline(options);\n    if (options.additionalPolicies?.length) {\n      for (const { policy, position } of options.additionalPolicies) {\n        // Sign happens after Retry and is commonly needed to occur\n        // before policies that intercept post-retry.\n        const afterPhase = position === \"perRetry\" ? \"Sign\" : undefined;\n        this.pipeline.addPolicy(policy, {\n          afterPhase,\n        });\n      }\n    }\n  }\n\n  /**\n   * Send the provided httpRequest.\n   */\n  async sendRequest(request: PipelineRequest): Promise<PipelineResponse> {\n    return this.pipeline.sendRequest(this._httpClient, request);\n  }\n\n  /**\n   * Send an HTTP request that is populated using the provided OperationSpec.\n   * @typeParam T - The typed result of the request, based on the OperationSpec.\n   * @param operationArguments - The arguments that the HTTP request's templated values will be populated from.\n   * @param operationSpec - The OperationSpec to use to populate the httpRequest.\n   */\n  async sendOperationRequest<T>(\n    operationArguments: OperationArguments,\n    operationSpec: OperationSpec,\n  ): Promise<T> {\n    const endpoint: string | undefined = operationSpec.baseUrl || this._endpoint;\n    if (!endpoint) {\n      throw new Error(\n        \"If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.\",\n      );\n    }\n\n    // Templatized URLs sometimes reference properties on the ServiceClient child class,\n    // so we have to pass `this` below in order to search these properties if they're\n    // not part of OperationArguments\n    const url = getRequestUrl(endpoint, operationSpec, operationArguments, this);\n\n    const request: OperationRequest = createPipelineRequest({\n      url,\n    });\n    request.method = operationSpec.httpMethod;\n    const operationInfo = getOperationRequestInfo(request);\n    operationInfo.operationSpec = operationSpec;\n    operationInfo.operationArguments = operationArguments;\n\n    const contentType = operationSpec.contentType || this._requestContentType;\n    if (contentType && operationSpec.requestBody) {\n      request.headers.set(\"Content-Type\", contentType);\n    }\n\n    const options = operationArguments.options;\n    if (options) {\n      const requestOptions = options.requestOptions;\n\n      if (requestOptions) {\n        if (requestOptions.timeout) {\n          request.timeout = requestOptions.timeout;\n        }\n\n        if (requestOptions.onUploadProgress) {\n          request.onUploadProgress = requestOptions.onUploadProgress;\n        }\n\n        if (requestOptions.onDownloadProgress) {\n          request.onDownloadProgress = requestOptions.onDownloadProgress;\n        }\n\n        if (requestOptions.shouldDeserialize !== undefined) {\n          operationInfo.shouldDeserialize = requestOptions.shouldDeserialize;\n        }\n\n        if (requestOptions.allowInsecureConnection) {\n          request.allowInsecureConnection = true;\n        }\n      }\n\n      if (options.abortSignal) {\n        request.abortSignal = options.abortSignal;\n      }\n\n      if (options.tracingOptions) {\n        request.tracingOptions = options.tracingOptions;\n      }\n    }\n\n    if (this._allowInsecureConnection) {\n      request.allowInsecureConnection = true;\n    }\n\n    if (request.streamResponseStatusCodes === undefined) {\n      request.streamResponseStatusCodes = getStreamingResponseStatusCodes(operationSpec);\n    }\n\n    try {\n      const rawResponse = await this.sendRequest(request);\n      const flatResponse = flattenResponse(\n        rawResponse,\n        operationSpec.responses[rawResponse.status],\n      ) as T;\n      if (options?.onResponse) {\n        options.onResponse(rawResponse, flatResponse);\n      }\n      return flatResponse;\n    } catch (error: any) {\n      if (typeof error === \"object\" && error?.response) {\n        const rawResponse = error.response;\n        const flatResponse = flattenResponse(\n          rawResponse,\n          operationSpec.responses[error.statusCode] || operationSpec.responses[\"default\"],\n        );\n        error.details = flatResponse;\n        if (options?.onResponse) {\n          options.onResponse(rawResponse, flatResponse, error);\n        }\n      }\n      throw error;\n    }\n  }\n}\n\nfunction createDefaultPipeline(options: ServiceClientOptions): Pipeline {\n  const credentialScopes = getCredentialScopes(options);\n  const credentialOptions =\n    options.credential && credentialScopes\n      ? { credentialScopes, credential: options.credential }\n      : undefined;\n\n  return createClientPipeline({\n    ...options,\n    credentialOptions,\n  });\n}\n\nfunction getCredentialScopes(options: ServiceClientOptions): string | string[] | undefined {\n  if (options.credentialScopes) {\n    return options.credentialScopes;\n  }\n\n  if (options.endpoint) {\n    return `${options.endpoint}/.default`;\n  }\n\n  if (options.baseUri) {\n    return `${options.baseUri}/.default`;\n  }\n\n  if (options.credential && !options.credentialScopes) {\n    throw new Error(\n      `When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy`,\n    );\n  }\n\n  return undefined;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { AuthorizeRequestOnChallengeOptions } from \"@azure/core-rest-pipeline\";\nimport { logger as coreClientLogger } from \"./log.js\";\nimport { decodeStringToString } from \"./base64.js\";\n\n/**\n * Converts: `Bearer a=\"b\", c=\"d\", Bearer d=\"e\", f=\"g\"`.\n * Into: `[ { a: 'b', c: 'd' }, { d: 'e', f: 'g' } ]`.\n *\n * @internal\n */\nexport function parseCAEChallenge(challenges: string): any[] {\n  const bearerChallenges = `, ${challenges.trim()}`.split(\", Bearer \").filter((x) => x);\n  return bearerChallenges.map((challenge) => {\n    const challengeParts = `${challenge.trim()}, `.split('\", ').filter((x) => x);\n    const keyValuePairs = challengeParts.map((keyValue) =>\n      (([key, value]) => ({ [key]: value }))(keyValue.trim().split('=\"')),\n    );\n    // Key-value pairs to plain object:\n    return keyValuePairs.reduce((a, b) => ({ ...a, ...b }), {});\n  });\n}\n\n/**\n * CAE Challenge structure\n */\nexport interface CAEChallenge {\n  scope: string;\n  claims: string;\n}\n\n/**\n * This function can be used as a callback for the `bearerTokenAuthenticationPolicy` of `@azure/core-rest-pipeline`, to support CAE challenges:\n * [Continuous Access Evaluation](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-continuous-access-evaluation).\n *\n * Call the `bearerTokenAuthenticationPolicy` with the following options:\n *\n * ```ts\n * import { bearerTokenAuthenticationPolicy } from \"@azure/core-rest-pipeline\";\n * import { authorizeRequestOnClaimChallenge } from \"@azure/core-client\";\n *\n * const bearerTokenAuthenticationPolicy = bearerTokenAuthenticationPolicy({\n *   authorizeRequestOnChallenge: authorizeRequestOnClaimChallenge\n * });\n * ```\n *\n * Once provided, the `bearerTokenAuthenticationPolicy` policy will internally handle Continuous Access Evaluation (CAE) challenges.\n * When it can't complete a challenge it will return the 401 (unauthorized) response from ARM.\n *\n * Example challenge with claims:\n *\n * ```\n * Bearer authorization_uri=\"https://login.windows-ppe.net/\", error=\"invalid_token\",\n * error_description=\"User session has been revoked\",\n * claims=\"eyJhY2Nlc3NfdG9rZW4iOnsibmJmIjp7ImVzc2VudGlhbCI6dHJ1ZSwgInZhbHVlIjoiMTYwMzc0MjgwMCJ9fX0=\"\n * ```\n */\nexport async function authorizeRequestOnClaimChallenge(\n  onChallengeOptions: AuthorizeRequestOnChallengeOptions,\n): Promise<boolean> {\n  const { scopes, response } = onChallengeOptions;\n  const logger = onChallengeOptions.logger || coreClientLogger;\n\n  const challenge = response.headers.get(\"WWW-Authenticate\");\n  if (!challenge) {\n    logger.info(\n      `The WWW-Authenticate header was missing. Failed to perform the Continuous Access Evaluation authentication flow.`,\n    );\n    return false;\n  }\n  const challenges: CAEChallenge[] = parseCAEChallenge(challenge) || [];\n\n  const parsedChallenge = challenges.find((x) => x.claims);\n  if (!parsedChallenge) {\n    logger.info(\n      `The WWW-Authenticate header was missing the necessary \"claims\" to perform the Continuous Access Evaluation authentication flow.`,\n    );\n    return false;\n  }\n\n  const accessToken = await onChallengeOptions.getAccessToken(\n    parsedChallenge.scope ? [parsedChallenge.scope] : scopes,\n    {\n      claims: decodeStringToString(parsedChallenge.claims),\n    },\n  );\n\n  if (!accessToken) {\n    return false;\n  }\n\n  onChallengeOptions.request.headers.set(\"Authorization\", `Bearer ${accessToken.token}`);\n  return true;\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  AuthorizeRequestOnChallengeOptions,\n  PipelineRequest,\n  PipelineResponse,\n} from \"@azure/core-rest-pipeline\";\n\nimport { GetTokenOptions } from \"@azure/core-auth\";\n\n/**\n * A set of constants used internally when processing requests.\n */\nconst Constants = {\n  DefaultScope: \"/.default\",\n  /**\n   * Defines constants for use with HTTP headers.\n   */\n  HeaderConstants: {\n    /**\n     * The Authorization header.\n     */\n    AUTHORIZATION: \"authorization\",\n  },\n};\n\nfunction isUuid(text: string): boolean {\n  return /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/.test(\n    text,\n  );\n}\n\n/**\n * Defines a callback to handle auth challenge for Storage APIs.\n * This implements the bearer challenge process described here: https://docs.microsoft.com/rest/api/storageservices/authorize-with-azure-active-directory#bearer-challenge\n * Handling has specific features for storage that departs to the general AAD challenge docs.\n **/\nexport const authorizeRequestOnTenantChallenge: (\n  challengeOptions: AuthorizeRequestOnChallengeOptions,\n) => Promise<boolean> = async (challengeOptions) => {\n  const requestOptions = requestToOptions(challengeOptions.request);\n  const challenge = getChallenge(challengeOptions.response);\n  if (challenge) {\n    const challengeInfo: Challenge = parseChallenge(challenge);\n    const challengeScopes = buildScopes(challengeOptions, challengeInfo);\n    const tenantId = extractTenantId(challengeInfo);\n    if (!tenantId) {\n      return false;\n    }\n    const accessToken = await challengeOptions.getAccessToken(challengeScopes, {\n      ...requestOptions,\n      tenantId,\n    });\n\n    if (!accessToken) {\n      return false;\n    }\n\n    challengeOptions.request.headers.set(\n      Constants.HeaderConstants.AUTHORIZATION,\n      `Bearer ${accessToken.token}`,\n    );\n    return true;\n  }\n  return false;\n};\n\n/**\n * Extracts the tenant id from the challenge information\n * The tenant id is contained in the authorization_uri as the first\n * path part.\n */\nfunction extractTenantId(challengeInfo: Challenge): string | undefined {\n  const parsedAuthUri = new URL(challengeInfo.authorization_uri);\n  const pathSegments = parsedAuthUri.pathname.split(\"/\");\n  const tenantId = pathSegments[1];\n  if (tenantId && isUuid(tenantId)) {\n    return tenantId;\n  }\n  return undefined;\n}\n\n/**\n * Builds the authentication scopes based on the information that comes in the\n * challenge information. Scopes url is present in the resource_id, if it is empty\n * we keep using the original scopes.\n */\nfunction buildScopes(\n  challengeOptions: AuthorizeRequestOnChallengeOptions,\n  challengeInfo: Challenge,\n): string[] {\n  if (!challengeInfo.resource_id) {\n    return challengeOptions.scopes;\n  }\n\n  const challengeScopes = new URL(challengeInfo.resource_id);\n  challengeScopes.pathname = Constants.DefaultScope;\n  let scope = challengeScopes.toString();\n  if (scope === \"https://disk.azure.com/.default\") {\n    // the extra slash is required by the service\n    scope = \"https://disk.azure.com//.default\";\n  }\n  return [scope];\n}\n\n/**\n * We will retrieve the challenge only if the response status code was 401,\n * and if the response contained the header \"WWW-Authenticate\" with a non-empty value.\n */\nfunction getChallenge(response: PipelineResponse): string | undefined {\n  const challenge = response.headers.get(\"WWW-Authenticate\");\n  if (response.status === 401 && challenge) {\n    return challenge;\n  }\n  return;\n}\n\n/**\n * Challenge structure\n */\ninterface Challenge {\n  authorization_uri: string;\n  resource_id?: string;\n}\n\n/**\n * Converts: `Bearer a=\"b\" c=\"d\"`.\n * Into: `[ { a: 'b', c: 'd' }]`.\n *\n * @internal\n */\nfunction parseChallenge(challenge: string): Challenge {\n  const bearerChallenge = challenge.slice(\"Bearer \".length);\n  const challengeParts = `${bearerChallenge.trim()} `.split(\" \").filter((x) => x);\n  const keyValuePairs = challengeParts.map((keyValue) =>\n    (([key, value]) => ({ [key]: value }))(keyValue.trim().split(\"=\")),\n  );\n  // Key-value pairs to plain object:\n  return keyValuePairs.reduce((a, b) => ({ ...a, ...b }), {} as Challenge);\n}\n\n/**\n * Extracts the options form a Pipeline Request for later re-use\n */\nfunction requestToOptions(request: PipelineRequest): GetTokenOptions {\n  return {\n    abortSignal: request.abortSignal,\n    requestOptions: {\n      timeout: request.timeout,\n    },\n    tracingOptions: request.tracingOptions,\n  };\n}\n","// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nexport { createSerializer, MapperTypeNames } from \"./serializer.js\";\nexport { ServiceClient, ServiceClientOptions } from \"./serviceClient.js\";\nexport { createClientPipeline, InternalClientPipelineOptions } from \"./pipeline.js\";\nexport {\n  OperationSpec,\n  OperationArguments,\n  OperationOptions,\n  OperationResponseMap,\n  OperationParameter,\n  OperationQueryParameter,\n  OperationURLParameter,\n  Serializer,\n  BaseMapper,\n  Mapper,\n  MapperType,\n  SimpleMapperType,\n  EnumMapper,\n  EnumMapperType,\n  SequenceMapper,\n  SequenceMapperType,\n  DictionaryMapper,\n  DictionaryMapperType,\n  CompositeMapper,\n  CompositeMapperType,\n  MapperConstraints,\n  OperationRequest,\n  OperationRequestOptions,\n  OperationRequestInfo,\n  QueryCollectionFormat,\n  ParameterPath,\n  FullOperationResponse,\n  PolymorphicDiscriminator,\n  SpanConfig,\n  XML_ATTRKEY,\n  XML_CHARKEY,\n  XmlOptions,\n  SerializerOptions,\n  RawResponseCallback,\n  CommonClientOptions,\n  AdditionalPolicyConfig,\n} from \"./interfaces.js\";\nexport {\n  deserializationPolicy,\n  deserializationPolicyName,\n  DeserializationPolicyOptions,\n  DeserializationContentTypes,\n} from \"./deserializationPolicy.js\";\nexport {\n  serializationPolicy,\n  serializationPolicyName,\n  SerializationPolicyOptions,\n} from \"./serializationPolicy.js\";\nexport { authorizeRequestOnClaimChallenge } from \"./authorizeRequestOnClaimChallenge.js\";\nexport { authorizeRequestOnTenantChallenge } from \"./authorizeRequestOnTenantChallenge.js\";\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RealTimeNotificationConfiguration = exports.TrouterConfigClient = void 0;\nconst coreClient = __importStar(require(\"@azure/core-client\")); // External library import\nconst core_rest_pipeline_1 = require(\"@azure/core-rest-pipeline\"); // Grouped imports from the same module\nconst constants_1 = require(\"./constants\");\nclass TrouterConfigClient extends coreClient.ServiceClient {\n    constructor(endpoint, options) {\n        // Initializing default values for options\n        if (!options) {\n            options = {};\n        }\n        const packageDetails = `azsdk-js-communication-signaling/${constants_1.PACKAGE_VERSION}`;\n        const userAgentPrefix = options.userAgentOptions && options.userAgentOptions.userAgentPrefix\n            ? `${options.userAgentOptions.userAgentPrefix} ${packageDetails}`\n            : `${packageDetails}`;\n        const clientOptions = Object.assign(Object.assign({}, options), { userAgentOptions: {\n                userAgentPrefix,\n            }, additionalPolicies: options.additionalPolicies });\n        super(clientOptions);\n        this.apiVersion = constants_1.CONFIG_API_VERSION;\n        this.endpoint = endpoint;\n        this.httpClient = (0, core_rest_pipeline_1.createDefaultHttpClient)();\n    }\n    fetchServiceUrls(credential) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const token = (yield credential.getToken()).token;\n                const request = (0, core_rest_pipeline_1.createPipelineRequest)({\n                    url: `${this.endpoint}/chat/config/realTimeNotifications?api-version=${this.apiVersion}`,\n                    method: \"GET\",\n                    headers: (0, core_rest_pipeline_1.createHttpHeaders)({\n                        Authorization: `Bearer ${token}`,\n                    }),\n                });\n                const response = yield this.pipeline.sendRequest(this.httpClient, request);\n                if (response.status !== 200 || !response.bodyAsText) {\n                    throw new Error(`Failed to fetch service URLs. Status: ${response.status}, Body: ${response.bodyAsText || \"No response body\"}`);\n                }\n                const data = JSON.parse(response.bodyAsText);\n                // Ensure all necessary data fields are present\n                if (!data.trouterServiceUrl || !data.registrarServiceUrl || !data.cloudType) {\n                    throw new Error(\"One or more required fields are missing in the response data\");\n                }\n                return new RealTimeNotificationConfiguration(data.trouterServiceUrl, data.registrarServiceUrl, data.cloudType);\n            }\n            catch (error) {\n                throw new Error(`Error fetching real-time notification configuration from Chat Gateway: ${error.message}`);\n            }\n        });\n    }\n}\nexports.TrouterConfigClient = TrouterConfigClient;\nclass RealTimeNotificationConfiguration {\n    constructor(trouterServiceUrl, registrarServiceUrl, cloudType) {\n        this.trouterServiceUrl = trouterServiceUrl;\n        this.registrarServiceUrl = registrarServiceUrl;\n        this.cloudType = cloudType;\n    }\n}\nexports.RealTimeNotificationConfiguration = RealTimeNotificationConfiguration;\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.defaultTelemetrySettings = exports.createSettings = void 0;\nconst TrouterUtils_1 = require(\"./TrouterUtils\");\nconst TrouterConfigClient_1 = require(\"./TrouterConfigClient\");\nconst defaultSettings = {\n    version: \"1.0.0\", // SignalingClient version, required for trouter connection\n    registrationId: \"\", // Required for trouter connection\n    sessionId: \"\", // Required for trouter connection\n    pnhAppId: \"AcsWeb\",\n    pnhTemplate: \"AcsWeb_Chat_1.8\",\n    platform: \"SPOOL\",\n    platformUIVersion: \"0.0.0\",\n    environment: \"\", // TBD\n    productName: \"acs-chat-web\",\n    trouterServiceUrl: \"\",\n    registrarServiceUrl: \"\",\n    registrarRefreshTimeoutInMs: 350000,\n    timeoutOptions: {\n        connectionTimeoutMs: 20000,\n        fetchTimeoutMs: 10000,\n        pingTimeoutMs: 40000,\n        pongTimeoutMs: 5000,\n        maxBackoffMs: 50000,\n        requestTimeoutMs: 5000,\n    },\n    maxRegistrationTimeInMs: 7200000,\n};\n// Main function to create settings based on environment\nconst createSettings = (credential, options) => __awaiter(void 0, void 0, void 0, function* () {\n    var _a;\n    const endpoint = options === null || options === void 0 ? void 0 : options.resourceEndpoint;\n    // Throw an error if resourceEndpoint is null or undefined\n    if (endpoint === undefined) {\n        throw new Error(\"'endpoint' cannot be null\");\n    }\n    // Initialize the settings by cloning the default ones\n    const settings = Object.assign({}, defaultSettings);\n    settings.registrationId = (0, TrouterUtils_1.generateUuid)(); // Generate unique IDs\n    settings.sessionId = (0, TrouterUtils_1.generateUuid)();\n    // Fetch the real time configuration from the service\n    const trouterConfigClient = new TrouterConfigClient_1.TrouterConfigClient(endpoint, options);\n    const realTimeNotificationConfiguration = yield trouterConfigClient.fetchServiceUrls(credential);\n    // Append suffix to trouterServiceUrl and registrarServiceUrl\n    settings.trouterServiceUrl = `${realTimeNotificationConfiguration.trouterServiceUrl}/v4/a`;\n    settings.registrarServiceUrl = `${realTimeNotificationConfiguration.registrarServiceUrl}/v3/registrations`;\n    // Customize settings if the environment is INT\n    if (realTimeNotificationConfiguration.cloudType === \"int\") {\n        settings.pnhAppId = \"cns-e2e-test\";\n        settings.pnhTemplate = \"cns-e2e-test:1.8\";\n    }\n    settings.maxRegistrationTimeInMs =\n        (_a = options === null || options === void 0 ? void 0 : options.registrationTimeInMs) !== null && _a !== void 0 ? _a : defaultSettings.maxRegistrationTimeInMs;\n    return settings;\n});\nexports.createSettings = createSettings;\nexports.defaultTelemetrySettings = {\n    // TBD Can we hook up OpenTelemetry?\n    enabled: false,\n};\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CommunicationSignalingClient = exports.ConnectionState = void 0;\nconst tstrouter_1 = require(\"@skype/tstrouter\");\nconst TrouterUtils_1 = require(\"./TrouterUtils\");\nconst TrouterSettings_1 = require(\"./TrouterSettings\");\nconst constants_1 = require(\"./constants\");\nvar ConnectionState;\n(function (ConnectionState) {\n    ConnectionState[ConnectionState[\"Unknown\"] = 0] = \"Unknown\";\n    ConnectionState[ConnectionState[\"Connected\"] = 2] = \"Connected\";\n    ConnectionState[ConnectionState[\"Disconnected\"] = 3] = \"Disconnected\";\n    ConnectionState[ConnectionState[\"Switching\"] = 9] = \"Switching\";\n})(ConnectionState || (exports.ConnectionState = ConnectionState = {}));\nclass CommunicationSignalingClient {\n    constructor(credential, logger, options) {\n        this.credential = credential;\n        this.logger = logger;\n        this.options = options;\n        this.stateChangedListener = null;\n        this.tokenFetchRetries = 0;\n        this.trouter = (0, tstrouter_1.createTrouterService)((0, TrouterUtils_1.toLogProvider)(logger));\n    }\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a, _b;\n            this.resourceEndpoint = (_a = this.options) === null || _a === void 0 ? void 0 : _a.resourceEndpoint;\n            if (this.resourceEndpoint === undefined) {\n                throw new Error(\"'endpoint' cannot be null\");\n            }\n            this.gatewayApiVersion = ((_b = this.options) === null || _b === void 0 ? void 0 : _b.gatewayApiVersion) || \"2024-03-07\";\n            if (this.config === undefined) {\n                this.config = {\n                    trouterSettings: yield (0, TrouterSettings_1.createSettings)(this.credential, this.options),\n                    skypeTokenProvider: (forceRefresh) => __awaiter(this, void 0, void 0, function* () {\n                        if (forceRefresh) {\n                            this.tokenFetchRetries += 1;\n                            if (this.tokenFetchRetries > constants_1.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES) {\n                                yield this.stop(true);\n                                throw new Error(`Access token is expired and failed to fetch a valid one after ${constants_1.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES} retries`);\n                            }\n                        }\n                        else {\n                            this.tokenFetchRetries = 0;\n                        }\n                        return Promise.resolve((yield this.credential.getToken()).token);\n                    }),\n                    telemetryConfig: {\n                        eventLogger: (0, TrouterUtils_1.toTelemetrySender)(this.logger),\n                        settings: TrouterSettings_1.defaultTelemetrySettings,\n                    },\n                };\n            }\n            this.trouter.start(this.config);\n            this.trouter.setUserActivityState(tstrouter_1.UserActivityState.Active);\n        });\n    }\n    stop(isTokenExpired) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.trouter.offStateChanged(this.stateChangedListener);\n            this.trouter.clearMessageHandlers();\n            this.trouter.stop(isTokenExpired !== null && isTokenExpired !== void 0 ? isTokenExpired : this.tokenFetchRetries > constants_1.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES);\n        });\n    }\n    on(event, listener) {\n        if (event === \"connectionChanged\") {\n            this.trouter.offStateChanged(this.stateChangedListener);\n            this.stateChangedListener = (state, _url) => listener(state);\n            this.trouter.onStateChanged(this.stateChangedListener);\n            return;\n        }\n        this.trouter.registerMessageHandler((0, TrouterUtils_1.toMessageHandler)(event, listener, this.resourceEndpoint, this.gatewayApiVersion));\n    }\n}\nexports.CommunicationSignalingClient = CommunicationSignalingClient;\n","\"use strict\";\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./SignalingClient\"), exports);\n"],"names":["root","factory","module","this","moduleId","installedModules","exports","i","l","call","__webpack_require__","m","modules","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","request","timeoutMs","fetchPromise","resolve","reject","fetch","then","response","timeoutId","clearTimeout","catch","error","setTimeout","url","race","timeoutPromise","obj","stringify","Timespan","toJson","fetchWithTimeout","start","Date","now","reset","logProvider","tokenProvider","options","__extends","b","extendStatics","setPrototypeOf","__proto__","constructor","String","create","__","__assign","assign","t","arguments","length","apply","__awaiter","thisArg","_arguments","P","generator","Promise","step","next","e","result","done","adopt","fulfilled","rejected","__generator","body","v","op","f","g","_","y","label","ops","pop","trys","push","sent","verb","throw","return","Symbol","iterator","createRegistrarClient","RegistrarClient","SUPPORTED_TOKEN_TYPES","message","_this","Error","logger","maxBackoffInMs","initialDelay","backoffCount","id","ExponentialDelay","idCounter","delay","taskName","timerHandle","calculateNextBackoffMs","info","backoffMs","cancelFunc","cancel","debug","Math","random","backoff","pow","fudge","round","min","DEFAULT_MAX_RETRIES_FOR_GET_TOKEN","DEFAULT_MAX_BACKOFF_TIME_IN_MS","backoffs","maxBackOffTime","maxRetryDelayMs","maxRetriesForGetToken","proxyUrlRewrite","setTelemetryLogger","eventLogger","register","client","transports","_a","performRegistration","cachedRegistrationParams","unregister","unregisterRequest","registrarUrl","registrationId","method","mode","headers","extraRegistrationHeaders","accept","callRegistrar","cancelPendingRequests","keys","forEach","resendRegistration","eventName","registerRequest","payload","clientDescription","nodeId","startBackoff","initialRetryDelayMs","stopBackoff","getToken","claimsChallenge","retryCount","token","error_1","stringfiedError","err","cancelError_1","needFresh","supportedTokenTypes","wwwAuthenticateHeader","purpose","JSON","warn","_b","_c","cachedToken","stopwatch","req","_d","_e","error_2","canceledError_1","details","_f","_g","error_3","_h","setTokenHeader","clone","requestTimeoutMs","status","statusText","sendTelemetryEvent","ok","json","delete","tokenType","toLowerCase","set","usingLegacyTokenApi","properties","result_code","begin_timestamp","startTime","elapsed","duration","logEvent","clientEvent","require","__WEBPACK_EXTERNAL_MODULE_21__","Logger","USER_AUTHENTICATE_EVENT_NAME","FAILED_MESSAGE_ACK","UNHANDLED_MESSAGE_ACK","HANDLED_MESSAGE_ACK","CLIENT_VERSION","constants","TROUTER_INIT","TROUTER_READY_EVENT","TROUTER_READY_TIMEOUT","TROUTER_TOKEN_REQUEST","TROUTER_TOKEN_GET_SUCCEEDED","TROUTER_TOKEN_GET_FAILED","TROUTER_RECONNECTING","RENEWAL","NEW_CONNECTION","ENDPOINT_REGISTRATION_FAILED","TrouterState","UserActivityState","expirationTsInSec","getTime","ttlInSec","origin","pathname","CorrelationVector","calculateExpireTsInSec","calculateTtlInSec","correlationVector","base","createCorrelationVectorBase","extension","extend","increase","endChars","chars","charAt","floor","TrouterManagerState","UserActivityEventReason","ServerState","connectionId","connectedClientId","domId","unsecureUrl","c2cUrlBase","expirationTsSec","getRemainingTtlInSec","reconnectParams","safeToString","scae","toString","protocol","fallbackReason","kind","args","replace","reconnectUrl","serviceUrl","parseInt","reason","host","endsWith","redirectHost","substring","redirectUrlIfPresent","ensureNumber","reconnectParamsWithoutUrls","adaptUrl","isV4ConnectEvent","usedProtocolAfterFallback","usedProtocol","TrouterFsm","State","RegistrationState","logfunc","worker","incallModeEnabled","protocolSelector","state","Initial","autoReconnect","registrationState","getState","isActive","Allocating","Connected","Handshaking","Connecting","RetrievingToken","AnonymousConnecting","WebsocketAuthenticating","isConnecting","setState","showIgnored","stop","dontUnregister","isTerminalError","isIncallMode","exitIncallMode","resetTokenBackoff","cancelPendingRegistrationRequests","stopConnectionTimer","stopPingTimer","clearSentEventTimers","stopRegistrationTimer","stopSocketIo","sendDisconnectTelemetryEvent","Registered","Registering","RegisteringButResendPending","Unregistering","TerminalError","dispatchTerminalError","dispatchDisconnected","sendUnregisterRequest","onTokenReceived","startConnectionTimer","connectV4c","sendAllocateRequest","checkConnection","disconnectDetected","onPingInterval","onAllocationSucceed","dispatchUnregistered","startSocketIo","onAllocationFailed","unauthorized","cleanUpAndInitiateReconnect","allowCachedToken","onV4cException","onConnectingTimeout","onConnecting","onSocketConnect","sendV4cAuthenticationEvent","onConnectingFailed","onSocketDisconnect","disconnectReason","toTelemetryString","countDisconnectBeforeConnectionEstablishment","onTerminalError","claims","onTrouterConnected","sendUserActivityState","startPingTimer","dispatchConnected","shouldSkipRegistration","RegistrationDisabled","dispatchRegistered","sendRegisterRequest","onReconnectRequired","useConnectParamsFromCache","eventArgs","target","dispatchReconnectIsRequired","disableAutoReconnect","onDownstreamRequest","switchToIncallModeIfEnabled","dispatchDownstreamRequest","onTrouterMessageLost","messageLossIndicators","dispatchTrouterMessageLost","sendPingRequest","onPingResponseTimeout","onMissedResponse","onPingResponse","onRegistrationFailed","Retrying","startRegistrationRetryTimer","onRetryRegistration","onRegistrationSucceeded","startRegistrationTimer","onRegistrationNearExpiry","onUnregistrationDone","onResendRegistration","onIncallModeTimer","onSetNewUserActivityState","Modified","onActivityStateResponseTimeout","forceReconnect","onResponseHandlerName","event","enterIncallMode","restartIncallModeTimer","dispatchReconnecting","migrationHeader","Authorization","stack","TrouterConnection","ReconnectReason","io","cv","ua","hr","ackTimeoutMs","rewriteUrlForProxy","cvHeader","requestJson","cvCounter","parse","startTS","safeJsonNumber","safeJsonString","shortUrl","safeJsonRecord","replied","timedout","receivedCv","updateCvHeader","on","targetCallback","dataCallback","incrementCorrelationVector","defaultValue","jsonRecord","responseData","sendResponse","writeHead","write","chunk","end","timeoutTimerId","manager","initialUserActivityState","audienceSubscriptionState","WEBSOCKET_TRANSPORT_NAME","XHR_POLLING_TRANSPORT_NAME","AUDIENCE_SUBSCRIPTION_RESULT_ERROR","AUDIENCE_SUBSCRIPTION_RESULT_UNSUBSCRIBED","AUDIENCE_SUBSCRIPTION_RESULT_TIMEOUT","AUDIENCE_SUBSCRIPTION_RESULT_BAD_REQUEST","AUDIENCE_SUBSCRIPTION_STATE_QUERY_PARAM_REGEX","inIncallMode","connectionAttempt","isNavigatorOnline","onNavigatorOnlineStatusUpdateBound","onNavigatorOnlineStatusUpdate","bind","connectingErrorsInRow","unauthorizedErrorCount","pendingSentEventTimers","lastDisconnectReason","UNKNOWN_TRANSPORT","connectingErrorsThreshold","pendingAudienceSubscription","timeoutOptions","tokenBackoff","ExponentialBackoff","maxBackoffMs","clientID","window","location","hostname","clientInfo","safeString","connectionTracker","ConnectionTracker","getServerState","endpointId","clientCorrelationID","environment","applyConnectionTrackerOptions","incallModeTimeoutMs","fsm","useIncallMode","registration","fetchTimeoutMs","retryLimitOnTokenFetch","extraConnectionHeaders","registrarClient","registrarOptions","userActivityState","externalConnectParams","navigator","addEventListener","onLine","removeEventListener","close","configure","trouterUrl","urlChanged","Configuration","sendTelemetry","ClientEventName","CheckConnection","disableRegistrationsAndAutoReconnect","allocateResult","surl","connectionExpireTimestampInSecs","useCache","retryCounter","trackStart","tokenRequest","trackEnd","msg","trackError","canRetryTokenFetchRequest","requestFunction","connectionTimeoutMs","connectionTimeoutId","transportTypeName","pingTimeoutMs","pingTimerId","setInterval","clearPingResponseTimer","clearInterval","hasCustomRegistrationTtl","registrarTtlSec","getRegistrationTtl","ttl","isTtlReduced","registrationTimerId","timeForReregistrationSec","registrationRetryDelaySec","buildSocketIoUrlParams","userActivitySnapshot","audienceSubscriptionSnapshot","signatureData","connectparams","urlParams","tc","encodeURI","timeout","auth","epid","userActivity","encodeURIComponent","appendConnectedClientIds","buildQuery","ioOptions","Unknown","increaseCvAndGetEventObject","audienceSubscriptionStateSnapshot","reconnect","requestHeaders","headersFromToken","query","socketio","socket","connect","attachSocketIoHandlers","removeAllListeners","disconnect","errorStackToJson","onConnected","onRegistered","onUnregistered","ResponseData","onReconnecting","onReconnectIsRequired","onDisconnected","resetReconnectParamsOnErrorThreshold","sendProcessedDroppedIndicators","processedMessageLossEvent","droppedIndicators","sendDownstreamEvent","trackNewConnection","rp","expiration","se","connectParams","appendCorrelationIds","appendEndpointId","startTimestamp","responseStatusCode","responseSkypetokenDeprecated","allocateRequest","responseClaimsChallenge","contentType","startsWith","responseObj","onAllocationResponse","errorMessage","testNominalUrlConnectivity","trackProgress","search","check","cor_id","testRequest","Accept","text","pingResponseTimerId","emit","pongTimeoutMs","inputUrl","websocketUrl","buildV4cUrlParams","setUserActivityState","userActivityObject","changed","toEventJSON","onUserActivityStateAccepted","connected","sendUserActivityStateMultiple","setAudienceSubscriptionsAsync","timeoutInMs","setAudienceSubscriptionsInternalAsync","setAudienceSubscriptionsLongpollInternalAsync","previousAudienceSubscriptionState","setAudienceSubscriptionsPromise","setAudienceSubscriptionsUnsafeAsync","audienceSubscriptionEvent","buildAudienceSubscriptionsTimeoutResponse","hasTimedOut","onAudienceSubscriptionResult","onAudiencesSetResolved","previousSubscriptionState","currentResponse","currentAudienceResponse","subscribesToDifferentAudience","synthResponses","audiences","handleAudienceUnsubscribeLongpoll","audienceSetResolve","responses","clearAudienceSubscriptionStateQueryParam","find","r","audienceId","audienceSubscriptionModel","audienceSubscriptions","mapToSyntheticAudienceSubscriptionResponses","synthState","synthResponseStatus","map","audSub","responseStatus","expediteBackoff","expediteIfPending","appId","pnhAppId","aesKey","languageId","platform","templateKey","pnhTemplateKey","platformUIVersion","productContext","TROUTER","context","path","registrationTtl","Registration","span","errorMessageToString","Unregistration","clearSentEventTimer","Number","key","clearIncallModeTimerId","incallModeTimerId","incallTimeoutOptions","setMaxBackoffMs","serverClosed","trackDisconnected","props","clearConnectedInfo","forceReconnectDueToNoRegistration","onSocketConnecting","onSocketConnectFailed","rawReason","getSessionLength","DisconnectReason","fromRawReason","sessionLengthMs","duplicateDisconnectThresholdMs","onSocketReconnect","onSocketReconnectFailed","fromSocketIoEventData","onSocketReconnecting","onSocketError","errorObject","safeToStringOrType","onSocketMessage","chainIdLogText","chainId","urlPath","trackRequest","sendResponseError","v4cArgs","populateAndCacheReconnectParams","populateConnectionStateFields","connectedUrl","trackConnected","isNewUrl","onTrouterReconnect","ServerInitiated","onTrouterMessageLoss","onConnectionParametersUpdated","ccid","curlb","indexOf","pos","substr","increasePingResponseCount","components","join","isParamsOnly","includes","params","slice","sep","str","cd","latencyMS","send","sentTS","trackResponse","errorMsg","remaining","activityEvent","activityEventObject","timeoutReached","userActivitySecondResendDelayMs","registerSentEventTimer","userActivityResponseTimeoutMs","responseCallback","timerId","timerDescription","allocationTtl","isLower","mergeSettings","telemetrySettings","enable","disable","currentCounter","retryLimit","MessageHandlerRegistry","messageHandlers","handler","some","item","clear","active","handleMessage","resultCode","isHandled","safeExecuteHandle","messageHandler","exception","provider","forceRefresh","addCacheAsBackupTo","TrouterManager","AudienceSubscriptionState","UserActivityObject","getStateString","Active","Inactive","toEventObject","logFunc","listener","tokenTypeProtocolSelector","forceV4aProtocol","TrouterManagerFsm","baseEndpointUrl","processedMessageLoss","firstConnection","secondConnection","isInTerminalState","getInternalState","reportStateInfo","managerState","firstState","secondState","startFirstConnection","configuredTrouterManager","connection","getConnectionCache","connectionCache","startSecondConnection","stopFirstConnection","storedFirstConnection","stopSecondConnection","stopSecondConnectionDelayed","lingeringConnectionDelayMs","forceStopLingeringConnection","switchConnections","tmp","doesSecondConnectionExist","ss","connectionInfo","newEndpointUrl","clientId","connectionTtlSec","onTrouterDisconnected","dispatchRegistrationState","isRegistered","registrationStateCallback","expediteBackoffOnConnections","lastExpediteBackoffCallAt","expediteBackoffOnStartMinimumDelayMs","rsp","onTrouterRequest","onReconnectionRequired","onTrouterUserActivityStateAccepted","audienceSubscriptionsResponse","connectionParameters","setConnectionCache","indicators","filter","di","tag","etag","duplicates","messageLossProcessed","onGetTrouterConnectionCache","serialized","parsed","content","onSetTrouterConnectionCache","RegistrationEnforcer","connectionDependsOnRegistration","delayEventsUntilRegistered","TrouterUrlPromise","getPromise","pendingPromise","pendingPromiseResolveRef","pendingPromiseRejectRef","resolveUrl","resolveCallback","rejectUrl","rejectCallback","resetUrl","global","version","j","sockets","uri","util","parseUri","document","domain","port","uuri","uniqueUri","secure","merge","Socket","of","re","parts","exec","addition","chunkQuery","part","qs","split","kv","load","fn","readyState","pageLoaded","element","capture","attachEvent","xdomain","hasCORS","concat","defer","webkit","additional","deep","lastseen","seen","depth","prop","mixin","ctor","ctor2","inherit","isArray","Array","intersect","arr","arr2","longest","shortest","ret","toArray","enu","a","withCredentials","test","userAgent","EventEmitter","$events","addListener","once","self","removeListener","list","splice","listeners","parent","nativeJSON","parser","packets","reasons","advice","encodePacket","packet","type","endpoint","ack","data","adv","ev","ackId","encoded","encodePayload","decoded","decodePacket","match","regexp","pieces","opts","decodePayload","sessid","connectErrorCallback","isOpened","Transport","onData","clearCloseTimeout","connecting","reconnecting","setCloseTimeout","msgs","onPacket","setHeartbeatTimeout","onHeartbeat","onConnect","closeTimeout","onDisconnect","clearTimeouts","reopenTimeout","heartbeat","onOpen","onClose","prepareUrl","scheme","resource","ready","clearEventHandlers","Infinity","open","namespaces","buffer","doBuffer","disconnected","isXDomain","disconnectSync","SocketNamespace","publish","nsp","$emit","handshake","onError","getElementsByTagName","script","createElement","src","insertAt","parentNode","insertBefore","complete","removeChild","xhr","setRequestHeader","onreadystatechange","empty","responseText","getTransport","override","transport","xdomainCheck","sessionid","onHandshakeComplete","sid","connectTimeoutTimer","remainingTransports","tryNextTransport","heartbeatTimeout","heartbeatTimeoutTimer","setBuffer","wasConnecting","wasConnected","reconnectionAttempts","reconnectionTimer","maybeReconnect","reconnectionDelay","redoTransports","tryMultiple","maxAttempts","limit","flags","ackPackets","acks","namespace","lastArg","Flag","websocket","WS","MozWebSocket","WebSocket","onopen","onmessage","onclose","onerror","XHR","post","ackTimeoutTimer","onload","sendXHR","XDomainRequest","stateChange","usesXDomReq","socketProtocol","isXProtocol","XHRPolling","abort","Function","eval","webpackPolyfill","deprecate","paths","children","Properties","TrackerStep","stepName","operation","delta","ts","numberOfPingReplies","connectedTimestamp","transportType","connectionNumber","enabled","numberOfStepsToMaintain","logHealthCheckError","sendProgressTimeoutSecs","logSendPingError","trouter_js_client_connected","trouter_js_client_disconnected","trouter_js_client_error","trouter_js_client_progress","trouter_js_client_response","trouter_js_client_request","trouter_js_client_registration","trouter_js_client_unregistration","trouter_js_client_check_connection","steps","totalStepCount","beginTimestamp","eventLogSettings","connectedInfo","telemetrySender","sendProgress","Progress","cancelProgressTimer","progressTimeout","resetProgressSendTimer","timeoutSecs","setConnectedInfo","copyProperties","dest","source","eventProperties","progress","eventVersion","serverState","ttlInSecs","exc","createStep","addStep","progressHint","subOperation","totalSteps","connectionDuration","stepCount","connectionEstablishmentMs_Total","sessionLengthMS","Disconnected","hasError","requestID","httpMethod","bodyLength","requestTimeStamp","header","Request","responseTimestamp","responseCode","responseLength","Response","settings","max","k","newProgressTimeout","parsedReason","arg","waitStart","expectedWait","tolerance","actualWait","minimumWaitMs","gapDetectionSettings","backoffId","ms","previousCompleteTime","callback","shouldReset","backoffWaitStart","__spreadArray","to","from","pack","ar","LoggingManagerConsumer","wrapped","shouldConnectionDependOnRegistration","shouldHoldBackEvents","heldBackEvents","passIfRegisteredOrNotNeeded","fireHeldBackEvents","dropHeldBackEvents","flowTags","holdBackEvent","holdBackEvents","prefix","onEventAction","onEvent","jsonArgs","console","log","Switching","first","startingCfg","ecsCfg","TelemetryEnabled","ClientTelemetryEventEnabled","res","cfg","_j","_k","rewriteUrlForProxyCallback","trouterSettings","productName","sessionId","populateTelemetryOptions","telemetryConfig","TrouterConnectionUrl","trouterServiceUrl","registrarServiceUrl","pnhTemplate","pnhProductContext","pnhContext","maxRegistrationTimeInMs","trouterConnectTimeoutInMs","registrationStateCallbackForAcsDoNotUse","toJSON","existingUrl","newBase","schemaSepPos","pathSepPos","requestTime","toISOString","previousToken","replaceTrouterUrlBase","getTrouterServiceVersion","createTrouterService","TrouterService","stateChangedListeners","trouterUrlPromise","skypeTokenProvider","authTokenProvider","disableInternalSkypeTokenCache","trouterCfg","populateTrouterOptions","internalEnableV4cProtocol","authTokenProviderProtector","skypeTokenAdapter","trouterServer","pendingActivityState","setEcsConfig","fullEcsData","registerListener","unregisterListener","endpointUrl","notifyStateChanged","bestPath","tryMessageHandlers","setAudienceSubscriptions","getTrouterUrlAsync","onStateChanged","wrappedCallback","offStateChanged","wrapper","sizeBeforeRemoval","addCallback","removeCallback","index","registerMessageHandler","clearMessageHandlers","eventId","evt","rawBody","responseHeaders","responseBody","URL","createHmac","createHash","v4RandomUUID","core_util_1","uuid_1","constants_1","base64.decodeString","base64.encodeByteArray","process.stderr","EOL","coreLogger","process","process.versions","os.arch","os.type","os.release","Readable","StandardAbortMessage","require$$0","https","http","net","https_1","agent_base_1","url_1","tls","parse_proxy_response_1","events_1","HttpProxyAgent","HttpsProxyAgent","inspect","Transform","http.request","https.request","http.globalAgent","http.Agent","https.globalAgent","https.Agent","zlib.createGunzip","zlib.createInflate","coreClientLogger","getChallenge","core_rest_pipeline_1","TrouterUtils_1","tstrouter_1","TrouterSettings_1"],"mappings":"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"}